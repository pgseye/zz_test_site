auc_ci <- ci.auc(roc_obj)
# Create label
auc_label <- paste0("AUC = ", round(auc(roc_obj), 3),
"\n95% CI: ", round(auc_ci[1], 3),
" - ", round(auc_ci[3], 3))
# Find optimal threshold (Youden's index)
best_coords <- coords(roc_obj, "best", ret = c("threshold", "sensitivity", "specificity"))
# Plot
ggroc(roc_obj) +
geom_ribbon(data = ci_data,
aes(x = specificity, ymin = lower, ymax = upper),
fill = "#1c61b6", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = best_coords$specificity, y = best_coords$sensitivity,
size = 3, color = "red") +
annotate("text", x = 0.25, y = 0.25, label = auc_label, hjust = 0) +
annotate("text", x = best_coords$specificity - 0.1,
y = best_coords$sensitivity + 0.05,
label = paste("Threshold =", round(best_coords$threshold, 3))) +
theme_minimal()
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = specificity, ymin = lower, ymax = upper),
fill = "#1c61b6", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = best_coords$specificity, y = best_coords$sensitivity,
size = 3, color = "red") +
annotate("text", x = 0.25, y = 0.25, label = auc_label, hjust = 0) +
annotate("text", x = best_coords$specificity - 0.1,
y = best_coords$sensitivity + 0.05,
label = paste("Threshold =", round(best_coords$threshold, 3))) +
theme_minimal()
# Create ROC object with CI
roc_obj <- roc(data$disease, data$test_values)
# Calculate CI for sensitivity across specificities
ci_obj <- ci.se(roc_obj,
specificities = seq(0, 1, 0.05))
# Extract CI data for plotting - CONVERT TO 1-SPECIFICITY
ci_data <- data.frame(
fpr = 1 - as.numeric(rownames(ci_obj)),  # 1 - specificity
lower = ci_obj[, 1],
upper = ci_obj[, 3]
)
# Calculate AUC CI
auc_ci <- ci.auc(roc_obj)
# Create label
auc_label <- paste0("AUC = ", round(auc(roc_obj), 3),
"\n95% CI: ", round(auc_ci[1], 3),
" - ", round(auc_ci[3], 3))
# Find optimal threshold (Youden's index)
best_coords <- coords(roc_obj, "best", ret = c("threshold", "sensitivity", "specificity"))
# Plot with legacy axes
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.25, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity + 0.1,  # Adjust position
y = best_coords$sensitivity + 0.05,
label = paste("Threshold =", round(best_coords$threshold, 3))) +
theme_minimal()
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity + 0.4,  # Adjust position
y = best_coords$sensitivity + 0.05,
label = paste("Threshold =", round(best_coords$threshold, 3))) +
theme_minimal()
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity - 0.1,  # Adjust position
y = best_coords$sensitivity + 0.05,
label = paste("Threshold =", round(best_coords$threshold, 3))) +
theme_minimal()
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity - 0.05,  # Adjust position
y = best_coords$sensitivity + 0.05,
label = paste("Threshold =", round(best_coords$threshold, 3))) +
theme_minimal()
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6AA", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity - 0.05,  # Adjust position
y = best_coords$sensitivity + 0.05,
label = paste("Threshold =", round(best_coords$threshold, 3))) +
theme_minimal()
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6AA", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity - 0.05,  # Adjust position
y = best_coords$sensitivity + 0.05,
label = paste("Threshold =", round(best_coords$threshold, 3))) +
theme_minimal()
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6AA", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity - 0.05,  # Adjust position
y = best_coords$sensitivity + 0.05,
label = paste("Threshold =", round(best_coords$threshold, 3))) +
theme_minimal()
# Extended ROC Plot
roc_obj <- plot.roc(data$disease, data$test_values,
main = "Confidence intervals", percent = TRUE,
ci = TRUE, # compute AUC (of AUC by default)
print.auc = TRUE) # print the AUC (will contain the CI)
ci_obj <- ci.se(roc_obj, # CI of sensitivity
specificities = seq(0, 100, 5)) # over a select set of specificities
plot(ci_obj, type = "shape", col = "#1c61b6AA") # plot as a blue shape
plot(ci(roc_obj, of = "thresholds", thresholds = "best")) # add one threshold
# Compute ROC object
roc_obj <- roc(data$disease, data$test_values)
# Basic ROC Plot
plot(roc_obj)
# Extended ROC Plot
roc_obj <- plot.roc(data$disease, data$test_values,
main = "Confidence intervals", percent = TRUE,
ci = TRUE, # compute AUC (of AUC by default)
print.auc = TRUE) # print the AUC (will contain the CI)
ci_obj <- ci.se(roc_obj, # CI of sensitivity
specificities = seq(0, 100, 5)) # over a select set of specificities
plot(ci_obj, type = "shape", col = "#1c61b6AA") # plot as a blue shape
plot(ci(roc_obj, of = "thresholds", thresholds = "best")) # add one threshold
auc(roc_obj)
coords(roc_obj, x = "best", best.method = "youden")
# ggplot2 style plot
# Create ROC object with CI
roc_obj <- roc(data$disease, data$test_values)
# Calculate CI for sensitivity across specificities
ci_obj <- ci.se(roc_obj,
specificities = seq(0, 1, 0.05))
# Extract CI data for plotting - CONVERT TO 1-SPECIFICITY
ci_data <- data.frame(
fpr = 1 - as.numeric(rownames(ci_obj)),  # 1 - specificity
lower = ci_obj[, 1],
upper = ci_obj[, 3]
)
# Calculate AUC CI
auc_ci <- ci.auc(roc_obj)
# Create label
auc_label <- paste0("AUC = ", round(auc(roc_obj), 3),
"\n95% CI: ", round(auc_ci[1], 3),
" - ", round(auc_ci[3], 3))
# Find optimal threshold (Youden's index)
best_coords <- coords(roc_obj, "best", ret = c("threshold", "sensitivity", "specificity"))
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6AA", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity - 0.05,  # Adjust position
y = best_coords$sensitivity + 0.05,
label = paste("Threshold =", round(best_coords$threshold, 3))) +
theme_minimal()
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6AA", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity - 0.05,  # Adjust position
y = best_coords$sensitivity + 0.05,
label = paste("Threshold =", round(best_coords$threshold, 3))) +
theme_bw(base_size = 20)
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6AA", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity + 0.05,  # Adjust position
y = best_coords$sensitivity + 0.05,
label = paste("Threshold =", round(best_coords$threshold, 3))) +
theme_bw(base_size = 20)
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6AA", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity + 0.1,  # Adjust position
y = best_coords$sensitivity + 0.05,
label = paste("Threshold =", round(best_coords$threshold, 3))) +
theme_bw(base_size = 20)
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6AA", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity + 0.12,  # Adjust position
y = best_coords$sensitivity + 0.05,
label = paste("Threshold =", round(best_coords$threshold, 3))) +
theme_bw(base_size = 20)
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6AA", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity + 0.12,  # Adjust position
y = best_coords$sensitivity + 0.1,
label = paste("Threshold =", round(best_coords$threshold, 3))) +
theme_bw(base_size = 20)
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6AA", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity + 0.12,  # Adjust position
y = best_coords$sensitivity - 0.1,
label = paste("Threshold =", round(best_coords$threshold, 3))) +
theme_bw(base_size = 20)
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6AA", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity + 0.12,  # Adjust position
y = best_coords$sensitivity - 0.07,
label = paste("Threshold =", round(best_coords$threshold, 3))) +
theme_bw(base_size = 20)
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6AA", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity + 0.12,  # Adjust position
y = best_coords$sensitivity - 0.075,
label = paste("Threshold =", round(best_coords$threshold, 3))) +
theme_bw(base_size = 20)
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6AA", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity + 0.12,  # Adjust position
y = best_coords$sensitivity - 0.09,
label = paste("Threshold =", round(best_coords$threshold, 3))) +
theme_bw(base_size = 20)
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6AA", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity + 0.12,  # Adjust position
y = best_coords$sensitivity - 0.06,
label = paste("Threshold =", round(best_coords$threshold, 3))) +
theme_bw(base_size = 20)
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6AA", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity + 0.12,  # Adjust position
y = best_coords$sensitivity - 0.06,
label = paste("Threshold =", round(best_coords$threshold, 2))) +
theme_bw(base_size = 20)
test <-  coords(roc_obj, ret = c("threshold", "tp", "fp", "tpr", "fpr"))
test
test <-  test |>
arrange(threshold)
test
test <-  test |>
arrange(desc(threshold))
test
data
library(pROC)
library(kableExtra)
library(tidyverse)
set.seed(123)
# Simulate data
n <- 50
# Disease status: 0 = healthy, 1 = diseased
disease <- rbinom(n, size = 1, prob = 0.4)
# Continuous test: diseased group has higher values
test_values <- rnorm(n, mean = 0 + 2*disease, sd = 1)
data <- data.frame(disease, test_values)
# Peek at data
head(data) |>
kable(align = "c", digits = 2)
library(pROC)
library(kableExtra)
library(tidyverse)
set.seed(123)
# Simulate data
n <- 50
# Disease status: 0 = healthy, 1 = diseased
disease <- rbinom(n, size = 1, prob = 0.4)
# Continuous test: diseased group has higher values
test_values <- rnorm(n, mean = 0 + 2*disease, sd = 1)
data <- data.frame(disease, test_values) |>
arrange(desc(test_values))
# Peek at data
head(data) |>
kable(align = "c", digits = 2)
coord_data <-  coords(roc_obj, ret = c("threshold", "tp", "fp", "tpr", "fpr"))
coord_data <-  coord_data |>
arrange(desc(threshold)) |>
slice(-1)
coord_data
View(coord_data)
library(pROC)
library(kableExtra)
library(tidyverse)
set.seed(123)
# Simulate data
n <- 50
# Disease status: 0 = healthy, 1 = diseased
disease <- rbinom(n, size = 1, prob = 0.4)
# Continuous test: diseased group has higher values
test_values <- rnorm(n, mean = 0 + 2*disease, sd = 1)
sim_data <- data.frame(disease, test_values) |>
arrange(desc(test_values))
# Peek at data
head(sim_data) |>
kable(align = "c", digits = 2)
coord_data <-  coords(roc_obj, ret = c("threshold", "tp", "fp", "tpr", "fpr"))
coord_data <-  coord_data |>
arrange(desc(threshold)) |>
slice(-1)
View(sim_data)
coord_data <-  cbind(coord_data, sim_data)
coord_data <-  cbind(coord_data, sim_data) |>
select(test_values, disease, tp, fp, tpr, fpr)
# Calculate threshold data
coord_data <-  coords(roc_obj, ret = c("threshold", "tp", "fp", "tpr", "fpr"))
# Merge in actual data
coord_data <-  coord_data |>
arrange(desc(threshold)) |>
slice(-1)
coord_data <-  cbind(coord_data, sim_data) |>
select(test_values, disease, tp, fp, tpr, fpr)
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6AA", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity + 0.12,  # Adjust position
y = best_coords$sensitivity - 0.06,
label = paste("Threshold =", round(best_coords$threshold, 2))) +
theme_bw(base_size = 20)
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6AA", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity + 0.12,  # Adjust position
y = best_coords$sensitivity - 0.06,
label = paste("Threshold =", round(best_coords$threshold, 2))) +
xlab("FPR") + ylab("TPR") +
theme_bw(base_size = 20)
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6AA", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity + 0.12,  # Adjust position
y = best_coords$sensitivity - 0.06,
label = paste("Threshold =", round(best_coords$threshold, 2))) +
xlab("FPR (1 - Specificity)") + ylab("TPR (Sensitivity)") +
theme_bw(base_size = 20)
coord_data
table(coord_data$disease)
# Basic ROC Plot
plot(roc_obj)
table(sim_data$disease)
plot1 <-  coord_data |>
slice(1)
ggplot(pplot1, aes(fpr, tpr)) +
geom_point(size = 3) +
xlab("FPR (1 - Specificity)") + ylab("TPR (Sensitivity)") +
theme_bw(base_size = 20)
ggplot(plot1, aes(fpr, tpr)) +
geom_point(size = 3) +
xlab("FPR (1 - Specificity)") + ylab("TPR (Sensitivity)") +
theme_bw(base_size = 20)
ggplot(plot1, aes(fpr, tpr)) +
geom_point(size = 3) +
xlab("FPR (1 - Specificity)") + ylab("TPR (Sensitivity)") +
scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +
theme_bw(base_size = 20)
plot1 <-  coord_data |>
slice(1)
ggplot(plot1, aes(fpr, tpr)) +
geom_point(size = 3) +
xlab("FPR (1 - Specificity)") + ylab("TPR (Sensitivity)") +
scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +
theme_bw(base_size = 20)
coord_data
plot1 <-  coord_data |>
slice(1:2)
ggplot(plot1, aes(fpr, tpr)) +
geom_point(size = 3) +
xlab("FPR (1 - Specificity)") + ylab("TPR (Sensitivity)") +
scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +
theme_bw(base_size = 20)
9/20
1/30
11$(1/35)
11^(1/35)
11000 *1.071^20
# Basic ROC Plot
plot(roc_obj)
# Create ROC object with CI
roc_obj <- roc(sim_data$disease, sim_data$test_values)
# Calculate CI for sensitivity across specificities
ci_obj <- ci.se(roc_obj,
specificities = seq(0, 1, 0.05))
# Extract CI data for plotting - CONVERT TO 1-SPECIFICITY
ci_data <- data.frame(
fpr = 1 - as.numeric(rownames(ci_obj)),  # 1 - specificity
lower = ci_obj[, 1],
upper = ci_obj[, 3]
)
# Calculate AUC CI
auc_ci <- ci.auc(roc_obj)
# Create label
auc_label <- paste0("AUC = ", round(auc(roc_obj), 3),
"\n95% CI: ", round(auc_ci[1], 3),
" - ", round(auc_ci[3], 3))
# Find optimal threshold (Youden's index)
best_coords <- coords(roc_obj, "best", ret = c("threshold", "sensitivity", "specificity"))
# Plot
ggroc(roc_obj, legacy.axes = TRUE) +
geom_ribbon(data = ci_data,
aes(x = fpr, ymin = lower, ymax = upper),  # Use fpr (1-specificity)
fill = "#1c61b6AA", alpha = 0.3, inherit.aes = FALSE) +
annotate("point", x = 1 - best_coords$specificity, y = best_coords$sensitivity,  # Convert here too
size = 3, color = "red") +
annotate("text", x = 0.75, y = 0.5, label = auc_label, hjust = 0) +
annotate("text", x = 1 - best_coords$specificity + 0.12,  # Adjust position
y = best_coords$sensitivity - 0.06,
label = paste("Threshold =", round(best_coords$threshold, 2))) +
xlab("FPR (1 - Specificity)") + ylab("TPR (Sensitivity)") +
theme_bw(base_size = 20)
9/20
