newdf2 <-  newdf2 |>
mutate(pred_logodds = predict(mod2, newdata = newdf2))
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_logodds)) +
geom_point(size = 3) +
geom_line(data = newdf2, aes(x = age, y = pred_logodds)) +
scale_y_continuous(limits = c(-2, 0), breaks = seq(-2, 0, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age (yrs)") + ylab("Predicted Log-odds of Low Birthweight") +
theme_bw(base_size = 20)
anova(mod, mod2)
#| message: false
#| warning: false
library(tidyverse)
library(splines)
library(gtsummary)
data(birthwt, package = "MASS")
# Model
mod <-  glm(low ~ age, family = "binomial", data = subset(birthwt, age < 40))
tbl_regression(mod, intercept = T)
# Categorise maternal age into 5 quantiles (could make this more or less)
birthwt <- birthwt |>
mutate(age_5 = cut_number(age, 5))
# Proportion of women with low birthweight babies in each quantile of maternal age
grouped_dat <- birthwt |>
group_by(age_5) |>
count(low) |>
pivot_wider(names_from = low,
values_from = n) |>
mutate(obs_props = `1`/(`0` + `1`),
obs_logodds = qlogis(obs_props))
# Take the middle age of each quantile range and bind to data
vec = c(16.5, 20, 22.5, 26, 36.5)
grouped_dat <-  cbind("age_5_mid" = vec, grouped_dat)
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_logodds)) +
geom_point(size = 3) +
scale_y_continuous(limits = c(-2, 0), breaks = seq(-2, 0, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age") + ylab("Log-odds of Low Birthweight") +
theme_bw(base_size = 20)
newdf <-  expand.grid(age = seq(15, 45, by = 5))
newdf <-  newdf |>
mutate(pred_logodds = predict(mod, newdata = newdf))
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_logodds)) +
geom_point(size = 3) +
geom_line(data = newdf, aes(x = age, y = pred_logodds)) +
scale_y_continuous(limits = c(-2, 0), breaks = seq(-2, 0, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age (yrs)") + ylab("Predicted Log-odds of Low Birthweight") +
theme_bw(base_size = 20)
newdf <-  expand.grid(age = seq(15, 45, by = 5))
newdf <-  newdf |>
mutate(pred_probs = predict(mod, newdata = newdf, type = "response"))
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_props)) +
geom_point(size = 3) +
geom_line(data = newdf, aes(x = age, y = pred_probs)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age (yrs)") + ylab("Predicted Probability of Low Birthweight") +
theme_bw(base_size = 20)
# Model
mod2 <-  glm(low ~ ns(age,3), family = "binomial", data = subset(birthwt, age < 40))
tbl_regression(mod2, intercept = T)
#| message: false
#| warning: false
newdf2 <-  expand.grid(age = seq(15, 45, by = 0.5))
newdf2 <-  newdf2 |>
mutate(pred_logodds = predict(mod2, newdata = newdf2))
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_logodds)) +
geom_point(size = 3) +
geom_line(data = newdf2, aes(x = age, y = pred_logodds)) +
scale_y_continuous(limits = c(-2, 0), breaks = seq(-2, 0, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age (yrs)") + ylab("Predicted Log-odds of Low Birthweight") +
theme_bw(base_size = 20)
#| message: false
#| warning: false
newdf2 <-  expand.grid(age = seq(15, 45, by = 0.5))
newdf2 <-  newdf2 |>
mutate(pred_probs = predict(mod2, newdata = newdf2, type = "response"))
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_props)) +
geom_point(size = 3) +
geom_line(data = newdf2, aes(x = age, y = pred_probs)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age (yrs)") + ylab("Predicted Probability of Low Birthweight") +
theme_bw(base_size = 20)
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_props)) +
geom_point(size = 3) +
geom_line(data = newdf2, aes(x = age, y = pred_probs)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age (yrs)") + ylab("Predicted Probability of Low Birthweight") +
theme_bw(base_size = 20)
#| message: false
#| warning: false
library(tidyverse)
library(splines)
library(gtsummary)
data(birthwt, package = "MASS")
# Model
mod <-  glm(low ~ age, family = "binomial", data = subset(birthwt, age < 40))
tbl_regression(mod, intercept = T)
# Categorise maternal age into 5 quantiles (could make this more or less)
birthwt <- birthwt |>
mutate(age_5 = cut_number(age, 5))
# Proportion of women with low birthweight babies in each quantile of maternal age
grouped_dat <- birthwt |>
group_by(age_5) |>
count(low) |>
pivot_wider(names_from = low,
values_from = n) |>
mutate(obs_props = `1`/(`0` + `1`),
obs_logodds = qlogis(obs_props))
# Take the middle age of each quantile range and bind to data
vec = c(16.5, 20, 22.5, 26, 36.5)
grouped_dat <-  cbind("age_5_mid" = vec, grouped_dat)
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_logodds)) +
geom_point(size = 3) +
scale_y_continuous(limits = c(-2, 0), breaks = seq(-2, 0, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age") + ylab("Log-odds of Low Birthweight") +
theme_bw(base_size = 20)
newdf <-  expand.grid(age = seq(15, 45, by = 5))
newdf <-  newdf |>
mutate(pred_logodds = predict(mod, newdata = newdf))
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_logodds)) +
geom_point(size = 3) +
geom_line(data = newdf, aes(x = age, y = pred_logodds)) +
scale_y_continuous(limits = c(-2, 0), breaks = seq(-2, 0, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age (yrs)") + ylab("Predicted Log-odds of Low Birthweight") +
theme_bw(base_size = 20)
newdf <-  expand.grid(age = seq(15, 45, by = 5))
newdf <-  newdf |>
mutate(pred_probs = predict(mod, newdata = newdf, type = "response"))
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_props)) +
geom_point(size = 3) +
geom_line(data = newdf, aes(x = age, y = pred_probs)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age (yrs)") + ylab("Predicted Probability of Low Birthweight") +
theme_bw(base_size = 20)
# Model
mod2 <-  glm(low ~ ns(age,3), family = "binomial", data = subset(birthwt, age < 40))
tbl_regression(mod2, intercept = T)
#| message: false
#| warning: false
newdf2 <-  expand.grid(age = seq(15, 45, by = 0.5))
newdf2 <-  newdf2 |>
mutate(pred_logodds = predict(mod2, newdata = newdf2))
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_logodds)) +
geom_point(size = 3) +
geom_line(data = newdf2, aes(x = age, y = pred_logodds)) +
scale_y_continuous(limits = c(-2, 0), breaks = seq(-2, 0, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age (yrs)") + ylab("Predicted Log-odds of Low Birthweight") +
theme_bw(base_size = 20)
#| message: false
#| warning: false
newdf2 <-  expand.grid(age = seq(15, 45, by = 0.5))
newdf2 <-  newdf2 |>
mutate(pred_probs = predict(mod2, newdata = newdf2, type = "response"))
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_props)) +
geom_point(size = 3) +
geom_line(data = newdf2, aes(x = age, y = pred_probs)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age (yrs)") + ylab("Predicted Probability of Low Birthweight") +
theme_bw(base_size = 20)
#| message: false
library(lme4)
library(ggplot2)
library(plotly)
# Load data
data("sleepstudy")
# Model
mod <- lmer(Reaction ~ Days + (Days | Subject), data = sleepstudy)
# Predict
sleepstudy$mod_pred_fix <- predict(mod, re.form = NA) # predict fixed effects
sleepstudy$mod_pred_ran <- predict(mod) # predict random effects
# View data
head(sleepstudy, 10)
View(sleepstudy)
#| message: false
#| warning: false
library(tidyverse)
library(splines)
library(gtsummary)
data(birthwt, package = "MASS")
# Model
mod <-  glm(low ~ age, family = "binomial", data = subset(birthwt, age < 40))
tbl_regression(mod, intercept = T)
# Categorise maternal age into 5 quantiles (could make this more or less)
birthwt <- birthwt |>
mutate(age_5 = cut_number(age, 5))
# Proportion of women with low birthweight babies in each quantile of maternal age
grouped_dat <- birthwt |>
group_by(age_5) |>
count(low) |>
pivot_wider(names_from = low,
values_from = n) |>
mutate(obs_props = `1`/(`0` + `1`),
obs_logodds = qlogis(obs_props))
# Take the middle age of each quantile range and bind to data
vec = c(16.5, 20, 22.5, 26, 36.5)
grouped_dat <-  cbind("age_5_mid" = vec, grouped_dat)
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_logodds)) +
geom_point(size = 3) +
scale_y_continuous(limits = c(-2, 0), breaks = seq(-2, 0, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age") + ylab("Log-odds of Low Birthweight") +
theme_bw(base_size = 20)
newdf <-  expand.grid(age = seq(15, 45, by = 5))
newdf <-  newdf |>
mutate(pred_logodds = predict(mod, newdata = newdf))
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_logodds)) +
geom_point(size = 3) +
geom_line(data = newdf, aes(x = age, y = pred_logodds)) +
scale_y_continuous(limits = c(-2, 0), breaks = seq(-2, 0, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age (yrs)") + ylab("Predicted Log-odds of Low Birthweight") +
theme_bw(base_size = 20)
newdf <-  expand.grid(age = seq(15, 45, by = 5))
newdf <-  newdf |>
mutate(pred_probs = predict(mod, newdata = newdf, type = "response"))
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_props)) +
geom_point(size = 3) +
geom_line(data = newdf, aes(x = age, y = pred_probs)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age (yrs)") + ylab("Predicted Probability of Low Birthweight") +
theme_bw(base_size = 20)
# Model
mod2 <-  glm(low ~ ns(age,3), family = "binomial", data = subset(birthwt, age < 40))
tbl_regression(mod2, intercept = T)
# Model
mod2 <-  glm(low ~ ns(age,2), family = "binomial", data = subset(birthwt, age < 40))
tbl_regression(mod2, intercept = T)
#| message: false
#| warning: false
newdf2 <-  expand.grid(age = seq(15, 45, by = 0.5))
newdf2 <-  newdf2 |>
mutate(pred_logodds = predict(mod2, newdata = newdf2))
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_logodds)) +
geom_point(size = 3) +
geom_line(data = newdf2, aes(x = age, y = pred_logodds)) +
scale_y_continuous(limits = c(-2, 0), breaks = seq(-2, 0, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age (yrs)") + ylab("Predicted Log-odds of Low Birthweight") +
theme_bw(base_size = 20)
#| message: false
#| warning: false
newdf2 <-  expand.grid(age = seq(15, 45, by = 0.5))
newdf2 <-  newdf2 |>
mutate(pred_probs = predict(mod2, newdata = newdf2, type = "response"))
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_props)) +
geom_point(size = 3) +
geom_line(data = newdf2, aes(x = age, y = pred_probs)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age (yrs)") + ylab("Predicted Probability of Low Birthweight") +
theme_bw(base_size = 20)
# Model
mod2 <-  glm(low ~ ns(age,1), family = "binomial", data = subset(birthwt, age < 40))
tbl_regression(mod2, intercept = T)
#| message: false
#| warning: false
newdf2 <-  expand.grid(age = seq(15, 45, by = 0.5))
newdf2 <-  newdf2 |>
mutate(pred_logodds = predict(mod2, newdata = newdf2))
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_logodds)) +
geom_point(size = 3) +
geom_line(data = newdf2, aes(x = age, y = pred_logodds)) +
scale_y_continuous(limits = c(-2, 0), breaks = seq(-2, 0, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age (yrs)") + ylab("Predicted Log-odds of Low Birthweight") +
theme_bw(base_size = 20)
#| message: false
#| warning: false
library(tidyverse)
library(splines)
library(gtsummary)
data(birthwt, package = "MASS")
# Model
mod <-  glm(low ~ age, family = "binomial", data = subset(birthwt, age < 40))
tbl_regression(mod, intercept = T)
# Categorise maternal age into 5 quantiles (could make this more or less)
birthwt <- birthwt |>
mutate(age_5 = cut_number(age, 5))
# Proportion of women with low birthweight babies in each quantile of maternal age
grouped_dat <- birthwt |>
group_by(age_5) |>
count(low) |>
pivot_wider(names_from = low,
values_from = n) |>
mutate(obs_props = `1`/(`0` + `1`),
obs_logodds = qlogis(obs_props))
# Take the middle age of each quantile range and bind to data
vec = c(16.5, 20, 22.5, 26, 36.5)
grouped_dat <-  cbind("age_5_mid" = vec, grouped_dat)
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_logodds)) +
geom_point(size = 3) +
scale_y_continuous(limits = c(-2, 0), breaks = seq(-2, 0, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age") + ylab("Log-odds of Low Birthweight") +
theme_bw(base_size = 20)
newdf <-  expand.grid(age = seq(15, 45, by = 5))
newdf <-  newdf |>
mutate(pred_logodds = predict(mod, newdata = newdf))
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_logodds)) +
geom_point(size = 3) +
geom_line(data = newdf, aes(x = age, y = pred_logodds)) +
scale_y_continuous(limits = c(-2, 0), breaks = seq(-2, 0, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age (yrs)") + ylab("Predicted Log-odds of Low Birthweight") +
theme_bw(base_size = 20)
newdf <-  expand.grid(age = seq(15, 45, by = 5))
newdf <-  newdf |>
mutate(pred_probs = predict(mod, newdata = newdf, type = "response"))
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_props)) +
geom_point(size = 3) +
geom_line(data = newdf, aes(x = age, y = pred_probs)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age (yrs)") + ylab("Predicted Probability of Low Birthweight") +
theme_bw(base_size = 20)
# Model
mod2 <-  glm(low ~ ns(age,2), family = "binomial", data = subset(birthwt, age < 40))
tbl_regression(mod2, intercept = T)
#| message: false
#| warning: false
newdf2 <-  expand.grid(age = seq(15, 45, by = 0.5))
newdf2 <-  newdf2 |>
mutate(pred_logodds = predict(mod2, newdata = newdf2))
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_logodds)) +
geom_point(size = 3) +
geom_line(data = newdf2, aes(x = age, y = pred_logodds)) +
scale_y_continuous(limits = c(-2, 0), breaks = seq(-2, 0, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age (yrs)") + ylab("Predicted Log-odds of Low Birthweight") +
theme_bw(base_size = 20)
#| message: false
#| warning: false
newdf2 <-  expand.grid(age = seq(15, 45, by = 0.5))
newdf2 <-  newdf2 |>
mutate(pred_probs = predict(mod2, newdata = newdf2, type = "response"))
ggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_props)) +
geom_point(size = 3) +
geom_line(data = newdf2, aes(x = age, y = pred_probs)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +
scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +
xlab("Maternal Age (yrs)") + ylab("Predicted Probability of Low Birthweight") +
theme_bw(base_size = 20)
fixef(mod)
#| message: false
library(lme4)
library(ggplot2)
library(gtsummary)
# Load data
data("sleepstudy")
# Model
mod <- lmer(Reaction ~ Days + (Days | Subject), data = sleepstudy)
# Predict
sleepstudy$mod_pred_fix <- predict(mod, re.form = NA) # predict fixed effects
sleepstudy$mod_pred_ran <- predict(mod) # predict random effects
# View data
head(sleepstudy, 10)
summary(mod)
fixef(mod)
ranef(mod)
# Plot
sleepstudy |>
ggplot(aes(x = Days, y = Reaction, color = factor(Subject))) +
geom_line(aes(x = Days, y = mod_pred_ran)) +
geom_line(aes(x = Days, y = mod_pred_fix), linewidth = 2, color = "blue") +
geom_point(alpha = 0.5) +
xlab("Time (days)") + ylab("Reaction Time (ms)") +
guides(color = "none") +
theme_bw(base_size = 15)
# Plot
sleepstudy |>
ggplot(aes(x = Days, y = Reaction, color = factor(Subject))) +
geom_line(aes(x = Days, y = mod_pred_ran)) +
geom_line(aes(x = Days, y = mod_pred_fix), linewidth = 2, color = "blue") +
geom_point(alpha = 0.5) +
xlab("Time (days)") + ylab("Reaction Time (ms)") +
theme_bw(base_size = 15)
2.2585509+9.1989758
273.3299-11.45753
10.46729 +251.40510
sleepstudy |>
ggplot(aes(x = Days, y = Reaction)) +
geom_line(aes(x = Days, y = mod_pred_ran)) +
geom_line(aes(x = Days, y = mod_pred_fix), linewidth = 2, color = "blue") +
scale_y_continuous(limits = c(200, 500), breaks = seq(200, 500, by = 50)) +
scale_x_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 1)) +
geom_point(alpha = 0.5) +
facet_wrap(~Subject) +
xlab("Time (days)") + ylab("Reaction Time (ms)") +
theme_bw(base_size = 15)
sleepstudy |>
ggplot(aes(x = Days, y = Reaction)) +
geom_line(aes(x = Days, y = mod_pred_ran)) +
geom_line(aes(x = Days, y = mod_pred_fix), linewidth = 1, color = "blue") +
scale_y_continuous(limits = c(200, 500), breaks = seq(200, 500, by = 50)) +
scale_x_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 1)) +
geom_point(alpha = 0.5) +
facet_wrap(~Subject) +
xlab("Time (days)") + ylab("Reaction Time (ms)") +
theme_bw(base_size = 15)
sleepstudy |>
ggplot(aes(x = Days, y = Reaction)) +
geom_line(aes(x = Days, y = mod_pred_ran), linewidth = 1, color = "yellow") +
geom_line(aes(x = Days, y = mod_pred_fix), linewidth = 1, color = "blue") +
scale_y_continuous(limits = c(200, 500), breaks = seq(200, 500, by = 50)) +
scale_x_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 1)) +
geom_point(alpha = 0.5) +
facet_wrap(~Subject) +
xlab("Time (days)") + ylab("Reaction Time (ms)") +
theme_bw(base_size = 15)
sleepstudy |>
ggplot(aes(x = Days, y = Reaction)) +
geom_line(aes(x = Days, y = mod_pred_ran), linewidth = 1, color = "green") +
geom_line(aes(x = Days, y = mod_pred_fix), linewidth = 1, color = "blue") +
scale_y_continuous(limits = c(200, 500), breaks = seq(200, 500, by = 50)) +
scale_x_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 1)) +
geom_point(alpha = 0.5) +
facet_wrap(~Subject) +
xlab("Time (days)") + ylab("Reaction Time (ms)") +
theme_bw(base_size = 15)
sleepstudy |>
ggplot(aes(x = Days, y = Reaction)) +
geom_line(aes(x = Days, y = mod_pred_ran), linewidth = 1, color = "green") +
geom_line(aes(x = Days, y = mod_pred_fix), linewidth = 1, color = "blue") +
scale_y_continuous(limits = c(200, 500), breaks = seq(200, 500, by = 100)) +
scale_x_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 2)) +
geom_point(alpha = 0.5) +
facet_wrap(~Subject) +
labs(x = "Time (Days)",
y = "Reaction Time (ms)",
title = "Reaction Time ~ Days of Sleep Deprivation",
subtitle = "Blue = Fixed Effects Prediction | Green = Random Effects Prediction") +
theme_bw(base_size = 15)
#| message: false
library(lme4)
library(ggplot2)
library(gtsummary)
# Load data
data("sleepstudy")
# Model
mod <- lmer(Reaction ~ Days + (Days | Subject), data = sleepstudy)
# Predict
sleepstudy$mod_pred_fix <- predict(mod, re.form = NA) # predict fixed effects
sleepstudy$mod_pred_ran <- predict(mod) # predict random effects
# View data
head(sleepstudy, 10)
#| message: false
#| warning: false
# Plot all data
sleepstudy |>
ggplot(aes(x = Days, y = Reaction, color = factor(Subject))) +
geom_line(aes(x = Days, y = mod_pred_ran)) +
geom_line(aes(x = Days, y = mod_pred_fix), linewidth = 2, color = "blue") +
scale_y_continuous(limits = c(200, 500), breaks = seq(200, 500, by = 50)) +
scale_x_continuous(limits = c(0, 9), breaks = seq(0, 9, by = 1)) +
geom_point(alpha = 0.5) +
labs(title = "Reaction Time ~ Days of Sleep Deprivation") + xlab("Time (days)") + ylab("Average Reaction Time (ms)") +
theme_bw(base_size = 15)
#| message: false
#| warning: false
# Plot - facet on individual
sleepstudy |>
ggplot(aes(x = Days, y = Reaction)) +
geom_line(aes(x = Days, y = mod_pred_ran), linewidth = 1, color = "green") +
geom_line(aes(x = Days, y = mod_pred_fix), linewidth = 1, color = "blue") +
scale_y_continuous(limits = c(200, 500), breaks = seq(200, 500, by = 100)) +
scale_x_continuous(limits = c(0, 9), breaks = seq(0, 9, by = 2)) +
geom_point(alpha = 0.5) +
facet_wrap(~Subject) +
labs(x = "Time (Days)",
y = "Average Reaction Time (ms)",
title = "Reaction Time ~ Days of Sleep Deprivation",
subtitle = "Blue = Fixed Effects Prediction | Green = Random Effects Prediction") +
theme_bw(base_size = 15)
summary(mod)
fixef(mod)
ranef(mod)
251.4+2.3
predict(mod, newdata = data.frame(days = 0, Subject = 308), re.form = ~(Days|Subject))
predict(mod, newdata = data.frame(Days = 0, Subject = 308), re.form = ~(Days|Subject))
251.405 + 2.259
(10.467 + 9.199) * 5 + 253.664
predict(mod, newdata = data.frame(Days = 5, Subject = 308), re.form = ~(Days|Subject))
(251.405 + 10.467) * 5
251.405 + (10.467 * 5)
9.199*5
45.995+2.589
303.74+48.584
10.467*5
9.199*5
52.335+45.995
10.467+9.199
19.666*5
251.405 + (10.467 * 5)
9.199*5
45.995+2.259
48.254+303.74
2.259 + (9.198 * 5)
303.74 + 48.249
251.405 + (10.467 * 5)
2.259 + (9.198 * 5)
303.74 + 48.249
