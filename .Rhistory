age <-  rnorm(n, 40, 10)                            # generate age variable - mean = 40, SD = 10
sex <-  rbinom(n, 1, 0.5)                           # generate sex variable ~ 50% females (0) and 50% males (1)
# Generate bodyweight from regression model based on additive effects of sex and age - on average, males are 5 kg heavier than females and each year increase in age is associated with a 3 kg increase in bodyweight
# Thus, this model is NOT realistic -
# When sex and age = 0, bodyweight = 5, but as this is assumed to increase linearly with age, an average 70 year old would weigh 215 kg for females and 220 kg for males. A quadratic function of age would be more appropriate, but lets keep things simple...
bodyweight <-  5 + 5 * sex + 3 * age + rnorm(n, 0, 1)
# Check that we recover the original coefficients:
dat <-  data.frame(sex = sex, age = age, bodyweight = bodyweight)
summary(lm(bodyweight ~ age + sex , data = dat))
# Now, let's create some missingness at random (where the missingness in bodyweight depends on sex)
# The model intercept and coefficient have been selected so that the probability of missingness will be ~ 12% for males and ~ 73% for females
logodds_missing <-  1 - 3 * sex
odds_missing <-  exp(logodds_missing)
prob_missing  <-  odds_missing/(1 + odds_missing)
binary_missing <-  rbinom(n, 1, prob_missing)
dat <- cbind(dat, odds = odds_missing, prob = prob_missing, missing = binary_missing)
summary(glm(missing ~ sex, data = dat, family = "binomial"))
table(dat$prob, dat$missing)
table(dat$prob, dat$sex)
table(dat$sex, dat$missing)
table(dat$prob, dat$missing)
456+59
515*.119
library(tidyverse)
# Simulation
n <- 1000                                           # set number of obs to simulate
set.seed(1234)                                      # set seed for reproducibility
age <-  rnorm(n, 40, 10)                            # generate age variable - mean = 40, SD = 10
sex <-  rbinom(n, 1, 0.5)                           # generate sex variable ~ 50% females (0) and 50% males (1)
# Generate bodyweight from regression model based on additive effects of sex and age - on average, males are 5 kg heavier than females and each year increase in age is associated with a 3 kg increase in bodyweight
# Thus, this model is NOT realistic -
# When sex and age = 0, bodyweight = 5, but as this is assumed to increase linearly with age, an average 70 year old would weigh 215 kg for females and 220 kg for males. A quadratic function of age would be more appropriate, but lets keep things simple...
bodyweight <-  5 + 5 * sex + 3 * age + rnorm(n, 0, 1)
# Check that we recover the original coefficients:
dat <-  data.frame(sex = sex, age = age, bodyweight = bodyweight)
summary(lm(bodyweight ~ age + sex , data = dat))
# Now, let's create some missingness at random (where the missingness in bodyweight depends on sex)
# The model intercept and coefficient have been selected so that the probability of missingness will be ~ 12% for males and ~ 73% for females
logodds_missing <-  1 - 3 * sex
odds_missing <-  exp(logodds_missing)
prob_missing  <-  odds_missing/(1 + odds_missing)
binary_missing <-  rbinom(n, 1, prob_missing)
dat <- cbind(dat, odds = odds_missing, prob = prob_missing, missing = binary_missing)
# Check with tabulation
table(dat$prob, dat$missing)
59+456
0.119*515
119+366
0.731*485
# Now set missingness in bodyweight
dat$bodyweight <-  ifelse(dat$missing == 1, NA, dat$bodyweight)
# MAR testing
# Test for an association between missingness and sex
mod <- glm(missingness ~ sex, data = dat, family = "binomial")
# MAR testing
# Test for an association between missingness and sex
mod <- glm(missing ~ sex, data = dat, family = "binomial")
exp(mod)$coef
exp(mod$coef)
summary(mod)
.135/2.71
mod_females <- glm(missing ~ bodyweight, data = subset(dat, sex == 0), family = "binomial")
mod_females <- glm(missing ~ bodyweight, data = subset(dat, sex == 1), family = "binomial")
mod_females <- lm(bodyweight ~ missing, data = subset(dat, sex == 0))
summary(mod_females)
dat_females <-  dat |>
filter(sex == 0)
View(dat_females)
library(tidyverse)
# Simulation
n <- 10000                                           # set number of obs to simulate
set.seed(1234)                                      # set seed for reproducibility
age <-  rnorm(n, 40, 10)                            # generate age variable - mean = 40, SD = 10
sex <-  rbinom(n, 1, 0.5)                           # generate sex variable ~ 50% females (0) and 50% males (1)
# Generate bodyweight from regression model based on additive effects of sex and age - on average, males are 5 kg heavier than females and each year increase in age is associated with a 3 kg increase in bodyweight
# Thus, this model is NOT realistic -
# When sex and age = 0, bodyweight = 5, but as this is assumed to increase linearly with age, an average 70 year old would weigh 215 kg for females and 220 kg for males. A quadratic function of age would be more appropriate, but lets keep things simple...
bodyweight <-  5 + 5 * sex + 3 * age + rnorm(n, 0, 1)
# Check that we recover the original coefficients:
dat <-  data.frame(sex = sex, age = age, bodyweight = bodyweight)
summary(lm(bodyweight ~ age + sex , data = dat))
# Now, let's create some missingness at random (where the missingness in bodyweight depends on sex)
# The model intercept and coefficient have been selected so that the probability of missingness will be ~ 12% for males and ~ 73% for females
logodds_missing <-  1 - 3 * sex
odds_missing <-  exp(logodds_missing)
prob_missing  <-  odds_missing/(1 + odds_missing)
binary_missing <-  rbinom(n, 1, prob_missing)
dat <- cbind(dat, odds = odds_missing, prob = prob_missing, missing = binary_missing)
# Check with tabulation
table(dat$prob, dat$missing)
# This is about right
0.119*515 # gives 61 males
0.731*485 # gives 354 females
# Now set missingness in bodyweight
dat$bodyweight <-  ifelse(dat$missing == 1, NA, dat$bodyweight)
# MAR testing
# Test for an association between missingness and sex
mod <- glm(missing ~ sex, data = dat, family = "binomial")
summary(mod)
exp(mod$coef) # i.e. there's an ~ 95% reduction in the odds of having missingness in bodyweight for males relative to females and this is significant
dat_females <-  dat |>
filter(sex == 0)
mod_females <- lm(bodyweight ~ missing, data = dat_females)
summary(mod_females)
library(tidyverse)
# Simulation
n <- 1000                                           # set number of obs to simulate
set.seed(1234)                                      # set seed for reproducibility
age <-  rnorm(n, 40, 10)                            # generate age variable - mean = 40, SD = 10
sex <-  rbinom(n, 1, 0.5)                           # generate sex variable ~ 50% females (0) and 50% males (1)
# Generate bodyweight from regression model based on additive effects of sex and age - on average, males are 5 kg heavier than females and each year increase in age is associated with a 3 kg increase in bodyweight
# Thus, this model is NOT realistic -
# When sex and age = 0, bodyweight = 5, but as this is assumed to increase linearly with age, an average 70 year old would weigh 215 kg for females and 220 kg for males. A quadratic function of age would be more appropriate, but lets keep things simple...
bodyweight <-  5 + 5 * sex + 3 * age + rnorm(n, 0, 1)
# Check that we recover the original coefficients:
dat <-  data.frame(sex = sex, age = age, bodyweight = bodyweight)
summary(lm(bodyweight ~ age + sex , data = dat))
# Now, let's create some missingness at random (where the missingness in bodyweight depends on sex)
# The model intercept and coefficient have been selected so that the probability of missingness will be ~ 12% for males and ~ 73% for females
logodds_missing <-  1 - 2 * sex
odds_missing <-  exp(logodds_missing)
prob_missing  <-  odds_missing/(1 + odds_missing)
binary_missing <-  rbinom(n, 1, prob_missing)
dat <- cbind(dat, odds = odds_missing, prob = prob_missing, missing = binary_missing)
library(tidyverse)
# Simulation
n <- 1000                                           # set number of obs to simulate
set.seed(1234)                                      # set seed for reproducibility
age <-  rnorm(n, 40, 10)                            # generate age variable - mean = 40, SD = 10
sex <-  rbinom(n, 1, 0.5)                           # generate sex variable ~ 50% females (0) and 50% males (1)
# Generate bodyweight from regression model based on additive effects of sex and age - on average, males are 5 kg heavier than females and each year increase in age is associated with a 3 kg increase in bodyweight
# Thus, this model is NOT realistic -
# When sex and age = 0, bodyweight = 5, but as this is assumed to increase linearly with age, an average 70 year old would weigh 215 kg for females and 220 kg for males. A quadratic function of age would be more appropriate, but lets keep things simple...
bodyweight <-  5 + 5 * sex + 3 * age + rnorm(n, 0, 1)
# Check that we recover the original coefficients:
dat <-  data.frame(sex = sex, age = age, bodyweight = bodyweight)
summary(lm(bodyweight ~ age + sex , data = dat))
# Now, let's create some missingness at random (where the missingness in bodyweight depends on sex)
# The model intercept and coefficient have been selected so that the probability of missingness will be ~ 12% for males and ~ 73% for females
logodds_missing <-  0.5 - 3 * sex
odds_missing <-  exp(logodds_missing)
prob_missing  <-  odds_missing/(1 + odds_missing)
binary_missing <-  rbinom(n, 1, prob_missing)
dat <- cbind(dat, odds = odds_missing, prob = prob_missing, missing = binary_missing)
library(tidyverse)
# Simulation
n <- 1000                                           # set number of obs to simulate
set.seed(1234)                                      # set seed for reproducibility
age <-  rnorm(n, 40, 10)                            # generate age variable - mean = 40, SD = 10
sex <-  rbinom(n, 1, 0.5)                           # generate sex variable ~ 50% females (0) and 50% males (1)
# Generate bodyweight from regression model based on additive effects of sex and age - on average, males are 5 kg heavier than females and each year increase in age is associated with a 3 kg increase in bodyweight
# Thus, this model is NOT realistic -
# When sex and age = 0, bodyweight = 5, but as this is assumed to increase linearly with age, an average 70 year old would weigh 215 kg for females and 220 kg for males. A quadratic function of age would be more appropriate, but lets keep things simple...
bodyweight <-  5 + 5 * sex + 3 * age + rnorm(n, 0, 1)
# Check that we recover the original coefficients:
dat <-  data.frame(sex = sex, age = age, bodyweight = bodyweight)
summary(lm(bodyweight ~ age + sex , data = dat))
# Now, let's create some missingness at random (where the missingness in bodyweight depends on sex)
# The model intercept and coefficient have been selected so that the probability of missingness will be ~ 12% for males and ~ 73% for females
logodds_missing <-  -1 - 2 * sex
odds_missing <-  exp(logodds_missing)
prob_missing  <-  odds_missing/(1 + odds_missing)
binary_missing <-  rbinom(n, 1, prob_missing)
dat <- cbind(dat, odds = odds_missing, prob = prob_missing, missing = binary_missing)
library(tidyverse)
# Simulation
n <- 1000                                           # set number of obs to simulate
set.seed(1234)                                      # set seed for reproducibility
age <-  rnorm(n, 40, 10)                            # generate age variable - mean = 40, SD = 10
sex <-  rbinom(n, 1, 0.5)                           # generate sex variable ~ 50% females (0) and 50% males (1)
# Generate bodyweight from regression model based on additive effects of sex and age - on average, males are 5 kg heavier than females and each year increase in age is associated with a 3 kg increase in bodyweight
# Thus, this model is NOT realistic -
# When sex and age = 0, bodyweight = 5, but as this is assumed to increase linearly with age, an average 70 year old would weigh 215 kg for females and 220 kg for males. A quadratic function of age would be more appropriate, but lets keep things simple...
bodyweight <-  5 + 5 * sex + 3 * age + rnorm(n, 0, 1)
# Check that we recover the original coefficients:
dat <-  data.frame(sex = sex, age = age, bodyweight = bodyweight)
summary(lm(bodyweight ~ age + sex , data = dat))
# Now, let's create some missingness at random (where the missingness in bodyweight depends on sex)
# The model intercept and coefficient have been selected so that the probability of missingness will be ~ 12% for males and ~ 73% for females
logodds_missing <-  0 - 2 * sex
odds_missing <-  exp(logodds_missing)
prob_missing  <-  odds_missing/(1 + odds_missing)
binary_missing <-  rbinom(n, 1, prob_missing)
dat <- cbind(dat, odds = odds_missing, prob = prob_missing, missing = binary_missing)
library(tidyverse)
# Simulation
n <- 1000                                           # set number of obs to simulate
set.seed(1234)                                      # set seed for reproducibility
age <-  rnorm(n, 40, 10)                            # generate age variable - mean = 40, SD = 10
sex <-  rbinom(n, 1, 0.5)                           # generate sex variable ~ 50% females (0) and 50% males (1)
# Generate bodyweight from regression model based on additive effects of sex and age - on average, males are 5 kg heavier than females and each year increase in age is associated with a 3 kg increase in bodyweight
# Thus, this model is NOT realistic -
# When sex and age = 0, bodyweight = 5, but as this is assumed to increase linearly with age, an average 70 year old would weigh 215 kg for females and 220 kg for males. A quadratic function of age would be more appropriate, but lets keep things simple...
bodyweight <-  5 + 5 * sex + 3 * age + rnorm(n, 0, 1)
# Check that we recover the original coefficients:
dat <-  data.frame(sex = sex, age = age, bodyweight = bodyweight)
summary(lm(bodyweight ~ age + sex , data = dat))
# Now, let's create some missingness at random (where the missingness in bodyweight depends on sex)
# The model intercept and coefficient have been selected so that the probability of missingness will be ~ 12% for males and ~ 73% for females
logodds_missing <-  0 - 2 * sex
odds_missing <-  exp(logodds_missing)
prob_missing  <-  odds_missing/(1 + odds_missing)
binary_missing <-  rbinom(n, 1, prob_missing)
dat <- cbind(dat, odds = odds_missing, prob = prob_missing, missing = binary_missing)
# Check with tabulation
table(dat$prob, dat$missing)
# This is about right
0.119*515 # gives 61 males
0.731*485 # gives 354 females
# Now set missingness in bodyweight
dat$bodyweight <-  ifelse(dat$missing == 1, NA, dat$bodyweight)
# MAR testing
# Test for an association between missingness and sex
mod <- glm(missing ~ sex, data = dat, family = "binomial")
summary(mod)
exp(mod$coef) # i.e. there's an ~ 95% reduction in the odds of having missingness in bodyweight for males relative to females and this is significant
dat_females <-  dat |>
filter(sex == 0)
mod_females <- lm(bodyweight ~ missing, data = dat_females)
summary(mod_females)
dat_females <-  dat |>
filter(sex == 1)
mod_females <- lm(bodyweight ~ missing, data = dat_females)
summary(mod_females)
library(tidyverse)
# Simulation
n <- 1000                                           # set number of obs to simulate
set.seed(1234)                                      # set seed for reproducibility
age <-  rnorm(n, 40, 10)                            # generate age variable - mean = 40, SD = 10
sex <-  rbinom(n, 1, 0.5)                           # generate sex variable ~ 50% females (0) and 50% males (1)
# Generate bodyweight from regression model based on additive effects of sex and age - on average, males are 5 kg heavier than females and each year increase in age is associated with a 3 kg increase in bodyweight
# Thus, this model is NOT realistic -
# When sex and age = 0, bodyweight = 5, but as this is assumed to increase linearly with age, an average 70 year old would weigh 215 kg for females and 220 kg for males. A quadratic function of age would be more appropriate, but lets keep things simple...
bodyweight <-  5 + 5 * sex + 3 * age + rnorm(n, 0, 1)
# Check that we recover the original coefficients:
dat <-  data.frame(sex = sex, age = age, bodyweight = bodyweight)
summary(lm(bodyweight ~ age + sex , data = dat))
# Now, let's create some missingness at random (where the missingness in bodyweight depends on sex)
# The model intercept and coefficient have been selected so that the probability of missingness will be ~ 12% for males and ~ 73% for females
logodds_missing <-  1 - 3 * sex
odds_missing <-  exp(logodds_missing)
prob_missing  <-  odds_missing/(1 + odds_missing)
binary_missing <-  rbinom(n, 1, prob_missing)
dat <- cbind(dat, odds = odds_missing, prob = prob_missing, missing = binary_missing)
# Check with tabulation
table(dat$prob, dat$missing)
# This is about right
0.119*515 # gives 61 males
0.731*485 # gives 354 females
# Now set missingness in bodyweight
dat$bodyweight <-  ifelse(dat$missing == 1, NA, dat$bodyweight)
# MAR testing
# Test for an association between missingness and sex
mod <- glm(missing ~ sex, data = dat, family = "binomial")
summary(mod)
exp(mod$coef) # i.e. there's an ~ 95% reduction in the odds of having missingness in bodyweight for males relative to females and this is significant
library(tidyverse)
# Simulation
n <- 1000                                           # set number of obs to simulate
set.seed(1234)                                      # set seed for reproducibility
age <-  rnorm(n, 40, 10)                            # generate age variable - mean = 40, SD = 10
sex <-  rbinom(n, 1, 0.5)                           # generate sex variable ~ 50% females (0) and 50% males (1)
# Generate bodyweight from regression model based on additive effects of sex and age - on average, males are 5 kg heavier than females and each year increase in age is associated with a 3 kg increase in bodyweight
# Thus, this model is NOT realistic -
# When sex and age = 0, bodyweight = 5, but as this is assumed to increase linearly with age, an average 70 year old would weigh 215 kg for females and 220 kg for males. A quadratic function of age would be more appropriate, but lets keep things simple...
bodyweight <-  5 + 5 * sex + 3 * age + rnorm(n, 0, 1)
# Check that we recover the original coefficients:
dat <-  data.frame(sex = sex, age = age, bodyweight = bodyweight)
summary(lm(bodyweight ~ age + sex , data = dat))
# Now, let's create some missingness at random (where the missingness in bodyweight depends on sex)
# The model intercept and coefficient have been selected so that the probability of missingness will be ~ 12% for males and ~ 73% for females
logodds_missing <-  -1 - 3 * sex
odds_missing <-  exp(logodds_missing)
prob_missing  <-  odds_missing/(1 + odds_missing)
binary_missing <-  rbinom(n, 1, prob_missing)
dat <- cbind(dat, odds = odds_missing, prob = prob_missing, missing = binary_missing)
# Check with tabulation
table(dat$prob, dat$missing)
# This is about right
0.119*515 # gives 61 males
0.731*485 # gives 354 females
# Now set missingness in bodyweight
dat$bodyweight <-  ifelse(dat$missing == 1, NA, dat$bodyweight)
# MAR testing
# Test for an association between missingness and sex
mod <- glm(missing ~ sex, data = dat, family = "binomial")
summary(mod)
exp(mod$coef) # i.e. there's an ~ 95% reduction in the odds of having missingness in bodyweight for males relative to females and this is significant
dat_females <-  dat |>
filter(sex == 0)
mod_females <- lm(bodyweight ~ missing, data = dat_females)
summary(mod_females)
library(tidyverse)
# Simulation
n <- 1000                                           # set number of obs to simulate
set.seed(1234)                                      # set seed for reproducibility
age <-  rnorm(n, 40, 10)                            # generate age variable - mean = 40, SD = 10
sex <-  rbinom(n, 1, 0.5)                           # generate sex variable ~ 50% females (0) and 50% males (1)
# Generate bodyweight from regression model based on additive effects of sex and age - on average, males are 5 kg heavier than females and each year increase in age is associated with a 3 kg increase in bodyweight
# Thus, this model is NOT realistic -
# When sex and age = 0, bodyweight = 5, but as this is assumed to increase linearly with age, an average 70 year old would weigh 215 kg for females and 220 kg for males. A quadratic function of age would be more appropriate, but lets keep things simple...
bodyweight <-  5 + 5 * sex + 3 * age + rnorm(n, 0, 1)
# Check that we recover the original coefficients:
dat <-  data.frame(sex = sex, age = age, bodyweight = bodyweight)
summary(lm(bodyweight ~ age + sex , data = dat))
# Now, let's create some missingness at random (where the missingness in bodyweight depends on sex)
# The model intercept and coefficient have been selected so that the probability of missingness will be ~ 12% for males and ~ 73% for females
logodds_missing <-  -1 - 3 * sex
odds_missing <-  exp(logodds_missing)
prob_missing  <-  odds_missing/(1 + odds_missing)
binary_missing <-  rbinom(n, 1, prob_missing)
dat <- cbind(dat, odds = odds_missing, prob = prob_missing, missing = binary_missing)
# Check with tabulation
table(dat$prob, dat$missing)
# This is about right
0.119*515 # gives 61 males
0.731*485 # gives 354 females
# Now set missingness in bodyweight
#dat$bodyweight <-  ifelse(dat$missing == 1, NA, dat$bodyweight)
# MAR testing
# Test for an association between missingness and sex
mod <- glm(missing ~ sex, data = dat, family = "binomial")
summary(mod)
exp(mod$coef) # i.e. there's an ~ 95% reduction in the odds of having missingness in bodyweight for males relative to females and this is significant
dat_females <-  dat |>
filter(sex == 0)
mod_females <- lm(bodyweight ~ missing, data = dat_females)
summary(mod_females)
mod_females <- glm(missing ~ bodyweight, data = dat_females, family = "binomial")
summary(mod_females)
broom::tidy(mod)
broom::tidy(mod, exp = T)
library(tidyverse)
# Simulation
n <- 1000                                           # set number of obs to simulate
set.seed(1234)                                      # set seed for reproducibility
age <-  rnorm(n, 40, 10)                            # generate age variable - mean = 40, SD = 10
sex <-  rbinom(n, 1, 0.5)                           # generate sex variable ~ 50% females (0) and 50% males (1)
# Generate bodyweight from regression model based on additive effects of sex and age - on average, males are 5 kg heavier than females and each year increase in age is associated with a 3 kg increase in bodyweight
# Thus, this model is NOT realistic -
# When sex and age = 0, bodyweight = 5, but as this is assumed to increase linearly with age, an average 70 year old would weigh 215 kg for females and 220 kg for males. A quadratic function of age would be more appropriate, but lets keep things simple...
bodyweight <-  5 + 5 * sex + 3 * age + rnorm(n, 0, 1)
# Check that we recover the original coefficients:
dat <-  data.frame(sex = sex, age = age, bodyweight = bodyweight)
summary(lm(bodyweight ~ age + sex , data = dat))
# Now, let's create some missingness at random (where the missingness in bodyweight depends on sex)
# The model intercept and coefficient have been selected so that the probability of missingness will be ~ 12% for males and ~ 73% for females
logodds_missing <-  -1 - 3 * sex
odds_missing <-  exp(logodds_missing)
prob_missing  <-  odds_missing/(1 + odds_missing)
binary_missing <-  rbinom(n, 1, prob_missing)
dat <- cbind(dat, odds = odds_missing, prob = prob_missing, missing = binary_missing)
# Check with tabulation
table(dat$prob, dat$missing)
# This is about right
0.119*515 # gives 61 males
0.731*485 # gives 354 females
# Now set missingness in bodyweight
#dat$bodyweight <-  ifelse(dat$missing == 1, NA, dat$bodyweight)
# MAR testing
# Test for an association between missingness and sex
mod <- glm(missing ~ sex, data = dat, family = "binomial")
broom::tidy(mod, exp = T)  # i.e. there's an ~ 95% reduction in the odds of having missingness in bodyweight for males relative to females and this is significant
mod_females <- glm(missing ~ bodyweight, data = subset(dat, sex == 0), family = "binomial")
broom::tidy(mod_females, exp = T)
mod_males <- glm(missing ~ bodyweight, data = subset(dat, sex == 1), family = "binomial")
broom::tidy(mod_males, exp = T)
library(tidyverse)
# Simulation
n <- 1000                                           # set number of obs to simulate
set.seed(1234)                                      # set seed for reproducibility
age <-  rnorm(n, 40, 10)                            # generate age variable - mean = 40, SD = 10
sex <-  rbinom(n, 1, 0.5)                           # generate sex variable ~ 50% females (0) and 50% males (1)
# Generate bodyweight from regression model based on additive effects of sex and age - on average, males are 5 kg heavier than females and each year increase in age is associated with a 3 kg increase in bodyweight
# Thus, this model is NOT realistic -
# When sex and age = 0, bodyweight = 5, but as this is assumed to increase linearly with age, an average 70 year old would weigh 215 kg for females and 220 kg for males. A quadratic function of age would be more appropriate, but lets keep things simple...
bodyweight <-  5 + 5 * sex + 3 * age + rnorm(n, 0, 1)
# Check that we recover the original coefficients:
dat <-  data.frame(sex = sex, age = age, bodyweight = bodyweight)
summary(lm(bodyweight ~ age + sex , data = dat))
# Now, let's create some missingness at random (where the missingness in bodyweight depends on sex)
# The model intercept and coefficient have been selected so that the probability of missingness will be ~ 12% for males and ~ 73% for females
logodds_missing <-  1 - 3 * sex
odds_missing <-  exp(logodds_missing)
prob_missing  <-  odds_missing/(1 + odds_missing)
binary_missing <-  rbinom(n, 1, prob_missing)
dat <- cbind(dat, odds = odds_missing, prob = prob_missing, missing = binary_missing)
# Check with tabulation
table(dat$prob, dat$missing)
# This is about right
0.119*515 # gives 61 males
0.731*485 # gives 354 females
# Now set missingness in bodyweight
#dat$bodyweight <-  ifelse(dat$missing == 1, NA, dat$bodyweight)
# MAR testing
# Test for an association between missingness and sex
mod <- glm(missing ~ sex, data = dat, family = "binomial")
broom::tidy(mod, exp = T)  # i.e. there's an ~ 95% reduction in the odds of having missingness in bodyweight for males relative to females and this is significant
mod_females <- glm(missing ~ bodyweight, data = subset(dat, sex == 0), family = "binomial")
broom::tidy(mod_females, exp = T)
mod_males <- glm(missing ~ bodyweight, data = subset(dat, sex == 1), family = "binomial")
broom::tidy(mod_males, exp = T)
0.119*515 # gives 61 males
0.731*485 # gives 354 females
# Check with tabulation
table(dat$prob, dat$missing)
# This is about right
0.119*515 # gives 61 males
0.731*485 # gives 354 females
mod_age <- glm(missing ~ age, data = dat, family = "binomial")
tidy(mod_age, exp = T)
library(tidyverse)
library(broom)
# Simulation
n <- 1000                                           # set number of obs to simulate
set.seed(1234)                                      # set seed for reproducibility
age <-  rnorm(n, 40, 10)                            # generate age variable - mean = 40, SD = 10
sex <-  rbinom(n, 1, 0.5)                           # generate sex variable ~ 50% females (0) and 50% males (1)
# Generate bodyweight from regression model based on additive effects of sex and age - on average, males are 5 kg heavier than females and each year increase in age is associated with a 3 kg increase in bodyweight
# Thus, this model is NOT realistic -
# When sex and age = 0, bodyweight = 5, but as this is assumed to increase linearly with age, an average 70 year old would weigh 215 kg for females and 220 kg for males. A quadratic function of age would be more appropriate, but lets keep things simple...
bodyweight <-  5 + 5 * sex + 3 * age + rnorm(n, 0, 1)
# Check that we recover the original coefficients:
dat <-  data.frame(sex = sex, age = age, bodyweight = bodyweight)
summary(lm(bodyweight ~ age + sex , data = dat))
# Now, let's create some missingness at random (where the missingness in bodyweight depends on sex)
# The model intercept and coefficient have been selected so that the probability of missingness will be ~ 12% for males and ~ 73% for females
logodds_missing <-  1 - 3 * sex
odds_missing <-  exp(logodds_missing)
prob_missing  <-  odds_missing/(1 + odds_missing)
binary_missing <-  rbinom(n, 1, prob_missing)
dat <- cbind(dat, odds = odds_missing, prob = prob_missing, missing = binary_missing)
# Check with tabulation
table(dat$prob, dat$missing)
# This is about right
0.119*515 # gives 61 males
0.731*485 # gives 354 females
# Test for an association between missingness and sex (MAR)
mod_sex <- glm(missing ~ sex, data = dat, family = "binomial")
broom::tidy(mod_sex, exp = T)  # i.e. there's an ~ 95% reduction in the odds of having missingness in bodyweight for males relative to females and this is significant
# But WITHIN categories of Sex, missingness is random (MCAR)
mod_females <- glm(missing ~ bodyweight, data = subset(dat, sex == 0), family = "binomial")
tidy(mod_females, exp = T) # i.e. no statistically significant effect of bodyweight on missingness
mod_males <- glm(missing ~ bodyweight, data = subset(dat, sex == 1), family = "binomial")
tidy(mod_males, exp = T) # i.e. no statistically significant effect of bodyweight on missingness
# Test for an association between missingness and age (MCAR)
mod_age <- glm(missing ~ age, data = dat, family = "binomial")
tidy(mod_age, exp = T)
library(tidyverse)
library(broom)
# Simulation
n <- 1000                                           # set number of obs to simulate
set.seed(1234)                                      # set seed for reproducibility
age <-  rnorm(n, 40, 10)                            # generate age variable - mean = 40, SD = 10
sex <-  rbinom(n, 1, 0.5)                           # generate sex variable ~ 50% females (0) and 50% males (1)
# Generate bodyweight from regression model based on additive effects of sex and age - on average, males are 5 kg heavier than females and each year increase in age is associated with a 3 kg increase in bodyweight
# Thus, this model is NOT realistic -
# When sex and age = 0, bodyweight = 5, but as this is assumed to increase linearly with age, an average 70 year old would weigh 215 kg for females and 220 kg for males. A quadratic function of age would be more appropriate, but lets keep things simple...
bodyweight <-  5 + 5 * sex + 3 * age + rnorm(n, 0, 1)
# Check that we recover the original coefficients:
dat <-  data.frame(sex = sex, age = age, bodyweight = bodyweight)
summary(lm(bodyweight ~ age + sex , data = dat))
# Now, let's create some missingness at random (where the missingness in bodyweight depends on sex)
# The model intercept and coefficient have been selected so that the probability of missingness will be ~ 12% for males and ~ 73% for females
logodds_missing <-  1 - 3 * sex
odds_missing <-  exp(logodds_missing)
prob_missing  <-  odds_missing/(1 + odds_missing)
binary_missing <-  rbinom(n, 1, prob_missing)
dat <- cbind(dat, odds = odds_missing, prob = prob_missing, missing = binary_missing)
library(tidyverse)
library(broom)
# Simulation
n <- 1000                                           # set number of obs to simulate
set.seed(1234)                                      # set seed for reproducibility
age <-  rnorm(n, 40, 10)                            # generate age variable - mean = 40, SD = 10
sex <-  rbinom(n, 1, 0.5)                           # generate sex variable ~ 50% females (0) and 50% males (1)
# Generate bodyweight from regression model based on additive effects of sex and age - on average, males are 5 kg heavier than females and each year increase in age is associated with a 3 kg increase in bodyweight
# Thus, this model is NOT realistic -
# When sex and age = 0, bodyweight = 5, but as this is assumed to increase linearly with age, an average 70 year old would weigh 215 kg for females and 220 kg for males. A quadratic function of age would be more appropriate, but lets keep things simple...
bodyweight <-  5 + 5 * sex + 3 * age + rnorm(n, 0, 1)
# Check that we recover the original coefficients:
dat <-  data.frame(sex = sex, age = age, bodyweight = bodyweight)
summary(lm(bodyweight ~ age + sex , data = dat))
# Now, let's create some missingness at random (where the missingness in bodyweight depends on sex)
# The model intercept and coefficient have been selected so that the probability of missingness will be ~ 12% for males and ~ 73% for females
logodds_missing <-  1 - 3 * sex
odds_missing <-  exp(logodds_missing)
prob_missing  <-  odds_missing/(1 + odds_missing)
binary_missing <-  rbinom(n, 1, prob_missing)
dat <- cbind(dat, odds_missing = odds_missing, prob_missing = prob_missing, binary_missing = binary_missing)
# Check with tabulation
table(dat$prob, dat$binary_missing)
# This is about right
0.119*515 # gives 61 males
0.731*485 # gives 354 females
mod_sex <- glm(binary_missing ~ sex, data = dat, family = "binomial")
broom::tidy(mod_sex, exp = T)  # i.e. there's an ~ 95% reduction in the odds of having missingness in bodyweight for males relative to females and this is significant
# Step 2 - now test whether missingness depends on bodyweight WITHIN each category of sex - i.e. missingness is random (MCAR) within categories
mod_females <- glm(binary_missing ~ bodyweight, data = subset(dat, sex == 0), family = "binomial")
tidy(mod_females, exp = T)
mod_males <- glm(binary_missing ~ bodyweight, data = subset(dat, sex == 1), family = "binomial")
tidy(mod_males, exp = T)
mod_age <- glm(binary_missing ~ age, data = dat, family = "binomial")
tidy(mod_age, exp = T)
# Check with tabulation
table(dat$prob, dat$binary_missing)
# This is about right
0.119*515 # gives 61 males
0.731*485 # gives 354 females
# Test for an association between missingness and age (MCAR)
mod_age <- glm(binary_missing ~ age, data = dat, family = "binomial")
tidy(mod_age, exp = T)
