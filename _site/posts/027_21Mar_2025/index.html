<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-03-21">
<meta name="description" content="How to predict from your model.">

<title>Test Site 2 - Model Prediction/Visualisation  1. The Basics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Test Site 2</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">All Posts</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-is-model-prediction" id="toc-what-is-model-prediction" class="nav-link active" data-scroll-target="#what-is-model-prediction"><span class="header-section-number">1</span> What is Model Prediction</a></li>
  <li><a href="#birthwt-dataset" id="toc-birthwt-dataset" class="nav-link" data-scroll-target="#birthwt-dataset"><span class="header-section-number">2</span> <code>birthwt</code> Dataset</a>
  <ul>
  <li><a href="#birthweight-as-a-function-of-maternal-age" id="toc-birthweight-as-a-function-of-maternal-age" class="nav-link" data-scroll-target="#birthweight-as-a-function-of-maternal-age"><span class="header-section-number">2.1</span> Birthweight as a Function of Maternal Age</a>
  <ul class="collapse">
  <li><a href="#predict" id="toc-predict" class="nav-link" data-scroll-target="#predict"><span class="header-section-number">2.1.1</span> Predict</a></li>
  <li><a href="#visualise" id="toc-visualise" class="nav-link" data-scroll-target="#visualise"><span class="header-section-number">2.1.2</span> Visualise</a></li>
  </ul></li>
  <li><a href="#birthweight-as-a-function-of-maternal-age-and-smoking" id="toc-birthweight-as-a-function-of-maternal-age-and-smoking" class="nav-link" data-scroll-target="#birthweight-as-a-function-of-maternal-age-and-smoking"><span class="header-section-number">2.2</span> Birthweight as a Function of Maternal Age and Smoking</a>
  <ul class="collapse">
  <li><a href="#predict-1" id="toc-predict-1" class="nav-link" data-scroll-target="#predict-1"><span class="header-section-number">2.2.1</span> Predict</a></li>
  <li><a href="#visualise-1" id="toc-visualise-1" class="nav-link" data-scroll-target="#visualise-1"><span class="header-section-number">2.2.2</span> Visualise</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Model Prediction/Visualisation <br> 1. The Basics</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">code</div>
    <div class="quarto-category">concept</div>
    <div class="quarto-category">modelling</div>
    <div class="quarto-category">visualisation</div>
  </div>
  </div>

<div>
  <div class="description">
    How to predict from your model.
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 21, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Most of you will be familiar with how to create and run a statistical model in <code>R</code>. But what do you then do with your model results? I bet you take <code>R</code>’s rather bland console output, convert that to a formatted table in your manuscript, then based on the regression coefficient values, go on and talk about associations of your exposure/s with your outcome.</p>
<p>And leave it at that.</p>
<p>Well, the old adage of “a picture is worth a thousand words” has never been truer in the context of model prediction and how much additional information value you can obtain if you take your analyses a step further. Our reliance on just looking at the numbers (i.e.&nbsp;the regression coefficients) is sufficient a lot of the time in simple cases, but when models become a more complex - for example, by the specification of non-linear covariate functional forms via splines - regression coefficients on their own are essentially useless in aiding our interpretation. Plotting the model predictions, however, can put us back on track for understanding the important relationships in our data. Even a complex model can make more sense when we can visualise its predictions. These are skills worth learning and adding to your data analyst toolkit.</p>
<p>So, I thought I would put together a series of posts on predicting from and visualising your model, where in each post we cover a different area related to the subject. This week it’s just about the basics of model prediction and visualisation, but in future posts I hope to extend those ideas to more advanced topics including non-linear functional forms, glm’s, mixed-models, etc (let’s see how we go). But first, let’s start at the start…</p>
<section id="what-is-model-prediction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> What is Model Prediction</h1>
<p>When we specify a model using traditional <code>lm()</code> syntax in <code>R</code>, remember that we are just re-expressing the fundamental regression equation you will find in any statistical textbook:</p>
<p><span class="math display">\[ \hat{y} = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + ... \]</span></p>
<p>Where:</p>
<p><span class="math inline">\(\beta_0\)</span> is the intercept (the expected value of <span class="math inline">\(y\)</span> when <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> are both equal to <code>0</code>);</p>
<p><span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> are the regression coefficients for <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>, respectively, and;</p>
<p><span class="math inline">\(\beta_1\)</span> is the expected <em>change</em> in <span class="math inline">\(y\)</span> for a one-unit change in <span class="math inline">\(x_1\)</span> (when <span class="math inline">\(x_2\)</span> is held at a constant value);</p>
<p><span class="math inline">\(\beta_2\)</span> is the expected <em>change</em> in <span class="math inline">\(y\)</span> for a one-unit change in <span class="math inline">\(x_2\)</span> (when <span class="math inline">\(x_1\)</span> is held at a constant value).</p>
<p>The coefficents in the regression equation define the relationship between each independent variable (exposure/predictor) and the dependent variable (outcome). But you don’t need to stop there - it’s very easy to enter values for the independent variables into the equation to also predict the expected (mean) value of the dependent variable. Let’s take a look at a very simple example that uses the built-in <code>mtcars</code> dataset in <code>R</code>. Say we want to examine the relationship between fuel economy (miles/gallon [<code>mpg</code>]) and weight and transmission type (<code>wt + am</code>). A standard linear regression gives:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">summary</span>(<span class="fu">lm</span>(mpg <span class="sc">~</span> wt <span class="sc">+</span> am, <span class="at">data =</span> mtcars))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = mpg ~ wt + am, data = mtcars)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.5295 -2.3619 -0.1317  1.4025  6.8782 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 37.32155    3.05464  12.218 5.84e-13 ***
wt          -5.35281    0.78824  -6.791 1.87e-07 ***
am          -0.02362    1.54565  -0.015    0.988    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.098 on 29 degrees of freedom
Multiple R-squared:  0.7528,    Adjusted R-squared:  0.7358 
F-statistic: 44.17 on 2 and 29 DF,  p-value: 1.579e-09</code></pre>
</div>
</div>
<p>Interpreting just the regression coefficients, we could say that on average, a one-unit increase in weight (which corresponds here to <code>1000</code> pounds) is associated with a reduction in fuel economy of <code>5.4</code> mpg when transmission type is held constant. Similary, we can also say that on average, a one-unit increase in transmission type (which corresponds here to simply changing from an automatic to manual car) is associated with a barely notable reduction in fuel economy of <code>0.02</code> mpg, when weight is held constant.</p>
<p>But we can use this model to make some simple predictions as well. You might want to know what is the expected fuel economy for a manual, <code>5000</code> pound car (not very good I would think). Well it’s a simple exercise in substitution:</p>
<p><span class="math display">\[ \hat{y} = 37.3 - 5.4 * 5 - 0.02 * 0 = 10.3 \]</span></p>
<p>Ok, what about the economy of a much lighter, automatic, <code>2000</code> pound vehicle?</p>
<p><span class="math display">\[ \hat{y} = 37.3 - 5.4 * 2 - 0.02 * 1 = 26.5 \]</span></p>
<p>That’s all that prediction is, really - substitution into your regression equation. Prediction in this context isn’t about predicting the future - in fact for most simple models, time plays no role (although it may, depending on the research question and the model we are using). We are typically more interested in predicting the mean value of the dependent variable given specific values of the independent variable/s.</p>
<p>While you can predict for any combination of covariate values, the visualisation of model predictions comes into its own when we focus on the relationship between some exposure and an outcome, holding the values of all other covariates in the model fixed. These are, in other words, <strong>adjusted</strong> predictions, and can help you to answer the question: “What is the expected outcome for certain values or levels of my exposure, when I have removed any other potential confounding effects?”</p>
<p>Alright, I think you get enough of an idea that we can actually now take a look at a more concrete example.</p>
</section>
<section id="birthwt-dataset" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> <code>birthwt</code> Dataset</h1>
<p>In our very first example to show you how to get up and running with predicting and visualising from your model, we will use the <code>birthwt</code> dataset that comes with the <code>MASS</code> package. A listing of the variables can be found <a href="https://vincentarelbundock.github.io/Rdatasets/doc/MASS/birthwt.html">here</a>, and the first <code>10</code> rows of the dataframe look like:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">data</span>(birthwt, <span class="at">package =</span> <span class="st">"MASS"</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">head</span>(birthwt, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">low</th>
<th style="text-align: right;">age</th>
<th style="text-align: right;">lwt</th>
<th style="text-align: right;">race</th>
<th style="text-align: right;">smoke</th>
<th style="text-align: right;">ptl</th>
<th style="text-align: right;">ht</th>
<th style="text-align: right;">ui</th>
<th style="text-align: right;">ftv</th>
<th style="text-align: right;">bwt</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">85</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">182</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2523</td>
</tr>
<tr class="even">
<td style="text-align: left;">86</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">155</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2551</td>
</tr>
<tr class="odd">
<td style="text-align: left;">87</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">105</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2557</td>
</tr>
<tr class="even">
<td style="text-align: left;">88</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2594</td>
</tr>
<tr class="odd">
<td style="text-align: left;">89</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">107</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2600</td>
</tr>
<tr class="even">
<td style="text-align: left;">91</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">124</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2622</td>
</tr>
<tr class="odd">
<td style="text-align: left;">92</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">118</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2637</td>
</tr>
<tr class="even">
<td style="text-align: left;">93</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">103</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2637</td>
</tr>
<tr class="odd">
<td style="text-align: left;">94</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">123</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2663</td>
</tr>
<tr class="even">
<td style="text-align: left;">95</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">113</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2665</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="birthweight-as-a-function-of-maternal-age" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="birthweight-as-a-function-of-maternal-age"><span class="header-section-number">2.1</span> Birthweight as a Function of Maternal Age</h2>
<p>Let’s initially consider the possible association between baby birthweight (<code>bwt</code> - outcome) and mother’s <code>age</code> (exposure). We will run the model as follows:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>mod <span class="ot">&lt;-</span>  <span class="fu">lm</span>(bwt <span class="sc">~</span> age, <span class="at">data =</span> birthwt)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="fu">summary</span>(mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = bwt ~ age, data = birthwt)

Residuals:
     Min       1Q   Median       3Q      Max 
-2294.78  -517.63    10.51   530.80  1774.92 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  2655.74     238.86   11.12   &lt;2e-16 ***
age            12.43      10.02    1.24    0.216    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 728.2 on 187 degrees of freedom
Multiple R-squared:  0.008157,  Adjusted R-squared:  0.002853 
F-statistic: 1.538 on 1 and 187 DF,  p-value: 0.2165</code></pre>
</div>
</div>
<p>The model seems to suggest that increasing maternal age is associated with increasing birthweight. Keep in mind that this is unlikely to represent reality and I would guess that the relationship between maternal age and birthweight is non-linear (i.e.&nbsp;at some maternal age, birthweight is more likely to start decreasing with increasing maternal age). But for the sake of today’s exercise let’s just assume the relationship is linear.</p>
<section id="predict" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="predict"><span class="header-section-number">2.1.1</span> Predict</h3>
<p>Calculating predictions from the model is as simple as using the <code>predict()</code> function following your model call, adding the predictions as a new column to the original dataframe (or creating a new dataframe if you desire). Here I will just add the new column containing the predictions to a new dataframe containing only the relevant variables, and print the first <code>10</code> rows:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>birthwt2 <span class="ot">&lt;-</span>  birthwt <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="fu">select</span>(bwt, age) <span class="sc">|&gt;</span> </span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> <span class="fu">predict</span>(mod))</span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="fu">head</span>(birthwt2, <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-5"><a href="#cb6-5"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">bwt</th>
<th style="text-align: center;">age</th>
<th style="text-align: center;">pred</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">85</td>
<td style="text-align: center;">2523</td>
<td style="text-align: center;">19</td>
<td style="text-align: center;">2891.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">86</td>
<td style="text-align: center;">2551</td>
<td style="text-align: center;">33</td>
<td style="text-align: center;">3065.9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">87</td>
<td style="text-align: center;">2557</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">2904.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">88</td>
<td style="text-align: center;">2594</td>
<td style="text-align: center;">21</td>
<td style="text-align: center;">2916.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">89</td>
<td style="text-align: center;">2600</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">2879.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">91</td>
<td style="text-align: center;">2622</td>
<td style="text-align: center;">21</td>
<td style="text-align: center;">2916.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">92</td>
<td style="text-align: center;">2637</td>
<td style="text-align: center;">22</td>
<td style="text-align: center;">2929.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">93</td>
<td style="text-align: center;">2637</td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">2867.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">94</td>
<td style="text-align: center;">2663</td>
<td style="text-align: center;">29</td>
<td style="text-align: center;">3016.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">95</td>
<td style="text-align: center;">2665</td>
<td style="text-align: center;">26</td>
<td style="text-align: center;">2978.9</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="visualise" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="visualise"><span class="header-section-number">2.1.2</span> Visualise</h3>
<p>Plotting the model predictions is simple using <code>ggplot2</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">ggplot</span>(birthwt2, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> pred)) <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>It can be useful to add in the raw datapoints, so let’s do that, and I’ll add a couple of plotting embellishments as well.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> birthwt2, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> pred)) <span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> birthwt2, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> bwt)) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">xlab</span>(<span class="st">"Maternal Age"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted Birthweight"</span>) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>Great! We’ve generated predictions from our model and visualised the results. That wasn’t too hard.</p>
</section>
</section>
<section id="birthweight-as-a-function-of-maternal-age-and-smoking" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="birthweight-as-a-function-of-maternal-age-and-smoking"><span class="header-section-number">2.2</span> Birthweight as a Function of Maternal Age and Smoking</h2>
<p>Let’s take it up a step by now including maternal smoking (<code>smoke</code>) as another exposure in our model:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>mod2 <span class="ot">&lt;-</span>  <span class="fu">lm</span>(bwt <span class="sc">~</span> age <span class="sc">+</span> smoke, <span class="at">data =</span> birthwt)</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="fu">summary</span>(mod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = bwt ~ age + smoke, data = birthwt)

Residuals:
     Min       1Q   Median       3Q      Max 
-2119.98  -442.66    52.92   532.38  1690.74 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 2791.224    240.950  11.584   &lt;2e-16 ***
age           11.290      9.881   1.143    0.255    
smoke       -278.356    106.987  -2.602    0.010 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 717.2 on 186 degrees of freedom
Multiple R-squared:  0.04299,   Adjusted R-squared:  0.0327 
F-statistic: 4.177 on 2 and 186 DF,  p-value: 0.0168</code></pre>
</div>
</div>
<p>So, the coefficient for <code>age</code> hasn’t really changed that much, but we can see that smoking seems to have a significant impact, decreasing birthweight on average by <code>278</code> grams.</p>
<p>Let’s predict birthweight from this model as we did before:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>birthwt2 <span class="ot">&lt;-</span>  birthwt <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="fu">select</span>(bwt, age, smoke) <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> <span class="fu">predict</span>(mod2))</span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="fu">head</span>(birthwt2, <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-5"><a href="#cb11-5"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">bwt</th>
<th style="text-align: center;">age</th>
<th style="text-align: center;">smoke</th>
<th style="text-align: center;">pred</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">85</td>
<td style="text-align: center;">2523</td>
<td style="text-align: center;">19</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3005.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">86</td>
<td style="text-align: center;">2551</td>
<td style="text-align: center;">33</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3163.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">87</td>
<td style="text-align: center;">2557</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2738.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">88</td>
<td style="text-align: center;">2594</td>
<td style="text-align: center;">21</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2749.9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">89</td>
<td style="text-align: center;">2600</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2716.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">91</td>
<td style="text-align: center;">2622</td>
<td style="text-align: center;">21</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3028.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">92</td>
<td style="text-align: center;">2637</td>
<td style="text-align: center;">22</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3039.6</td>
</tr>
<tr class="even">
<td style="text-align: left;">93</td>
<td style="text-align: center;">2637</td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">2983.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">94</td>
<td style="text-align: center;">2663</td>
<td style="text-align: center;">29</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2840.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">95</td>
<td style="text-align: center;">2665</td>
<td style="text-align: center;">26</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2806.4</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>And plot the predictions as we did before:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> birthwt2, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> pred)) <span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> birthwt2, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> bwt)) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="fu">xlab</span>(<span class="st">"Maternal Age"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted Birthweight"</span>) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>Uh-oh! Something has obviously gone badly wrong.</p>
<p>The problem is that we have <strong>predicted on the original data</strong> and the predictions are the result of the combination of each woman’s unique values of both maternal age <strong>and</strong> smoking status. In other words, we are not just plotting the predicted value of birthweight as a function of maternal age alone, but rather as a function of both maternal age and smoking status. We are then trying to visualise those predictions as if they were generated from a function of maternal age alone.</p>
<p>As you can then see - “Computer says no”.</p>
<p>To properly visualise predictions when more than one predictor are involved, requires that we find a way to generate the adjusted predictions I mentioned earlier. And, of course, there’s a fairly easy way to do that in <code>R</code>.</p>
<section id="predict-1" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="predict-1"><span class="header-section-number">2.2.1</span> Predict</h3>
<p>When you have more than one covariate in your model, <strong>predicting on new data</strong> will allow you to generate the adjusted predictions that facilitate sensible visualisation. The <code>predict()</code> function actually contains a <code>newdata</code> argument that you can point towards a ‘grid’ of specified covariate values to predict on. This ‘grid’ is essentially a new dataframe that contains all possible combinations of covariates at salient values (typically a range of values at set intervals for numeric variables and every category/level for factor variables). In this way (adjusted) predictions can be made for one variable while keeping the other variable/s at fixed values.</p>
<p>To construct the grid of new data, we will use the <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/expand.grid"><code>expand.grid()</code></a> function. I will specify a maternal age range from <code>15</code> to <code>45</code> in <code>5</code> year intervals and a smoking status variable equal to either <code>0</code> or <code>1</code>. This grid of new data (which I have called <code>newdf</code>) looks like:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>newdf <span class="ot">&lt;-</span>  <span class="fu">expand.grid</span>(<span class="at">age =</span> <span class="fu">seq</span>(<span class="dv">15</span>, <span class="dv">45</span>, <span class="at">by =</span> <span class="dv">5</span>),</span>
<span id="cb13-2"><a href="#cb13-2"></a>                      <span class="at">smoke =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb13-3"><a href="#cb13-3"></a>newdf <span class="sc">|&gt;</span> </span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: center;">age</th>
<th style="text-align: center;">smoke</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">15</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">20</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">25</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">30</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">35</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">40</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">45</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">15</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">20</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">25</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">30</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">35</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">40</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">45</td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that the variable names in your new dataframe <strong>MUST</strong> match the names of the corresponding variables in your original dataset, otherwise <code>predict()</code> will become upset with you and refuse to do any more work.</p>
</div>
</div>
<p>Now we are in a position to generate the predictions that we need. Nothing changes compared to before, except we now specify a new dataframe to predict upon using the <code>newdata</code> argument:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>newdf <span class="ot">&lt;-</span>  newdf <span class="sc">|&gt;</span> </span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> <span class="fu">predict</span>(mod2, <span class="at">newdata =</span> newdf))</span>
<span id="cb14-3"><a href="#cb14-3"></a>newdf <span class="sc">|&gt;</span> </span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: center;">age</th>
<th style="text-align: center;">smoke</th>
<th style="text-align: center;">pred</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">15</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">2960.6</td>
</tr>
<tr class="even">
<td style="text-align: center;">20</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3017.0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">25</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3073.5</td>
</tr>
<tr class="even">
<td style="text-align: center;">30</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3129.9</td>
</tr>
<tr class="odd">
<td style="text-align: center;">35</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3186.4</td>
</tr>
<tr class="even">
<td style="text-align: center;">40</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3242.8</td>
</tr>
<tr class="odd">
<td style="text-align: center;">45</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3299.3</td>
</tr>
<tr class="even">
<td style="text-align: center;">15</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2682.2</td>
</tr>
<tr class="odd">
<td style="text-align: center;">20</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2738.7</td>
</tr>
<tr class="even">
<td style="text-align: center;">25</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2795.1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">30</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2851.6</td>
</tr>
<tr class="even">
<td style="text-align: center;">35</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2908.0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">40</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2964.5</td>
</tr>
<tr class="even">
<td style="text-align: center;">45</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">3020.9</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="visualise-1" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="visualise-1"><span class="header-section-number">2.2.2</span> Visualise</h3>
<p>The key when we come to plotting the predictions is to now realise that because we are representing age on the x-axis, we need to use some other means to represent smoking status. In this case we can do that quite easily by using the colour aesthetic in our <code>ggplot</code> call:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> newdf, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> pred, <span class="at">color =</span> <span class="fu">factor</span>(smoke))) <span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> birthwt2, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> bwt), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="fu">xlab</span>(<span class="st">"Maternal Age"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted Birthweight"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Smoking Status"</span>) <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>Note that I converted smoking status to a factor variable on the fly so that <code>ggplot</code> knows that it only has two levels (otherwise it assumes it’s a continuous variable).</p>
<p>So, what do we actually have here, when I call this a plot of adjusted predictions? We have two parallel regression lines - one for smokers (blue) and one for non-smokers (red). They are parallel because ‘effects’ are additive - we did not specify an interaction between maternal age and smoking status. The red line is the predicted birthweight as a function of maternal age for non-smoking mothers and the blue line is the predicted birthweight as a function of maternal age for smoking mothers. In other words, predictions of the association between maternal age and newborn birthweight, adjusted for maternal smoking status (we can flip this around and also say that these are predictions of the association between smoking status and newborn birthweight, adjusted for maternal age). The regression line/s no longer zig-zag, like they did in the earlier plot, because we have separated out the ‘effect’ of the second exposure from the first allowing a ‘pure’ association between maternal age and newborn birthweight at each level of smoking status to be observed.</p>
<p>These same principles of prediction and visualisation can be applied in nearly all model plotting endeavours. There does, however, become a limit in the number of covariates that can practically be visualised and that is something we will look at in more detail in the next post.</p>
<p>I will conclude by saying that for this series I am going to illustrate all concepts using what I consider to be ‘first principles’ - that is, applying the <code>predict()</code> and <code>expand.grid()</code> functions for predicting, and <code>ggplot2</code> for visualising. But there may be better/faster ways to do this and a package I came across recently that I think would be worthwhile exploring is <a href="https://strengejacke.github.io/ggeffects/index.html"><code>ggeffects</code></a>. I haven’t used this myself but a quick scan of the package website gives me the impression this will make even shorter work of my ‘first principles’ approach. It is a package that I will keep in mind as we go forward on this topic.</p>
<p>Catch you in a couple of weeks…</p>


<!-- -->

</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="pgseye/Weekly_Stats_Tips" data-repo-id="R_kgDOKvfOfQ" data-category="General" data-category-id="DIC_kwDOKvfOfc4CbFWq" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb16" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb16-1"><a href="#cb16-1"></a><span class="co">---</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="an">title:</span><span class="co"> "Model Prediction/Visualisation &lt;br&gt; 1. The Basics"</span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="an">date:</span><span class="co"> 2025-03-21</span></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="an">categories:</span><span class="co"> [code, concept, modelling, visualisation]</span></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="an">image:</span><span class="co"> "images/plot.png"</span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="an">description:</span><span class="co"> "How to predict from your model."</span></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="co">---</span></span>
<span id="cb16-8"><a href="#cb16-8"></a></span>
<span id="cb16-9"><a href="#cb16-9"></a>Most of you will be familiar with how to create and run a statistical model in <span class="in">`R`</span>. But what do you then do with your model results? I bet you take <span class="in">`R`</span>'s rather bland console output, convert that to a formatted table in your manuscript, then based on the regression coefficient values, go on and talk about associations of your exposure/s with your outcome.</span>
<span id="cb16-10"><a href="#cb16-10"></a></span>
<span id="cb16-11"><a href="#cb16-11"></a>And leave it at that.</span>
<span id="cb16-12"><a href="#cb16-12"></a></span>
<span id="cb16-13"><a href="#cb16-13"></a>Well, the old adage of "a picture is worth a thousand words" has never been truer in the context of model prediction and how much additional information value you can obtain if you take your analyses a step further. Our reliance on just looking at the numbers (i.e. the regression coefficients) is sufficient a lot of the time in simple cases, but when models become a more complex - for example, by the specification of non-linear covariate functional forms via splines - regression coefficients on their own are essentially useless in aiding our interpretation. Plotting the model predictions, however, can put us back on track for understanding the important relationships in our data. Even a complex model can make more sense when we can visualise its predictions. These are skills worth learning and adding to your data analyst toolkit.</span>
<span id="cb16-14"><a href="#cb16-14"></a></span>
<span id="cb16-15"><a href="#cb16-15"></a>So, I thought I would put together a series of posts on predicting from and visualising your model, where in each post we cover a different area related to the subject. This week it's just about the basics of model prediction and visualisation, but in future posts I hope to extend those ideas to more advanced topics including non-linear functional forms, glm's, mixed-models, etc (let's see how we go). But first, let's start at the start...</span>
<span id="cb16-16"><a href="#cb16-16"></a></span>
<span id="cb16-17"><a href="#cb16-17"></a><span class="fu"># What is Model Prediction</span></span>
<span id="cb16-18"><a href="#cb16-18"></a></span>
<span id="cb16-19"><a href="#cb16-19"></a>When we specify a model using traditional <span class="in">`lm()`</span> syntax in <span class="in">`R`</span>, remember that we are just re-expressing the fundamental regression equation you will find in any statistical textbook:</span>
<span id="cb16-20"><a href="#cb16-20"></a></span>
<span id="cb16-21"><a href="#cb16-21"></a>$$ \hat{y} = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + ... $$</span>
<span id="cb16-22"><a href="#cb16-22"></a></span>
<span id="cb16-23"><a href="#cb16-23"></a>Where:</span>
<span id="cb16-24"><a href="#cb16-24"></a></span>
<span id="cb16-25"><a href="#cb16-25"></a>$\beta_0$ is the intercept (the expected value of $y$ when $x_1$ and $x_2$ are both equal to <span class="in">`0`</span>);</span>
<span id="cb16-26"><a href="#cb16-26"></a></span>
<span id="cb16-27"><a href="#cb16-27"></a>$\beta_1$ and $\beta_2$ are the regression coefficients for $x_1$ and $x_2$, respectively, and;</span>
<span id="cb16-28"><a href="#cb16-28"></a></span>
<span id="cb16-29"><a href="#cb16-29"></a>$\beta_1$ is the expected *change* in $y$ for a one-unit change in $x_1$ (when $x_2$ is held at a constant value);</span>
<span id="cb16-30"><a href="#cb16-30"></a></span>
<span id="cb16-31"><a href="#cb16-31"></a>$\beta_2$ is the expected *change* in $y$ for a one-unit change in $x_2$ (when $x_1$ is held at a constant value).</span>
<span id="cb16-32"><a href="#cb16-32"></a></span>
<span id="cb16-33"><a href="#cb16-33"></a>The coefficents in the regression equation define the relationship between each independent variable (exposure/predictor) and the dependent variable (outcome). But you don't need to stop there - it's very easy to enter values for the independent variables into the equation to also predict the expected (mean) value of the dependent variable. Let's take a look at a very simple example that uses the built-in <span class="in">`mtcars`</span> dataset in <span class="in">`R`</span>. Say we want to examine the relationship between fuel economy (miles/gallon <span class="sc">\[</span><span class="in">`mpg`</span><span class="sc">\]</span>) and weight and transmission type (<span class="in">`wt + am`</span>). A standard linear regression gives:</span>
<span id="cb16-34"><a href="#cb16-34"></a></span>
<span id="cb16-37"><a href="#cb16-37"></a><span class="in">```{r}</span></span>
<span id="cb16-38"><a href="#cb16-38"></a><span class="co">#| message: false</span></span>
<span id="cb16-39"><a href="#cb16-39"></a><span class="co">#| warning: false</span></span>
<span id="cb16-40"><a href="#cb16-40"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb16-41"><a href="#cb16-41"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb16-42"><a href="#cb16-42"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb16-43"><a href="#cb16-43"></a><span class="fu">summary</span>(<span class="fu">lm</span>(mpg <span class="sc">~</span> wt <span class="sc">+</span> am, <span class="at">data =</span> mtcars))</span>
<span id="cb16-44"><a href="#cb16-44"></a><span class="in">```</span></span>
<span id="cb16-45"><a href="#cb16-45"></a></span>
<span id="cb16-46"><a href="#cb16-46"></a>Interpreting just the regression coefficients, we could say that on average, a one-unit increase in weight (which corresponds here to <span class="in">`1000`</span> pounds) is associated with a reduction in fuel economy of <span class="in">`5.4`</span> mpg when transmission type is held constant. Similary, we can also say that on average, a one-unit increase in transmission type (which corresponds here to simply changing from an automatic to manual car) is associated with a barely notable reduction in fuel economy of <span class="in">`0.02`</span> mpg, when weight is held constant.</span>
<span id="cb16-47"><a href="#cb16-47"></a></span>
<span id="cb16-48"><a href="#cb16-48"></a>But we can use this model to make some simple predictions as well. You might want to know what is the expected fuel economy for a manual, <span class="in">`5000`</span> pound car (not very good I would think). Well it's a simple exercise in substitution:</span>
<span id="cb16-49"><a href="#cb16-49"></a></span>
<span id="cb16-50"><a href="#cb16-50"></a>$$ \hat{y} = 37.3 - 5.4 * 5 - 0.02 * 0 = 10.3 $$</span>
<span id="cb16-51"><a href="#cb16-51"></a></span>
<span id="cb16-52"><a href="#cb16-52"></a>Ok, what about the economy of a much lighter, automatic, <span class="in">`2000`</span> pound vehicle?</span>
<span id="cb16-53"><a href="#cb16-53"></a></span>
<span id="cb16-54"><a href="#cb16-54"></a>$$ \hat{y} = 37.3 - 5.4 * 2 - 0.02 * 1 = 26.5 $$</span>
<span id="cb16-55"><a href="#cb16-55"></a></span>
<span id="cb16-56"><a href="#cb16-56"></a>That's all that prediction is, really - substitution into your regression equation. Prediction in this context isn't about predicting the future - in fact for most simple models, time plays no role (although it may, depending on the research question and the model we are using). We are typically more interested in predicting the mean value of the dependent variable given specific values of the independent variable/s.</span>
<span id="cb16-57"><a href="#cb16-57"></a></span>
<span id="cb16-58"><a href="#cb16-58"></a>While you can predict for any combination of covariate values, the visualisation of model predictions comes into its own when we focus on the relationship between some exposure and an outcome, holding the values of all other covariates in the model fixed. These are, in other words, **adjusted** predictions, and can help you to answer the question: "What is the expected outcome for certain values or levels of my exposure, when I have removed any other potential confounding effects?"</span>
<span id="cb16-59"><a href="#cb16-59"></a></span>
<span id="cb16-60"><a href="#cb16-60"></a>Alright, I think you get enough of an idea that we can actually now take a look at a more concrete example.</span>
<span id="cb16-61"><a href="#cb16-61"></a></span>
<span id="cb16-62"><a href="#cb16-62"></a><span class="fu"># `birthwt` Dataset</span></span>
<span id="cb16-63"><a href="#cb16-63"></a></span>
<span id="cb16-64"><a href="#cb16-64"></a>In our very first example to show you how to get up and running with predicting and visualising from your model, we will use the <span class="in">`birthwt`</span> dataset that comes with the <span class="in">`MASS`</span> package. A listing of the variables can be found <span class="co">[</span><span class="ot">here</span><span class="co">](https://vincentarelbundock.github.io/Rdatasets/doc/MASS/birthwt.html)</span>, and the first <span class="in">`10`</span> rows of the dataframe look like:</span>
<span id="cb16-65"><a href="#cb16-65"></a></span>
<span id="cb16-68"><a href="#cb16-68"></a><span class="in">```{r}</span></span>
<span id="cb16-69"><a href="#cb16-69"></a><span class="fu">data</span>(birthwt, <span class="at">package =</span> <span class="st">"MASS"</span>)</span>
<span id="cb16-70"><a href="#cb16-70"></a><span class="fu">head</span>(birthwt, <span class="dv">10</span>)</span>
<span id="cb16-71"><a href="#cb16-71"></a><span class="in">```</span></span>
<span id="cb16-72"><a href="#cb16-72"></a></span>
<span id="cb16-73"><a href="#cb16-73"></a><span class="fu">## Birthweight as a Function of Maternal Age</span></span>
<span id="cb16-74"><a href="#cb16-74"></a></span>
<span id="cb16-75"><a href="#cb16-75"></a>Let's initially consider the possible association between baby birthweight (<span class="in">`bwt`</span> - outcome) and mother's <span class="in">`age`</span> (exposure). We will run the model as follows:</span>
<span id="cb16-76"><a href="#cb16-76"></a></span>
<span id="cb16-79"><a href="#cb16-79"></a><span class="in">```{r}</span></span>
<span id="cb16-80"><a href="#cb16-80"></a>mod <span class="ot">&lt;-</span>  <span class="fu">lm</span>(bwt <span class="sc">~</span> age, <span class="at">data =</span> birthwt)</span>
<span id="cb16-81"><a href="#cb16-81"></a><span class="fu">summary</span>(mod)</span>
<span id="cb16-82"><a href="#cb16-82"></a><span class="in">```</span></span>
<span id="cb16-83"><a href="#cb16-83"></a></span>
<span id="cb16-84"><a href="#cb16-84"></a>The model seems to suggest that increasing maternal age is associated with increasing birthweight. Keep in mind that this is unlikely to represent reality and I would guess that the relationship between maternal age and birthweight is non-linear (i.e. at some maternal age, birthweight is more likely to start decreasing with increasing maternal age). But for the sake of today's exercise let's just assume the relationship is linear.</span>
<span id="cb16-85"><a href="#cb16-85"></a></span>
<span id="cb16-86"><a href="#cb16-86"></a><span class="fu">### Predict</span></span>
<span id="cb16-87"><a href="#cb16-87"></a></span>
<span id="cb16-88"><a href="#cb16-88"></a>Calculating predictions from the model is as simple as using the <span class="in">`predict()`</span> function following your model call, adding the predictions as a new column to the original dataframe (or creating a new dataframe if you desire). Here I will just add the new column containing the predictions to a new dataframe containing only the relevant variables, and print the first <span class="in">`10`</span> rows:</span>
<span id="cb16-89"><a href="#cb16-89"></a></span>
<span id="cb16-92"><a href="#cb16-92"></a><span class="in">```{r}</span></span>
<span id="cb16-93"><a href="#cb16-93"></a>birthwt2 <span class="ot">&lt;-</span>  birthwt <span class="sc">|&gt;</span> </span>
<span id="cb16-94"><a href="#cb16-94"></a>  <span class="fu">select</span>(bwt, age) <span class="sc">|&gt;</span> </span>
<span id="cb16-95"><a href="#cb16-95"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> <span class="fu">predict</span>(mod))</span>
<span id="cb16-96"><a href="#cb16-96"></a><span class="fu">head</span>(birthwt2, <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb16-97"><a href="#cb16-97"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">1</span>)</span>
<span id="cb16-98"><a href="#cb16-98"></a><span class="in">```</span></span>
<span id="cb16-99"><a href="#cb16-99"></a></span>
<span id="cb16-100"><a href="#cb16-100"></a><span class="fu">### Visualise</span></span>
<span id="cb16-101"><a href="#cb16-101"></a></span>
<span id="cb16-102"><a href="#cb16-102"></a>Plotting the model predictions is simple using <span class="in">`ggplot2`</span>.</span>
<span id="cb16-103"><a href="#cb16-103"></a></span>
<span id="cb16-106"><a href="#cb16-106"></a><span class="in">```{r}</span></span>
<span id="cb16-107"><a href="#cb16-107"></a><span class="fu">ggplot</span>(birthwt2, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> pred)) <span class="sc">+</span></span>
<span id="cb16-108"><a href="#cb16-108"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>)</span>
<span id="cb16-109"><a href="#cb16-109"></a><span class="in">```</span></span>
<span id="cb16-110"><a href="#cb16-110"></a></span>
<span id="cb16-111"><a href="#cb16-111"></a>It can be useful to add in the raw datapoints, so let's do that, and I'll add a couple of plotting embellishments as well.</span>
<span id="cb16-112"><a href="#cb16-112"></a></span>
<span id="cb16-115"><a href="#cb16-115"></a><span class="in">```{r}</span></span>
<span id="cb16-116"><a href="#cb16-116"></a><span class="fu">ggplot</span>(<span class="at">data =</span> birthwt2, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> pred)) <span class="sc">+</span></span>
<span id="cb16-117"><a href="#cb16-117"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb16-118"><a href="#cb16-118"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> birthwt2, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> bwt)) <span class="sc">+</span></span>
<span id="cb16-119"><a href="#cb16-119"></a>  <span class="fu">xlab</span>(<span class="st">"Maternal Age"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted Birthweight"</span>) <span class="sc">+</span></span>
<span id="cb16-120"><a href="#cb16-120"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span>
<span id="cb16-121"><a href="#cb16-121"></a><span class="in">```</span></span>
<span id="cb16-122"><a href="#cb16-122"></a></span>
<span id="cb16-123"><a href="#cb16-123"></a>Great! We've generated predictions from our model and visualised the results. That wasn't too hard.</span>
<span id="cb16-124"><a href="#cb16-124"></a></span>
<span id="cb16-125"><a href="#cb16-125"></a><span class="fu">## Birthweight as a Function of Maternal Age and Smoking</span></span>
<span id="cb16-126"><a href="#cb16-126"></a></span>
<span id="cb16-127"><a href="#cb16-127"></a>Let's take it up a step by now including maternal smoking (<span class="in">`smoke`</span>) as another exposure in our model:</span>
<span id="cb16-128"><a href="#cb16-128"></a></span>
<span id="cb16-131"><a href="#cb16-131"></a><span class="in">```{r}</span></span>
<span id="cb16-132"><a href="#cb16-132"></a>mod2 <span class="ot">&lt;-</span>  <span class="fu">lm</span>(bwt <span class="sc">~</span> age <span class="sc">+</span> smoke, <span class="at">data =</span> birthwt)</span>
<span id="cb16-133"><a href="#cb16-133"></a><span class="fu">summary</span>(mod2)</span>
<span id="cb16-134"><a href="#cb16-134"></a><span class="in">```</span></span>
<span id="cb16-135"><a href="#cb16-135"></a></span>
<span id="cb16-136"><a href="#cb16-136"></a>So, the coefficient for <span class="in">`age`</span> hasn't really changed that much, but we can see that smoking seems to have a significant impact, decreasing birthweight on average by <span class="in">`278`</span> grams.</span>
<span id="cb16-137"><a href="#cb16-137"></a></span>
<span id="cb16-138"><a href="#cb16-138"></a>Let's predict birthweight from this model as we did before:</span>
<span id="cb16-139"><a href="#cb16-139"></a></span>
<span id="cb16-142"><a href="#cb16-142"></a><span class="in">```{r}</span></span>
<span id="cb16-143"><a href="#cb16-143"></a>birthwt2 <span class="ot">&lt;-</span>  birthwt <span class="sc">|&gt;</span> </span>
<span id="cb16-144"><a href="#cb16-144"></a>  <span class="fu">select</span>(bwt, age, smoke) <span class="sc">|&gt;</span> </span>
<span id="cb16-145"><a href="#cb16-145"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> <span class="fu">predict</span>(mod2))</span>
<span id="cb16-146"><a href="#cb16-146"></a><span class="fu">head</span>(birthwt2, <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb16-147"><a href="#cb16-147"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">1</span>)</span>
<span id="cb16-148"><a href="#cb16-148"></a><span class="in">```</span></span>
<span id="cb16-149"><a href="#cb16-149"></a></span>
<span id="cb16-150"><a href="#cb16-150"></a>And plot the predictions as we did before:</span>
<span id="cb16-151"><a href="#cb16-151"></a></span>
<span id="cb16-154"><a href="#cb16-154"></a><span class="in">```{r}</span></span>
<span id="cb16-155"><a href="#cb16-155"></a><span class="fu">ggplot</span>(<span class="at">data =</span> birthwt2, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> pred)) <span class="sc">+</span></span>
<span id="cb16-156"><a href="#cb16-156"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb16-157"><a href="#cb16-157"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> birthwt2, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> bwt)) <span class="sc">+</span></span>
<span id="cb16-158"><a href="#cb16-158"></a>  <span class="fu">xlab</span>(<span class="st">"Maternal Age"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted Birthweight"</span>) <span class="sc">+</span></span>
<span id="cb16-159"><a href="#cb16-159"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span>
<span id="cb16-160"><a href="#cb16-160"></a><span class="in">```</span></span>
<span id="cb16-161"><a href="#cb16-161"></a></span>
<span id="cb16-162"><a href="#cb16-162"></a>Uh-oh! Something has obviously gone badly wrong.</span>
<span id="cb16-163"><a href="#cb16-163"></a></span>
<span id="cb16-164"><a href="#cb16-164"></a>The problem is that we have **predicted on the original data** and the predictions are the result of the combination of each woman's unique values of both maternal age **and** smoking status. In other words, we are not just plotting the predicted value of birthweight as a function of maternal age alone, but rather as a function of both maternal age and smoking status. We are then trying to visualise those predictions as if they were generated from a function of maternal age alone.</span>
<span id="cb16-165"><a href="#cb16-165"></a></span>
<span id="cb16-166"><a href="#cb16-166"></a>As you can then see - "Computer says no".</span>
<span id="cb16-167"><a href="#cb16-167"></a></span>
<span id="cb16-168"><a href="#cb16-168"></a>To properly visualise predictions when more than one predictor are involved, requires that we find a way to generate the adjusted predictions I mentioned earlier. And, of course, there's a fairly easy way to do that in <span class="in">`R`</span>.</span>
<span id="cb16-169"><a href="#cb16-169"></a></span>
<span id="cb16-170"><a href="#cb16-170"></a><span class="fu">### Predict</span></span>
<span id="cb16-171"><a href="#cb16-171"></a></span>
<span id="cb16-172"><a href="#cb16-172"></a>When you have more than one covariate in your model, **predicting on new data** will allow you to generate the adjusted predictions that facilitate sensible visualisation. The <span class="in">`predict()`</span> function actually contains a <span class="in">`newdata`</span> argument that you can point towards a 'grid' of specified covariate values to predict on. This 'grid' is essentially a new dataframe that contains all possible combinations of covariates at salient values (typically a range of values at set intervals for numeric variables and every category/level for factor variables). In this way (adjusted) predictions can be made for one variable while keeping the other variable/s at fixed values.</span>
<span id="cb16-173"><a href="#cb16-173"></a></span>
<span id="cb16-174"><a href="#cb16-174"></a>To construct the grid of new data, we will use the <span class="co">[</span><span class="ot">`expand.grid()`</span><span class="co">](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/expand.grid)</span> function. I will specify a maternal age range from <span class="in">`15`</span> to <span class="in">`45`</span> in <span class="in">`5`</span> year intervals and a smoking status variable equal to either <span class="in">`0`</span> or <span class="in">`1`</span>. This grid of new data (which I have called <span class="in">`newdf`</span>) looks like:</span>
<span id="cb16-175"><a href="#cb16-175"></a></span>
<span id="cb16-178"><a href="#cb16-178"></a><span class="in">```{r}</span></span>
<span id="cb16-179"><a href="#cb16-179"></a>newdf <span class="ot">&lt;-</span>  <span class="fu">expand.grid</span>(<span class="at">age =</span> <span class="fu">seq</span>(<span class="dv">15</span>, <span class="dv">45</span>, <span class="at">by =</span> <span class="dv">5</span>),</span>
<span id="cb16-180"><a href="#cb16-180"></a>                      <span class="at">smoke =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb16-181"><a href="#cb16-181"></a>newdf <span class="sc">|&gt;</span> </span>
<span id="cb16-182"><a href="#cb16-182"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">1</span>)</span>
<span id="cb16-183"><a href="#cb16-183"></a><span class="in">```</span></span>
<span id="cb16-184"><a href="#cb16-184"></a></span>
<span id="cb16-185"><a href="#cb16-185"></a>::: callout-important</span>
<span id="cb16-186"><a href="#cb16-186"></a>Note that the variable names in your new dataframe **MUST** match the names of the corresponding variables in your original dataset, otherwise <span class="in">`predict()`</span> will become upset with you and refuse to do any more work.</span>
<span id="cb16-187"><a href="#cb16-187"></a>:::</span>
<span id="cb16-188"><a href="#cb16-188"></a></span>
<span id="cb16-189"><a href="#cb16-189"></a>Now we are in a position to generate the predictions that we need. Nothing changes compared to before, except we now specify a new dataframe to predict upon using the <span class="in">`newdata`</span> argument:</span>
<span id="cb16-190"><a href="#cb16-190"></a></span>
<span id="cb16-193"><a href="#cb16-193"></a><span class="in">```{r}</span></span>
<span id="cb16-194"><a href="#cb16-194"></a>newdf <span class="ot">&lt;-</span>  newdf <span class="sc">|&gt;</span> </span>
<span id="cb16-195"><a href="#cb16-195"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> <span class="fu">predict</span>(mod2, <span class="at">newdata =</span> newdf))</span>
<span id="cb16-196"><a href="#cb16-196"></a>newdf <span class="sc">|&gt;</span> </span>
<span id="cb16-197"><a href="#cb16-197"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">1</span>)</span>
<span id="cb16-198"><a href="#cb16-198"></a><span class="in">```</span></span>
<span id="cb16-199"><a href="#cb16-199"></a></span>
<span id="cb16-200"><a href="#cb16-200"></a><span class="fu">### Visualise</span></span>
<span id="cb16-201"><a href="#cb16-201"></a></span>
<span id="cb16-202"><a href="#cb16-202"></a>The key when we come to plotting the predictions is to now realise that because we are representing age on the x-axis, we need to use some other means to represent smoking status. In this case we can do that quite easily by using the colour aesthetic in our <span class="in">`ggplot`</span> call:</span>
<span id="cb16-203"><a href="#cb16-203"></a></span>
<span id="cb16-206"><a href="#cb16-206"></a><span class="in">```{r}</span></span>
<span id="cb16-207"><a href="#cb16-207"></a><span class="fu">ggplot</span>(<span class="at">data =</span> newdf, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> pred, <span class="at">color =</span> <span class="fu">factor</span>(smoke))) <span class="sc">+</span></span>
<span id="cb16-208"><a href="#cb16-208"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb16-209"><a href="#cb16-209"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> birthwt2, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> bwt), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb16-210"><a href="#cb16-210"></a>  <span class="fu">xlab</span>(<span class="st">"Maternal Age"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted Birthweight"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Smoking Status"</span>) <span class="sc">+</span></span>
<span id="cb16-211"><a href="#cb16-211"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb16-212"><a href="#cb16-212"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb16-213"><a href="#cb16-213"></a><span class="in">```</span></span>
<span id="cb16-214"><a href="#cb16-214"></a></span>
<span id="cb16-215"><a href="#cb16-215"></a>Note that I converted smoking status to a factor variable on the fly so that <span class="in">`ggplot`</span> knows that it only has two levels (otherwise it assumes it's a continuous variable).</span>
<span id="cb16-216"><a href="#cb16-216"></a></span>
<span id="cb16-217"><a href="#cb16-217"></a>So, what do we actually have here, when I call this a plot of adjusted predictions? We have two parallel regression lines - one for smokers (blue) and one for non-smokers (red). They are parallel because 'effects' are additive - we did not specify an interaction between maternal age and smoking status. The red line is the predicted birthweight as a function of maternal age for non-smoking mothers and the blue line is the predicted birthweight as a function of maternal age for smoking mothers. In other words, predictions of the association between maternal age and newborn birthweight, adjusted for maternal smoking status (we can flip this around and also say that these are predictions of the association between smoking status and newborn birthweight, adjusted for maternal age). The regression line/s no longer zig-zag, like they did in the earlier plot, because we have separated out the 'effect' of the second exposure from the first allowing a 'pure' association between maternal age and newborn birthweight at each level of smoking status to be observed.</span>
<span id="cb16-218"><a href="#cb16-218"></a></span>
<span id="cb16-219"><a href="#cb16-219"></a>These same principles of prediction and visualisation can be applied in nearly all model plotting endeavours. There does, however, become a limit in the number of covariates that can practically be visualised and that is something we will look at in more detail in the next post.</span>
<span id="cb16-220"><a href="#cb16-220"></a></span>
<span id="cb16-221"><a href="#cb16-221"></a>I will conclude by saying that for this series I am going to illustrate all concepts using what I consider to be 'first principles' - that is, applying the <span class="in">`predict()`</span> and <span class="in">`expand.grid()`</span> functions for predicting, and <span class="in">`ggplot2`</span> for visualising. But there may be better/faster ways to do this and a package I came across recently that I think would be worthwhile exploring is <span class="co">[</span><span class="ot">`ggeffects`</span><span class="co">](https://strengejacke.github.io/ggeffects/index.html)</span>. I haven't used this myself but a quick scan of the package website gives me the impression this will make even shorter work of my 'first principles' approach. It is a package that I will keep in mind as we go forward on this topic.</span>
<span id="cb16-222"><a href="#cb16-222"></a></span>
<span id="cb16-223"><a href="#cb16-223"></a>Catch you in a couple of weeks...</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>