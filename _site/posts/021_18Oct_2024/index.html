<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-10-18">
<meta name="description" content="If you find survival analysis confusing - this post is for you.">

<title>Test Site 2 - Survival Analysis - Under the Hood</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Test Site 2</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">All Posts</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-is-survival-analysis" id="toc-what-is-survival-analysis" class="nav-link active" data-scroll-target="#what-is-survival-analysis"><span class="header-section-number">1</span> What is Survival Analysis?</a></li>
  <li><a href="#what-does-survival-data-look-like" id="toc-what-does-survival-data-look-like" class="nav-link" data-scroll-target="#what-does-survival-data-look-like"><span class="header-section-number">2</span> What Does Survival Data Look Like?</a>
  <ul>
  <li><a href="#calendar-time-format" id="toc-calendar-time-format" class="nav-link" data-scroll-target="#calendar-time-format"><span class="header-section-number">2.1</span> Calendar-time format</a></li>
  <li><a href="#time-on-study-format" id="toc-time-on-study-format" class="nav-link" data-scroll-target="#time-on-study-format"><span class="header-section-number">2.2</span> Time-on-study format</a></li>
  </ul></li>
  <li><a href="#could-we-use-logistic-regression-instead" id="toc-could-we-use-logistic-regression-instead" class="nav-link" data-scroll-target="#could-we-use-logistic-regression-instead"><span class="header-section-number">3</span> Could We Use Logistic Regression Instead?</a>
  <ul>
  <li><a href="#this-bed-is-too-soft" id="toc-this-bed-is-too-soft" class="nav-link" data-scroll-target="#this-bed-is-too-soft"><span class="header-section-number">3.1</span> This bed is too soft</a></li>
  <li><a href="#this-bed-is-too-hard" id="toc-this-bed-is-too-hard" class="nav-link" data-scroll-target="#this-bed-is-too-hard"><span class="header-section-number">3.2</span> This bed is too hard</a></li>
  <li><a href="#ahhh-just-right" id="toc-ahhh-just-right" class="nav-link" data-scroll-target="#ahhh-just-right"><span class="header-section-number">3.3</span> Ahhh, just right</a></li>
  <li><a href="#the-take-home-message" id="toc-the-take-home-message" class="nav-link" data-scroll-target="#the-take-home-message"><span class="header-section-number">3.4</span> The take-home message</a></li>
  </ul></li>
  <li><a href="#probability-in-survival-analysis-can-mean-different-things" id="toc-probability-in-survival-analysis-can-mean-different-things" class="nav-link" data-scroll-target="#probability-in-survival-analysis-can-mean-different-things"><span class="header-section-number">4</span> Probability In Survival Analysis Can Mean Different Things</a>
  <ul>
  <li><a href="#questions---so-many-questions" id="toc-questions---so-many-questions" class="nav-link" data-scroll-target="#questions---so-many-questions"><span class="header-section-number">4.1</span> Questions - so many questions…</a></li>
  <li><a href="#some-answershopefully" id="toc-some-answershopefully" class="nav-link" data-scroll-target="#some-answershopefully"><span class="header-section-number">4.2</span> Some answers…hopefully</a>
  <ul class="collapse">
  <li><a href="#marginal-probabilities-of-event" id="toc-marginal-probabilities-of-event" class="nav-link" data-scroll-target="#marginal-probabilities-of-event"><span class="header-section-number">4.2.1</span> Marginal probabilities of event</a></li>
  <li><a href="#conditional-probabilities-of-event" id="toc-conditional-probabilities-of-event" class="nav-link" data-scroll-target="#conditional-probabilities-of-event"><span class="header-section-number">4.2.2</span> Conditional probabilities of event</a></li>
  <li><a href="#survival" id="toc-survival" class="nav-link" data-scroll-target="#survival"><span class="header-section-number">4.2.3</span> Survival</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#hazard-rates-are-fundamental-to-survival-analysis" id="toc-hazard-rates-are-fundamental-to-survival-analysis" class="nav-link" data-scroll-target="#hazard-rates-are-fundamental-to-survival-analysis"><span class="header-section-number">5</span> Hazard Rates Are Fundamental To Survival Analysis</a>
  <ul>
  <li><a href="#definition" id="toc-definition" class="nav-link" data-scroll-target="#definition"><span class="header-section-number">5.1</span> Definition</a></li>
  <li><a href="#the-hazard-rate-is-related-to-the-incident-rate" id="toc-the-hazard-rate-is-related-to-the-incident-rate" class="nav-link" data-scroll-target="#the-hazard-rate-is-related-to-the-incident-rate"><span class="header-section-number">5.2</span> The hazard rate is related to the incident rate</a></li>
  <li><a href="#some-common-hazard-function-shapes" id="toc-some-common-hazard-function-shapes" class="nav-link" data-scroll-target="#some-common-hazard-function-shapes"><span class="header-section-number">5.3</span> Some common hazard function shapes</a>
  <ul class="collapse">
  <li><a href="#constant-exponential" id="toc-constant-exponential" class="nav-link" data-scroll-target="#constant-exponential"><span class="header-section-number">5.3.1</span> Constant (exponential)</a></li>
  <li><a href="#increasing-weibull" id="toc-increasing-weibull" class="nav-link" data-scroll-target="#increasing-weibull"><span class="header-section-number">5.3.2</span> Increasing (Weibull)</a></li>
  <li><a href="#decreasing-weibull" id="toc-decreasing-weibull" class="nav-link" data-scroll-target="#decreasing-weibull"><span class="header-section-number">5.3.3</span> Decreasing (Weibull)</a></li>
  <li><a href="#increasingdecreasing-lognormal" id="toc-increasingdecreasing-lognormal" class="nav-link" data-scroll-target="#increasingdecreasing-lognormal"><span class="header-section-number">5.3.4</span> Increasing/Decreasing (lognormal)</a></li>
  <li><a href="#bathtub" id="toc-bathtub" class="nav-link" data-scroll-target="#bathtub"><span class="header-section-number">5.3.5</span> Bathtub</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#time-scales" id="toc-time-scales" class="nav-link" data-scroll-target="#time-scales"><span class="header-section-number">6</span> Time Scales</a>
  <ul>
  <li><a href="#time-on-study" id="toc-time-on-study" class="nav-link" data-scroll-target="#time-on-study"><span class="header-section-number">6.1</span> Time-on-study</a></li>
  <li><a href="#age" id="toc-age" class="nav-link" data-scroll-target="#age"><span class="header-section-number">6.2</span> Age</a></li>
  </ul></li>
  <li><a href="#its-a-choose-your-own-survival-analysis-adventure" id="toc-its-a-choose-your-own-survival-analysis-adventure" class="nav-link" data-scroll-target="#its-a-choose-your-own-survival-analysis-adventure"><span class="header-section-number">7</span> It’s A Choose-Your-Own Survival Analysis Adventure</a>
  <ul>
  <li><a href="#non-parametric-kaplan-meier-estimator" id="toc-non-parametric-kaplan-meier-estimator" class="nav-link" data-scroll-target="#non-parametric-kaplan-meier-estimator"><span class="header-section-number">7.1</span> Non-parametric (Kaplan-Meier estimator)</a></li>
  <li><a href="#semi-parametric-cox-model" id="toc-semi-parametric-cox-model" class="nav-link" data-scroll-target="#semi-parametric-cox-model"><span class="header-section-number">7.2</span> Semi-parametric (Cox model)</a></li>
  <li><a href="#parametric-exponential-weibull-log-normal-etc" id="toc-parametric-exponential-weibull-log-normal-etc" class="nav-link" data-scroll-target="#parametric-exponential-weibull-log-normal-etc"><span class="header-section-number">7.3</span> Parametric (exponential, Weibull, log-normal, etc)</a></li>
  </ul></li>
  <li><a href="#extensions" id="toc-extensions" class="nav-link" data-scroll-target="#extensions"><span class="header-section-number">8</span> Extensions</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">9</span> Summary</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Survival Analysis - Under the Hood</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">code</div>
    <div class="quarto-category">concept</div>
    <div class="quarto-category">survival</div>
  </div>
  </div>

<div>
  <div class="description">
    If you find survival analysis confusing - this post is for you.
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 18, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Welcome to today’s post which is based on a talk that some of you may have heard me give in lab meetings. A warning in advance - it’s a bit of a lengthy one, so maybe down a couple of reds to steel yourself before you start. We’re going to discuss survival analysis, but in a similar spirit to how I presented the post on logistic regression a couple of months ago - nothing too fancy, but with an aim that you understand what is happening ‘under the hood’ when you next fire up your stats software to plot a Kaplan-Meier curve or run a Cox model.</p>
<p>Survival analysis is a BIG topic and in university statistics courses, it tends to have an entire subject dedicted just to it, so it’s not just taught as a part of regression modelling, for example. I also don’t find it particularly easy, even now - there are a lot of challenging concepts to understand, and that is in large part because <strong>time</strong> is such an integral component of everything you do in this area of biostatistics. So, what I hope I can do today is to take a broad-brush approach to survival methods, touch on the concepts that I think are most important in establishing a good base understanding, build in a little intuition for these, and also give you some practical tips along the way.</p>
<p>Let’s get started.</p>
<section id="what-is-survival-analysis" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> What is Survival Analysis?</h1>
<p>So what is survival analysis? Any time you’re interested in knowing about the <strong>time</strong> to some endpoint or event, you are probably wanting a survival analysis. So we might be interested in the <strong>time to death</strong> or the <strong>time to development of new symptoms</strong>, or <strong>time to relapse</strong> in our field. Each of these endpoints is considered an ‘event’.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Time to this event is the outcome variable in survival analysis</strong> and it’s continuous and strictly positive (i.e.&nbsp;you can’t have negative times).</p>
</div>
</div>
<p>We measure time from the start of follow-up to that event. Now an important concept here is the start of follow-up, because this can seem quite vague.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The start of follow-up or observation is also commonly referred to as ‘time 0’, the ‘time origin’ or ‘baseline’. Pick your poison and be consistent. I will use ‘time 0’ through the remainder of this post.</p>
</div>
</div>
<p>You need to think about time 0 as the point at which the subject becomes <strong>‘at risk’</strong> of developing the event that we’re interested in. In a clinical trial, this is at randomisation. If we’re interested in death from some disease (or maybe relapse in MS), time 0 is usually the point of diagnosis (or possibly the start of treatment). We can also use birth as time 0 and I’ll talk about that in a bit. Keep in mind that survival methods aren’t exclusive to medicine - time to re-offending upon release from jail is an equally valid use of the techniques in social research and criminology.</p>
<p>Finally, an observation is <strong>right-censored</strong> if the subject still hasn’t had the event at the last point that we observe them. They might have dropped out of the study for various reasons, the study has simply been ended by us, or they may have experienced some other event that prevents further follow-up.</p>
</section>
<section id="what-does-survival-data-look-like" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> What Does Survival Data Look Like?</h1>
<section id="calendar-time-format" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="calendar-time-format"><span class="header-section-number">2.1</span> Calendar-time format</h2>
<p>What does survival data look like? Well - in the case of a prospective study, subjects are usually recruited into the study at different times. To illustrate this, let’s consider this hypothetical dataset of patients diagnosed with some disease that we follow until they either die or are right-censored. The study was planned to recruit for 4 months from Dec 2015 to Mar 2016, and during this period <code>5</code> subjects were entered into the study, all starting at various times, but importantly, the exact dates of their start were recorded. All subjects were then followed at regular intervals, and the study was then ended, as planned, in Jan 2017.</p>
<p>Now, this is showing the observation times for each subject as they occurred in <strong>calendar-time format</strong>. While this reflects the reality of how survival data are collected, it doesn’t really inform you with an intuitive sense of time because you can’t easily make comparisons across subjects.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/survival_calendar.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="time-on-study-format" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="time-on-study-format"><span class="header-section-number">2.2</span> Time-on-study format</h2>
<p>So, for easier interpretation we can align the start time of all subjects like so - and we call this format, <strong>‘time-on-study’</strong>. We can see that Subject 1 dropped out because they moved interstate and couldn’t attend clinic appointments anymore, and so they are considered censored. Their follow-up time was <code>6</code> months. Subjects 2 and 4 are also censored, but for a different reason - they were still alive when we decided to end the study and had the study gone on we may have been able to follow them for longer. In any case they were each observed for <code>12</code> months. Unfortunately, the other two subjects weren’t so lucky - Subject 3 died after <code>7</code> months and Subject 5 died after <code>4</code> months of being in the study.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/survival_study.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Now, what if we were interested in working out the one-year survival for this sample of patients?</p>
<p><strong>How would you do that?</strong></p>
</section>
</section>
<section id="could-we-use-logistic-regression-instead" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Could We Use Logistic Regression Instead?</h1>
<p>You might be thinking at this point, well we’re dealing with a binary outcome and I know that’s what we use logistic regression for. Couldn’t I just count up the number of subjects still alive at one year and divide that by the number of subjects at the start? (this is estimating a proportion which is equivalent in this simple case to a logistic regression with just an intercept in the model).</p>
<p>Well you could do that, but the problem is that you’re then ignoring time and we know that as Subject 1 was censored prior to one-year, we don’t really know what happened to them in the meantime. Were they still alive at one year or did they in fact die? So, we’ve got a choice to make.</p>
<section id="this-bed-is-too-soft" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="this-bed-is-too-soft"><span class="header-section-number">3.1</span> This bed is too soft</h2>
<p>This can commonly lead us to assume that the subject survived the full year - and if I’m to borrow a metaphor from a children’s fable, it would have to in this case be Goldilocks. So what we have here is the equivalent of Goldilock’s bed being too soft.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/goldi_soft.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%"></p>
</figure>
</div>
<p>Under this assumption we would include Subject 1 in the proportion numerator and calculate the one-year survival as <code>3/5</code> or <code>60%</code> (we could also get that from a logistic regression model).</p>
<p><span class="math display">\[
\text{Survival (one-year)} = \frac{\text{3}}{\text{5}} = 60\%
\]</span></p>
<p>But there’s something not quite right about that.</p>
<p>Unfortunately, Goldilocks doesn’t sleep well.</p>
</section>
<section id="this-bed-is-too-hard" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="this-bed-is-too-hard"><span class="header-section-number">3.2</span> This bed is too hard</h2>
<p>Well then, let’s be conservative you might say, and assume Subject 1 has in fact died. In this case we would exclude them from the proportion numerator and calculate the one-year survival as <code>2/5</code> or <code>40%</code>. Can I suggest this is now the equivalent of Goldilock’s bed being too hard, because we know Subject 1 was followed for a full 6 months - that must count for something surely?</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/goldi_hard.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%"></p>
</figure>
</div>
<p><span class="math display">\[
\text{Survival (one-year)} = \frac{\text{2}}{\text{5}} = 40\%
\]</span></p>
<p>Poor Goldilocks still doesn’t sleep well.</p>
</section>
<section id="ahhh-just-right" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="ahhh-just-right"><span class="header-section-number">3.3</span> Ahhh, just right</h2>
<p>When you use survival methods, it in fact turns out that the probability of surviving in the entire year, taking into account censoring is <code>(4/5)x(2/3) = 53%</code>, somewhere in between <code>40</code> and <code>60%</code> - ahhh, Goldilocks has finally found the right bed.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/goldi_ahh.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%"></p>
</figure>
</div>
<p><span class="math display">\[
\text{Survival (one-year)} = \frac{\text{4}}{\text{5}} \times \frac{\text{2}}{\text{3}} = 53\%
\]</span> I will show you how to get to that number shortly.</p>
</section>
<section id="the-take-home-message" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="the-take-home-message"><span class="header-section-number">3.4</span> The take-home message</h2>
<p>If everybody is observed for at least the same length of time of interest (e.g.&nbsp;1 year), logistic regression could be used…</p>
<p>… but not if the duration of observation is less for some people.</p>
</section>
</section>
<section id="probability-in-survival-analysis-can-mean-different-things" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Probability In Survival Analysis Can Mean Different Things</h1>
<p>Probabilities can be a little tricky in survival analysis because they are very context-dependent. We can talk about the <strong>event probability density</strong>. This effectively gives the probability distribution of survival times, which remember is the outcome in survival analysis. We can also talk about the <strong>hazard</strong>, which is the <strong>instantaneous probability</strong> or <strong>risk</strong> of experiencing the event. And then we can also talk about the <strong>probability of survival</strong>, which tells us how many people haven’t experienced the event by same point in time.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Think of a density function as the continuous analog to a frequency distribution for a discrete variable. An example of the latter might be the number after the roll of a dice, and we can represent the distribution of resulting 1’s, 2’s, 3’s, 4’s, 5’s and 6’s with a frequency histogram. Given that survival times are continuous in nature (i.e.&nbsp;they can take on <em>any</em> positive value - not just discrete values) we represent the distribution of survival times with a density function instead.</p>
</div>
</div>
<section id="questions---so-many-questions" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="questions---so-many-questions"><span class="header-section-number">4.1</span> Questions - so many questions…</h2>
<p>So, let me get you thinking about this by way of a thought exercise.</p>
<p>If I were to ask you about human mortality; then as a function of age, how would you draw or describe:</p>
<ol type="1">
<li><p>The probability of death?</p></li>
<li><p>The hazard of death?</p></li>
<li><p>Survival?</p></li>
</ol>
<p>Following from that:</p>
<ol type="1">
<li><p>Is the probability of death greater at 80 or 100?</p></li>
<li><p>Is the hazard of death greater at 80 or 100?</p></li>
</ol>
<p>And finally:</p>
<p><strong>What’s the difference!?</strong></p>
</section>
<section id="some-answershopefully" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="some-answershopefully"><span class="header-section-number">4.2</span> Some answers…hopefully</h2>
<p>Ok, this is a little bit of a trick question, because it really hangs on semantics.</p>
<section id="marginal-probabilities-of-event" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="marginal-probabilities-of-event"><span class="header-section-number">4.2.1</span> Marginal probabilities of event</h3>
<p>When we talk about the probability of death we are referring to a probability density for death (as a function of age). This is where the area under the density curve (and while this involves a bit of calculus, you don’t need to concern yourself with the details) adds up to <code>1</code> - that is everyone is certain to die eventually. In other words the sums of all possible probabilities of dying across all ages equals <code>1</code> - and that’s what essentially defines a probability density function. So if you look at the following plot you will appreciate that the overall probability of death gradually increases until about <code>80</code> years than actually declines after that. So, in fact the most likely age to die at is about <code>80</code>, not <code>100</code>, and that’s simply because fewer people are alive at <code>100</code> in the first place. This is what is known as a <strong>‘marginal’</strong> probability of death.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/prob_density.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:40.0%"></p>
</figure>
</div>
</section>
<section id="conditional-probabilities-of-event" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="conditional-probabilities-of-event"><span class="header-section-number">4.2.2</span> Conditional probabilities of event</h3>
<p>Now, the marginal probability of death is a different concept to the <strong>hazard</strong> of death. The hazard represents an instantaneous or <strong>conditional</strong> risk of the event happening. Looking at the commensurate hazard function, you will see that it increases exponentially. What this is saying is that the probability or risk that you die in the next year, increases the longer you remain alive. So, the risk of dying in the next year, <strong>given</strong> that you survived until <code>100</code> years is far, far, greater than than case for an <code>80</code> year old. These are conditional probabilities. In other words, the risk in the next instant of experiencing the event given you haven’t yet experienced it.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/prob_hazard.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:40.0%"></p>
</figure>
</div>
</section>
<section id="survival" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="survival"><span class="header-section-number">4.2.3</span> Survival</h3>
<p>And then finally the survival. This isn’t difficult. We all die (don’t thank me for cheering you up) - so the survival function eventually reaches <code>0</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/prob_survival.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:40.0%"></p>
</figure>
</div>
</section>
</section>
</section>
<section id="hazard-rates-are-fundamental-to-survival-analysis" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Hazard Rates Are Fundamental To Survival Analysis</h1>
<section id="definition" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="definition"><span class="header-section-number">5.1</span> Definition</h2>
<p>Ok, so having some understanding of the hazard rate is really important in survival analysis. At a basic level, the hazard rate is like an incident rate - the number of new events that occur in a period of time divided by the number of people at risk of that event at the beginning of that period. But it gets a little more complicated because the hazard rate is actually the limiting case of that - the <strong>instantaneous</strong> event rate. In other words the probability that, given that a subject has survived up to some time <code>t</code>, that he or she has the event in the next infinitesimally small time interval, divided by the length of that interval - and we need to use calculus to be able to compute that. The hazard rate ranges from <code>0</code> (no risk of the event) to infinity (certain to experience the event) and over time, it can be constant, increase, decrease, or take some other non-monotonic pattern, which I’ll show you in a moment.</p>
<p>The non-complicated, non-calculus formula for the hazard rate is shown below: Basically the hazard rate can be thought of as the number of events between time <span class="math inline">\(t\)</span> and <span class="math inline">\(\delta t\)</span>, divided by the number of people at risk of the event at time <span class="math inline">\(t\)</span> - that gives a conditional probability of the event - and then we divide that by the length of the interval.</p>
<p><span class="math display">\[
h(t) = \lim_{\delta \text{t} \to 0} \frac{\left( \cfrac{ \text{number of events between time t and } (\text{t} + \delta \text{t})}{\text{number of people at risk at time t }} \right) } {\delta \text{t}}
\]</span></p>
<p><span class="math display">\[
= \lim_{\delta \text{t} \to 0} \frac{\text{conditional probability of event between time t and } (\text{t} + \delta \text{t})} {\delta \text{t}}
\]</span></p>
</section>
<section id="the-hazard-rate-is-related-to-the-incident-rate" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="the-hazard-rate-is-related-to-the-incident-rate"><span class="header-section-number">5.2</span> The hazard rate is related to the incident rate</h2>
<p>Let me use a silly example to illustrate this idea of how the hazard rate is related to your run-of-the-mill incident rate. Let’s think about the hazard of getting married at 20 years of age - perilous I might suggest. But jokes aside, how would you work this out? Well we could start by thinking in terms of the incident rate - in a nutshell, count up the number of people married between the ages of <code>20</code> and 21 and divide that by the number NOT already married at age <code>20</code>.</p>
<p>So, let’s say we have <code>1000</code> people in a population of interest who still aren’t married at age <code>20</code> and we follow them forward and see that <code>100</code> get married in the next year. The incident rate is then <code>100</code>/<code>1000</code> per year or <code>0.1</code> marriages per year.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/hazard_20_yrs.1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>We could have actually considered a shorter time interval to work out the incident rate - let’s now say <code>6</code> months instead of one year. Assuming marriages are evenly distributed then the incident rate is now <code>50</code>/<code>1000</code> per <code>6</code> months or <code>0.05</code> marriages per 1/2 year.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/hazard_20_yrs.2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>And we could even consider the incident rate in the forthcoming day, which would be <code>0.274</code>/<code>1000</code> per day or <code>0.000274</code> marriages per day.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/hazard_20_yrs.3.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>So the incident rate differs in these three cases <strong>only</strong> because we are using different units of time. If we normalised the time period to one year in the second and third scenarios, then we would expect the same number of marriages over the year.</p>
<p>The point of all of this is really to show you that the hazard rate is a <strong>limiting case of the incident rate</strong>. As the time interval approaches zero, we essentially have an instantaneous estimate of the risk of the event at any point in time and this is what the hazard rate represents. It’s not hard when you think about it.</p>
</section>
<section id="some-common-hazard-function-shapes" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="some-common-hazard-function-shapes"><span class="header-section-number">5.3</span> Some common hazard function shapes</h2>
<p>Let’s have a look at some of the more common hazard function shapes that we might encounter. The shape of the hazard function is determined by the underlying disease, physiological or physical process - so some of these are more realistic in biological systems and some more realistic in mechanical systems.</p>
<section id="constant-exponential" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="constant-exponential"><span class="header-section-number">5.3.1</span> Constant (exponential)</h3>
<p>The first example is of a constant hazard - so the <strong>risk of failure at any point in time is the same</strong>. This could apply to a light bulb and it could also apply to a healthy individual in a study. When the hazard function is constant we say the survival model is <strong>exponential</strong> and memoryless, in that the age of the subject has no bearing on the instantaneous risk of failure. Now, this is not the most realistic distribution for biological systems, because - taking a well-known quote from a textbook - “If human lifetimes were exponential there wouldn’t be old or young people, just lucky or unlucky ones”.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/hazard_rate_constant.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</section>
<section id="increasing-weibull" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="increasing-weibull"><span class="header-section-number">5.3.2</span> Increasing (Weibull)</h3>
<p>This is a monotone increasing hazard function. This is one of the more realistic shapes that we expect in the real world - basically as things age, they wear out and are more likely to fail. In industry, cars and batteries are good examples of this. Most biological systems also follow this profile - as humans it’s why our life insurance premiums go up as we age. At <code>60</code> you’ve done well to have lived this long, but your short term prospects aren’t as optimistic as they were at <code>20</code>, and the actuaries build this in to their company’s insurance premiums.</p>
<p>An example in a medical study might be the hazard of metastatic cancer patients, where the event of interest is death. As survival time increases for such a patient, and as the prognosis accordingly worsens, the patient’s potential for dying of the disease also increases.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/hazard_rate_increasing.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</section>
<section id="decreasing-weibull" class="level3" data-number="5.3.3">
<h3 data-number="5.3.3" class="anchored" data-anchor-id="decreasing-weibull"><span class="header-section-number">5.3.3</span> Decreasing (Weibull)</h3>
<p>But not everything wears out over time. This is an example of a monotone decreasing hazard. Many electronic systems actually become more robust over time - believe it or not. In other words, the instantaneous risk of failure tends to be higher earlier on and then subsides with time. So manufacturers can utilise that to their advantage by running the system for a period before shipping and if it passes, it’s likely to be ok for the customer.</p>
<p>In medicine we might see this in patients recovering from major surgery, because the potential for dying after surgery usually decreases as the time after surgery increases.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/hazard_rate_decreasing.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</section>
<section id="increasingdecreasing-lognormal" class="level3" data-number="5.3.4">
<h3 data-number="5.3.4" class="anchored" data-anchor-id="increasingdecreasing-lognormal"><span class="header-section-number">5.3.4</span> Increasing/Decreasing (lognormal)</h3>
<p>Now we’re getting even more complex with a hazard function that can both increase and decrease. These kinds of shapes become increasingly difficult to generalise, but a specific example might be the hazard for tuberculosis patients since their potential for dying from the disease initially increases and then subsides.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/hazard_rate_increase_decrease.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</section>
<section id="bathtub" class="level3" data-number="5.3.5">
<h3 data-number="5.3.5" class="anchored" data-anchor-id="bathtub"><span class="header-section-number">5.3.5</span> Bathtub</h3>
<p>And then finally the ‘bathtub’ shaped hazard function, which I introduced to you before when talking about the risks of humans dying with age. In a general sense, this hazard function reflects the fact that some of the riskiest days of your life are those following birth, and then things start to settle down through and until mid-life.</p>
<p>But gradually, as you age, parts of your body start to wear out and your short-term risk begins to increase again - and if you manage to get to 80 for example, then your short-term risk of dying might be as high as it was during your first months of life.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/hazard_rate_bathtub.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</section>
</section>
</section>
<section id="time-scales" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Time Scales</h1>
<p>I just want to briefly touch on the idea of time scales. As I mentioned earlier the time origin is deﬁned as the time point at which individuals are first placed ‘at risk’ for the event occurring. But the choice of time origin should really be determined by clinical reasons and there are actually two time primary scales you can consider. By far the most common choice is to simply use time-on-study - so set time = <code>0</code> for example, from the point that a subject was diagnosed with a disease; had a surgical procedure; or was randomised into a clinical trial. And this makes sense because the outcome of interest can really only occur as the disease diagnosis or surgical procedure effectively places the subject ‘at risk’ of the outcome.</p>
<p>But in some cases, the distinction is less obvious and using age as the time scale can be more appropriate and actually make more sense. This is usually when you have outcomes of interest that are related more to ageing - e.g.&nbsp;the development of breast cancer, stroke, etc - because subjects may actually be at risk from a time earlier than when they became enrolled into the study. What we are basically suggesting here is that <strong>subjects become ‘at risk’ of the disease from birth</strong>.</p>
<p>So, when you are thinking about the design and analysis of your next time-to-event study, ask yourself when do subjects first become ‘at risk’ of this event? and on what scale is that underlying risk most likely to change?</p>
<section id="time-on-study" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="time-on-study"><span class="header-section-number">6.1</span> Time-on-study</h2>
<p>I want to illustrate these ideas about time scales with a figure and a very simplified example. Let’s assume this is some hazard function for death related to some fictitious disease. The risk of death related to this disease initially increases and then decreases over time. <img src="images/hazard_time_on_study_scale_overall.png" class="img-fluid quarto-figure quarto-figure-center" style="width:80.0%"></p>
<p>When we look at the hazard, it’s a fairly safe bet that we would use time-on-study in this case, <strong>because the hazard is going to primarily be a function of time since diagnosis more than a function of age</strong>. And that’s because <strong>the subject becomes at risk of the outcome from the point of diagnosis</strong>. So in this case we can expect subjects of any age to have a similar hazard. If we were to estimate a Cox model for example, the hazards are fairly consistent in shape across subjects, regardless of age (note that the intercepts might actually be different for different ages - gives rise to proportional hazards - but the shapes are consistent). In other words, an apples-to-apples comparison of the hazard function at any point in observation time.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/hazard_time_on_study_scale_individual.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</section>
<section id="age" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="age"><span class="header-section-number">6.2</span> Age</h2>
<p>But now let’s assume that the same hazard is instead a function of age instead of time-on-study - for the sake of the exercise let’s say the outcome is now a type of cancer and <strong>you become ‘at risk’ of this cancer from birth</strong>. So the risk of the outcome this time relates more to just getting older than it does to any other precursor event.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/hazard_age_scale_overall.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>In this case, if we were to use time-on-study as the time scale, we end up trying to compare hazard functions among age groups that are not consistent in shape on that time scale. So, the hazard for a <code>20</code> year old entering the study might be different to the hazard for a <code>60</code> year old entering the study. Now we are attempting an apples-to-oranges comparison of the hazard function at any point in observation time and that is less than ideal - instead, we’re better off using age as the time scale on which to base our computations.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/hazard_age_scale_individual.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>When using age as the time scale for the analysis, age is automatically corrected for in the analysis and does not require specific covariate adjustment.</p>
</div>
</div>
</section>
</section>
<section id="its-a-choose-your-own-survival-analysis-adventure" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> It’s A Choose-Your-Own Survival Analysis Adventure</h1>
<p>Alright, let’s actually talk about some of the methods themselves. I think when people first look at survival analysis, they can find it confronting with the array of analysis approaches on offer. But the thing here to realise is that each of these is a tool for a particular job, and once you know that you can start to focus in on what method (or methods) best answer your research questions.</p>
<p>So, the three main forms of survival analysis are <strong>non-parametric</strong>, and that typically involves creating Kaplan-Meier curves; <strong>semi-parametric</strong>, and that pretty much revolves around the Cox model; and <strong>fully parametric</strong>, and here you have an assortment of statistical distributions for the survival times that you can choose from.</p>
<section id="non-parametric-kaplan-meier-estimator" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="non-parametric-kaplan-meier-estimator"><span class="header-section-number">7.1</span> Non-parametric (Kaplan-Meier estimator)</h2>
<p>So, in statistics, what does non-parametric actually mean? Basically, we do not rely on any assumptions that the data are drawn from a given parametric family of probability distributions. So we’re less interested or able to make inferences about the population and we’re really only talking about the data that we actually have - the sample at hand.</p>
<p>Now, in survival analysis, the Kaplan-Meier estimator is one such non-parametric approach to calculating the survival function. <strong>We don’t make any assumptions about the distribution of survival times in the population from which the sample was drawn.</strong> So, it’s just the empirical probability of surviving past certain times in the sample - and to that end it’s main purpose is descriptive.</p>
<p>The Kaplan-Meier approach is NOT a modelling method, and it’s really about visualising survival - and we can do this overall or commonly by splitting based on one important grouping variable, whether that be treatment or some other exposure variable (e.g.&nbsp;sex). Usually this a starting point in your survival analyses, and you’ll go on and do some modelling, but sometimes a simple Kaplan-Meier curve is enough to do what you want.</p>
<p>Let’s revisit that first example I showed you with the <code>5</code> patients, because it’s a worthwhile exercise in understanding how the Kaplan-Meier estimator works out a probability of survival taking into account, censoring. It’s a simple exercise with these data but with more complex datasets you obviously wouldn’t do this manually.</p>
<p>So, we have our <code>5</code> patients and we want to plot the proportion surviving at every step over the study duration.</p>
<p>Remember that if we’d used logistic regression, then depending on how we defined our censored subject we could have ended up with a one-year survival of either <code>40</code> or <code>60%</code>, and in fact the correct one-year survival estimate is <code>53%</code>. How do we get that?</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/km_estimator.1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>So, we start at time <code>0</code> with <code>100%</code> survival and with all subjects at risk of the event.</p>
<p>We know that survival remains at <code>100%</code> until at least month <code>4</code> because everyone remains alive during that time.</p>
<p>But then Subject <code>5</code> dies at <code>4</code> months. So, this is the event we’re interested in and the survival probability is <strong>re-estimated</strong> each time there is an event. How do we do that? Well, we multiply the <strong>cumulative survival proportion</strong> before the event by the <strong>conditional survival proportion</strong> just after the event - conditional because a subject must have survived at least until the event, to remain in the study after it.</p>
<p>And if we do that, this time around it’s a fairly straightforward multiplication of <code>1</code> x <code>4</code>/<code>5</code>, which gives <code>80%</code>. Note that censoring has not even entered into this calculation yet.</p>
<p>So the proportion surviving immediately after <code>4</code> months is <code>80%</code> and the number of people at risk of dying at this point is <code>4</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/km_estimator.2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Now as we go along in the time line we see that Subject <code>1</code> is censored at <code>6</code> months and we indicate that with a mark at that time point. Note that the <strong>survival estimate doesn’t change</strong> after <code>6</code> months, but the number of people at risk of dying now reduces by <code>1</code> to <code>3</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/km_estimator.3.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Now Subject <code>3</code> dies at <code>7</code> months. To re-estimate the survival this time we need to take just a little bit of extra care. The cumulative survival proportion immediately before <code>7</code> months is still <code>80%</code> but when we work out the conditional survival immediately after <code>7</code> months, the censoring of Subject <code>1</code> means that we now only have <code>2</code> people remaining alive (that we are certain about) out of the <code>3</code> potentially at risk, just prior to the death.</p>
<p>We then multiply those two survival proportions to give us the overall survival after <code>7</code> months. And that is <code>4</code> people out of <code>5</code> (<code>80%</code>) alive immediately prior to and <code>2</code> people out of <code>3</code> (<code>67%</code>) alive immediately after. The overall estimate of survival at <code>7</code> months is then <code>4</code>/<code>5</code> times <code>2</code>/<code>3</code> which gives us the <code>53%</code> we stated earlier.</p>
<p>Clearly this is a very simple case and you can appreciate how complicated this can get in larger datasets, but standard functions will take care of the calculations for you in whatever statistical package you’re using.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/km_estimator.4.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="semi-parametric-cox-model" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="semi-parametric-cox-model"><span class="header-section-number">7.2</span> Semi-parametric (Cox model)</h2>
<p>If you want to estimate survival as a function of more than just one grouping variable, then you really need to look further afield than the Kaplan-Meier estimator and this is usually where people will turn to a Cox model.</p>
<p>The Cox model is considered semi-parametric because there is both a non-parametric component and a fully parametric component. The <strong>baseline hazard function is non-parametric</strong> and is estimated directly from the sample data without any assumptions about the distribution of survival times. Because of this the hazard function in a Cox model can take on any shape you can imagine. This is both an advantage and a disadvantage - an advantage because the shape can be highly flexible, but a disadvantage because we don’t actually get any information returned in terms of parameter estimates that tell us anything about what that shape looks like.</p>
<p>The <strong>parametric part of the Cox model is to do with the effects of the predictors on the hazard function</strong> - and these are assumed to be linearly related to the log of the hazard. The coefficient estimates we get out of a Cox model are exponentiated to give a hazard ratio which is just the ratio of two hazard rates.</p>
<p>Because we don’t get any parameter estimates for the baseline hazard function, we aren’t in a position to easily predict the absolute risk of an event, and so the strength of the Cox model is really in providing information about relative rather than absolute risks of the event occurring.</p>
<p>And finally because the hazard is empirical, you really shouldn’t try to predict from a Cox model beyond the range of observable data that you have.</p>
<p>Ok, before we leave the Cox model, let’s talk about The Elephant in the room - proportional hazards. This is probably the most important assumption that you need to keep in mind and one that you should really test for each time you run a Cox model.</p>
<p>The proportional hazards assumption basically requires that the hazard ratio is constant over time, or equivalently, that the hazard for one individual is proportional to the hazard for any other individual, and where the proportionality constant doesn’t depend on time.</p>
<p>So if we look at the figure below - I have plotted hypothetical hazard functions for males (in blue) and females (in red) for the risk of some event. You’ll note that the shapes are essentially the same but are scaled versions of one another. When proportional hazards hold, then we can take a ratio of the two hazard rates at any time point and that ratio should remain constant. And I’ve illustrated that here at two time points - <span class="math inline">\(t1\)</span> and <span class="math inline">\(t2\)</span>. The difference in the hazards obviously varies but the ratio of the hazards at those two time points is the same. At time <code>1</code> a hazard rate of <code>3</code> for males and <code>2</code> for females gives a hazard ratio of <code>1.5</code> and similarly, at time <code>2</code>, a hazard rate of <code>0.75</code> for males and <code>0.5</code> for females, again gives a hazard ratio of <code>1.5</code>.</p>
<p>In reality, hazard rates are probably not going to be exactly proportional the entire time, but the aim is to make sure any departures from proportionality are minimal - otherwise this means the hazard ratio itself varies with time and this adds further complexity to your model.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/prop_hazards.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="parametric-exponential-weibull-log-normal-etc" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="parametric-exponential-weibull-log-normal-etc"><span class="header-section-number">7.3</span> Parametric (exponential, Weibull, log-normal, etc)</h2>
<p>Fully parametric survival models are essentially the same in concept and interpretation to the Cox model, barring a few structural differences. The main difference to the Cox model is that <strong>the baseline hazard function is fully specified</strong> in these models. In other words, the hazard function is assumed to follow a particular statistical distribution, and we looked at some of these before - monotone increasing, decreasing, lognormal, etc. And this then becomes a modelling choice that you have to make. You can never be certain that you’ve chosen the correct distribution but there are tools that you can use to guide your choice - theory should always be at the top of the list, but you can also do things like generate empirical hazards to see what their shape might look like, compare model fits via some fitting criteria like the AIC, and so on. If you get the distribution about right, these models are <strong>more powerful</strong> than their Cox counterparts.</p>
<p>Like Cox models, you get adjusted estimates of risk/survival. Unlike Cox models, you can estimate absolute risk of the event of interest, because you get a model parameter or parameters returned for that. Additionally, you’re in a better position with these models to predict beyond the maximum follow-up time, because there is a specified distribution of survival times that is expected to follow that of the population. But that comes with the usual caveat of always be careful about extrapolating beyond the range of your data.</p>
</section>
</section>
<section id="extensions" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Extensions</h1>
<p>And to end, some rabbit-holes that you can go down in your survival analysis endeavours:</p>
<ul>
<li>Time-dependent covariates:
<ul>
<li>The value of the covariate (e.g.&nbsp;treatment, weight, etc) changes over time, but it’s effect remains constant (i.e.&nbsp;the HR doesn’t change).</li>
</ul></li>
<li>Time-dependent coefficients:
<ul>
<li>The value of the covariate doesn’t change over time, but it’s effect does (i.e.&nbsp;the HR varies over time).</li>
</ul></li>
<li>Flexible parametric models:
<ul>
<li>Include splines on the log baseline hazard to allow even more flexibility in hazard function shapes (<strong>I am becoming a huge advocate of these</strong>).</li>
</ul></li>
<li>Competing risks:
<ul>
<li>Explicitly account for other events that ‘compete’ with our primary event of interest.</li>
</ul></li>
<li>Recurrent events/frailties (clustering)
<ul>
<li>More than one event per person/groups of people with shared characteristics.</li>
</ul></li>
</ul>
</section>
<section id="summary" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Summary</h1>
<p>Remember how I said Survival Analysis was a BIG subject!</p>
<p>If you ever struggled with the fundamentals, I hope today’s post has helped to clarify some of these ideas. There is a really good book on the topic that I can recommend if you want to do some more reading. It is comprehensive enough, yet I think gets the message across without the use of complicated theory and formulae.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/surv_text.jpeg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:30.0%"></p>
</figure>
</div>
<p>Until next time - may your models actually reflect reality.</p>
<p>(Most figures in today’s post created with&nbsp;<a href="https://www.biorender.com/">BioRender.com</a>).</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="pgseye/Weekly_Stats_Tips" data-repo-id="R_kgDOKvfOfQ" data-category="General" data-category-id="DIC_kwDOKvfOfc4CbFWq" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb1" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">---</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="an">title:</span><span class="co"> "Survival Analysis - Under the Hood"</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="an">date:</span><span class="co"> 2024-10-18</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="an">categories:</span><span class="co"> [code, concept, survival]</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co">#image: "R_small.jpeg"</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="an">description:</span><span class="co"> "If you find survival analysis confusing - this post is for you."</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">---</span></span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a>Welcome to today's post which is based on a talk that some of you may have heard me give in lab meetings. A warning in advance - it's a bit of a lengthy one, so maybe down a couple of reds to steel yourself before you start. We're going to discuss survival analysis, but in a similar spirit to how I presented the post on logistic regression a couple of months ago - nothing too fancy, but with an aim that you understand what is happening 'under the hood' when you next fire up your stats software to plot a Kaplan-Meier curve or run a Cox model.</span>
<span id="cb1-10"><a href="#cb1-10"></a></span>
<span id="cb1-11"><a href="#cb1-11"></a>Survival analysis is a BIG topic and in university statistics courses, it tends to have an entire subject dedicted just to it, so it's not just taught as a part of regression modelling, for example. I also don't find it particularly easy, even now - there are a lot of challenging concepts to understand, and that is in large part because **time** is such an integral component of everything you do in this area of biostatistics. So, what I hope I can do today is to take a broad-brush approach to survival methods, touch on the concepts that I think are most important in establishing a good base understanding, build in a little intuition for these, and also give you some practical tips along the way.</span>
<span id="cb1-12"><a href="#cb1-12"></a></span>
<span id="cb1-13"><a href="#cb1-13"></a>Let's get started.</span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="fu"># What is Survival Analysis?</span></span>
<span id="cb1-16"><a href="#cb1-16"></a></span>
<span id="cb1-17"><a href="#cb1-17"></a>So what is survival analysis? Any time you're interested in knowing about the **time** to some endpoint or event, you are probably wanting a survival analysis. So we might be interested in the **time to death** or the **time to development of new symptoms**, or **time to relapse** in our field. Each of these endpoints is considered an 'event'.</span>
<span id="cb1-18"><a href="#cb1-18"></a></span>
<span id="cb1-19"><a href="#cb1-19"></a>::: callout-important</span>
<span id="cb1-20"><a href="#cb1-20"></a>**Time to this event is the outcome variable in survival analysis** and it's continuous and strictly positive (i.e. you can't have negative times).</span>
<span id="cb1-21"><a href="#cb1-21"></a>:::</span>
<span id="cb1-22"><a href="#cb1-22"></a></span>
<span id="cb1-23"><a href="#cb1-23"></a>We measure time from the start of follow-up to that event. Now an important concept here is the start of follow-up, because this can seem quite vague.</span>
<span id="cb1-24"><a href="#cb1-24"></a></span>
<span id="cb1-25"><a href="#cb1-25"></a>::: callout-note</span>
<span id="cb1-26"><a href="#cb1-26"></a>The start of follow-up or observation is also commonly referred to as 'time 0', the 'time origin' or 'baseline'. Pick your poison and be consistent. I will use 'time 0' through the remainder of this post.</span>
<span id="cb1-27"><a href="#cb1-27"></a>:::</span>
<span id="cb1-28"><a href="#cb1-28"></a></span>
<span id="cb1-29"><a href="#cb1-29"></a>You need to think about time 0 as the point at which the subject becomes **'at risk'** of developing the event that we're interested in. In a clinical trial, this is at randomisation. If we're interested in death from some disease (or maybe relapse in MS), time 0 is usually the point of diagnosis (or possibly the start of treatment). We can also use birth as time 0 and I'll talk about that in a bit. Keep in mind that survival methods aren't exclusive to medicine - time to re-offending upon release from jail is an equally valid use of the techniques in social research and criminology.</span>
<span id="cb1-30"><a href="#cb1-30"></a></span>
<span id="cb1-31"><a href="#cb1-31"></a>Finally, an observation is **right-censored** if the subject still hasn't had the event at the last point that we observe them. They might have dropped out of the study for various reasons, the study has simply been ended by us, or they may have experienced some other event that prevents further follow-up.</span>
<span id="cb1-32"><a href="#cb1-32"></a></span>
<span id="cb1-33"><a href="#cb1-33"></a><span class="fu"># What Does Survival Data Look Like?</span></span>
<span id="cb1-34"><a href="#cb1-34"></a></span>
<span id="cb1-35"><a href="#cb1-35"></a><span class="fu">## Calendar-time format</span></span>
<span id="cb1-36"><a href="#cb1-36"></a></span>
<span id="cb1-37"><a href="#cb1-37"></a>What does survival data look like? Well - in the case of a prospective study, subjects are usually recruited into the study at different times. To illustrate this, let's consider this hypothetical dataset of patients diagnosed with some disease that we follow until they either die or are right-censored. The study was planned to recruit for 4 months from Dec 2015 to Mar 2016, and during this period <span class="in">`5`</span> subjects were entered into the study, all starting at various times, but importantly, the exact dates of their start were recorded. All subjects were then followed at regular intervals, and the study was then ended, as planned, in Jan 2017.</span>
<span id="cb1-38"><a href="#cb1-38"></a></span>
<span id="cb1-39"><a href="#cb1-39"></a>Now, this is showing the observation times for each subject as they occurred in **calendar-time format**. While this reflects the reality of how survival data are collected, it doesn't really inform you with an intuitive sense of time because you can't easily make comparisons across subjects.</span>
<span id="cb1-40"><a href="#cb1-40"></a></span>
<span id="cb1-41"><a href="#cb1-41"></a><span class="al">![](images/survival_calendar.png)</span>{fig-align="center"}</span>
<span id="cb1-42"><a href="#cb1-42"></a></span>
<span id="cb1-43"><a href="#cb1-43"></a><span class="fu">## Time-on-study format</span></span>
<span id="cb1-44"><a href="#cb1-44"></a></span>
<span id="cb1-45"><a href="#cb1-45"></a>So, for easier interpretation we can align the start time of all subjects like so - and we call this format, **'time-on-study'**. We can see that Subject 1 dropped out because they moved interstate and couldn't attend clinic appointments anymore, and so they are considered censored. Their follow-up time was <span class="in">`6`</span> months. Subjects 2 and 4 are also censored, but for a different reason - they were still alive when we decided to end the study and had the study gone on we may have been able to follow them for longer. In any case they were each observed for <span class="in">`12`</span> months. Unfortunately, the other two subjects weren't so lucky - Subject 3 died after <span class="in">`7`</span> months and Subject 5 died after <span class="in">`4`</span> months of being in the study.</span>
<span id="cb1-46"><a href="#cb1-46"></a></span>
<span id="cb1-47"><a href="#cb1-47"></a><span class="al">![](images/survival_study.png)</span>{fig-align="center"}</span>
<span id="cb1-48"><a href="#cb1-48"></a></span>
<span id="cb1-49"><a href="#cb1-49"></a>Now, what if we were interested in working out the one-year survival for this sample of patients?</span>
<span id="cb1-50"><a href="#cb1-50"></a></span>
<span id="cb1-51"><a href="#cb1-51"></a>**How would you do that?**</span>
<span id="cb1-52"><a href="#cb1-52"></a></span>
<span id="cb1-53"><a href="#cb1-53"></a><span class="fu"># Could We Use Logistic Regression Instead?</span></span>
<span id="cb1-54"><a href="#cb1-54"></a></span>
<span id="cb1-55"><a href="#cb1-55"></a>You might be thinking at this point, well we're dealing with a binary outcome and I know that's what we use logistic regression for. Couldn't I just count up the number of subjects still alive at one year and divide that by the number of subjects at the start? (this is estimating a proportion which is equivalent in this simple case to a logistic regression with just an intercept in the model).</span>
<span id="cb1-56"><a href="#cb1-56"></a></span>
<span id="cb1-57"><a href="#cb1-57"></a>Well you could do that, but the problem is that you're then ignoring time and we know that as Subject 1 was censored prior to one-year, we don't really know what happened to them in the meantime. Were they still alive at one year or did they in fact die? So, we've got a choice to make.</span>
<span id="cb1-58"><a href="#cb1-58"></a></span>
<span id="cb1-59"><a href="#cb1-59"></a><span class="fu">## This bed is too soft</span></span>
<span id="cb1-60"><a href="#cb1-60"></a></span>
<span id="cb1-61"><a href="#cb1-61"></a>This can commonly lead us to assume that the subject survived the full year - and if I'm to borrow a metaphor from a children's fable, it would have to in this case be Goldilocks. So what we have here is the equivalent of Goldilock's bed being too soft.</span>
<span id="cb1-62"><a href="#cb1-62"></a></span>
<span id="cb1-63"><a href="#cb1-63"></a><span class="al">![](images/goldi_soft.png)</span>{fig-align="center" width="60%"}</span>
<span id="cb1-64"><a href="#cb1-64"></a></span>
<span id="cb1-65"><a href="#cb1-65"></a>Under this assumption we would include Subject 1 in the proportion numerator and calculate the one-year survival as <span class="in">`3/5`</span> or <span class="in">`60%`</span> (we could also get that from a logistic regression model).</span>
<span id="cb1-66"><a href="#cb1-66"></a></span>
<span id="cb1-67"><a href="#cb1-67"></a>$$</span>
<span id="cb1-68"><a href="#cb1-68"></a>\text{Survival (one-year)} = \frac{\text{3}}{\text{5}} = 60\%</span>
<span id="cb1-69"><a href="#cb1-69"></a>$$</span>
<span id="cb1-70"><a href="#cb1-70"></a></span>
<span id="cb1-71"><a href="#cb1-71"></a>But there's something not quite right about that.</span>
<span id="cb1-72"><a href="#cb1-72"></a></span>
<span id="cb1-73"><a href="#cb1-73"></a>Unfortunately, Goldilocks doesn't sleep well.</span>
<span id="cb1-74"><a href="#cb1-74"></a></span>
<span id="cb1-75"><a href="#cb1-75"></a><span class="fu">## This bed is too hard</span></span>
<span id="cb1-76"><a href="#cb1-76"></a></span>
<span id="cb1-77"><a href="#cb1-77"></a>Well then, let's be conservative you might say, and assume Subject 1 has in fact died. In this case we would exclude them from the proportion numerator and calculate the one-year survival as <span class="in">`2/5`</span> or <span class="in">`40%`</span>. Can I suggest this is now the equivalent of Goldilock's bed being too hard, because we know Subject 1 was followed for a full 6 months - that must count for something surely?</span>
<span id="cb1-78"><a href="#cb1-78"></a></span>
<span id="cb1-79"><a href="#cb1-79"></a><span class="al">![](images/goldi_hard.png)</span>{fig-align="center" width="60%"}</span>
<span id="cb1-80"><a href="#cb1-80"></a></span>
<span id="cb1-81"><a href="#cb1-81"></a>$$</span>
<span id="cb1-82"><a href="#cb1-82"></a>\text{Survival (one-year)} = \frac{\text{2}}{\text{5}} = 40\%</span>
<span id="cb1-83"><a href="#cb1-83"></a>$$</span>
<span id="cb1-84"><a href="#cb1-84"></a></span>
<span id="cb1-85"><a href="#cb1-85"></a>Poor Goldilocks still doesn't sleep well.</span>
<span id="cb1-86"><a href="#cb1-86"></a></span>
<span id="cb1-87"><a href="#cb1-87"></a><span class="fu">## Ahhh, just right</span></span>
<span id="cb1-88"><a href="#cb1-88"></a></span>
<span id="cb1-89"><a href="#cb1-89"></a>When you use survival methods, it in fact turns out that the probability of surviving in the entire year, taking into account censoring is <span class="in">`(4/5)x(2/3) = 53%`</span>, somewhere in between <span class="in">`40`</span> and <span class="in">`60%`</span> - ahhh, Goldilocks has finally found the right bed.</span>
<span id="cb1-90"><a href="#cb1-90"></a></span>
<span id="cb1-91"><a href="#cb1-91"></a><span class="al">![](images/goldi_ahh.png)</span>{fig-align="center" width="60%"}</span>
<span id="cb1-92"><a href="#cb1-92"></a></span>
<span id="cb1-93"><a href="#cb1-93"></a>$$</span>
<span id="cb1-94"><a href="#cb1-94"></a>\text{Survival (one-year)} = \frac{\text{4}}{\text{5}} \times \frac{\text{2}}{\text{3}} = 53\%</span>
<span id="cb1-95"><a href="#cb1-95"></a>$$ I will show you how to get to that number shortly.</span>
<span id="cb1-96"><a href="#cb1-96"></a></span>
<span id="cb1-97"><a href="#cb1-97"></a><span class="fu">## The take-home message</span></span>
<span id="cb1-98"><a href="#cb1-98"></a></span>
<span id="cb1-99"><a href="#cb1-99"></a>If everybody is observed for at least the same length of time of interest (e.g. 1 year), logistic regression could be used...</span>
<span id="cb1-100"><a href="#cb1-100"></a></span>
<span id="cb1-101"><a href="#cb1-101"></a>... but not if the duration of observation is less for some people.</span>
<span id="cb1-102"><a href="#cb1-102"></a></span>
<span id="cb1-103"><a href="#cb1-103"></a><span class="fu"># Probability In Survival Analysis Can Mean Different Things</span></span>
<span id="cb1-104"><a href="#cb1-104"></a></span>
<span id="cb1-105"><a href="#cb1-105"></a>Probabilities can be a little tricky in survival analysis because they are very context-dependent. We can talk about the **event probability density**. This effectively gives the probability distribution of survival times, which remember is the outcome in survival analysis. We can also talk about the **hazard**, which is the **instantaneous probability** or **risk** of experiencing the event. And then we can also talk about the **probability of survival**, which tells us how many people haven't experienced the event by same point in time.</span>
<span id="cb1-106"><a href="#cb1-106"></a></span>
<span id="cb1-107"><a href="#cb1-107"></a>::: callout-note</span>
<span id="cb1-108"><a href="#cb1-108"></a>Think of a density function as the continuous analog to a frequency distribution for a discrete variable. An example of the latter might be the number after the roll of a dice, and we can represent the distribution of resulting 1's, 2's, 3's, 4's, 5's and 6's with a frequency histogram. Given that survival times are continuous in nature (i.e. they can take on *any* positive value - not just discrete values) we represent the distribution of survival times with a density function instead.</span>
<span id="cb1-109"><a href="#cb1-109"></a>:::</span>
<span id="cb1-110"><a href="#cb1-110"></a></span>
<span id="cb1-111"><a href="#cb1-111"></a><span class="fu">## Questions - so many questions...</span></span>
<span id="cb1-112"><a href="#cb1-112"></a></span>
<span id="cb1-113"><a href="#cb1-113"></a>So, let me get you thinking about this by way of a thought exercise.</span>
<span id="cb1-114"><a href="#cb1-114"></a></span>
<span id="cb1-115"><a href="#cb1-115"></a>If I were to ask you about human mortality; then as a function of age, how would you draw or describe:</span>
<span id="cb1-116"><a href="#cb1-116"></a></span>
<span id="cb1-117"><a href="#cb1-117"></a><span class="ss">1.  </span>The probability of death?</span>
<span id="cb1-118"><a href="#cb1-118"></a></span>
<span id="cb1-119"><a href="#cb1-119"></a><span class="ss">2.  </span>The hazard of death?</span>
<span id="cb1-120"><a href="#cb1-120"></a></span>
<span id="cb1-121"><a href="#cb1-121"></a><span class="ss">3.  </span>Survival?</span>
<span id="cb1-122"><a href="#cb1-122"></a></span>
<span id="cb1-123"><a href="#cb1-123"></a>Following from that:</span>
<span id="cb1-124"><a href="#cb1-124"></a></span>
<span id="cb1-125"><a href="#cb1-125"></a><span class="ss">1.  </span>Is the probability of death greater at 80 or 100?</span>
<span id="cb1-126"><a href="#cb1-126"></a></span>
<span id="cb1-127"><a href="#cb1-127"></a><span class="ss">2.  </span>Is the hazard of death greater at 80 or 100?</span>
<span id="cb1-128"><a href="#cb1-128"></a></span>
<span id="cb1-129"><a href="#cb1-129"></a>And finally:</span>
<span id="cb1-130"><a href="#cb1-130"></a></span>
<span id="cb1-131"><a href="#cb1-131"></a>**What's the difference!?**</span>
<span id="cb1-132"><a href="#cb1-132"></a></span>
<span id="cb1-133"><a href="#cb1-133"></a><span class="fu">## Some answers...hopefully</span></span>
<span id="cb1-134"><a href="#cb1-134"></a></span>
<span id="cb1-135"><a href="#cb1-135"></a>Ok, this is a little bit of a trick question, because it really hangs on semantics.</span>
<span id="cb1-136"><a href="#cb1-136"></a></span>
<span id="cb1-137"><a href="#cb1-137"></a><span class="fu">### Marginal probabilities of event </span></span>
<span id="cb1-138"><a href="#cb1-138"></a></span>
<span id="cb1-139"><a href="#cb1-139"></a>When we talk about the probability of death we are referring to a probability density for death (as a function of age). This is where the area under the density curve (and while this involves a bit of calculus, you don't need to concern yourself with the details) adds up to <span class="in">`1`</span> - that is everyone is certain to die eventually. In other words the sums of all possible probabilities of dying across all ages equals <span class="in">`1`</span> - and that's what essentially defines a probability density function. So if you look at the following plot you will appreciate that the overall probability of death gradually increases until about <span class="in">`80`</span> years than actually declines after that. So, in fact the most likely age to die at is about <span class="in">`80`</span>, not <span class="in">`100`</span>, and that's simply because fewer people are alive at <span class="in">`100`</span> in the first place. This is what is known as a **'marginal'** probability of death.</span>
<span id="cb1-140"><a href="#cb1-140"></a></span>
<span id="cb1-141"><a href="#cb1-141"></a><span class="al">![](images/prob_density)</span>{fig-align="center" width="40%"}</span>
<span id="cb1-142"><a href="#cb1-142"></a></span>
<span id="cb1-143"><a href="#cb1-143"></a><span class="fu">### Conditional probabilities of event</span></span>
<span id="cb1-144"><a href="#cb1-144"></a></span>
<span id="cb1-145"><a href="#cb1-145"></a>Now, the marginal probability of death is a different concept to the **hazard** of death. The hazard represents an instantaneous or **conditional** risk of the event happening. Looking at the commensurate hazard function, you will see that it increases exponentially. What this is saying is that the probability or risk that you die in the next year, increases the longer you remain alive. So, the risk of dying in the next year, **given** that you survived until <span class="in">`100`</span> years is far, far, greater than than case for an <span class="in">`80`</span> year old. These are conditional probabilities. In other words, the risk in the next instant of experiencing the event given you haven't yet experienced it.</span>
<span id="cb1-146"><a href="#cb1-146"></a></span>
<span id="cb1-147"><a href="#cb1-147"></a><span class="al">![](images/prob_hazard)</span>{fig-align="center" width="40%"}</span>
<span id="cb1-148"><a href="#cb1-148"></a></span>
<span id="cb1-149"><a href="#cb1-149"></a><span class="fu">### Survival</span></span>
<span id="cb1-150"><a href="#cb1-150"></a></span>
<span id="cb1-151"><a href="#cb1-151"></a>And then finally the survival. This isn't difficult. We all die (don't thank me for cheering you up) - so the survival function eventually reaches <span class="in">`0`</span>.</span>
<span id="cb1-152"><a href="#cb1-152"></a></span>
<span id="cb1-153"><a href="#cb1-153"></a><span class="al">![](images/prob_survival)</span>{fig-align="center" width="40%"}</span>
<span id="cb1-154"><a href="#cb1-154"></a></span>
<span id="cb1-155"><a href="#cb1-155"></a><span class="fu"># Hazard Rates Are Fundamental To Survival Analysis</span></span>
<span id="cb1-156"><a href="#cb1-156"></a></span>
<span id="cb1-157"><a href="#cb1-157"></a><span class="fu">## Definition</span></span>
<span id="cb1-158"><a href="#cb1-158"></a></span>
<span id="cb1-159"><a href="#cb1-159"></a>Ok, so having some understanding of the hazard rate is really important in survival analysis. At a basic level, the hazard rate is like an incident rate - the number of new events that occur in a period of time divided by the number of people at risk of that event at the beginning of that period. But it gets a little more complicated because the hazard rate is actually the limiting case of that - the **instantaneous** event rate. In other words the probability that, given that a subject has survived up to some time <span class="in">`t`</span>, that he or she has the event in the next infinitesimally small time interval, divided by the length of that interval - and we need to use calculus to be able to compute that. The hazard rate ranges from <span class="in">`0`</span> (no risk of the event) to infinity (certain to experience the event) and over time, it can be constant, increase, decrease, or take some other non-monotonic pattern, which I'll show you in a moment.</span>
<span id="cb1-160"><a href="#cb1-160"></a></span>
<span id="cb1-161"><a href="#cb1-161"></a>The non-complicated, non-calculus formula for the hazard rate is shown below: Basically the hazard rate can be thought of as the number of events between time $t$ and $\delta t$, divided by the number of people at risk of the event at time $t$ - that gives a conditional probability of the event - and then we divide that by the length of the interval.</span>
<span id="cb1-162"><a href="#cb1-162"></a></span>
<span id="cb1-163"><a href="#cb1-163"></a>$$</span>
<span id="cb1-164"><a href="#cb1-164"></a>h(t) = \lim_{\delta \text{t} \to 0} \frac{\left( \cfrac{ \text{number of events between time t and } (\text{t} + \delta \text{t})}{\text{number of people at risk at time t }} \right) } {\delta \text{t}}</span>
<span id="cb1-165"><a href="#cb1-165"></a>$$</span>
<span id="cb1-166"><a href="#cb1-166"></a></span>
<span id="cb1-167"><a href="#cb1-167"></a>$$</span>
<span id="cb1-168"><a href="#cb1-168"></a>= \lim_{\delta \text{t} \to 0} \frac{\text{conditional probability of event between time t and } (\text{t} + \delta \text{t})} {\delta \text{t}}</span>
<span id="cb1-169"><a href="#cb1-169"></a>$$</span>
<span id="cb1-170"><a href="#cb1-170"></a></span>
<span id="cb1-171"><a href="#cb1-171"></a><span class="fu">## The hazard rate is related to the incident rate</span></span>
<span id="cb1-172"><a href="#cb1-172"></a></span>
<span id="cb1-173"><a href="#cb1-173"></a>Let me use a silly example to illustrate this idea of how the hazard rate is related to your run-of-the-mill incident rate. Let's think about the hazard of getting married at 20 years of age - perilous I might suggest. But jokes aside, how would you work this out? Well we could start by thinking in terms of the incident rate - in a nutshell, count up the number of people married between the ages of <span class="in">`20`</span> and 21 and divide that by the number NOT already married at age <span class="in">`20`</span>.</span>
<span id="cb1-174"><a href="#cb1-174"></a></span>
<span id="cb1-175"><a href="#cb1-175"></a>So, let's say we have <span class="in">`1000`</span> people in a population of interest who still aren't married at age <span class="in">`20`</span> and we follow them forward and see that <span class="in">`100`</span> get married in the next year. The incident rate is then <span class="in">`100`</span>/<span class="in">`1000`</span> per year or <span class="in">`0.1`</span> marriages per year.</span>
<span id="cb1-176"><a href="#cb1-176"></a></span>
<span id="cb1-177"><a href="#cb1-177"></a><span class="al">![](images/hazard_20_yrs.1.png)</span>{fig-align="center"}</span>
<span id="cb1-178"><a href="#cb1-178"></a></span>
<span id="cb1-179"><a href="#cb1-179"></a>We could have actually considered a shorter time interval to work out the incident rate - let's now say <span class="in">`6`</span> months instead of one year. Assuming marriages are evenly distributed then the incident rate is now <span class="in">`50`</span>/<span class="in">`1000`</span> per <span class="in">`6`</span> months or <span class="in">`0.05`</span> marriages per 1/2 year. </span>
<span id="cb1-180"><a href="#cb1-180"></a></span>
<span id="cb1-181"><a href="#cb1-181"></a><span class="al">![](images/hazard_20_yrs.2.png)</span>{fig-align="center"}</span>
<span id="cb1-182"><a href="#cb1-182"></a></span>
<span id="cb1-183"><a href="#cb1-183"></a>And we could even consider the incident rate in the forthcoming day, which would be <span class="in">`0.274`</span>/<span class="in">`1000`</span> per day or <span class="in">`0.000274`</span> marriages per day. </span>
<span id="cb1-184"><a href="#cb1-184"></a></span>
<span id="cb1-185"><a href="#cb1-185"></a><span class="al">![](images/hazard_20_yrs.3.png)</span>{fig-align="center"}</span>
<span id="cb1-186"><a href="#cb1-186"></a></span>
<span id="cb1-187"><a href="#cb1-187"></a>So the incident rate differs in these three cases **only** because we are using different units of time. If we normalised the time period to one year in the second and third scenarios, then we would expect the same number of marriages over the year.</span>
<span id="cb1-188"><a href="#cb1-188"></a></span>
<span id="cb1-189"><a href="#cb1-189"></a>The point of all of this is really to show you that the hazard rate is a **limiting case of the incident rate**. As the time interval approaches zero, we essentially have an instantaneous estimate of the risk of the event at any point in time and this is what the hazard rate represents. It's not hard when you think about it.</span>
<span id="cb1-190"><a href="#cb1-190"></a></span>
<span id="cb1-191"><a href="#cb1-191"></a><span class="fu">## Some common hazard function shapes</span></span>
<span id="cb1-192"><a href="#cb1-192"></a></span>
<span id="cb1-193"><a href="#cb1-193"></a>Let's have a look at some of the more common hazard function shapes that we might encounter. The shape of the hazard function is determined by the underlying disease, physiological or physical process - so some of these are more realistic in biological systems and some more realistic in mechanical systems. </span>
<span id="cb1-194"><a href="#cb1-194"></a></span>
<span id="cb1-195"><a href="#cb1-195"></a><span class="fu">### Constant (exponential)</span></span>
<span id="cb1-196"><a href="#cb1-196"></a></span>
<span id="cb1-197"><a href="#cb1-197"></a>The first example is of a constant hazard - so the **risk of failure at any point in time is the same**. This could apply to a light bulb and it could also apply to a healthy individual in a study. When the hazard function is constant we say the survival model is **exponential** and memoryless, in that the age of the subject has no bearing on the instantaneous risk of failure. Now, this is not the most realistic distribution for biological systems, because - taking a well-known quote from a textbook - "If human lifetimes were exponential there wouldn't be old or young people, just lucky or unlucky ones".</span>
<span id="cb1-198"><a href="#cb1-198"></a></span>
<span id="cb1-199"><a href="#cb1-199"></a><span class="al">![](images/hazard_rate_constant.png)</span>{fig-align="center" width="80%"}</span>
<span id="cb1-200"><a href="#cb1-200"></a></span>
<span id="cb1-201"><a href="#cb1-201"></a><span class="fu">### Increasing (Weibull)</span></span>
<span id="cb1-202"><a href="#cb1-202"></a></span>
<span id="cb1-203"><a href="#cb1-203"></a>This is a monotone increasing hazard function. This is one of the more realistic shapes that we expect in the real world - basically as things age, they wear out and are more likely to fail. In industry, cars and batteries are good examples of this. Most biological systems also follow this profile - as humans it's why our life insurance premiums go up as we age. At <span class="in">`60`</span> you've done well to have lived this long, but your short term prospects aren't as optimistic as they were at <span class="in">`20`</span>, and the actuaries build this in to their company's insurance premiums. </span>
<span id="cb1-204"><a href="#cb1-204"></a></span>
<span id="cb1-205"><a href="#cb1-205"></a>An example in a medical study might be the hazard of metastatic cancer patients, where the event of interest is death. As survival time increases for such a patient, and as the prognosis accordingly worsens, the patient’s potential for dying of the disease also increases.</span>
<span id="cb1-206"><a href="#cb1-206"></a></span>
<span id="cb1-207"><a href="#cb1-207"></a><span class="al">![](images/hazard_rate_increasing.png)</span>{fig-align="center" width="80%"}</span>
<span id="cb1-208"><a href="#cb1-208"></a></span>
<span id="cb1-209"><a href="#cb1-209"></a><span class="fu">### Decreasing (Weibull)</span></span>
<span id="cb1-210"><a href="#cb1-210"></a></span>
<span id="cb1-211"><a href="#cb1-211"></a>But not everything wears out over time. This is an example of a monotone decreasing hazard. Many electronic systems actually become more robust over time - believe it or not. In other words, the instantaneous risk of failure tends to be higher earlier on and then subsides with time. So manufacturers can utilise that to their advantage by running the system for a period before shipping and if it passes, it's likely to be ok for the customer.</span>
<span id="cb1-212"><a href="#cb1-212"></a></span>
<span id="cb1-213"><a href="#cb1-213"></a>In medicine we might see this in patients recovering from major surgery, because the potential for dying after surgery usually decreases as the time after surgery increases.</span>
<span id="cb1-214"><a href="#cb1-214"></a></span>
<span id="cb1-215"><a href="#cb1-215"></a><span class="al">![](images/hazard_rate_decreasing.png)</span>{fig-align="center" width="80%"}</span>
<span id="cb1-216"><a href="#cb1-216"></a></span>
<span id="cb1-217"><a href="#cb1-217"></a><span class="fu">### Increasing/Decreasing (lognormal)</span></span>
<span id="cb1-218"><a href="#cb1-218"></a></span>
<span id="cb1-219"><a href="#cb1-219"></a>Now we’re getting even more complex with a hazard function that can both increase and decrease. These kinds of shapes become increasingly difficult to generalise, but a specific example might be the hazard for tuberculosis patients since their potential for dying from the disease initially increases and then subsides.</span>
<span id="cb1-220"><a href="#cb1-220"></a></span>
<span id="cb1-221"><a href="#cb1-221"></a><span class="al">![](images/hazard_rate_increase_decrease.png)</span>{fig-align="center" width="80%"}</span>
<span id="cb1-222"><a href="#cb1-222"></a></span>
<span id="cb1-223"><a href="#cb1-223"></a><span class="fu">### Bathtub</span></span>
<span id="cb1-224"><a href="#cb1-224"></a></span>
<span id="cb1-225"><a href="#cb1-225"></a>And then finally the 'bathtub' shaped hazard function, which I introduced to you before when talking about the risks of humans dying with age. In a general sense, this hazard function reflects the fact that some of the riskiest days of your life are those following birth, and then things start to settle down through and until mid-life.</span>
<span id="cb1-226"><a href="#cb1-226"></a></span>
<span id="cb1-227"><a href="#cb1-227"></a>But gradually, as you age, parts of your body start to wear out and your short-term risk begins to increase again - and if you manage to get to 80 for example, then your short-term risk of dying might be as high as it was during your first months of life.</span>
<span id="cb1-228"><a href="#cb1-228"></a></span>
<span id="cb1-229"><a href="#cb1-229"></a><span class="al">![](images/hazard_rate_bathtub.png)</span>{fig-align="center" width="80%"}</span>
<span id="cb1-230"><a href="#cb1-230"></a></span>
<span id="cb1-231"><a href="#cb1-231"></a><span class="fu"># Time Scales</span></span>
<span id="cb1-232"><a href="#cb1-232"></a></span>
<span id="cb1-233"><a href="#cb1-233"></a>I just want to briefly touch on the idea of time scales. As I mentioned earlier the time origin is deﬁned as the time point at which individuals are first placed 'at risk' for the event occurring. But the choice of time origin should really be determined by clinical reasons and there are actually two time primary scales you can consider. By far the most common choice is to simply use time-on-study - so set time = <span class="in">`0`</span> for example, from the point that a subject was diagnosed with a disease; had a surgical procedure; or was randomised into a clinical trial. And this makes sense because the outcome of interest can really only occur as the disease diagnosis or surgical procedure effectively places the subject 'at risk' of the outcome.</span>
<span id="cb1-234"><a href="#cb1-234"></a></span>
<span id="cb1-235"><a href="#cb1-235"></a>But in some cases, the distinction is less obvious and using age as the time scale can be more appropriate and actually make more sense. This is usually when you have outcomes of interest that are related more to ageing - e.g. the development of breast cancer, stroke, etc - because subjects may actually be at risk from a time earlier than when they became enrolled into the study. What we are basically suggesting here is that **subjects become 'at risk' of the disease from birth**.</span>
<span id="cb1-236"><a href="#cb1-236"></a></span>
<span id="cb1-237"><a href="#cb1-237"></a>So, when you are thinking about the design and analysis of your next time-to-event study, ask yourself when do subjects first become 'at risk' of this event? and on what scale is that underlying risk most likely to change?</span>
<span id="cb1-238"><a href="#cb1-238"></a></span>
<span id="cb1-239"><a href="#cb1-239"></a><span class="fu">## Time-on-study</span></span>
<span id="cb1-240"><a href="#cb1-240"></a></span>
<span id="cb1-241"><a href="#cb1-241"></a>I want to illustrate these ideas about time scales with a figure and a very simplified example. Let's assume this is some hazard function for death related to some fictitious disease. The risk of death related to this disease initially increases and then decreases over time. </span>
<span id="cb1-242"><a href="#cb1-242"></a><span class="al">![](images/hazard_time_on_study_scale_overall.png)</span>{fig-align="center" width="80%"}</span>
<span id="cb1-243"><a href="#cb1-243"></a></span>
<span id="cb1-244"><a href="#cb1-244"></a>When we look at the hazard, it's a fairly safe bet that we would use time-on-study in this case, **because the hazard is going to primarily be a function of time since diagnosis more than a function of age**. And that's because **the subject becomes at risk of the outcome from the point of diagnosis**. So in this case we can expect subjects of any age to have a similar hazard. If we were to estimate a Cox model for example, the hazards are fairly consistent in shape across subjects, regardless of age (note that the intercepts might actually be different for different ages - gives rise to proportional hazards - but the shapes are consistent). In other words, an apples-to-apples comparison of the hazard function at any point in observation time.</span>
<span id="cb1-245"><a href="#cb1-245"></a></span>
<span id="cb1-246"><a href="#cb1-246"></a><span class="al">![](images/hazard_time_on_study_scale_individual.png)</span>{fig-align="center" width="80%"}</span>
<span id="cb1-247"><a href="#cb1-247"></a></span>
<span id="cb1-248"><a href="#cb1-248"></a><span class="fu">## Age</span></span>
<span id="cb1-249"><a href="#cb1-249"></a></span>
<span id="cb1-250"><a href="#cb1-250"></a>But now let's assume that the same hazard is instead a function of age instead of time-on-study - for the sake of the exercise let's say the outcome is now a type of cancer and **you become 'at risk' of this cancer from birth**. So the risk of the outcome this time relates more to just getting older than it does to any other precursor event. </span>
<span id="cb1-251"><a href="#cb1-251"></a></span>
<span id="cb1-252"><a href="#cb1-252"></a><span class="al">![](images/hazard_age_scale_overall.png)</span>{fig-align="center" width="80%"}</span>
<span id="cb1-253"><a href="#cb1-253"></a></span>
<span id="cb1-254"><a href="#cb1-254"></a>In this case, if we were to use time-on-study as the time scale, we end up trying to compare hazard functions among age groups that are not consistent in shape on that time scale. So, the hazard for a <span class="in">`20`</span> year old entering the study might be different to the hazard for a <span class="in">`60`</span> year old entering the study. Now we are attempting an apples-to-oranges comparison of the hazard function at any point in observation time and that is less than ideal - instead, we're better off using age as the time scale on which to base our computations.</span>
<span id="cb1-255"><a href="#cb1-255"></a></span>
<span id="cb1-256"><a href="#cb1-256"></a><span class="al">![](images/hazard_age_scale_individual.png)</span>{fig-align="center" width="80%"}</span>
<span id="cb1-257"><a href="#cb1-257"></a></span>
<span id="cb1-258"><a href="#cb1-258"></a>::: callout-important</span>
<span id="cb1-259"><a href="#cb1-259"></a>When using age as the time scale for the analysis, age is automatically corrected for in the analysis and does not require specific covariate adjustment.</span>
<span id="cb1-260"><a href="#cb1-260"></a>:::</span>
<span id="cb1-261"><a href="#cb1-261"></a></span>
<span id="cb1-262"><a href="#cb1-262"></a><span class="fu"># It's A Choose-Your-Own Survival Analysis Adventure</span></span>
<span id="cb1-263"><a href="#cb1-263"></a></span>
<span id="cb1-264"><a href="#cb1-264"></a>Alright, let's actually talk about some of the methods themselves. I think when people first look at survival analysis, they can find it confronting with the array of analysis approaches on offer. But the thing here to realise is that each of these is a tool for a particular job, and once you know that you can start to focus in on what method (or methods) best answer your research questions.</span>
<span id="cb1-265"><a href="#cb1-265"></a></span>
<span id="cb1-266"><a href="#cb1-266"></a>So, the three main forms of survival analysis are **non-parametric**, and that typically involves creating Kaplan-Meier curves; **semi-parametric**, and that pretty much revolves around the Cox model; and **fully parametric**, and here you have an assortment of statistical distributions for the survival times that you can choose from.</span>
<span id="cb1-267"><a href="#cb1-267"></a></span>
<span id="cb1-268"><a href="#cb1-268"></a><span class="fu">## Non-parametric (Kaplan-Meier estimator)</span></span>
<span id="cb1-269"><a href="#cb1-269"></a></span>
<span id="cb1-270"><a href="#cb1-270"></a>So, in statistics, what does non-parametric actually mean? Basically, we do not rely on any assumptions that the data are drawn from a given parametric family of probability distributions. So we're less interested or able to make inferences about the population and we're really only talking about the data that we actually have - the sample at hand. </span>
<span id="cb1-271"><a href="#cb1-271"></a></span>
<span id="cb1-272"><a href="#cb1-272"></a>Now, in survival analysis, the Kaplan-Meier estimator is one such non-parametric approach to calculating the survival function. **We don't make any assumptions about the distribution of survival times in the population from which the sample was drawn.** So, it's just the empirical probability of surviving past certain times in the sample - and to that end it's main purpose is descriptive.</span>
<span id="cb1-273"><a href="#cb1-273"></a></span>
<span id="cb1-274"><a href="#cb1-274"></a>The Kaplan-Meier approach is NOT a modelling method, and it's really about visualising survival - and we can do this overall or commonly by splitting based on one important grouping variable, whether that be treatment or some other exposure variable (e.g. sex). Usually this a starting point in your survival analyses, and you'll go on and do some modelling, but sometimes a simple Kaplan-Meier curve is enough to do what you want.</span>
<span id="cb1-275"><a href="#cb1-275"></a></span>
<span id="cb1-276"><a href="#cb1-276"></a>Let's revisit that first example I showed you with the <span class="in">`5`</span> patients, because it's a worthwhile exercise in understanding how the Kaplan-Meier estimator works out a probability of survival taking into account, censoring. It's a simple exercise with these data but with more complex datasets you obviously wouldn't do this manually.</span>
<span id="cb1-277"><a href="#cb1-277"></a></span>
<span id="cb1-278"><a href="#cb1-278"></a>So, we have our <span class="in">`5`</span> patients and we want to plot the proportion surviving at every step over the study duration.</span>
<span id="cb1-279"><a href="#cb1-279"></a></span>
<span id="cb1-280"><a href="#cb1-280"></a>Remember that if we'd used logistic regression, then depending on how we defined our censored subject we could have ended up with a one-year survival of either <span class="in">`40`</span> or <span class="in">`60%`</span>, and in fact the correct one-year survival estimate is <span class="in">`53%`</span>. How do we get that?</span>
<span id="cb1-281"><a href="#cb1-281"></a></span>
<span id="cb1-282"><a href="#cb1-282"></a><span class="al">![](images/km_estimator.1.png)</span>{fig-align="center"}</span>
<span id="cb1-283"><a href="#cb1-283"></a></span>
<span id="cb1-284"><a href="#cb1-284"></a>So, we start at time <span class="in">`0`</span> with <span class="in">`100%`</span> survival and with all subjects at risk of the event.</span>
<span id="cb1-285"><a href="#cb1-285"></a></span>
<span id="cb1-286"><a href="#cb1-286"></a>We know that survival remains at <span class="in">`100%`</span> until at least month <span class="in">`4`</span> because everyone remains alive during that time.</span>
<span id="cb1-287"><a href="#cb1-287"></a></span>
<span id="cb1-288"><a href="#cb1-288"></a>But then Subject <span class="in">`5`</span> dies at <span class="in">`4`</span> months. So, this is the event we're interested in and the survival probability is **re-estimated** each time there is an event. How do we do that? Well, we multiply the **cumulative survival proportion** before the event by the **conditional survival proportion** just after the event - conditional because a subject must have survived at least until the event, to remain in the study after it. </span>
<span id="cb1-289"><a href="#cb1-289"></a></span>
<span id="cb1-290"><a href="#cb1-290"></a>And if we do that, this time around it's a fairly straightforward multiplication of <span class="in">`1`</span> x <span class="in">`4`</span>/<span class="in">`5`</span>, which gives <span class="in">`80%`</span>. Note that censoring has not even entered into this calculation yet.</span>
<span id="cb1-291"><a href="#cb1-291"></a></span>
<span id="cb1-292"><a href="#cb1-292"></a>So the proportion surviving immediately after <span class="in">`4`</span> months is <span class="in">`80%`</span> and the number of people at risk of dying at this point is <span class="in">`4`</span>.</span>
<span id="cb1-293"><a href="#cb1-293"></a></span>
<span id="cb1-294"><a href="#cb1-294"></a><span class="al">![](images/km_estimator.2.png)</span>{fig-align="center"}</span>
<span id="cb1-295"><a href="#cb1-295"></a></span>
<span id="cb1-296"><a href="#cb1-296"></a>Now as we go along in the time line we see that Subject <span class="in">`1`</span> is censored at <span class="in">`6`</span> months and we indicate that with a mark at that time point. Note that the **survival estimate doesn't change** after <span class="in">`6`</span> months, but the number of people at risk of dying now reduces by <span class="in">`1`</span> to <span class="in">`3`</span>.</span>
<span id="cb1-297"><a href="#cb1-297"></a></span>
<span id="cb1-298"><a href="#cb1-298"></a><span class="al">![](images/km_estimator.3.png)</span>{fig-align="center"}</span>
<span id="cb1-299"><a href="#cb1-299"></a></span>
<span id="cb1-300"><a href="#cb1-300"></a>Now Subject <span class="in">`3`</span> dies at <span class="in">`7`</span> months. To re-estimate the survival this time we need to take just a little bit of extra care. The cumulative survival proportion immediately before <span class="in">`7`</span> months is still <span class="in">`80%`</span> but when we work out the conditional survival immediately after <span class="in">`7`</span> months, the censoring of Subject <span class="in">`1`</span> means that we now only have <span class="in">`2`</span> people remaining alive (that we are certain about) out of the <span class="in">`3`</span> potentially at risk, just prior to the death.</span>
<span id="cb1-301"><a href="#cb1-301"></a></span>
<span id="cb1-302"><a href="#cb1-302"></a>We then multiply those two survival proportions to give us the overall survival after <span class="in">`7`</span> months. And that is <span class="in">`4`</span> people out of <span class="in">`5`</span> (<span class="in">`80%`</span>) alive immediately prior to and <span class="in">`2`</span> people out of <span class="in">`3`</span> (<span class="in">`67%`</span>) alive immediately after. The overall estimate of survival at <span class="in">`7`</span> months is then <span class="in">`4`</span>/<span class="in">`5`</span> times <span class="in">`2`</span>/<span class="in">`3`</span> which gives us the <span class="in">`53%`</span> we stated earlier.</span>
<span id="cb1-303"><a href="#cb1-303"></a></span>
<span id="cb1-304"><a href="#cb1-304"></a>Clearly this is a very simple case and you can appreciate how complicated this can get in larger datasets, but standard functions will take care of the calculations for you in whatever statistical package you're using.</span>
<span id="cb1-305"><a href="#cb1-305"></a></span>
<span id="cb1-306"><a href="#cb1-306"></a><span class="al">![](images/km_estimator.4.png)</span>{fig-align="center"}</span>
<span id="cb1-307"><a href="#cb1-307"></a></span>
<span id="cb1-308"><a href="#cb1-308"></a><span class="fu">## Semi-parametric (Cox model)</span></span>
<span id="cb1-309"><a href="#cb1-309"></a></span>
<span id="cb1-310"><a href="#cb1-310"></a>If you want to estimate survival as a function of more than just one grouping variable, then you really need to look further afield than the Kaplan-Meier estimator and this is usually where people will turn to a Cox model. </span>
<span id="cb1-311"><a href="#cb1-311"></a></span>
<span id="cb1-312"><a href="#cb1-312"></a>The Cox model is considered semi-parametric because there is both a non-parametric component and a fully parametric component. The **baseline hazard function is non-parametric** and is estimated directly from the sample data without any assumptions about the distribution of survival times. Because of this the hazard function in a Cox model can take on any shape you can imagine. This is both an advantage and a disadvantage - an advantage because the shape can be highly flexible, but a disadvantage because we don't actually get any information returned in terms of parameter estimates that tell us anything about what that shape looks like.</span>
<span id="cb1-313"><a href="#cb1-313"></a></span>
<span id="cb1-314"><a href="#cb1-314"></a>The **parametric part of the Cox model is to do with the effects of the predictors on the hazard function** - and these are assumed to be linearly related to the log of the hazard. The coefficient estimates we get out of a Cox model are exponentiated to give a hazard ratio which is just the ratio of two hazard rates.</span>
<span id="cb1-315"><a href="#cb1-315"></a></span>
<span id="cb1-316"><a href="#cb1-316"></a>Because we don't get any parameter estimates for the baseline hazard function, we aren't in a position to easily predict the absolute risk of an event, and so the strength of the Cox model is really in providing information about relative rather than absolute risks of the event occurring.</span>
<span id="cb1-317"><a href="#cb1-317"></a></span>
<span id="cb1-318"><a href="#cb1-318"></a>And finally because the hazard is empirical, you really shouldn't try to predict from a Cox model beyond the range of observable data that you have.</span>
<span id="cb1-319"><a href="#cb1-319"></a></span>
<span id="cb1-320"><a href="#cb1-320"></a>Ok, before we leave the Cox model, let's talk about The Elephant in the room - proportional hazards. This is probably the most important assumption that you need to keep in mind and one that you should really test for each time you run a Cox model.</span>
<span id="cb1-321"><a href="#cb1-321"></a></span>
<span id="cb1-322"><a href="#cb1-322"></a>The proportional hazards assumption basically requires that the hazard ratio is constant over time, or equivalently, that the hazard for one individual is proportional to the hazard for any other individual, and where the proportionality constant doesn't depend on time.</span>
<span id="cb1-323"><a href="#cb1-323"></a></span>
<span id="cb1-324"><a href="#cb1-324"></a>So if we look at the figure below - I have plotted hypothetical hazard functions for males (in blue) and females (in red) for the risk of some event. You'll note that the shapes are essentially the same but are scaled versions of one another. When proportional hazards hold, then we can take a ratio of the two hazard rates at any time point and that ratio should remain constant. And I've illustrated that here at two time points - $t1$ and $t2$. The difference in the hazards obviously varies but the ratio of the hazards at those two time points is the same. At time <span class="in">`1`</span> a hazard rate of <span class="in">`3`</span> for males and <span class="in">`2`</span> for females gives a hazard ratio of <span class="in">`1.5`</span> and similarly, at time <span class="in">`2`</span>, a hazard rate of <span class="in">`0.75`</span> for males and <span class="in">`0.5`</span> for females, again gives a hazard ratio of <span class="in">`1.5`</span>.</span>
<span id="cb1-325"><a href="#cb1-325"></a></span>
<span id="cb1-326"><a href="#cb1-326"></a>In reality, hazard rates are probably not going to be exactly proportional the entire time, but the aim is to make sure any departures from proportionality are minimal - otherwise this means the hazard ratio itself varies with time and this adds further complexity to your model.</span>
<span id="cb1-327"><a href="#cb1-327"></a></span>
<span id="cb1-328"><a href="#cb1-328"></a><span class="al">![](images/prop_hazards.png)</span>{fig-align="center"}</span>
<span id="cb1-329"><a href="#cb1-329"></a></span>
<span id="cb1-330"><a href="#cb1-330"></a><span class="fu">## Parametric (exponential, Weibull, log-normal, etc)</span></span>
<span id="cb1-331"><a href="#cb1-331"></a></span>
<span id="cb1-332"><a href="#cb1-332"></a>Fully parametric survival models are essentially the same in concept and interpretation to the Cox model, barring a few structural differences. The main difference to the Cox model is that **the baseline hazard function is fully specified** in these models. In other words, the hazard function is assumed to follow a particular statistical distribution, and we looked at some of these before - monotone increasing, decreasing, lognormal, etc. And this then becomes a modelling choice that you have to make. You can never be certain that you've chosen the correct distribution but there are tools that you can use to guide your choice - theory should always be at the top of the list, but you can also do things like generate empirical hazards to see what their shape might look like, compare model fits via some fitting criteria like the AIC, and so on. If you get the distribution about right, these models are **more powerful** than their Cox counterparts.</span>
<span id="cb1-333"><a href="#cb1-333"></a></span>
<span id="cb1-334"><a href="#cb1-334"></a>Like Cox models, you get adjusted estimates of risk/survival. Unlike Cox models, you can estimate absolute risk of the event of interest, because you get a model parameter or parameters returned for that. Additionally, you're in a better position with these models to predict beyond the maximum follow-up time, because there is a specified distribution of survival times that is expected to follow that of the population. But that comes with the usual caveat of always be careful about extrapolating beyond the range of your data.</span>
<span id="cb1-335"><a href="#cb1-335"></a></span>
<span id="cb1-336"><a href="#cb1-336"></a><span class="fu"># Extensions</span></span>
<span id="cb1-337"><a href="#cb1-337"></a></span>
<span id="cb1-338"><a href="#cb1-338"></a>And to end, some rabbit-holes that you can go down in your survival analysis endeavours:</span>
<span id="cb1-339"><a href="#cb1-339"></a></span>
<span id="cb1-340"><a href="#cb1-340"></a><span class="ss">-   </span>Time-dependent covariates:</span>
<span id="cb1-341"><a href="#cb1-341"></a><span class="ss">    - </span>The value of the covariate (e.g. treatment, weight, etc) changes over time, but it's effect remains constant (i.e. the HR doesn't change).</span>
<span id="cb1-342"><a href="#cb1-342"></a><span class="ss">-   </span>Time-dependent coefficients:</span>
<span id="cb1-343"><a href="#cb1-343"></a><span class="ss">    - </span>The value of the covariate doesn’t change over time, but it's effect does (i.e. the HR varies over time).</span>
<span id="cb1-344"><a href="#cb1-344"></a><span class="ss">-   </span>Flexible parametric models:</span>
<span id="cb1-345"><a href="#cb1-345"></a><span class="ss">    - </span>Include splines on the log baseline hazard to allow even more flexibility in hazard function shapes (**I am becoming a huge advocate of these**).</span>
<span id="cb1-346"><a href="#cb1-346"></a><span class="ss">-   </span>Competing risks:</span>
<span id="cb1-347"><a href="#cb1-347"></a><span class="ss">    - </span>Explicitly account for other events that 'compete' with our primary event of interest.</span>
<span id="cb1-348"><a href="#cb1-348"></a><span class="ss">-   </span>Recurrent events/frailties (clustering)</span>
<span id="cb1-349"><a href="#cb1-349"></a><span class="ss">    - </span>More than one event per person/groups of people with shared characteristics.</span>
<span id="cb1-350"><a href="#cb1-350"></a></span>
<span id="cb1-351"><a href="#cb1-351"></a><span class="fu"># Summary</span></span>
<span id="cb1-352"><a href="#cb1-352"></a></span>
<span id="cb1-353"><a href="#cb1-353"></a>Remember how I said Survival Analysis was a BIG subject! </span>
<span id="cb1-354"><a href="#cb1-354"></a></span>
<span id="cb1-355"><a href="#cb1-355"></a>If you ever struggled with the fundamentals, I hope today's post has helped to clarify some of these ideas. There is a really good book on the topic that I can recommend if you want to do some more reading. It is comprehensive enough, yet I think gets the message across without the use of complicated theory and formulae. </span>
<span id="cb1-356"><a href="#cb1-356"></a></span>
<span id="cb1-357"><a href="#cb1-357"></a><span class="al">![](images/surv_text.jpeg)</span>{fig-align="center" width="30%"}</span>
<span id="cb1-358"><a href="#cb1-358"></a></span>
<span id="cb1-359"><a href="#cb1-359"></a>Until next time - may your models actually reflect reality.</span>
<span id="cb1-360"><a href="#cb1-360"></a></span>
<span id="cb1-361"><a href="#cb1-361"></a>(Most figures in today's post created with&nbsp;<span class="co">[</span><span class="ot">BioRender.com</span><span class="co">](https://www.biorender.com/)</span>).</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>