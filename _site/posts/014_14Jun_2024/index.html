<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-06-14">
<meta name="description" content="See how log-odds, odds and probability are all simply versions of each other - and fundamental to logistic regression.">

<title>Test Site 2 - Logistic Regression - Under the Hood</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Test Site 2</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">All Posts</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#some-background" id="toc-some-background" class="nav-link active" data-scroll-target="#some-background"><span class="header-section-number">1</span> Some Background</a></li>
  <li><a href="#the-research-question" id="toc-the-research-question" class="nav-link" data-scroll-target="#the-research-question"><span class="header-section-number">2</span> The Research Question</a></li>
  <li><a href="#some-basic-concepts" id="toc-some-basic-concepts" class="nav-link" data-scroll-target="#some-basic-concepts"><span class="header-section-number">3</span> Some Basic Concepts</a>
  <ul class="collapse">
  <li><a href="#primary-transformations" id="toc-primary-transformations" class="nav-link" data-scroll-target="#primary-transformations"><span class="header-section-number">3.1</span> Primary Transformations</a></li>
  <li><a href="#secondary-transformations" id="toc-secondary-transformations" class="nav-link" data-scroll-target="#secondary-transformations"><span class="header-section-number">3.2</span> Secondary Transformations</a></li>
  <li><a href="#probability-vs-odds-and-as-applied-to-the-research-question" id="toc-probability-vs-odds-and-as-applied-to-the-research-question" class="nav-link" data-scroll-target="#probability-vs-odds-and-as-applied-to-the-research-question"><span class="header-section-number">3.3</span> Probability vs Odds (and as applied to the Research Question)</a></li>
  </ul></li>
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression"><span class="header-section-number">4</span> Logistic Regression</a>
  <ul class="collapse">
  <li><a href="#the-logit-link-function-and-why-log-odds-are-actually-important" id="toc-the-logit-link-function-and-why-log-odds-are-actually-important" class="nav-link" data-scroll-target="#the-logit-link-function-and-why-log-odds-are-actually-important"><span class="header-section-number">4.1</span> The Logit Link Function (and why log-odds are actually important)</a></li>
  <li><a href="#wth-log-oddsoddsprobabilities---youre-confusing-me---pick-one-please" id="toc-wth-log-oddsoddsprobabilities---youre-confusing-me---pick-one-please" class="nav-link" data-scroll-target="#wth-log-oddsoddsprobabilities---youre-confusing-me---pick-one-please"><span class="header-section-number">4.2</span> WTH? log-odds/odds/probabilities - Youâ€™re confusing me - pick one please!!</a></li>
  <li><a href="#back-to-the-research-question" id="toc-back-to-the-research-question" class="nav-link" data-scroll-target="#back-to-the-research-question"><span class="header-section-number">4.3</span> Back to the Research Question</a>
  <ul class="collapse">
  <li><a href="#simulate-some-data" id="toc-simulate-some-data" class="nav-link" data-scroll-target="#simulate-some-data"><span class="header-section-number">4.3.1</span> Simulate Some Data</a></li>
  <li><a href="#plot-the-observed-data" id="toc-plot-the-observed-data" class="nav-link" data-scroll-target="#plot-the-observed-data"><span class="header-section-number">4.3.2</span> Plot the Observed Data</a></li>
  <li><a href="#fit-linear-model-naive-approach" id="toc-fit-linear-model-naive-approach" class="nav-link" data-scroll-target="#fit-linear-model-naive-approach"><span class="header-section-number">4.3.3</span> Fit Linear Model (Naive Approach)</a></li>
  <li><a href="#problem---predictions-are-made-outside-the-probability-domain" id="toc-problem---predictions-are-made-outside-the-probability-domain" class="nav-link" data-scroll-target="#problem---predictions-are-made-outside-the-probability-domain"><span class="header-section-number">4.3.4</span> Problem - Predictions are made Outside the Probability Domain</a></li>
  <li><a href="#plot-the-binned-observed-data" id="toc-plot-the-binned-observed-data" class="nav-link" data-scroll-target="#plot-the-binned-observed-data"><span class="header-section-number">4.3.5</span> Plot the â€˜Binnedâ€™ Observed Data</a></li>
  <li><a href="#fit-a-logistic-model-to-the-simulated-data" id="toc-fit-a-logistic-model-to-the-simulated-data" class="nav-link" data-scroll-target="#fit-a-logistic-model-to-the-simulated-data"><span class="header-section-number">4.3.6</span> Fit a Logistic Model to the Simulated Data</a></li>
  <li><a href="#plot-predicted-log-odds-of-surgical-repair-success" id="toc-plot-predicted-log-odds-of-surgical-repair-success" class="nav-link" data-scroll-target="#plot-predicted-log-odds-of-surgical-repair-success"><span class="header-section-number">4.3.7</span> Plot Predicted log-odds of Surgical Repair Success</a></li>
  <li><a href="#plot-predicted-odds-of-surgical-repair-success" id="toc-plot-predicted-odds-of-surgical-repair-success" class="nav-link" data-scroll-target="#plot-predicted-odds-of-surgical-repair-success"><span class="header-section-number">4.3.8</span> Plot Predicted Odds of Surgical Repair Success</a></li>
  <li><a href="#plot-predicted-probabilities-of-surgical-repair-success" id="toc-plot-predicted-probabilities-of-surgical-repair-success" class="nav-link" data-scroll-target="#plot-predicted-probabilities-of-surgical-repair-success"><span class="header-section-number">4.3.9</span> Plot Predicted Probabilities of Surgical Repair Success</a></li>
  <li><a href="#plot-observed-and-predicted-probabilities-of-surgical-repair-success" id="toc-plot-observed-and-predicted-probabilities-of-surgical-repair-success" class="nav-link" data-scroll-target="#plot-observed-and-predicted-probabilities-of-surgical-repair-success"><span class="header-section-number">4.3.10</span> Plot Observed and Predicted Probabilities of Surgical Repair Success</a></li>
  <li><a href="#putting-it-all-together" id="toc-putting-it-all-together" class="nav-link" data-scroll-target="#putting-it-all-together"><span class="header-section-number">4.3.11</span> Putting It All Together</a></li>
  <li><a href="#key-points" id="toc-key-points" class="nav-link" data-scroll-target="#key-points"><span class="header-section-number">4.3.12</span> Key points</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Logistic Regression - Under the Hood</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">code</div>
    <div class="quarto-category">analysis</div>
    <div class="quarto-category">modelling</div>
    <div class="quarto-category">visualisation</div>
    <div class="quarto-category">probability</div>
  </div>
  </div>

<div>
  <div class="description">
    See how log-odds, odds and probability are all simply versions of each other - and fundamental to logistic regression.
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 14, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="some-background" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Some Background</h1>
<p>Todayâ€™s post comes from a talk that some of you may have already heard me give in lab meetings, but I thought it could be helpful to have a â€˜printâ€™ copy so Iâ€™m going to do that here. The material in the talk was loosely based on the following paper:</p>
<p><a href="https://bjo.bmj.com/content/100/12/1594">Ophthalmic Statistics Note 11: Logistic Regression</a></p>
<p>Iâ€™m going back to basics today. I think too often we use statistical techniques without really understanding what is going on â€˜under the hoodâ€™. While that is ok to some extent, a better appreciation of what youâ€™re actually doing when you perform a hypothesis test, or run a regression model, lends more robustness to the validity of both your results and your interpretation of them.</p>
<p>So letâ€™s take a more fundamental look at logistic regression - a workhorse statistical model that Iâ€™d be willing to bet most of you have run at some point in your research careers. Now, because I consider myself more an applied rather than theoretical biostatistician, I am going to try and get my main points across to you with as little maths as possible, and hopefully not bore you in the process (but this is statistics, so heyâ€¦).</p>
<p>What I hope you can gain from reading this is to think about logistic regression in a new and different way - one that completely illuminates the technique for you.</p>
</section>
<section id="the-research-question" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> The Research Question</h1>
<p>The research question in the above paper is asking whether macular hole size at diagnosis is a predictor of surgical repair success. So, in a linear model context, macular hole size is the predictor variable and surgical repair success is the outcome variable, which we consider to be binary in nature - the macular hole is either repaired or it isnâ€™t. For those of you who donâ€™t know what a macular hole is, there is some good information <a href="https://www.mdfoundation.com.au/about-macular-disease/other-macular-conditions/macular-hole/">here</a>. Essentially, a small hole develops in the macular - the very center of your retina that you use for detailed vision talks such as driving, reading, etc. The effect is to leave you with a blind spot in your direct line of sight, which is obviously not ideal. When it comes to surgical repair, partial-thickness, smaller holes tend to be associated with a better prognosis, than full-thickness, larger holes.</p>
</section>
<section id="some-basic-concepts" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Some Basic Concepts</h1>
<p>Before we actually talk about logistic regression, I want to make sure youâ€™re familiar with the three primary effect measures that logistic regression is based on.</p>
<ol type="1">
<li>Probability - exists in the domain <code>[</code>0, 1<code>]</code>.</li>
<li>Odds - exists in the domain <code>[</code>0, <span class="math inline">\(+\infty\)</span><code>]</code>.</li>
<li>log-odds - exists in the domain <code>[</code><span class="math inline">\(-\infty\)</span>, <span class="math inline">\(+\infty\)</span><code>]</code>.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/primary_effect_measures.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
<figcaption>Three Primary Effect Measures in Logistic Regression</figcaption>
</figure>
</div>
<p>Itâ€™s important to remember that these are all simple transformations of one another.</p>
<section id="primary-transformations" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="primary-transformations"><span class="header-section-number">3.1</span> Primary Transformations</h2>
<p>If we have the odds of an event, then we can transform that to a probability - or a <em>risk</em>, which is another way to refer to the chance of an outcome - by dividing the odds by the odds plus 1.</p>
<p><span class="math display">\[\text{p} = \frac{\text{odds}}{1 + \text{odds}}\]</span></p>
<p>If instead we have the probability of an event, we can transform that to the equivalent odds of the event, by dividing the probability by its complement (that is 1 minus the probability).</p>
<p><span class="math display">\[\text{odds} = \frac{\text{p}}{1 - \text{p}}\]</span></p>
<p>And the log-odds is simply taking the natural logarithm of the odds - there is nothing difficult about that.</p>
<p><span class="math display">\[\text{log-odds} = \text{log(odds)}\]</span></p>
<p>So these three are what I consider primary transformations and we can cycle between them quite easily with a calculator.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/primary_effect_measures2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="secondary-transformations" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="secondary-transformations"><span class="header-section-number">3.2</span> Secondary Transformations</h2>
<p>There are additional transformations that you can make and while these arenâ€™t quite as straightforward, they are even more fundamental to logistic regression, which ultimately uses the log-odds as the scale to estimate its parameters on.</p>
<p>The first is that we can get to a probability directly from the log-odds by taking the exponent of the log-odds divided by the exponent of the log-odds plus one.</p>
<p><span class="math display">\[\text{p} = \frac{e^{\text{log-odds}}}{1 + e^{\text{log-odds}}}\]</span></p>
<p>And as you can see, thatâ€™s really no different to the first equation above because the exponent of the log-odds is simply the odds (the reverse transformation of logging a number is to take the exponent of that logged number). i.e.</p>
<p><span class="math display">\[\text{odds} = e^{\text{log-odds}}\]</span></p>
<p>Now, the final transformation, and the one thatâ€™s most relevant to logistic regression shows the relationship between the log-odds and probability and is known as the <strong>logit function</strong> (red box) - and weâ€™ll talk more about this in a minute.</p>
<p><span class="math display">\[\text{log-odds} = \text{log}\Bigl(\frac{\text{p}}{1 - \text{p}}\Bigr)\]</span></p>
<p><img src="images/secondary_effect_measures.png" class="img-fluid"></p>
</section>
<section id="probability-vs-odds-and-as-applied-to-the-research-question" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="probability-vs-odds-and-as-applied-to-the-research-question"><span class="header-section-number">3.3</span> Probability vs Odds (and as applied to the Research Question)</h2>
<p>Letâ€™s go back now to our original research question and specifically look at the difference between the probability and odds of an event - I want to solidify this concept in your minds. For most of us probability (or <em>chance</em>) is much more intuitive than the notion of odds. If I think about the likelihood of it being a wet day, I think thereâ€™s (for example) an 80% chance of it raining, rather than 4 to 1 odds in favour of it raining. However, if you like to wager on the horses than you may actually be quite comfortable with thinking in terms of odds - as those are the terms bets are placed in.</p>
<p>In the following Iâ€™ve simulated some data from the original paper (based on the summary statistics and regression model provided). Obviously macular hole size is a continuous variable, but for the sake of this illustration I am going to dichotomise it at itâ€™s approximate mean value (<code>480</code> microns). From this we can draw up a 2 x 2 contingency table of the number of successful and failed macular hole repairs as a function of the dichotomised version of macular hole size.</p>
<p>When we talk about probabilities we focus on the proportion of <strong>successes</strong> out of the <strong>total</strong> for each row. So, the probability (or risk) of successful repair for those patients with a macular hole size less than <code>480</code> microns is therefore <code>479/487</code> or about <code>0.98</code>. Thatâ€™s in contrast to the probability of successful repair in those patients with a size greater than <code>480</code> microns - where the chance of success is <code>380/503</code> or <code>0.76</code> - so lower as one would expect. You can then take a ratio of those two probabilities or risks to give the classic risk ratio and that equals <code>1.3</code> which tells you that the chance of successful repair is <code>30%</code> greater if you have a smaller macular hole at initial presentation.</p>
<p>Now letâ€™s look at the equivalent odds. When we talk about odds we focus on the ratio of <strong>successes</strong> to <strong>failures</strong> and donâ€™t really worry about the totals. So the odds of successful repair for those patients with a smaller initial hole is <code>479/8</code> or <code>60</code> to <code>1</code>. The odds of success with a larger hole are a lot more modest - <code>380/123</code> or about <code>3</code> to <code>1</code>. We can then calculate the classic odds ratio which works out at about <code>20</code>, meaning the odds of successful repair is about <code>20</code> times greater in those with thinner initial holes.</p>
<p>Note that both of these effect measures are commensurate - they point in exactly the same direction - that you fare better with a smaller hole at diagnosis. They are just different ways of expressing the same thing.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/prob_vs_odds.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
</section>
<section id="logistic-regression" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Logistic Regression</h1>
<p>Ok, letâ€™s actually talk about logistic regression.</p>
<p>Logistic regression is a type of <em>generalised linear model</em> - of which there are many - the poisson, negative binomial, multinomial are just some examples. The important thing is that the standard linear model equation consists of an outcome variable (<code>Y</code>) on the left side and a linear predictor of that outcome (<code>X</code>) on the right. The linear predictor can be composed of one or multiple variables.</p>
<p><span class="math display">\[\text{Y} = \beta_0 \; + \; \beta_1x\]</span> Now, a fundamental assumption of the linear model is that <code>Y</code> is an unbounded and continuous variable and the relationship between <code>X</code> and <code>Y</code> is linear - if you plot <code>X</code> and <code>Y</code> you should get close to a straight line. That also means <strong>the â€˜effectâ€™ of a one-unit change in <code>X</code> on <code>Y</code> remains constant, over the range of <code>X</code></strong>.</p>
<p>However, a few things change with logistic regression: The first thing is that weâ€™re no longer estimating <code>Y</code> itself but rather the probability that <code>Y = 1</code> or in other words the probability that the outcome has occurred.</p>
<p><span class="math display">\[\text{p(Y = 1)} = \beta_0 \; + \; \beta_1x\]</span></p>
<p>But in estimating the probability that <code>Y = 1</code>, the relationship between <code>X</code> and <code>Y</code> is no longer linear and instead takes on a sigmoidal or S shape (Iâ€™ll illustrate this shortly). Consequently this means that <strong>the â€˜effectâ€™ of a one-unit change in <code>X</code> on <code>Y</code> is no longer constant</strong> - that link has now broken down.</p>
<p>So what do we do when our outcome violates the above assumptions because it can only take on values between <code>0</code> and <code>1</code> and the relationship between <code>Y</code> and <code>X</code> is no longer linear?</p>
<p><strong>How do we now â€˜linkâ€™ <code>X</code> and <code>Y</code>?</strong></p>
<section id="the-logit-link-function-and-why-log-odds-are-actually-important" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="the-logit-link-function-and-why-log-odds-are-actually-important"><span class="header-section-number">4.1</span> The Logit Link Function (and why log-odds are actually important)</h2>
<p>The log-odds or the logit function is pivotal to how logistic regression works. The logit function is a type of <strong>link</strong> function and thereâ€™s really nothing mysterious or difficult about this. A link function is just a <strong>function of the mean of Y</strong> - in other words a <strong>transformation of the mean of Y</strong> - and we use this link function as the outcome instead of Y itself.</p>
<p><span class="math display">\[\text{logit(p)} = \text{log}\Bigl(\frac{\text{p}}{1 - \text{p}}\Bigr)\]</span> The logistic model then becomes:</p>
<p><span class="math display">\[\text{Y} = \text{logit(p)} = \beta_0 \; + \; \beta_1x\]</span></p>
<p>This allows the outcome to become continuous and unbounded and the association between <code>Y</code> and <code>X</code> to become linear, therefore satisfying those fundamental assumptions of the linear model that I mentioned earlier.</p>
<p>Thus, the logit is a type of transformation that <strong>links or maps probability values from</strong> <span class="math inline">\((0, 1)\)</span> to real numbers <span class="math inline">\({\displaystyle (-\infty ,+\infty )}\)</span>. Now, on the log-odds/logit scale <strong>the effect of a one-unit change in <code>X</code> on <code>Y</code> becomes constant once again</strong>.</p>
</section>
<section id="wth-log-oddsoddsprobabilities---youre-confusing-me---pick-one-please" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="wth-log-oddsoddsprobabilities---youre-confusing-me---pick-one-please"><span class="header-section-number">4.2</span> WTH? log-odds/odds/probabilities - Youâ€™re confusing me - pick one please!!</h2>
<p>Itâ€™s important to remember that logistic regression is really about probabilities, not odds. Probabilities are more intuitive than odds (unless you like to put a bet on the horses), so why use odds? Well, model results have historically been expressed in terms of odds and odds ratios for mathematical convenience. As it is for the log-odds scale, the â€˜effectâ€™ of a one-unit change in <code>X</code> on <code>Y</code> is also constant on the odds scale (but as a <em>ratio</em> of two odds, not as a <em>difference</em> in two log-odds). So an odds ratio describes a constant â€˜effectâ€™ of a predictor on the odds of an outcome, irrespective of the value of the predictor. This is not the case on the probability scale, where both differences and ratios vary per unit change depending on the value of the predictor (I will illustrate this later).</p>
<p>The TLDR:</p>
<ul>
<li><p>Model is estimated (under the hood) on the <strong>log-odds</strong> scale to satisfy modelling assumptions.</p></li>
<li><p>Model results are displayed on the <strong>odds</strong> scale (as odds ratios) for their constancy.</p></li>
<li><p><strong>Probabilities</strong> are calculated post-hoc with not much extra effort.</p></li>
</ul>
</section>
<section id="back-to-the-research-question" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="back-to-the-research-question"><span class="header-section-number">4.3</span> Back to the Research Question</h2>
<p>Letâ€™s go back to the original research question for the final time and now illustrate these concepts in that context. The regression equation for surgical repair success as a function of macular hole size that was estimated in our paper is shown here.</p>
<p><span class="math display">\[\text{logit(p)} = 10.89 - 0.016 \; \text{x} \;\text{macular hole size}\;(\mu m)\]</span></p>
<p>Basically, the log-odds of successful repair can be predicted by calculating the result of 10.89 minus the product of 0.016 and whatever the macular hole size is in microns.</p>
<section id="simulate-some-data" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="simulate-some-data"><span class="header-section-number">4.3.1</span> Simulate Some Data</h3>
<p>We can simulate some data from that regression equation - essentially reverse engineering fake data from the estimated best fit equation on the actual data. Why do this? Well, it gives us some sense of what the actual data may have looked like that the researchers collected empirically. We can then do all sorts of cool things like refit a model, generate model predictions, etc. Data simulation is something I am still learning more about but it opens up a world of possibilities in your analytical work.</p>
<p>For this simulation I used a normal distribution with a mean and SD for macular hole size of <code>486</code> and <code>142</code>, respectively (the numbers came from the original research paper). The code to show how to reproduce this in <code>R</code> is included below but you can do something similar in <code>Stata</code> and in most other scriptable statistical software packages.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(ggmagnify)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co"># Simulation</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span>                                          <span class="co"># set number of obs to simulate</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)                                     <span class="co"># set seed for reproducibility</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>mac_hole_size  <span class="ot">&lt;-</span>  <span class="fu">rnorm</span>(n, <span class="dv">486</span>, <span class="dv">142</span>)              <span class="co"># generate macular hole inner opening data with mean 486 and sd = 152</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>logodds_success  <span class="ot">&lt;-</span>  <span class="fl">10.89</span> <span class="sc">-</span> <span class="fl">0.016</span> <span class="sc">*</span> mac_hole_size <span class="co"># generate variable that is linear combination of intercept = 10.89 and coefficient for macular hole -0.016 (logit scale)</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>odds_success  <span class="ot">&lt;-</span>  <span class="fu">exp</span>(logodds_success)             <span class="co"># exponentiate logodds to get odds</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>prob_success  <span class="ot">&lt;-</span>  odds_success<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> odds_success)  <span class="co"># generate probabilities from this</span></span>
<span id="cb1-14"><a href="#cb1-14"></a>y_success  <span class="ot">&lt;-</span>  <span class="fu">rbinom</span>(n, <span class="dv">1</span>, prob_success)          <span class="co"># generate outcome variable as a function of those probabilities</span></span>
<span id="cb1-15"><a href="#cb1-15"></a>df <span class="ot">&lt;-</span>  <span class="fu">data.frame</span>(<span class="fu">cbind</span>(mac_hole_size,             <span class="co"># combine into dataframe</span></span>
<span id="cb1-16"><a href="#cb1-16"></a>                        logodds_success,</span>
<span id="cb1-17"><a href="#cb1-17"></a>                        odds_success,</span>
<span id="cb1-18"><a href="#cb1-18"></a>                        prob_success, </span>
<span id="cb1-19"><a href="#cb1-19"></a>                        y_success))</span>
<span id="cb1-20"><a href="#cb1-20"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb1-21"><a href="#cb1-21"></a>  <span class="fu">filter</span>(mac_hole_size <span class="sc">&gt;</span> <span class="dv">100</span>)                       <span class="co"># only include those with size &gt; 100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Essentially, we generate some random values of macular hole size based on the specified distribution and then plug those values in to the regression equation and calculate the various outcome measures. The resultant data look like (first 20 rows shown):</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">head</span>(df, <span class="dv">20</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="fu">kable_styling</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="fu">row_spec</span>(<span class="dv">1</span>, <span class="at">bold =</span> T, <span class="at">background =</span> <span class="st">"skyblue1"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="fu">row_spec</span>(<span class="dv">20</span>, <span class="at">bold =</span> T, <span class="at">background =</span> <span class="st">"lightgoldenrod1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">mac_hole_size</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">logodds_success</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">odds_success</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">prob_success</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">y_success</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center; font-weight: bold; background-color: rgba(135, 206, 255, 255) !important;">314.60</td>
<td style="text-align: center; font-weight: bold; background-color: rgba(135, 206, 255, 255) !important;">5.86</td>
<td style="text-align: center; font-weight: bold; background-color: rgba(135, 206, 255, 255) !important;">349.48</td>
<td style="text-align: center; font-weight: bold; background-color: rgba(135, 206, 255, 255) !important;">1.00</td>
<td style="text-align: center; font-weight: bold; background-color: rgba(135, 206, 255, 255) !important;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">525.39</td>
<td style="text-align: center;">2.48</td>
<td style="text-align: center;">11.99</td>
<td style="text-align: center;">0.92</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">639.99</td>
<td style="text-align: center;">0.65</td>
<td style="text-align: center;">1.92</td>
<td style="text-align: center;">0.66</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">152.91</td>
<td style="text-align: center;">8.44</td>
<td style="text-align: center;">4644.44</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">546.94</td>
<td style="text-align: center;">2.14</td>
<td style="text-align: center;">8.49</td>
<td style="text-align: center;">0.89</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">557.86</td>
<td style="text-align: center;">1.96</td>
<td style="text-align: center;">7.13</td>
<td style="text-align: center;">0.88</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">404.39</td>
<td style="text-align: center;">4.42</td>
<td style="text-align: center;">83.08</td>
<td style="text-align: center;">0.99</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">408.38</td>
<td style="text-align: center;">4.36</td>
<td style="text-align: center;">77.94</td>
<td style="text-align: center;">0.99</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">405.85</td>
<td style="text-align: center;">4.40</td>
<td style="text-align: center;">81.16</td>
<td style="text-align: center;">0.99</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">359.61</td>
<td style="text-align: center;">5.14</td>
<td style="text-align: center;">170.06</td>
<td style="text-align: center;">0.99</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">418.24</td>
<td style="text-align: center;">4.20</td>
<td style="text-align: center;">66.57</td>
<td style="text-align: center;">0.99</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">344.23</td>
<td style="text-align: center;">5.38</td>
<td style="text-align: center;">217.53</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">375.77</td>
<td style="text-align: center;">4.88</td>
<td style="text-align: center;">131.32</td>
<td style="text-align: center;">0.99</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">495.15</td>
<td style="text-align: center;">2.97</td>
<td style="text-align: center;">19.44</td>
<td style="text-align: center;">0.95</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">622.25</td>
<td style="text-align: center;">0.93</td>
<td style="text-align: center;">2.54</td>
<td style="text-align: center;">0.72</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">470.34</td>
<td style="text-align: center;">3.36</td>
<td style="text-align: center;">28.92</td>
<td style="text-align: center;">0.97</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">413.44</td>
<td style="text-align: center;">4.28</td>
<td style="text-align: center;">71.88</td>
<td style="text-align: center;">0.99</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">356.61</td>
<td style="text-align: center;">5.18</td>
<td style="text-align: center;">178.44</td>
<td style="text-align: center;">0.99</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">367.12</td>
<td style="text-align: center;">5.02</td>
<td style="text-align: center;">150.82</td>
<td style="text-align: center;">0.99</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center; font-weight: bold; background-color: rgba(255, 236, 139, 255) !important;">829.05</td>
<td style="text-align: center; font-weight: bold; background-color: rgba(255, 236, 139, 255) !important;">-2.37</td>
<td style="text-align: center; font-weight: bold; background-color: rgba(255, 236, 139, 255) !important;">0.09</td>
<td style="text-align: center; font-weight: bold; background-color: rgba(255, 236, 139, 255) !important;">0.09</td>
<td style="text-align: center; font-weight: bold; background-color: rgba(255, 236, 139, 255) !important;">0</td>
</tr>
</tbody>
</table>


</div>
</div>
<p><br></p>
<p>Letâ€™s pick a couple of data points to examine more closely.</p>
<p>If we look at the first row (blue), the macular hole size is about <code>315</code> microns and this translates to a log-odds of successful repair of <code>5.9</code> (calculated straight from the regression equation), an odds of successful repair of about <code>350</code> to <code>1</code> (transformation calculation) and a probability of successful repair of <code>0.997</code> (transformation calculation). We can then generate the actual outcome status using that probability as a random variable in a binomial distribution. So in this case a relatively low macular hole size translates to a successful repair, as we might have expected.</p>
<p>Now if we look at the last row of data (yellow), we see something different. Here we have a simulated size of <code>829</code> microns and this translates to a log-odds of successful repair of <code>-2.4</code>, an odds of <code>1</code> to <code>10</code> against and a probability of less than <code>0.1.</code> Not surprisingly, the outcome status in this case is simulated as a failure.</p>
</section>
<section id="plot-the-observed-data" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="plot-the-observed-data"><span class="header-section-number">4.3.2</span> Plot the Observed Data</h3>
<p>What if we now plot the observed data, that is, plot the outcome status as a function of macular hole size?</p>
<p>Iâ€™m a big advocate of always plotting your data first - before you calculate any descriptive statistics and certainly before running any statistical tests. In fact Iâ€™m not being melodramatic when I say that plotting your data can save you from looking like an analytical fool when youâ€™re potentially ill-founded assumptions arenâ€™t realised in the actual data. A good visualisation can reveal these kinds of problems instantly.</p>
<p>After that big recommendation, we might be left feeling slightly deflated when we see that plotting binary data doesnâ€™t appear that informative - I mean whereâ€™s the nice scatter plot and imaginary trend line that weâ€™re used to thinking about?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Plot observed data</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(mac_hole_size, y_success)) <span class="sc">+</span> </span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>  <span class="fu">xlab</span>(<span class="st">"Macular hole size"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Surgical repair success"</span>) <span class="sc">+</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>Well itâ€™s not entirely helpless - we can see that thereâ€™s more successes skewed towards smaller macular holes and more failures skewed towards larger macular holes, so that does tell us something useful. But there are better ways to plot binary data and Iâ€™ll take you through this shortly.</p>
</section>
<section id="fit-linear-model-naive-approach" class="level3" data-number="4.3.3">
<h3 data-number="4.3.3" class="anchored" data-anchor-id="fit-linear-model-naive-approach"><span class="header-section-number">4.3.3</span> Fit Linear Model (Naive Approach)</h3>
<p>What if we fit a standard regression line to binary data, effectively treating <code>Y</code> as continuous? Well people have done this in the past, and in some parts of the data analysis world, still do. It kind of works, but itâ€™s not the best tool for the job and we can certainly do better. The best fit line is negative suggesting that as macular hole size increases, repair success decreases, so it is in line with what we know to be true. Note that I have rescaled macular hole size so that the resulting coefficient isnâ€™t so small (now 1 â€˜unitâ€™ = 100 microns instead of 1 micron).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Linear model</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>mod_linear <span class="ot">&lt;-</span> <span class="fu">lm</span>(y_success <span class="sc">~</span> <span class="fu">I</span>(mac_hole_size<span class="sc">/</span><span class="dv">100</span>), <span class="at">data =</span> df) </span>
<span id="cb4-3"><a href="#cb4-3"></a>mod_linear <span class="sc">|&gt;</span> </span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="fu">tbl_regression</span>(<span class="at">intercept =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="oornzzuoxv" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#oornzzuoxv table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#oornzzuoxv thead, #oornzzuoxv tbody, #oornzzuoxv tfoot, #oornzzuoxv tr, #oornzzuoxv td, #oornzzuoxv th {
  border-style: none;
}

#oornzzuoxv p {
  margin: 0;
  padding: 0;
}

#oornzzuoxv .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#oornzzuoxv .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#oornzzuoxv .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#oornzzuoxv .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#oornzzuoxv .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oornzzuoxv .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oornzzuoxv .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oornzzuoxv .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#oornzzuoxv .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#oornzzuoxv .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#oornzzuoxv .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#oornzzuoxv .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#oornzzuoxv .gt_spanner_row {
  border-bottom-style: hidden;
}

#oornzzuoxv .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#oornzzuoxv .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#oornzzuoxv .gt_from_md > :first-child {
  margin-top: 0;
}

#oornzzuoxv .gt_from_md > :last-child {
  margin-bottom: 0;
}

#oornzzuoxv .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#oornzzuoxv .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#oornzzuoxv .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#oornzzuoxv .gt_row_group_first td {
  border-top-width: 2px;
}

#oornzzuoxv .gt_row_group_first th {
  border-top-width: 2px;
}

#oornzzuoxv .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oornzzuoxv .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#oornzzuoxv .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#oornzzuoxv .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oornzzuoxv .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oornzzuoxv .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#oornzzuoxv .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#oornzzuoxv .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#oornzzuoxv .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oornzzuoxv .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oornzzuoxv .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#oornzzuoxv .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oornzzuoxv .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#oornzzuoxv .gt_left {
  text-align: left;
}

#oornzzuoxv .gt_center {
  text-align: center;
}

#oornzzuoxv .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#oornzzuoxv .gt_font_normal {
  font-weight: normal;
}

#oornzzuoxv .gt_font_bold {
  font-weight: bold;
}

#oornzzuoxv .gt_font_italic {
  font-style: italic;
}

#oornzzuoxv .gt_super {
  font-size: 65%;
}

#oornzzuoxv .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#oornzzuoxv .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#oornzzuoxv .gt_indent_1 {
  text-indent: 5px;
}

#oornzzuoxv .gt_indent_2 {
  text-indent: 10px;
}

#oornzzuoxv .gt_indent_3 {
  text-indent: 15px;
}

#oornzzuoxv .gt_indent_4 {
  text-indent: 20px;
}

#oornzzuoxv .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="<strong>Characteristic</strong>" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Characteristic</strong></th>
<th id="<strong>Beta</strong>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Beta</strong></th>
<th id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
<th id="<strong>p-value</strong>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>p-value</strong></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">(Intercept)</td>
<td class="gt_row gt_center" headers="estimate">1.5</td>
<td class="gt_row gt_center" headers="ci">1.4, 1.5</td>
<td class="gt_row gt_center" headers="p.value">&lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">I(mac_hole_size/100)</td>
<td class="gt_row gt_center" headers="estimate">-0.12</td>
<td class="gt_row gt_center" headers="ci">-0.14, -0.11</td>
<td class="gt_row gt_center" headers="p.value">&lt;0.001</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="odd">
<td colspan="4" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> CI = Confidence Interval</td>
</tr>
</tfoot>

</table>

</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Plot data with regression line</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(mac_hole_size, y_success)) <span class="sc">+</span> </span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="fu">coef</span>(mod_linear)[[<span class="st">"I(mac_hole_size/100)"</span>]]<span class="sc">/</span><span class="dv">100</span>, </span>
<span id="cb5-5"><a href="#cb5-5"></a>              <span class="at">intercept =</span> <span class="fu">coef</span>(mod_linear)[[<span class="st">"(Intercept)"</span>]], </span>
<span id="cb5-6"><a href="#cb5-6"></a>              <span class="at">color =</span> <span class="st">"cornflowerblue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>  <span class="fu">xlab</span>(<span class="st">"Macular hole size"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Surgical repair success"</span>) <span class="sc">+</span></span>
<span id="cb5-10"><a href="#cb5-10"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="problem---predictions-are-made-outside-the-probability-domain" class="level3" data-number="4.3.4">
<h3 data-number="4.3.4" class="anchored" data-anchor-id="problem---predictions-are-made-outside-the-probability-domain"><span class="header-section-number">4.3.4</span> Problem - Predictions are made Outside the Probability Domain</h3>
<p>The problem with naively fitting a standard linear model is that because we are know treating <code>Y</code> as unbounded and continuous, the model no longer knows that the outcome has to be constrained between 0 and 1, and predictions can easily fall outside this range. And thatâ€™s exactly what we can see here - a macular hole size of <code>100</code> microns (blue) predicts outcome success at <code>1.35</code> and a size of <code>1200</code> microns (yellow) predicts outcome success at <code>-0.02</code>. So fitting a standard linear model to binary data is really not a good approach.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Create new df to predict on new values of x</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>new_dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">mac_hole_size =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">50</span>))</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co"># Predict new fitted values</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>pred <span class="ot">&lt;-</span> <span class="fu">cbind</span>(new_dat, <span class="at">prediction =</span> <span class="fu">predict</span>(mod_linear, <span class="at">newdata =</span> new_dat))</span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co"># Display predictions</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>pred <span class="sc">|&gt;</span> </span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="fu">kable_styling</span>() <span class="sc">|&gt;</span> </span>
<span id="cb6-9"><a href="#cb6-9"></a>  <span class="fu">row_spec</span>(<span class="dv">3</span>, <span class="at">bold =</span> T, <span class="at">background =</span> <span class="st">"skyblue1"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-10"><a href="#cb6-10"></a>  <span class="fu">row_spec</span>(<span class="dv">25</span>, <span class="at">bold =</span> T, <span class="at">background =</span> <span class="st">"lightgoldenrod1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">mac_hole_size</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">prediction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0</td>
<td style="text-align: center;">1.47</td>
</tr>
<tr class="even">
<td style="text-align: center;">50</td>
<td style="text-align: center;">1.41</td>
</tr>
<tr class="odd">
<td style="text-align: center; font-weight: bold; background-color: rgba(135, 206, 255, 255) !important;">100</td>
<td style="text-align: center; font-weight: bold; background-color: rgba(135, 206, 255, 255) !important;">1.35</td>
</tr>
<tr class="even">
<td style="text-align: center;">150</td>
<td style="text-align: center;">1.29</td>
</tr>
<tr class="odd">
<td style="text-align: center;">200</td>
<td style="text-align: center;">1.22</td>
</tr>
<tr class="even">
<td style="text-align: center;">250</td>
<td style="text-align: center;">1.16</td>
</tr>
<tr class="odd">
<td style="text-align: center;">300</td>
<td style="text-align: center;">1.10</td>
</tr>
<tr class="even">
<td style="text-align: center;">350</td>
<td style="text-align: center;">1.04</td>
</tr>
<tr class="odd">
<td style="text-align: center;">400</td>
<td style="text-align: center;">0.98</td>
</tr>
<tr class="even">
<td style="text-align: center;">450</td>
<td style="text-align: center;">0.91</td>
</tr>
<tr class="odd">
<td style="text-align: center;">500</td>
<td style="text-align: center;">0.85</td>
</tr>
<tr class="even">
<td style="text-align: center;">550</td>
<td style="text-align: center;">0.79</td>
</tr>
<tr class="odd">
<td style="text-align: center;">600</td>
<td style="text-align: center;">0.73</td>
</tr>
<tr class="even">
<td style="text-align: center;">650</td>
<td style="text-align: center;">0.66</td>
</tr>
<tr class="odd">
<td style="text-align: center;">700</td>
<td style="text-align: center;">0.60</td>
</tr>
<tr class="even">
<td style="text-align: center;">750</td>
<td style="text-align: center;">0.54</td>
</tr>
<tr class="odd">
<td style="text-align: center;">800</td>
<td style="text-align: center;">0.48</td>
</tr>
<tr class="even">
<td style="text-align: center;">850</td>
<td style="text-align: center;">0.42</td>
</tr>
<tr class="odd">
<td style="text-align: center;">900</td>
<td style="text-align: center;">0.35</td>
</tr>
<tr class="even">
<td style="text-align: center;">950</td>
<td style="text-align: center;">0.29</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1000</td>
<td style="text-align: center;">0.23</td>
</tr>
<tr class="even">
<td style="text-align: center;">1050</td>
<td style="text-align: center;">0.17</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1100</td>
<td style="text-align: center;">0.10</td>
</tr>
<tr class="even">
<td style="text-align: center;">1150</td>
<td style="text-align: center;">0.04</td>
</tr>
<tr class="odd">
<td style="text-align: center; font-weight: bold; background-color: rgba(255, 236, 139, 255) !important;">1200</td>
<td style="text-align: center; font-weight: bold; background-color: rgba(255, 236, 139, 255) !important;">-0.02</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="plot-the-binned-observed-data" class="level3" data-number="4.3.5">
<h3 data-number="4.3.5" class="anchored" data-anchor-id="plot-the-binned-observed-data"><span class="header-section-number">4.3.5</span> Plot the â€˜Binnedâ€™ Observed Data</h3>
<p>So I said above that there was a better way to plot binary data in an effort to make the visualisation more information, and there is. Instead of just plotting the raw data - just the <code>0</code>â€˜s and <code>1</code>â€™s - you can create â€™binsâ€™ of data based on (some fairly arbitrary) thresholds of the predictor you are plotting against and then plot the proportion of successes within each bin. Here I created â€˜binsâ€™ of data for each <code>50</code> <span class="math inline">\(\mu m\)</span>â€™s of macular hole size and then calculated the mean success rate (i.e.&nbsp;the proportion of 1â€™s) within each bin.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Create bins of data for each 50 microns of macular hole size</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>df<span class="sc">$</span>bins <span class="ot">&lt;-</span> <span class="fu">cut</span>(df<span class="sc">$</span>mac_hole_size, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1000</span>, <span class="at">by =</span> <span class="dv">50</span>))</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co"># Calculate means (number of successful repairs divided by total number of repairs) in each bin</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="fu">group_by</span>(bins) <span class="sc">|&gt;</span> </span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="fu">mutate</span>(<span class="at">mean_y =</span> <span class="fu">mean</span>(y_success))</span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co"># Plot observed (averaged) data </span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="fu">as.numeric</span>(bins)<span class="sc">*</span><span class="dv">50-25</span>, mean_y)) <span class="sc">+</span> </span>
<span id="cb7-9"><a href="#cb7-9"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13"></a>  <span class="fu">xlab</span>(<span class="st">"Macular hole size"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Proportion"</span>) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>Now we are starting to see the classic sigmoid shape of the relationship between probability and a continuous predictor.</p>
</section>
<section id="fit-a-logistic-model-to-the-simulated-data" class="level3" data-number="4.3.6">
<h3 data-number="4.3.6" class="anchored" data-anchor-id="fit-a-logistic-model-to-the-simulated-data"><span class="header-section-number">4.3.6</span> Fit a Logistic Model to the Simulated Data</h3>
<p>Now, letâ€™s finally fit a logistic model to these simulated data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Logistic model</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>mod_logistic <span class="ot">&lt;-</span> <span class="fu">glm</span>(y_success <span class="sc">~</span> <span class="fu">I</span>(mac_hole_size<span class="sc">/</span><span class="dv">100</span>), <span class="at">data =</span> df, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb8-3"><a href="#cb8-3"></a>mod_logistic <span class="sc">|&gt;</span> </span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">tbl_regression</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="jiexajhhzk" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#jiexajhhzk table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#jiexajhhzk thead, #jiexajhhzk tbody, #jiexajhhzk tfoot, #jiexajhhzk tr, #jiexajhhzk td, #jiexajhhzk th {
  border-style: none;
}

#jiexajhhzk p {
  margin: 0;
  padding: 0;
}

#jiexajhhzk .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#jiexajhhzk .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#jiexajhhzk .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#jiexajhhzk .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#jiexajhhzk .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jiexajhhzk .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jiexajhhzk .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jiexajhhzk .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jiexajhhzk .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jiexajhhzk .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jiexajhhzk .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jiexajhhzk .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jiexajhhzk .gt_spanner_row {
  border-bottom-style: hidden;
}

#jiexajhhzk .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#jiexajhhzk .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#jiexajhhzk .gt_from_md > :first-child {
  margin-top: 0;
}

#jiexajhhzk .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jiexajhhzk .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#jiexajhhzk .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#jiexajhhzk .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#jiexajhhzk .gt_row_group_first td {
  border-top-width: 2px;
}

#jiexajhhzk .gt_row_group_first th {
  border-top-width: 2px;
}

#jiexajhhzk .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jiexajhhzk .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#jiexajhhzk .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#jiexajhhzk .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jiexajhhzk .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jiexajhhzk .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#jiexajhhzk .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#jiexajhhzk .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#jiexajhhzk .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jiexajhhzk .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jiexajhhzk .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jiexajhhzk .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jiexajhhzk .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jiexajhhzk .gt_left {
  text-align: left;
}

#jiexajhhzk .gt_center {
  text-align: center;
}

#jiexajhhzk .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jiexajhhzk .gt_font_normal {
  font-weight: normal;
}

#jiexajhhzk .gt_font_bold {
  font-weight: bold;
}

#jiexajhhzk .gt_font_italic {
  font-style: italic;
}

#jiexajhhzk .gt_super {
  font-size: 65%;
}

#jiexajhhzk .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#jiexajhhzk .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#jiexajhhzk .gt_indent_1 {
  text-indent: 5px;
}

#jiexajhhzk .gt_indent_2 {
  text-indent: 10px;
}

#jiexajhhzk .gt_indent_3 {
  text-indent: 15px;
}

#jiexajhhzk .gt_indent_4 {
  text-indent: 20px;
}

#jiexajhhzk .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="<strong>Characteristic</strong>" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Characteristic</strong></th>
<th id="<strong>log(OR)</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>log(OR)</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
<th id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
<th id="<strong>p-value</strong>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>p-value</strong></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">I(mac_hole_size/100)</td>
<td class="gt_row gt_center" headers="estimate">-1.5</td>
<td class="gt_row gt_center" headers="ci">-1.8, -1.3</td>
<td class="gt_row gt_center" headers="p.value">&lt;0.001</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="even">
<td colspan="4" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> OR = Odds Ratio, CI = Confidence Interval</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
<p>On the model estimation log-odds scale, the parameter estimate for the effect of macular hole size is <code>-1.5</code>, meaning for every <code>100</code> micron increase in macular hole size, the log-odds of success decreases by <code>1.5</code> units. All stats software will also provide you with parameter estimates as odds ratios, because thatâ€™s how weâ€™re accustomed to reporting effects. And the equivalent odds ratio in this case is <code>0.22</code>. In other words, for every <code>100</code> micron increase in macular hole size there is about a <code>78</code>% reduction in the odds of success.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>mod_logistic <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="fu">tbl_regression</span>(<span class="at">exponentiate =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="pvenohjoqo" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#pvenohjoqo table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#pvenohjoqo thead, #pvenohjoqo tbody, #pvenohjoqo tfoot, #pvenohjoqo tr, #pvenohjoqo td, #pvenohjoqo th {
  border-style: none;
}

#pvenohjoqo p {
  margin: 0;
  padding: 0;
}

#pvenohjoqo .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#pvenohjoqo .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#pvenohjoqo .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#pvenohjoqo .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#pvenohjoqo .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pvenohjoqo .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pvenohjoqo .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pvenohjoqo .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#pvenohjoqo .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#pvenohjoqo .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#pvenohjoqo .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#pvenohjoqo .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#pvenohjoqo .gt_spanner_row {
  border-bottom-style: hidden;
}

#pvenohjoqo .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#pvenohjoqo .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#pvenohjoqo .gt_from_md > :first-child {
  margin-top: 0;
}

#pvenohjoqo .gt_from_md > :last-child {
  margin-bottom: 0;
}

#pvenohjoqo .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#pvenohjoqo .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#pvenohjoqo .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#pvenohjoqo .gt_row_group_first td {
  border-top-width: 2px;
}

#pvenohjoqo .gt_row_group_first th {
  border-top-width: 2px;
}

#pvenohjoqo .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pvenohjoqo .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#pvenohjoqo .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#pvenohjoqo .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pvenohjoqo .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pvenohjoqo .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#pvenohjoqo .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#pvenohjoqo .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#pvenohjoqo .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pvenohjoqo .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pvenohjoqo .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pvenohjoqo .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pvenohjoqo .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pvenohjoqo .gt_left {
  text-align: left;
}

#pvenohjoqo .gt_center {
  text-align: center;
}

#pvenohjoqo .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pvenohjoqo .gt_font_normal {
  font-weight: normal;
}

#pvenohjoqo .gt_font_bold {
  font-weight: bold;
}

#pvenohjoqo .gt_font_italic {
  font-style: italic;
}

#pvenohjoqo .gt_super {
  font-size: 65%;
}

#pvenohjoqo .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#pvenohjoqo .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#pvenohjoqo .gt_indent_1 {
  text-indent: 5px;
}

#pvenohjoqo .gt_indent_2 {
  text-indent: 10px;
}

#pvenohjoqo .gt_indent_3 {
  text-indent: 15px;
}

#pvenohjoqo .gt_indent_4 {
  text-indent: 20px;
}

#pvenohjoqo .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="<strong>Characteristic</strong>" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Characteristic</strong></th>
<th id="<strong>OR</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>OR</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
<th id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
<th id="<strong>p-value</strong>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>p-value</strong></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">I(mac_hole_size/100)</td>
<td class="gt_row gt_center" headers="estimate">0.22</td>
<td class="gt_row gt_center" headers="ci">0.17, 0.28</td>
<td class="gt_row gt_center" headers="p.value">&lt;0.001</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="even">
<td colspan="4" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> OR = Odds Ratio, CI = Confidence Interval</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
<p>Note that the odds ratio coefficient is a simple transformation of the log-odds coefficient (as we described earlier.) That is:</p>
<p><span class="math display">\[e^{-1.5} = 0.22\]</span></p>
</section>
<section id="plot-predicted-log-odds-of-surgical-repair-success" class="level3" data-number="4.3.7">
<h3 data-number="4.3.7" class="anchored" data-anchor-id="plot-predicted-log-odds-of-surgical-repair-success"><span class="header-section-number">4.3.7</span> Plot Predicted log-odds of Surgical Repair Success</h3>
<p>Now we can plot the predicted log-odds of surgical repair success. Note that this is a straight line effectively fitted to our binary outcome, and the reason again that we can do this is because the binary outcome has been â€˜remappedâ€™ to log-odds and the log-odds exist on an unbounded and continuous scale. So this <strong>is</strong> a valid plot, unlike that before where we plotted the predictions treating <code>Y</code> as if it were a continuous outcome (Iâ€™m not necessarily suggesting this is a <em>useful</em> plot, just that itâ€™s valid).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Predictions</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="co"># Emmeans of logodds at 600 and 700 microns</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>emmeans_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">emmeans</span>(mod_logistic, <span class="sc">~</span> mac_hole_size, <span class="at">at =</span> <span class="fu">list</span>(<span class="at">mac_hole_size =</span> <span class="fu">c</span>(<span class="dv">600</span>, <span class="dv">700</span>, <span class="dv">800</span>))))</span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co"># Create df of emmeans and corresponding odds and probs, for plotting</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>emmeans_df <span class="ot">&lt;-</span> emmeans_df <span class="sc">|&gt;</span> </span>
<span id="cb10-6"><a href="#cb10-6"></a>  <span class="fu">select</span>(mac_hole_size, emmean) <span class="sc">|&gt;</span> </span>
<span id="cb10-7"><a href="#cb10-7"></a>  <span class="fu">rename</span>(<span class="at">logodds =</span> emmean) <span class="sc">|&gt;</span> </span>
<span id="cb10-8"><a href="#cb10-8"></a>  <span class="fu">mutate</span>(<span class="at">odds =</span> <span class="fu">round</span>(<span class="fu">exp</span>(logodds), <span class="dv">3</span>),</span>
<span id="cb10-9"><a href="#cb10-9"></a>         <span class="at">probs =</span> <span class="fu">round</span>(<span class="fu">plogis</span>(logodds), <span class="dv">2</span>),</span>
<span id="cb10-10"><a href="#cb10-10"></a>         <span class="at">logodds =</span> <span class="fu">round</span>(logodds, <span class="dv">3</span>))</span>
<span id="cb10-11"><a href="#cb10-11"></a></span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="co"># Predictions ----</span></span>
<span id="cb10-13"><a href="#cb10-13"></a><span class="co"># Create new df to predict on new values of x</span></span>
<span id="cb10-14"><a href="#cb10-14"></a>new_dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">mac_hole_size =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1200</span>, <span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="co"># Predict new fitted values and SE's on logodds scale</span></span>
<span id="cb10-16"><a href="#cb10-16"></a>pred_logodds <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_logistic, <span class="at">newdata =</span> new_dat, <span class="at">type =</span> <span class="st">"link"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-17"><a href="#cb10-17"></a>new_dat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(new_dat, pred_logodds)</span>
<span id="cb10-18"><a href="#cb10-18"></a><span class="co"># Create new df of predictions</span></span>
<span id="cb10-19"><a href="#cb10-19"></a>predictions <span class="ot">&lt;-</span> new_dat <span class="sc">|&gt;</span> </span>
<span id="cb10-20"><a href="#cb10-20"></a>  <span class="fu">rename</span>(<span class="at">pred_logodds_est =</span> fit) <span class="sc">|&gt;</span> </span>
<span id="cb10-21"><a href="#cb10-21"></a>  <span class="fu">mutate</span>(<span class="at">pred_logodds_LL =</span> pred_logodds_est <span class="sc">-</span> (<span class="fl">1.96</span> <span class="sc">*</span> se.fit),</span>
<span id="cb10-22"><a href="#cb10-22"></a>         <span class="at">pred_logodds_UL =</span> pred_logodds_est <span class="sc">+</span> (<span class="fl">1.96</span> <span class="sc">*</span> se.fit)) <span class="sc">|&gt;</span> </span>
<span id="cb10-23"><a href="#cb10-23"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(se.fit, residual.scale))</span>
<span id="cb10-24"><a href="#cb10-24"></a><span class="co"># Predict new fitted values and SE's on odds scale</span></span>
<span id="cb10-25"><a href="#cb10-25"></a>predictions <span class="ot">&lt;-</span> predictions <span class="sc">|&gt;</span> </span>
<span id="cb10-26"><a href="#cb10-26"></a>  <span class="fu">mutate</span>(<span class="at">pred_odds_est =</span> <span class="fu">exp</span>(pred_logodds_est),</span>
<span id="cb10-27"><a href="#cb10-27"></a>         <span class="at">pred_odds_LL =</span> <span class="fu">exp</span>(pred_logodds_LL),</span>
<span id="cb10-28"><a href="#cb10-28"></a>         <span class="at">pred_odds_UL =</span> <span class="fu">exp</span>(pred_logodds_UL))</span>
<span id="cb10-29"><a href="#cb10-29"></a><span class="co"># Predict new fitted values and SE's on probability scale</span></span>
<span id="cb10-30"><a href="#cb10-30"></a>pred_probs <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_logistic, <span class="at">newdata =</span> new_dat, <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-31"><a href="#cb10-31"></a>new_dat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(new_dat[<span class="dv">1</span>], pred_probs)</span>
<span id="cb10-32"><a href="#cb10-32"></a>new_dat <span class="ot">&lt;-</span> new_dat <span class="sc">|&gt;</span> </span>
<span id="cb10-33"><a href="#cb10-33"></a>  <span class="fu">mutate</span>(<span class="at">pred_probs_LL =</span> fit <span class="sc">-</span> (<span class="fl">1.96</span> <span class="sc">*</span> se.fit),</span>
<span id="cb10-34"><a href="#cb10-34"></a>         <span class="at">pred_probs_UL =</span> fit <span class="sc">+</span> (<span class="fl">1.96</span> <span class="sc">*</span> se.fit))</span>
<span id="cb10-35"><a href="#cb10-35"></a><span class="co"># Add predicted probs and CIs to predictions df</span></span>
<span id="cb10-36"><a href="#cb10-36"></a>predictions <span class="ot">&lt;-</span> <span class="fu">cbind</span>(predictions, </span>
<span id="cb10-37"><a href="#cb10-37"></a>                     <span class="at">pred_probs_est =</span> new_dat<span class="sc">$</span>fit, </span>
<span id="cb10-38"><a href="#cb10-38"></a>                     <span class="at">pred_probs_LL =</span> new_dat<span class="sc">$</span>pred_probs_LL,</span>
<span id="cb10-39"><a href="#cb10-39"></a>                     <span class="at">pred_probs_UL =</span> new_dat<span class="sc">$</span>pred_probs_UL)</span>
<span id="cb10-40"><a href="#cb10-40"></a><span class="co"># Plot predicted log-odds</span></span>
<span id="cb10-41"><a href="#cb10-41"></a><span class="fu">ggplot</span>(predictions, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> pred_logodds_est)) <span class="sc">+</span> </span>
<span id="cb10-42"><a href="#cb10-42"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> pred_logodds_LL, <span class="at">ymax =</span> pred_logodds_UL), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb10-43"><a href="#cb10-43"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"cornflowerblue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb10-44"><a href="#cb10-44"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> y_success), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb10-45"><a href="#cb10-45"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb10-46"><a href="#cb10-46"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">100</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb10-47"><a href="#cb10-47"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8</span>, <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb10-48"><a href="#cb10-48"></a>  <span class="fu">xlab</span>(<span class="st">"Macular hole size"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted log-odds"</span>) <span class="sc">+</span></span>
<span id="cb10-49"><a href="#cb10-49"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plot-predicted-odds-of-surgical-repair-success" class="level3" data-number="4.3.8">
<h3 data-number="4.3.8" class="anchored" data-anchor-id="plot-predicted-odds-of-surgical-repair-success"><span class="header-section-number">4.3.8</span> Plot Predicted Odds of Surgical Repair Success</h3>
<p>We can also plot the predicted odds of surgical repair success. Note that this best-fitting line is not linear, but instead looks like an exponential plot. We established previously that odds exist on a scale from <code>0</code> to <span class="math inline">\(+\infty\)</span> and thatâ€™s what we can appeciate here. Remember that this is just another transformation of the log-odds and the same trend is seen - as hole size increases, the odds of success decline.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Plot predicted odds</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="fu">ggplot</span>(predictions, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> pred_odds_est)) <span class="sc">+</span> </span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> pred_odds_LL, <span class="at">ymax =</span> pred_odds_UL), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"cornflowerblue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> y_success), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000000</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1000000</span>, <span class="at">by =</span> <span class="dv">1000</span>)) <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">7000</span>)) <span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>  <span class="fu">xlab</span>(<span class="st">"Macular hole size"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted odds"</span>) <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plot-predicted-probabilities-of-surgical-repair-success" class="level3" data-number="4.3.9">
<h3 data-number="4.3.9" class="anchored" data-anchor-id="plot-predicted-probabilities-of-surgical-repair-success"><span class="header-section-number">4.3.9</span> Plot Predicted Probabilities of Surgical Repair Success</h3>
<p>And we can also plot the predicted probabilities of surgical repair success. Again this is just another transformation of the log-odds or the odds. Note the classic sigmoid shape which emulates what we saw earlier when plotting the binned raw data. To my mind this plot is more useful than either plots of predicted log-odds or odds, as it tells us the likely chance of successful repair conditional on the initial macular hole size.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Plot predicted probabilities</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="fu">ggplot</span>(predictions, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> pred_probs_est)) <span class="sc">+</span> </span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> pred_probs_LL, <span class="at">ymax =</span> pred_probs_UL), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"cornflowerblue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> y_success), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8"></a>  <span class="fu">xlab</span>(<span class="st">"Macular hole size"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted probability"</span>) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plot-observed-and-predicted-probabilities-of-surgical-repair-success" class="level3" data-number="4.3.10">
<h3 data-number="4.3.10" class="anchored" data-anchor-id="plot-observed-and-predicted-probabilities-of-surgical-repair-success"><span class="header-section-number">4.3.10</span> Plot Observed and Predicted Probabilities of Surgical Repair Success</h3>
<p>And in fact what you should ideally find if you plot both your observed and predicted probabilities is that they are quite similar, reflecting that the model actually fits the data quite well. Of course, in this case the convergence of observed and predicted probabilities is unsurprising given that we know the data-generating proces - i.e.&nbsp;we fitted a model to data that came from a model. But, in general, this is a good way to assess your model fit.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Plot observed and predicted data</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="fu">as.numeric</span>(bins)<span class="sc">*</span><span class="dv">50-25</span>, mean_y)) <span class="sc">+</span> </span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"observed"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> predictions, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> pred_probs_est, <span class="at">color =</span> <span class="st">"predicted"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">""</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"predicted"</span> <span class="ot">=</span> <span class="st">"cornflowerblue"</span>, <span class="st">"observed"</span> <span class="ot">=</span> <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>  <span class="fu">xlab</span>(<span class="st">"Macular hole size"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Probability"</span>) <span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="putting-it-all-together" class="level3" data-number="4.3.11">
<h3 data-number="4.3.11" class="anchored" data-anchor-id="putting-it-all-together"><span class="header-section-number">4.3.11</span> Putting It All Together</h3>
<p>What I want to try and reinforce in the figure below is how the log-odds, the odds and the probability of the outcome are all transformations of each other.</p>
<p>In logistic regression we are ultimately interested in the probability of the outcome occurring. But we use the log-odds or logit link function to map probabilities onto a linear real-number range. This means that the change in <code>Y</code> for each unit increase in <code>X</code> remains the same and we can see that in the top plot. So the log-odds coefficient that our stats software gives us is constant across all values of macular hole size. This represents the <strong>difference</strong> in the log-odds of success for each unit change in <code>X</code>.</p>
<p>One unit increase in log-odds:</p>
<ul>
<li><code>600 -&gt; 700</code> <span class="math inline">\(\mu m\)</span><br>
<code>= -0.181 - 1.323 = -1.504</code><br>
</li>
<li><code>700 -&gt; 800</code> <span class="math inline">\(\mu m\)</span><br>
<code>= -1.686 - -0.181 = -1.505</code><br>
</li>
</ul>
<p>The middle plot shows the equivalent odds of success across the same range of macular hole size. Here the difference in <code>Y</code> is no longer constant for each unit increase in <code>X</code>, but the commensurate <strong>ratio</strong> is constant - and this gives us the odds ratio. This means that the odds ratio is constant across all values of macular hole size.</p>
<p>One unit increase in odds:</p>
<ul>
<li><code>600 -&gt; 700</code> <span class="math inline">\(\mu m\)</span><br>
<code>= 0.834/3.756 = 0.22</code><br>
</li>
<li><code>700 -&gt; 800</code> <span class="math inline">\(\mu m\)</span><br>
<code>= 0.185/0.834 = 0.22</code><br>
</li>
</ul>
<p>Finally the lower plot shows the equivalent probabilities of success and now there is no constancy in either unit differences or ratios. So, if we are interested in expressing our logistic regression model results as differences or ratios of predicted probabilities, we need to make sure that we qualify the macular hole size that a particular predicted probability corresponds to, as this will change across the range of <code>X</code>.</p>
<p>One unit increase in probability:</p>
<ul>
<li><code>600 -&gt; 700</code> <span class="math inline">\(\mu m\)</span><br>
<code>= 0.45 - 0.79 = -0.34</code><br>
<code>= 0.45/0.79 = 0.57</code><br>
</li>
<li><code>700 -&gt; 800</code> <span class="math inline">\(\mu m\)</span><br>
<code>= 0.16 - 0.45 = -0.29</code><br>
<code>= 0.16/0.45 = 0.36</code><br>
</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Reformat plots slightly for ggarrange ----</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(predictions, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> pred_logodds_est)) <span class="sc">+</span> </span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> pred_logodds_LL, <span class="at">ymax =</span> pred_logodds_UL), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"cornflowerblue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> y_success), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1150</span>, <span class="at">y =</span> <span class="dv">6</span>, <span class="at">label =</span> <span class="st">"log-odds"</span>, <span class="at">size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1110</span>, <span class="at">y =</span> <span class="fl">3.5</span>, <span class="at">label =</span> <span class="st">"unit differences = constant"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">100</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb14-10"><a href="#cb14-10"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8</span>, <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb14-11"><a href="#cb14-11"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">600</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb14-12"><a href="#cb14-12"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">700</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb14-13"><a href="#cb14-13"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">800</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb14-14"><a href="#cb14-14"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(<span class="at">data =</span> emmeans_df, <span class="fu">aes</span>(mac_hole_size, logodds),</span>
<span id="cb14-15"><a href="#cb14-15"></a>                            <span class="at">label =</span> emmeans_df<span class="sc">$</span>logodds, </span>
<span id="cb14-16"><a href="#cb14-16"></a>                            <span class="at">nudge_x =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">50</span>), <span class="at">nudge_y =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb14-17"><a href="#cb14-17"></a>                            <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">segment.size =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb14-18"><a href="#cb14-18"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb14-19"><a href="#cb14-19"></a>  <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb14-20"><a href="#cb14-20"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb14-21"><a href="#cb14-21"></a></span>
<span id="cb14-22"><a href="#cb14-22"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(predictions, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> pred_odds_est)) <span class="sc">+</span> </span>
<span id="cb14-23"><a href="#cb14-23"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> pred_odds_LL, <span class="at">ymax =</span> pred_odds_UL), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb14-24"><a href="#cb14-24"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"cornflowerblue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb14-25"><a href="#cb14-25"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> y_success), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb14-26"><a href="#cb14-26"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1180</span>, <span class="at">y =</span> <span class="dv">6000</span>, <span class="at">label =</span> <span class="st">"odds"</span>, <span class="at">size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb14-27"><a href="#cb14-27"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1136</span>, <span class="at">y =</span> <span class="dv">5000</span>, <span class="at">label =</span> <span class="st">"unit ratios = constant"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb14-28"><a href="#cb14-28"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb14-29"><a href="#cb14-29"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">1000000</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1000000</span>, <span class="at">by =</span> <span class="dv">1000</span>))) <span class="sc">+</span></span>
<span id="cb14-30"><a href="#cb14-30"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">7000</span>)) <span class="sc">+</span></span>
<span id="cb14-31"><a href="#cb14-31"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">600</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb14-32"><a href="#cb14-32"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">700</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb14-33"><a href="#cb14-33"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">800</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb14-34"><a href="#cb14-34"></a>  <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb14-35"><a href="#cb14-35"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb14-36"><a href="#cb14-36"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb14-37"><a href="#cb14-37"></a>p2_inset <span class="ot">&lt;-</span> p2 <span class="sc">+</span></span>
<span id="cb14-38"><a href="#cb14-38"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">1000000</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1000000</span>, <span class="at">by =</span> <span class="dv">1000</span>))) <span class="sc">+</span></span>
<span id="cb14-39"><a href="#cb14-39"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">600</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb14-40"><a href="#cb14-40"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">700</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb14-41"><a href="#cb14-41"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(<span class="at">data =</span> emmeans_df, <span class="fu">aes</span>(mac_hole_size, odds),</span>
<span id="cb14-42"><a href="#cb14-42"></a>                            <span class="at">label =</span> emmeans_df<span class="sc">$</span>odds, </span>
<span id="cb14-43"><a href="#cb14-43"></a>                            <span class="at">nudge_x =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">50</span>), <span class="at">nudge_y =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb14-44"><a href="#cb14-44"></a>                            <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">segment.size =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">5</span>)</span>
<span id="cb14-45"><a href="#cb14-45"></a>p2 <span class="ot">&lt;-</span> p2 <span class="sc">+</span> <span class="fu">geom_magnify</span>(<span class="at">from =</span> <span class="fu">c</span>(<span class="at">xmin =</span> <span class="dv">500</span>, <span class="at">xmax =</span> <span class="dv">1000</span>, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">5</span>), </span>
<span id="cb14-46"><a href="#cb14-46"></a>                          <span class="at">to =</span> <span class="fu">c</span>(<span class="at">xmin =</span> <span class="dv">470</span>, <span class="at">xmax =</span> <span class="dv">1010</span>, <span class="at">ymin =</span> <span class="dv">1000</span>, <span class="at">ymax =</span> <span class="dv">5000</span>), </span>
<span id="cb14-47"><a href="#cb14-47"></a>                          <span class="at">shadow =</span> T, <span class="at">axes =</span> <span class="st">"y"</span>, <span class="at">plot =</span> p2_inset)</span>
<span id="cb14-48"><a href="#cb14-48"></a></span>
<span id="cb14-49"><a href="#cb14-49"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(predictions, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> pred_probs_est)) <span class="sc">+</span> </span>
<span id="cb14-50"><a href="#cb14-50"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> pred_probs_LL, <span class="at">ymax =</span> pred_probs_UL), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb14-51"><a href="#cb14-51"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"cornflowerblue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb14-52"><a href="#cb14-52"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> y_success), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb14-53"><a href="#cb14-53"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1140</span>, <span class="at">y =</span> <span class="fl">0.8</span>, <span class="at">label =</span> <span class="st">"probability"</span>, <span class="at">size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb14-54"><a href="#cb14-54"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1075</span>, <span class="at">y =</span> <span class="fl">0.65</span>, <span class="at">label =</span> <span class="st">"unit differences/ratios = not constant"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb14-55"><a href="#cb14-55"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb14-56"><a href="#cb14-56"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb14-57"><a href="#cb14-57"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">600</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb14-58"><a href="#cb14-58"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">700</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb14-59"><a href="#cb14-59"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">800</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb14-60"><a href="#cb14-60"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(<span class="at">data =</span> emmeans_df, <span class="fu">aes</span>(mac_hole_size, probs),</span>
<span id="cb14-61"><a href="#cb14-61"></a>                            <span class="at">label =</span> emmeans_df<span class="sc">$</span>probs, </span>
<span id="cb14-62"><a href="#cb14-62"></a>                            <span class="at">nudge_x =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">50</span>), <span class="at">nudge_y =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb14-63"><a href="#cb14-63"></a>                            <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">segment.size =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb14-64"><a href="#cb14-64"></a>  <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Macular hole size"</span>) <span class="sc">+</span></span>
<span id="cb14-65"><a href="#cb14-65"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span>
<span id="cb14-66"><a href="#cb14-66"></a><span class="fu">ggarrange</span>(p1, p2, p3, <span class="at">align =</span> <span class="st">"v"</span>, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">1.2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="1536"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="key-points" class="level3" data-number="4.3.12">
<h3 data-number="4.3.12" class="anchored" data-anchor-id="key-points"><span class="header-section-number">4.3.12</span> Key points</h3>
<p>This has been a long post but we are finally at the end. I hope that reading this has demystified what goes on under the hood in logistic regression as itâ€™s really not that difficult once you understand the purpose of the link function.</p>
<p>These are the main summary points:</p>
<ul>
<li><p>Logistic regression is a type of <em>generalised linear model</em> that allows the estimation of associations of potential predictors with a binary outcome.</p></li>
<li><p>The <em>logit link</em> function transforms the probabilities of a binary outcome variable to a continuous, unbounded scale (log-odds). <strong>Standard linear modelling methods can then be applied to estimate the model</strong>.</p></li>
<li><p>Log-odds, odds and probabilities are all simple transformations of one another.</p></li>
<li><p>The model is estimated on the log-odds scale where the association between the predictor and the log-odds of the outcome is linear, and the unit difference is constant.</p></li>
<li><p>Results may be reported in terms of odds or probabilities:</p>
<ul>
<li><p>On the odds scale the association between the predictor and the odds of the outcome is non-linear, but the unit ratio is constant.</p></li>
<li><p>On the probability scale the association between the predictor and the probability of the outcome is non-linear, and the unit difference/ratio is not constant.</p></li>
<li><p>This means probability estimates (risk differences of ratios) depend on the value of the predictor and this needs to be specified.</p></li>
</ul></li>
</ul>


<!-- -->

</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="pgseye/Weekly_Stats_Tips" data-repo-id="R_kgDOKvfOfQ" data-category="General" data-category-id="DIC_kwDOKvfOfc4CbFWq" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb15" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb15-1"><a href="#cb15-1"></a><span class="co">---</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="an">title:</span><span class="co"> "Logistic Regression - Under the Hood"</span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="an">date:</span><span class="co"> 2024-06-14</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="an">categories:</span><span class="co"> [code, analysis, modelling, visualisation, probability]</span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="co">#image: "R_small.jpeg"</span></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="an">description:</span><span class="co"> "See how log-odds, odds and probability are all simply versions of each other - and fundamental to logistic regression."</span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="co">---</span></span>
<span id="cb15-8"><a href="#cb15-8"></a></span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="fu"># Some Background</span></span>
<span id="cb15-10"><a href="#cb15-10"></a></span>
<span id="cb15-11"><a href="#cb15-11"></a>Today's post comes from a talk that some of you may have already heard me give in lab meetings, but I thought it could be helpful to have a 'print' copy so I'm going to do that here. The material in the talk was loosely based on the following paper:</span>
<span id="cb15-12"><a href="#cb15-12"></a></span>
<span id="cb15-13"><a href="#cb15-13"></a><span class="co">[</span><span class="ot">Ophthalmic Statistics Note 11: Logistic Regression</span><span class="co">](https://bjo.bmj.com/content/100/12/1594)</span></span>
<span id="cb15-14"><a href="#cb15-14"></a></span>
<span id="cb15-15"><a href="#cb15-15"></a>I'm going back to basics today. I think too often we use statistical techniques without really understanding what is going on 'under the hood'. While that is ok to some extent, a better appreciation of what you're actually doing when you perform a hypothesis test, or run a regression model, lends more robustness to the validity of both your results and your interpretation of them.</span>
<span id="cb15-16"><a href="#cb15-16"></a></span>
<span id="cb15-17"><a href="#cb15-17"></a>So let's take a more fundamental look at logistic regression - a workhorse statistical model that I'd be willing to bet most of you have run at some point in your research careers. Now, because I consider myself more an applied rather than theoretical biostatistician, I am going to try and get my main points across to you with as little maths as possible, and hopefully not bore you in the process (but this is statistics, so hey...).</span>
<span id="cb15-18"><a href="#cb15-18"></a></span>
<span id="cb15-19"><a href="#cb15-19"></a>What I hope you can gain from reading this is to think about logistic regression in a new and different way - one that completely illuminates the technique for you.</span>
<span id="cb15-20"><a href="#cb15-20"></a></span>
<span id="cb15-21"><a href="#cb15-21"></a><span class="fu"># The Research Question</span></span>
<span id="cb15-22"><a href="#cb15-22"></a></span>
<span id="cb15-23"><a href="#cb15-23"></a>The research question in the above paper is asking whether macular hole size at diagnosis is a predictor of surgical repair success. So, in a linear model context, macular hole size is the predictor variable and surgical repair success is the outcome variable, which we consider to be binary in nature - the macular hole is either repaired or it isn't. For those of you who don't know what a macular hole is, there is some good information <span class="co">[</span><span class="ot">here</span><span class="co">](https://www.mdfoundation.com.au/about-macular-disease/other-macular-conditions/macular-hole/)</span>. Essentially, a small hole develops in the macular - the very center of your retina that you use for detailed vision talks such as driving, reading, etc. The effect is to leave you with a blind spot in your direct line of sight, which is obviously not ideal. When it comes to surgical repair, partial-thickness, smaller holes tend to be associated with a better prognosis, than full-thickness, larger holes.</span>
<span id="cb15-24"><a href="#cb15-24"></a></span>
<span id="cb15-25"><a href="#cb15-25"></a><span class="fu"># Some Basic Concepts</span></span>
<span id="cb15-26"><a href="#cb15-26"></a></span>
<span id="cb15-27"><a href="#cb15-27"></a>Before we actually talk about logistic regression, I want to make sure you're familiar with the three primary effect measures that logistic regression is based on.</span>
<span id="cb15-28"><a href="#cb15-28"></a></span>
<span id="cb15-29"><a href="#cb15-29"></a><span class="ss">1.  </span>Probability - exists in the domain <span class="in">`[`</span>0, 1<span class="in">`]`</span>.</span>
<span id="cb15-30"><a href="#cb15-30"></a><span class="ss">2.  </span>Odds - exists in the domain <span class="in">`[`</span>0, $+\infty$<span class="in">`]`</span>.</span>
<span id="cb15-31"><a href="#cb15-31"></a><span class="ss">3.  </span>log-odds - exists in the domain <span class="in">`[`</span>$-\infty$, $+\infty$<span class="in">`]`</span>.</span>
<span id="cb15-32"><a href="#cb15-32"></a></span>
<span id="cb15-33"><a href="#cb15-33"></a><span class="al">![Three Primary Effect Measures in Logistic Regression](images/primary_effect_measures.png)</span>{fig-align="center"}</span>
<span id="cb15-34"><a href="#cb15-34"></a></span>
<span id="cb15-35"><a href="#cb15-35"></a>It's important to remember that these are all simple transformations of one another.</span>
<span id="cb15-36"><a href="#cb15-36"></a></span>
<span id="cb15-37"><a href="#cb15-37"></a><span class="fu">## Primary Transformations</span></span>
<span id="cb15-38"><a href="#cb15-38"></a></span>
<span id="cb15-39"><a href="#cb15-39"></a>If we have the odds of an event, then we can transform that to a probability - or a *risk*, which is another way to refer to the chance of an outcome - by dividing the odds by the odds plus 1.</span>
<span id="cb15-40"><a href="#cb15-40"></a></span>
<span id="cb15-41"><a href="#cb15-41"></a>$$\text{p} = \frac{\text{odds}}{1 + \text{odds}}$$</span>
<span id="cb15-42"><a href="#cb15-42"></a></span>
<span id="cb15-43"><a href="#cb15-43"></a>If instead we have the probability of an event, we can transform that to the equivalent odds of the event, by dividing the probability by its complement (that is 1 minus the probability).</span>
<span id="cb15-44"><a href="#cb15-44"></a></span>
<span id="cb15-45"><a href="#cb15-45"></a>$$\text{odds} = \frac{\text{p}}{1 - \text{p}}$$</span>
<span id="cb15-46"><a href="#cb15-46"></a></span>
<span id="cb15-47"><a href="#cb15-47"></a>And the log-odds is simply taking the natural logarithm of the odds - there is nothing difficult about that.</span>
<span id="cb15-48"><a href="#cb15-48"></a></span>
<span id="cb15-49"><a href="#cb15-49"></a>$$\text{log-odds} = \text{log(odds)}$$</span>
<span id="cb15-50"><a href="#cb15-50"></a></span>
<span id="cb15-51"><a href="#cb15-51"></a>So these three are what I consider primary transformations and we can cycle between them quite easily with a calculator.</span>
<span id="cb15-52"><a href="#cb15-52"></a></span>
<span id="cb15-53"><a href="#cb15-53"></a><span class="al">![](images/primary_effect_measures2.png)</span>{fig-align="center"}</span>
<span id="cb15-54"><a href="#cb15-54"></a></span>
<span id="cb15-55"><a href="#cb15-55"></a><span class="fu">## Secondary Transformations</span></span>
<span id="cb15-56"><a href="#cb15-56"></a></span>
<span id="cb15-57"><a href="#cb15-57"></a>There are additional transformations that you can make and while these aren't quite as straightforward, they are even more fundamental to logistic regression, which ultimately uses the log-odds as the scale to estimate its parameters on.</span>
<span id="cb15-58"><a href="#cb15-58"></a></span>
<span id="cb15-59"><a href="#cb15-59"></a>The first is that we can get to a probability directly from the log-odds by taking the exponent of the log-odds divided by the exponent of the log-odds plus one.</span>
<span id="cb15-60"><a href="#cb15-60"></a></span>
<span id="cb15-61"><a href="#cb15-61"></a>$$\text{p} = \frac{e^{\text{log-odds}}}{1 + e^{\text{log-odds}}}$$</span>
<span id="cb15-62"><a href="#cb15-62"></a></span>
<span id="cb15-63"><a href="#cb15-63"></a>And as you can see, that's really no different to the first equation above because the exponent of the log-odds is simply the odds (the reverse transformation of logging a number is to take the exponent of that logged number). i.e.</span>
<span id="cb15-64"><a href="#cb15-64"></a></span>
<span id="cb15-65"><a href="#cb15-65"></a>$$\text{odds} = e^{\text{log-odds}}$$</span>
<span id="cb15-66"><a href="#cb15-66"></a></span>
<span id="cb15-67"><a href="#cb15-67"></a>Now, the final transformation, and the one that's most relevant to logistic regression shows the relationship between the log-odds and probability and is known as the **logit function** (red box) - and we'll talk more about this in a minute.</span>
<span id="cb15-68"><a href="#cb15-68"></a></span>
<span id="cb15-69"><a href="#cb15-69"></a>$$\text{log-odds} = \text{log}\Bigl(\frac{\text{p}}{1 - \text{p}}\Bigr)$$</span>
<span id="cb15-70"><a href="#cb15-70"></a></span>
<span id="cb15-71"><a href="#cb15-71"></a><span class="al">![](images/secondary_effect_measures.png)</span></span>
<span id="cb15-72"><a href="#cb15-72"></a></span>
<span id="cb15-73"><a href="#cb15-73"></a><span class="fu">## Probability vs Odds (and as applied to the Research Question)</span></span>
<span id="cb15-74"><a href="#cb15-74"></a></span>
<span id="cb15-75"><a href="#cb15-75"></a>Let's go back now to our original research question and specifically look at the difference between the probability and odds of an event - I want to solidify this concept in your minds. For most of us probability (or *chance*) is much more intuitive than the notion of odds. If I think about the likelihood of it being a wet day, I think there's (for example) an 80% chance of it raining, rather than 4 to 1 odds in favour of it raining. However, if you like to wager on the horses than you may actually be quite comfortable with thinking in terms of odds - as those are the terms bets are placed in.</span>
<span id="cb15-76"><a href="#cb15-76"></a></span>
<span id="cb15-77"><a href="#cb15-77"></a>In the following I've simulated some data from the original paper (based on the summary statistics and regression model provided). Obviously macular hole size is a continuous variable, but for the sake of this illustration I am going to dichotomise it at it's approximate mean value (<span class="in">`480`</span> microns). From this we can draw up a 2 x 2 contingency table of the number of successful and failed macular hole repairs as a function of the dichotomised version of macular hole size.</span>
<span id="cb15-78"><a href="#cb15-78"></a></span>
<span id="cb15-79"><a href="#cb15-79"></a>When we talk about probabilities we focus on the proportion of **successes** out of the **total** for each row. So, the probability (or risk) of successful repair for those patients with a macular hole size less than <span class="in">`480`</span> microns is therefore <span class="in">`479/487`</span> or about <span class="in">`0.98`</span>. That's in contrast to the probability of successful repair in those patients with a size greater than <span class="in">`480`</span> microns - where the chance of success is <span class="in">`380/503`</span> or <span class="in">`0.76`</span> - so lower as one would expect. You can then take a ratio of those two probabilities or risks to give the classic risk ratio and that equals <span class="in">`1.3`</span> which tells you that the chance of successful repair is <span class="in">`30%`</span> greater if you have a smaller macular hole at initial presentation.</span>
<span id="cb15-80"><a href="#cb15-80"></a></span>
<span id="cb15-81"><a href="#cb15-81"></a>Now let's look at the equivalent odds. When we talk about odds we focus on the ratio of **successes** to **failures** and don't really worry about the totals. So the odds of successful repair for those patients with a smaller initial hole is <span class="in">`479/8`</span> or <span class="in">`60`</span> to <span class="in">`1`</span>. The odds of success with a larger hole are a lot more modest - <span class="in">`380/123`</span> or about <span class="in">`3`</span> to <span class="in">`1`</span>. We can then calculate the classic odds ratio which works out at about <span class="in">`20`</span>, meaning the odds of successful repair is about <span class="in">`20`</span> times greater in those with thinner initial holes.</span>
<span id="cb15-82"><a href="#cb15-82"></a></span>
<span id="cb15-83"><a href="#cb15-83"></a>Note that both of these effect measures are commensurate - they point in exactly the same direction - that you fare better with a smaller hole at diagnosis. They are just different ways of expressing the same thing.</span>
<span id="cb15-84"><a href="#cb15-84"></a></span>
<span id="cb15-85"><a href="#cb15-85"></a><span class="al">![](images/prob_vs_odds.png)</span>{fig-align="center"}</span>
<span id="cb15-86"><a href="#cb15-86"></a></span>
<span id="cb15-87"><a href="#cb15-87"></a><span class="fu"># Logistic Regression</span></span>
<span id="cb15-88"><a href="#cb15-88"></a></span>
<span id="cb15-89"><a href="#cb15-89"></a>Ok, let's actually talk about logistic regression.</span>
<span id="cb15-90"><a href="#cb15-90"></a></span>
<span id="cb15-91"><a href="#cb15-91"></a>Logistic regression is a type of *generalised linear model* - of which there are many - the poisson, negative binomial, multinomial are just some examples. The important thing is that the standard linear model equation consists of an outcome variable (<span class="in">`Y`</span>) on the left side and a linear predictor of that outcome (<span class="in">`X`</span>) on the right. The linear predictor can be composed of one or multiple variables.</span>
<span id="cb15-92"><a href="#cb15-92"></a></span>
<span id="cb15-93"><a href="#cb15-93"></a>$$\text{Y} = \beta_0 \; + \; \beta_1x$$ Now, a fundamental assumption of the linear model is that <span class="in">`Y`</span> is an unbounded and continuous variable and the relationship between <span class="in">`X`</span> and <span class="in">`Y`</span> is linear - if you plot <span class="in">`X`</span> and <span class="in">`Y`</span> you should get close to a straight line. That also means **the 'effect' of a one-unit change in `X` on `Y` remains constant, over the range of `X`**.</span>
<span id="cb15-94"><a href="#cb15-94"></a></span>
<span id="cb15-95"><a href="#cb15-95"></a>However, a few things change with logistic regression: The first thing is that we're no longer estimating <span class="in">`Y`</span> itself but rather the probability that <span class="in">`Y = 1`</span> or in other words the probability that the outcome has occurred.</span>
<span id="cb15-96"><a href="#cb15-96"></a></span>
<span id="cb15-97"><a href="#cb15-97"></a>$$\text{p(Y = 1)} = \beta_0 \; + \; \beta_1x$$</span>
<span id="cb15-98"><a href="#cb15-98"></a></span>
<span id="cb15-99"><a href="#cb15-99"></a>But in estimating the probability that <span class="in">`Y = 1`</span>, the relationship between <span class="in">`X`</span> and <span class="in">`Y`</span> is no longer linear and instead takes on a sigmoidal or S shape (I'll illustrate this shortly). Consequently this means that **the 'effect' of a one-unit change in `X` on `Y` is no longer constant** - that link has now broken down.</span>
<span id="cb15-100"><a href="#cb15-100"></a></span>
<span id="cb15-101"><a href="#cb15-101"></a>So what do we do when our outcome violates the above assumptions because it can only take on values between <span class="in">`0`</span> and <span class="in">`1`</span> and the relationship between <span class="in">`Y`</span> and <span class="in">`X`</span> is no longer linear?</span>
<span id="cb15-102"><a href="#cb15-102"></a></span>
<span id="cb15-103"><a href="#cb15-103"></a>**How do we now 'link' `X` and `Y`?**</span>
<span id="cb15-104"><a href="#cb15-104"></a></span>
<span id="cb15-105"><a href="#cb15-105"></a><span class="fu">## The Logit Link Function (and why log-odds are actually important)</span></span>
<span id="cb15-106"><a href="#cb15-106"></a></span>
<span id="cb15-107"><a href="#cb15-107"></a>The log-odds or the logit function is pivotal to how logistic regression works. The logit function is a type of **link** function and there's really nothing mysterious or difficult about this. A link function is just a **function of the mean of Y** - in other words a **transformation of the mean of Y** - and we use this link function as the outcome instead of Y itself.</span>
<span id="cb15-108"><a href="#cb15-108"></a></span>
<span id="cb15-109"><a href="#cb15-109"></a>$$\text{logit(p)} = \text{log}\Bigl(\frac{\text{p}}{1 - \text{p}}\Bigr)$$ The logistic model then becomes:</span>
<span id="cb15-110"><a href="#cb15-110"></a></span>
<span id="cb15-111"><a href="#cb15-111"></a>$$\text{Y} = \text{logit(p)} = \beta_0 \; + \; \beta_1x$$</span>
<span id="cb15-112"><a href="#cb15-112"></a></span>
<span id="cb15-113"><a href="#cb15-113"></a>This allows the outcome to become continuous and unbounded and the association between <span class="in">`Y`</span> and <span class="in">`X`</span> to become linear, therefore satisfying those fundamental assumptions of the linear model that I mentioned earlier.</span>
<span id="cb15-114"><a href="#cb15-114"></a></span>
<span id="cb15-115"><a href="#cb15-115"></a>Thus, the logit is a type of transformation that **links or maps probability values from** $(0, 1)$ to real numbers ${\displaystyle (-\infty ,+\infty )}$. Now, on the log-odds/logit scale **the effect of a one-unit change in `X` on `Y` becomes constant once again**.</span>
<span id="cb15-116"><a href="#cb15-116"></a></span>
<span id="cb15-117"><a href="#cb15-117"></a><span class="fu">## WTH? log-odds/odds/probabilities - You're confusing me - pick one please!!</span></span>
<span id="cb15-118"><a href="#cb15-118"></a></span>
<span id="cb15-119"><a href="#cb15-119"></a>It's important to remember that logistic regression is really about probabilities, not odds. Probabilities are more intuitive than odds (unless you like to put a bet on the horses), so why use odds? Well, model results have historically been expressed in terms of odds and odds ratios for mathematical convenience. As it is for the log-odds scale, the 'effect' of a one-unit change in <span class="in">`X`</span> on <span class="in">`Y`</span> is also constant on the odds scale (but as a *ratio* of two odds, not as a *difference* in two log-odds). So an odds ratio describes a constant 'effect' of a predictor on the odds of an outcome, irrespective of the value of the predictor. This is not the case on the probability scale, where both differences and ratios vary per unit change depending on the value of the predictor (I will illustrate this later).</span>
<span id="cb15-120"><a href="#cb15-120"></a></span>
<span id="cb15-121"><a href="#cb15-121"></a>The TLDR:</span>
<span id="cb15-122"><a href="#cb15-122"></a></span>
<span id="cb15-123"><a href="#cb15-123"></a><span class="ss">-   </span>Model is estimated (under the hood) on the **log-odds** scale to satisfy modelling assumptions.</span>
<span id="cb15-124"><a href="#cb15-124"></a></span>
<span id="cb15-125"><a href="#cb15-125"></a><span class="ss">-   </span>Model results are displayed on the **odds** scale (as odds ratios) for their constancy.</span>
<span id="cb15-126"><a href="#cb15-126"></a></span>
<span id="cb15-127"><a href="#cb15-127"></a><span class="ss">-   </span>**Probabilities** are calculated post-hoc with not much extra effort.</span>
<span id="cb15-128"><a href="#cb15-128"></a></span>
<span id="cb15-129"><a href="#cb15-129"></a><span class="fu">## Back to the Research Question</span></span>
<span id="cb15-130"><a href="#cb15-130"></a></span>
<span id="cb15-131"><a href="#cb15-131"></a>Let's go back to the original research question for the final time and now illustrate these concepts in that context. The regression equation for surgical repair success as a function of macular hole size that was estimated in our paper is shown here.</span>
<span id="cb15-132"><a href="#cb15-132"></a></span>
<span id="cb15-133"><a href="#cb15-133"></a>$$\text{logit(p)} = 10.89 - 0.016 \; \text{x} \;\text{macular hole size}\;(\mu m)$$</span>
<span id="cb15-134"><a href="#cb15-134"></a></span>
<span id="cb15-135"><a href="#cb15-135"></a>Basically, the log-odds of successful repair can be predicted by calculating the result of 10.89 minus the product of 0.016 and whatever the macular hole size is in microns.</span>
<span id="cb15-136"><a href="#cb15-136"></a></span>
<span id="cb15-137"><a href="#cb15-137"></a><span class="fu">### Simulate Some Data</span></span>
<span id="cb15-138"><a href="#cb15-138"></a></span>
<span id="cb15-139"><a href="#cb15-139"></a>We can simulate some data from that regression equation - essentially reverse engineering fake data from the estimated best fit equation on the actual data. Why do this? Well, it gives us some sense of what the actual data may have looked like that the researchers collected empirically. We can then do all sorts of cool things like refit a model, generate model predictions, etc. Data simulation is something I am still learning more about but it opens up a world of possibilities in your analytical work.</span>
<span id="cb15-140"><a href="#cb15-140"></a></span>
<span id="cb15-141"><a href="#cb15-141"></a>For this simulation I used a normal distribution with a mean and SD for macular hole size of <span class="in">`486`</span> and <span class="in">`142`</span>, respectively (the numbers came from the original research paper). The code to show how to reproduce this in <span class="in">`R`</span> is included below but you can do something similar in <span class="in">`Stata`</span> and in most other scriptable statistical software packages.</span>
<span id="cb15-142"><a href="#cb15-142"></a></span>
<span id="cb15-145"><a href="#cb15-145"></a><span class="in">```{r}</span></span>
<span id="cb15-146"><a href="#cb15-146"></a><span class="co">#| message: false</span></span>
<span id="cb15-147"><a href="#cb15-147"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb15-148"><a href="#cb15-148"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb15-149"><a href="#cb15-149"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb15-150"><a href="#cb15-150"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb15-151"><a href="#cb15-151"></a><span class="fu">library</span>(ggmagnify)</span>
<span id="cb15-152"><a href="#cb15-152"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb15-153"><a href="#cb15-153"></a><span class="co"># Simulation</span></span>
<span id="cb15-154"><a href="#cb15-154"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span>                                          <span class="co"># set number of obs to simulate</span></span>
<span id="cb15-155"><a href="#cb15-155"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)                                     <span class="co"># set seed for reproducibility</span></span>
<span id="cb15-156"><a href="#cb15-156"></a>mac_hole_size  <span class="ot">&lt;-</span>  <span class="fu">rnorm</span>(n, <span class="dv">486</span>, <span class="dv">142</span>)              <span class="co"># generate macular hole inner opening data with mean 486 and sd = 152</span></span>
<span id="cb15-157"><a href="#cb15-157"></a>logodds_success  <span class="ot">&lt;-</span>  <span class="fl">10.89</span> <span class="sc">-</span> <span class="fl">0.016</span> <span class="sc">*</span> mac_hole_size <span class="co"># generate variable that is linear combination of intercept = 10.89 and coefficient for macular hole -0.016 (logit scale)</span></span>
<span id="cb15-158"><a href="#cb15-158"></a>odds_success  <span class="ot">&lt;-</span>  <span class="fu">exp</span>(logodds_success)             <span class="co"># exponentiate logodds to get odds</span></span>
<span id="cb15-159"><a href="#cb15-159"></a>prob_success  <span class="ot">&lt;-</span>  odds_success<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> odds_success)  <span class="co"># generate probabilities from this</span></span>
<span id="cb15-160"><a href="#cb15-160"></a>y_success  <span class="ot">&lt;-</span>  <span class="fu">rbinom</span>(n, <span class="dv">1</span>, prob_success)          <span class="co"># generate outcome variable as a function of those probabilities</span></span>
<span id="cb15-161"><a href="#cb15-161"></a>df <span class="ot">&lt;-</span>  <span class="fu">data.frame</span>(<span class="fu">cbind</span>(mac_hole_size,             <span class="co"># combine into dataframe</span></span>
<span id="cb15-162"><a href="#cb15-162"></a>                        logodds_success,</span>
<span id="cb15-163"><a href="#cb15-163"></a>                        odds_success,</span>
<span id="cb15-164"><a href="#cb15-164"></a>                        prob_success, </span>
<span id="cb15-165"><a href="#cb15-165"></a>                        y_success))</span>
<span id="cb15-166"><a href="#cb15-166"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb15-167"><a href="#cb15-167"></a>  <span class="fu">filter</span>(mac_hole_size <span class="sc">&gt;</span> <span class="dv">100</span>)                       <span class="co"># only include those with size &gt; 100</span></span>
<span id="cb15-168"><a href="#cb15-168"></a><span class="in">```</span></span>
<span id="cb15-169"><a href="#cb15-169"></a></span>
<span id="cb15-170"><a href="#cb15-170"></a>Essentially, we generate some random values of macular hole size based on the specified distribution and then plug those values in to the regression equation and calculate the various outcome measures. The resultant data look like (first 20 rows shown):</span>
<span id="cb15-171"><a href="#cb15-171"></a></span>
<span id="cb15-174"><a href="#cb15-174"></a><span class="in">```{r}</span></span>
<span id="cb15-175"><a href="#cb15-175"></a><span class="fu">head</span>(df, <span class="dv">20</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-176"><a href="#cb15-176"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-177"><a href="#cb15-177"></a>  <span class="fu">kable_styling</span>() <span class="sc">|&gt;</span> </span>
<span id="cb15-178"><a href="#cb15-178"></a>  <span class="fu">row_spec</span>(<span class="dv">1</span>, <span class="at">bold =</span> T, <span class="at">background =</span> <span class="st">"skyblue1"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-179"><a href="#cb15-179"></a>  <span class="fu">row_spec</span>(<span class="dv">20</span>, <span class="at">bold =</span> T, <span class="at">background =</span> <span class="st">"lightgoldenrod1"</span>)</span>
<span id="cb15-180"><a href="#cb15-180"></a><span class="in">```</span></span>
<span id="cb15-181"><a href="#cb15-181"></a></span>
<span id="cb15-182"><a href="#cb15-182"></a>&lt;br&gt;</span>
<span id="cb15-183"><a href="#cb15-183"></a></span>
<span id="cb15-184"><a href="#cb15-184"></a>Let's pick a couple of data points to examine more closely.</span>
<span id="cb15-185"><a href="#cb15-185"></a></span>
<span id="cb15-186"><a href="#cb15-186"></a>If we look at the first row (blue), the macular hole size is about <span class="in">`315`</span> microns and this translates to a log-odds of successful repair of <span class="in">`5.9`</span> (calculated straight from the regression equation), an odds of successful repair of about <span class="in">`350`</span> to <span class="in">`1`</span> (transformation calculation) and a probability of successful repair of <span class="in">`0.997`</span> (transformation calculation). We can then generate the actual outcome status using that probability as a random variable in a binomial distribution. So in this case a relatively low macular hole size translates to a successful repair, as we might have expected.</span>
<span id="cb15-187"><a href="#cb15-187"></a></span>
<span id="cb15-188"><a href="#cb15-188"></a>Now if we look at the last row of data (yellow), we see something different. Here we have a simulated size of <span class="in">`829`</span> microns and this translates to a log-odds of successful repair of <span class="in">`-2.4`</span>, an odds of <span class="in">`1`</span> to <span class="in">`10`</span> against and a probability of less than <span class="in">`0.1.`</span> Not surprisingly, the outcome status in this case is simulated as a failure.</span>
<span id="cb15-189"><a href="#cb15-189"></a></span>
<span id="cb15-190"><a href="#cb15-190"></a><span class="fu">### Plot the Observed Data</span></span>
<span id="cb15-191"><a href="#cb15-191"></a></span>
<span id="cb15-192"><a href="#cb15-192"></a>What if we now plot the observed data, that is, plot the outcome status as a function of macular hole size?</span>
<span id="cb15-193"><a href="#cb15-193"></a></span>
<span id="cb15-194"><a href="#cb15-194"></a>I'm a big advocate of always plotting your data first - before you calculate any descriptive statistics and certainly before running any statistical tests. In fact I'm not being melodramatic when I say that plotting your data can save you from looking like an analytical fool when you're potentially ill-founded assumptions aren't realised in the actual data. A good visualisation can reveal these kinds of problems instantly.</span>
<span id="cb15-195"><a href="#cb15-195"></a></span>
<span id="cb15-196"><a href="#cb15-196"></a>After that big recommendation, we might be left feeling slightly deflated when we see that plotting binary data doesn't appear that informative - I mean where's the nice scatter plot and imaginary trend line that we're used to thinking about?</span>
<span id="cb15-197"><a href="#cb15-197"></a></span>
<span id="cb15-200"><a href="#cb15-200"></a><span class="in">```{r}</span></span>
<span id="cb15-201"><a href="#cb15-201"></a><span class="co"># Plot observed data</span></span>
<span id="cb15-202"><a href="#cb15-202"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(mac_hole_size, y_success)) <span class="sc">+</span> </span>
<span id="cb15-203"><a href="#cb15-203"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb15-204"><a href="#cb15-204"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb15-205"><a href="#cb15-205"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb15-206"><a href="#cb15-206"></a>  <span class="fu">xlab</span>(<span class="st">"Macular hole size"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Surgical repair success"</span>) <span class="sc">+</span></span>
<span id="cb15-207"><a href="#cb15-207"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">25</span>)</span>
<span id="cb15-208"><a href="#cb15-208"></a><span class="in">```</span></span>
<span id="cb15-209"><a href="#cb15-209"></a></span>
<span id="cb15-210"><a href="#cb15-210"></a>Well it's not entirely helpless - we can see that there's more successes skewed towards smaller macular holes and more failures skewed towards larger macular holes, so that does tell us something useful. But there are better ways to plot binary data and I'll take you through this shortly.</span>
<span id="cb15-211"><a href="#cb15-211"></a></span>
<span id="cb15-212"><a href="#cb15-212"></a><span class="fu">### Fit Linear Model (Naive Approach)</span></span>
<span id="cb15-213"><a href="#cb15-213"></a></span>
<span id="cb15-214"><a href="#cb15-214"></a>What if we fit a standard regression line to binary data, effectively treating <span class="in">`Y`</span> as continuous? Well people have done this in the past, and in some parts of the data analysis world, still do. It kind of works, but it's not the best tool for the job and we can certainly do better. The best fit line is negative suggesting that as macular hole size increases, repair success decreases, so it is in line with what we know to be true. Note that I have rescaled macular hole size so that the resulting coefficient isn't so small (now 1 'unit' = 100 microns instead of 1 micron).</span>
<span id="cb15-215"><a href="#cb15-215"></a></span>
<span id="cb15-218"><a href="#cb15-218"></a><span class="in">```{r}</span></span>
<span id="cb15-219"><a href="#cb15-219"></a><span class="co"># Linear model</span></span>
<span id="cb15-220"><a href="#cb15-220"></a>mod_linear <span class="ot">&lt;-</span> <span class="fu">lm</span>(y_success <span class="sc">~</span> <span class="fu">I</span>(mac_hole_size<span class="sc">/</span><span class="dv">100</span>), <span class="at">data =</span> df) </span>
<span id="cb15-221"><a href="#cb15-221"></a>mod_linear <span class="sc">|&gt;</span> </span>
<span id="cb15-222"><a href="#cb15-222"></a>  <span class="fu">tbl_regression</span>(<span class="at">intercept =</span> T)</span>
<span id="cb15-223"><a href="#cb15-223"></a><span class="co"># Plot data with regression line</span></span>
<span id="cb15-224"><a href="#cb15-224"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(mac_hole_size, y_success)) <span class="sc">+</span> </span>
<span id="cb15-225"><a href="#cb15-225"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb15-226"><a href="#cb15-226"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="fu">coef</span>(mod_linear)[[<span class="st">"I(mac_hole_size/100)"</span>]]<span class="sc">/</span><span class="dv">100</span>, </span>
<span id="cb15-227"><a href="#cb15-227"></a>              <span class="at">intercept =</span> <span class="fu">coef</span>(mod_linear)[[<span class="st">"(Intercept)"</span>]], </span>
<span id="cb15-228"><a href="#cb15-228"></a>              <span class="at">color =</span> <span class="st">"cornflowerblue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-229"><a href="#cb15-229"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb15-230"><a href="#cb15-230"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb15-231"><a href="#cb15-231"></a>  <span class="fu">xlab</span>(<span class="st">"Macular hole size"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Surgical repair success"</span>) <span class="sc">+</span></span>
<span id="cb15-232"><a href="#cb15-232"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">25</span>)</span>
<span id="cb15-233"><a href="#cb15-233"></a><span class="in">```</span></span>
<span id="cb15-234"><a href="#cb15-234"></a></span>
<span id="cb15-235"><a href="#cb15-235"></a><span class="fu">### Problem - Predictions are made Outside the Probability Domain</span></span>
<span id="cb15-236"><a href="#cb15-236"></a></span>
<span id="cb15-237"><a href="#cb15-237"></a>The problem with naively fitting a standard linear model is that because we are know treating <span class="in">`Y`</span> as unbounded and continuous, the model no longer knows that the outcome has to be constrained between 0 and 1, and predictions can easily fall outside this range. And that's exactly what we can see here - a macular hole size of <span class="in">`100`</span> microns (blue) predicts outcome success at <span class="in">`1.35`</span> and a size of <span class="in">`1200`</span> microns (yellow) predicts outcome success at <span class="in">`-0.02`</span>. So fitting a standard linear model to binary data is really not a good approach.</span>
<span id="cb15-238"><a href="#cb15-238"></a></span>
<span id="cb15-241"><a href="#cb15-241"></a><span class="in">```{r}</span></span>
<span id="cb15-242"><a href="#cb15-242"></a><span class="co"># Create new df to predict on new values of x</span></span>
<span id="cb15-243"><a href="#cb15-243"></a>new_dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">mac_hole_size =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">50</span>))</span>
<span id="cb15-244"><a href="#cb15-244"></a><span class="co"># Predict new fitted values</span></span>
<span id="cb15-245"><a href="#cb15-245"></a>pred <span class="ot">&lt;-</span> <span class="fu">cbind</span>(new_dat, <span class="at">prediction =</span> <span class="fu">predict</span>(mod_linear, <span class="at">newdata =</span> new_dat))</span>
<span id="cb15-246"><a href="#cb15-246"></a><span class="co"># Display predictions</span></span>
<span id="cb15-247"><a href="#cb15-247"></a>pred <span class="sc">|&gt;</span> </span>
<span id="cb15-248"><a href="#cb15-248"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-249"><a href="#cb15-249"></a>  <span class="fu">kable_styling</span>() <span class="sc">|&gt;</span> </span>
<span id="cb15-250"><a href="#cb15-250"></a>  <span class="fu">row_spec</span>(<span class="dv">3</span>, <span class="at">bold =</span> T, <span class="at">background =</span> <span class="st">"skyblue1"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-251"><a href="#cb15-251"></a>  <span class="fu">row_spec</span>(<span class="dv">25</span>, <span class="at">bold =</span> T, <span class="at">background =</span> <span class="st">"lightgoldenrod1"</span>)</span>
<span id="cb15-252"><a href="#cb15-252"></a><span class="in">```</span></span>
<span id="cb15-253"><a href="#cb15-253"></a></span>
<span id="cb15-254"><a href="#cb15-254"></a><span class="fu">### Plot the 'Binned' Observed Data</span></span>
<span id="cb15-255"><a href="#cb15-255"></a></span>
<span id="cb15-256"><a href="#cb15-256"></a>So I said above that there was a better way to plot binary data in an effort to make the visualisation more information, and there is. Instead of just plotting the raw data - just the <span class="in">`0`</span>'s and <span class="in">`1`</span>'s - you can create 'bins' of data based on (some fairly arbitrary) thresholds of the predictor you are plotting against and then plot the proportion of successes within each bin. Here I created 'bins' of data for each <span class="in">`50`</span> $\mu m$'s of macular hole size and then calculated the mean success rate (i.e. the proportion of 1's) within each bin.</span>
<span id="cb15-257"><a href="#cb15-257"></a></span>
<span id="cb15-260"><a href="#cb15-260"></a><span class="in">```{r}</span></span>
<span id="cb15-261"><a href="#cb15-261"></a><span class="co"># Create bins of data for each 50 microns of macular hole size</span></span>
<span id="cb15-262"><a href="#cb15-262"></a>df<span class="sc">$</span>bins <span class="ot">&lt;-</span> <span class="fu">cut</span>(df<span class="sc">$</span>mac_hole_size, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1000</span>, <span class="at">by =</span> <span class="dv">50</span>))</span>
<span id="cb15-263"><a href="#cb15-263"></a><span class="co"># Calculate means (number of successful repairs divided by total number of repairs) in each bin</span></span>
<span id="cb15-264"><a href="#cb15-264"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb15-265"><a href="#cb15-265"></a>  <span class="fu">group_by</span>(bins) <span class="sc">|&gt;</span> </span>
<span id="cb15-266"><a href="#cb15-266"></a>  <span class="fu">mutate</span>(<span class="at">mean_y =</span> <span class="fu">mean</span>(y_success))</span>
<span id="cb15-267"><a href="#cb15-267"></a><span class="co"># Plot observed (averaged) data </span></span>
<span id="cb15-268"><a href="#cb15-268"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="fu">as.numeric</span>(bins)<span class="sc">*</span><span class="dv">50-25</span>, mean_y)) <span class="sc">+</span> </span>
<span id="cb15-269"><a href="#cb15-269"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb15-270"><a href="#cb15-270"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-271"><a href="#cb15-271"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb15-272"><a href="#cb15-272"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb15-273"><a href="#cb15-273"></a>  <span class="fu">xlab</span>(<span class="st">"Macular hole size"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Proportion"</span>) <span class="sc">+</span></span>
<span id="cb15-274"><a href="#cb15-274"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">25</span>)</span>
<span id="cb15-275"><a href="#cb15-275"></a><span class="in">```</span></span>
<span id="cb15-276"><a href="#cb15-276"></a></span>
<span id="cb15-277"><a href="#cb15-277"></a>Now we are starting to see the classic sigmoid shape of the relationship between probability and a continuous predictor.</span>
<span id="cb15-278"><a href="#cb15-278"></a></span>
<span id="cb15-279"><a href="#cb15-279"></a><span class="fu">### Fit a Logistic Model to the Simulated Data</span></span>
<span id="cb15-280"><a href="#cb15-280"></a></span>
<span id="cb15-281"><a href="#cb15-281"></a>Now, let's finally fit a logistic model to these simulated data.</span>
<span id="cb15-282"><a href="#cb15-282"></a></span>
<span id="cb15-285"><a href="#cb15-285"></a><span class="in">```{r}</span></span>
<span id="cb15-286"><a href="#cb15-286"></a><span class="co"># Logistic model</span></span>
<span id="cb15-287"><a href="#cb15-287"></a>mod_logistic <span class="ot">&lt;-</span> <span class="fu">glm</span>(y_success <span class="sc">~</span> <span class="fu">I</span>(mac_hole_size<span class="sc">/</span><span class="dv">100</span>), <span class="at">data =</span> df, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb15-288"><a href="#cb15-288"></a>mod_logistic <span class="sc">|&gt;</span> </span>
<span id="cb15-289"><a href="#cb15-289"></a>  <span class="fu">tbl_regression</span>()</span>
<span id="cb15-290"><a href="#cb15-290"></a><span class="in">```</span></span>
<span id="cb15-291"><a href="#cb15-291"></a></span>
<span id="cb15-292"><a href="#cb15-292"></a>On the model estimation log-odds scale, the parameter estimate for the effect of macular hole size is <span class="in">`-1.5`</span>, meaning for every <span class="in">`100`</span> micron increase in macular hole size, the log-odds of success decreases by <span class="in">`1.5`</span> units. All stats software will also provide you with parameter estimates as odds ratios, because that's how we're accustomed to reporting effects. And the equivalent odds ratio in this case is <span class="in">`0.22`</span>. In other words, for every <span class="in">`100`</span> micron increase in macular hole size there is about a <span class="in">`78`</span>% reduction in the odds of success.</span>
<span id="cb15-293"><a href="#cb15-293"></a></span>
<span id="cb15-296"><a href="#cb15-296"></a><span class="in">```{r}</span></span>
<span id="cb15-297"><a href="#cb15-297"></a>mod_logistic <span class="sc">|&gt;</span> </span>
<span id="cb15-298"><a href="#cb15-298"></a>  <span class="fu">tbl_regression</span>(<span class="at">exponentiate =</span> T)</span>
<span id="cb15-299"><a href="#cb15-299"></a><span class="in">```</span></span>
<span id="cb15-300"><a href="#cb15-300"></a></span>
<span id="cb15-301"><a href="#cb15-301"></a>Note that the odds ratio coefficient is a simple transformation of the log-odds coefficient (as we described earlier.) That is:</span>
<span id="cb15-302"><a href="#cb15-302"></a></span>
<span id="cb15-303"><a href="#cb15-303"></a>$$e^{-1.5} = 0.22$$</span>
<span id="cb15-304"><a href="#cb15-304"></a></span>
<span id="cb15-305"><a href="#cb15-305"></a><span class="fu">### Plot Predicted log-odds of Surgical Repair Success</span></span>
<span id="cb15-306"><a href="#cb15-306"></a></span>
<span id="cb15-307"><a href="#cb15-307"></a>Now we can plot the predicted log-odds of surgical repair success. Note that this is a straight line effectively fitted to our binary outcome, and the reason again that we can do this is because the binary outcome has been 'remapped' to log-odds and the log-odds exist on an unbounded and continuous scale. So this **is** a valid plot, unlike that before where we plotted the predictions treating <span class="in">`Y`</span> as if it were a continuous outcome (I'm not necessarily suggesting this is a *useful* plot, just that it's valid).</span>
<span id="cb15-308"><a href="#cb15-308"></a></span>
<span id="cb15-311"><a href="#cb15-311"></a><span class="in">```{r}</span></span>
<span id="cb15-312"><a href="#cb15-312"></a><span class="co"># Predictions</span></span>
<span id="cb15-313"><a href="#cb15-313"></a><span class="co"># Emmeans of logodds at 600 and 700 microns</span></span>
<span id="cb15-314"><a href="#cb15-314"></a>emmeans_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">emmeans</span>(mod_logistic, <span class="sc">~</span> mac_hole_size, <span class="at">at =</span> <span class="fu">list</span>(<span class="at">mac_hole_size =</span> <span class="fu">c</span>(<span class="dv">600</span>, <span class="dv">700</span>, <span class="dv">800</span>))))</span>
<span id="cb15-315"><a href="#cb15-315"></a><span class="co"># Create df of emmeans and corresponding odds and probs, for plotting</span></span>
<span id="cb15-316"><a href="#cb15-316"></a>emmeans_df <span class="ot">&lt;-</span> emmeans_df <span class="sc">|&gt;</span> </span>
<span id="cb15-317"><a href="#cb15-317"></a>  <span class="fu">select</span>(mac_hole_size, emmean) <span class="sc">|&gt;</span> </span>
<span id="cb15-318"><a href="#cb15-318"></a>  <span class="fu">rename</span>(<span class="at">logodds =</span> emmean) <span class="sc">|&gt;</span> </span>
<span id="cb15-319"><a href="#cb15-319"></a>  <span class="fu">mutate</span>(<span class="at">odds =</span> <span class="fu">round</span>(<span class="fu">exp</span>(logodds), <span class="dv">3</span>),</span>
<span id="cb15-320"><a href="#cb15-320"></a>         <span class="at">probs =</span> <span class="fu">round</span>(<span class="fu">plogis</span>(logodds), <span class="dv">2</span>),</span>
<span id="cb15-321"><a href="#cb15-321"></a>         <span class="at">logodds =</span> <span class="fu">round</span>(logodds, <span class="dv">3</span>))</span>
<span id="cb15-322"><a href="#cb15-322"></a></span>
<span id="cb15-323"><a href="#cb15-323"></a><span class="co"># Predictions ----</span></span>
<span id="cb15-324"><a href="#cb15-324"></a><span class="co"># Create new df to predict on new values of x</span></span>
<span id="cb15-325"><a href="#cb15-325"></a>new_dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">mac_hole_size =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1200</span>, <span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb15-326"><a href="#cb15-326"></a><span class="co"># Predict new fitted values and SE's on logodds scale</span></span>
<span id="cb15-327"><a href="#cb15-327"></a>pred_logodds <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_logistic, <span class="at">newdata =</span> new_dat, <span class="at">type =</span> <span class="st">"link"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-328"><a href="#cb15-328"></a>new_dat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(new_dat, pred_logodds)</span>
<span id="cb15-329"><a href="#cb15-329"></a><span class="co"># Create new df of predictions</span></span>
<span id="cb15-330"><a href="#cb15-330"></a>predictions <span class="ot">&lt;-</span> new_dat <span class="sc">|&gt;</span> </span>
<span id="cb15-331"><a href="#cb15-331"></a>  <span class="fu">rename</span>(<span class="at">pred_logodds_est =</span> fit) <span class="sc">|&gt;</span> </span>
<span id="cb15-332"><a href="#cb15-332"></a>  <span class="fu">mutate</span>(<span class="at">pred_logodds_LL =</span> pred_logodds_est <span class="sc">-</span> (<span class="fl">1.96</span> <span class="sc">*</span> se.fit),</span>
<span id="cb15-333"><a href="#cb15-333"></a>         <span class="at">pred_logodds_UL =</span> pred_logodds_est <span class="sc">+</span> (<span class="fl">1.96</span> <span class="sc">*</span> se.fit)) <span class="sc">|&gt;</span> </span>
<span id="cb15-334"><a href="#cb15-334"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(se.fit, residual.scale))</span>
<span id="cb15-335"><a href="#cb15-335"></a><span class="co"># Predict new fitted values and SE's on odds scale</span></span>
<span id="cb15-336"><a href="#cb15-336"></a>predictions <span class="ot">&lt;-</span> predictions <span class="sc">|&gt;</span> </span>
<span id="cb15-337"><a href="#cb15-337"></a>  <span class="fu">mutate</span>(<span class="at">pred_odds_est =</span> <span class="fu">exp</span>(pred_logodds_est),</span>
<span id="cb15-338"><a href="#cb15-338"></a>         <span class="at">pred_odds_LL =</span> <span class="fu">exp</span>(pred_logodds_LL),</span>
<span id="cb15-339"><a href="#cb15-339"></a>         <span class="at">pred_odds_UL =</span> <span class="fu">exp</span>(pred_logodds_UL))</span>
<span id="cb15-340"><a href="#cb15-340"></a><span class="co"># Predict new fitted values and SE's on probability scale</span></span>
<span id="cb15-341"><a href="#cb15-341"></a>pred_probs <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_logistic, <span class="at">newdata =</span> new_dat, <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-342"><a href="#cb15-342"></a>new_dat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(new_dat[<span class="dv">1</span>], pred_probs)</span>
<span id="cb15-343"><a href="#cb15-343"></a>new_dat <span class="ot">&lt;-</span> new_dat <span class="sc">|&gt;</span> </span>
<span id="cb15-344"><a href="#cb15-344"></a>  <span class="fu">mutate</span>(<span class="at">pred_probs_LL =</span> fit <span class="sc">-</span> (<span class="fl">1.96</span> <span class="sc">*</span> se.fit),</span>
<span id="cb15-345"><a href="#cb15-345"></a>         <span class="at">pred_probs_UL =</span> fit <span class="sc">+</span> (<span class="fl">1.96</span> <span class="sc">*</span> se.fit))</span>
<span id="cb15-346"><a href="#cb15-346"></a><span class="co"># Add predicted probs and CIs to predictions df</span></span>
<span id="cb15-347"><a href="#cb15-347"></a>predictions <span class="ot">&lt;-</span> <span class="fu">cbind</span>(predictions, </span>
<span id="cb15-348"><a href="#cb15-348"></a>                     <span class="at">pred_probs_est =</span> new_dat<span class="sc">$</span>fit, </span>
<span id="cb15-349"><a href="#cb15-349"></a>                     <span class="at">pred_probs_LL =</span> new_dat<span class="sc">$</span>pred_probs_LL,</span>
<span id="cb15-350"><a href="#cb15-350"></a>                     <span class="at">pred_probs_UL =</span> new_dat<span class="sc">$</span>pred_probs_UL)</span>
<span id="cb15-351"><a href="#cb15-351"></a><span class="co"># Plot predicted log-odds</span></span>
<span id="cb15-352"><a href="#cb15-352"></a><span class="fu">ggplot</span>(predictions, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> pred_logodds_est)) <span class="sc">+</span> </span>
<span id="cb15-353"><a href="#cb15-353"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> pred_logodds_LL, <span class="at">ymax =</span> pred_logodds_UL), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb15-354"><a href="#cb15-354"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"cornflowerblue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-355"><a href="#cb15-355"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> y_success), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb15-356"><a href="#cb15-356"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb15-357"><a href="#cb15-357"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">100</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb15-358"><a href="#cb15-358"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8</span>, <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb15-359"><a href="#cb15-359"></a>  <span class="fu">xlab</span>(<span class="st">"Macular hole size"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted log-odds"</span>) <span class="sc">+</span></span>
<span id="cb15-360"><a href="#cb15-360"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">25</span>)</span>
<span id="cb15-361"><a href="#cb15-361"></a><span class="in">```</span></span>
<span id="cb15-362"><a href="#cb15-362"></a></span>
<span id="cb15-363"><a href="#cb15-363"></a><span class="fu">### Plot Predicted Odds of Surgical Repair Success</span></span>
<span id="cb15-364"><a href="#cb15-364"></a></span>
<span id="cb15-365"><a href="#cb15-365"></a>We can also plot the predicted odds of surgical repair success. Note that this best-fitting line is not linear, but instead looks like an exponential plot. We established previously that odds exist on a scale from <span class="in">`0`</span> to $+\infty$ and that's what we can appeciate here. Remember that this is just another transformation of the log-odds and the same trend is seen - as hole size increases, the odds of success decline.</span>
<span id="cb15-366"><a href="#cb15-366"></a></span>
<span id="cb15-369"><a href="#cb15-369"></a><span class="in">```{r}</span></span>
<span id="cb15-370"><a href="#cb15-370"></a><span class="co"># Plot predicted odds</span></span>
<span id="cb15-371"><a href="#cb15-371"></a><span class="fu">ggplot</span>(predictions, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> pred_odds_est)) <span class="sc">+</span> </span>
<span id="cb15-372"><a href="#cb15-372"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> pred_odds_LL, <span class="at">ymax =</span> pred_odds_UL), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb15-373"><a href="#cb15-373"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"cornflowerblue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-374"><a href="#cb15-374"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> y_success), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb15-375"><a href="#cb15-375"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb15-376"><a href="#cb15-376"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000000</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1000000</span>, <span class="at">by =</span> <span class="dv">1000</span>)) <span class="sc">+</span></span>
<span id="cb15-377"><a href="#cb15-377"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">7000</span>)) <span class="sc">+</span></span>
<span id="cb15-378"><a href="#cb15-378"></a>  <span class="fu">xlab</span>(<span class="st">"Macular hole size"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted odds"</span>) <span class="sc">+</span></span>
<span id="cb15-379"><a href="#cb15-379"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">25</span>)</span>
<span id="cb15-380"><a href="#cb15-380"></a><span class="in">```</span></span>
<span id="cb15-381"><a href="#cb15-381"></a></span>
<span id="cb15-382"><a href="#cb15-382"></a><span class="fu">### Plot Predicted Probabilities of Surgical Repair Success</span></span>
<span id="cb15-383"><a href="#cb15-383"></a></span>
<span id="cb15-384"><a href="#cb15-384"></a>And we can also plot the predicted probabilities of surgical repair success. Again this is just another transformation of the log-odds or the odds. Note the classic sigmoid shape which emulates what we saw earlier when plotting the binned raw data. To my mind this plot is more useful than either plots of predicted log-odds or odds, as it tells us the likely chance of successful repair conditional on the initial macular hole size.</span>
<span id="cb15-385"><a href="#cb15-385"></a></span>
<span id="cb15-388"><a href="#cb15-388"></a><span class="in">```{r}</span></span>
<span id="cb15-389"><a href="#cb15-389"></a><span class="co"># Plot predicted probabilities</span></span>
<span id="cb15-390"><a href="#cb15-390"></a><span class="fu">ggplot</span>(predictions, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> pred_probs_est)) <span class="sc">+</span> </span>
<span id="cb15-391"><a href="#cb15-391"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> pred_probs_LL, <span class="at">ymax =</span> pred_probs_UL), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb15-392"><a href="#cb15-392"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"cornflowerblue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-393"><a href="#cb15-393"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> y_success), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb15-394"><a href="#cb15-394"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb15-395"><a href="#cb15-395"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb15-396"><a href="#cb15-396"></a>  <span class="fu">xlab</span>(<span class="st">"Macular hole size"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted probability"</span>) <span class="sc">+</span></span>
<span id="cb15-397"><a href="#cb15-397"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">25</span>)</span>
<span id="cb15-398"><a href="#cb15-398"></a><span class="in">```</span></span>
<span id="cb15-399"><a href="#cb15-399"></a></span>
<span id="cb15-400"><a href="#cb15-400"></a><span class="fu">### Plot Observed and Predicted Probabilities of Surgical Repair Success</span></span>
<span id="cb15-401"><a href="#cb15-401"></a></span>
<span id="cb15-402"><a href="#cb15-402"></a>And in fact what you should ideally find if you plot both your observed and predicted probabilities is that they are quite similar, reflecting that the model actually fits the data quite well. Of course, in this case the convergence of observed and predicted probabilities is unsurprising given that we know the data-generating proces - i.e. we fitted a model to data that came from a model. But, in general, this is a good way to assess your model fit.</span>
<span id="cb15-403"><a href="#cb15-403"></a></span>
<span id="cb15-406"><a href="#cb15-406"></a><span class="in">```{r}</span></span>
<span id="cb15-407"><a href="#cb15-407"></a><span class="co"># Plot observed and predicted data</span></span>
<span id="cb15-408"><a href="#cb15-408"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="fu">as.numeric</span>(bins)<span class="sc">*</span><span class="dv">50-25</span>, mean_y)) <span class="sc">+</span> </span>
<span id="cb15-409"><a href="#cb15-409"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb15-410"><a href="#cb15-410"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"observed"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-411"><a href="#cb15-411"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> predictions, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> pred_probs_est, <span class="at">color =</span> <span class="st">"predicted"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-412"><a href="#cb15-412"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">""</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"predicted"</span> <span class="ot">=</span> <span class="st">"cornflowerblue"</span>, <span class="st">"observed"</span> <span class="ot">=</span> <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb15-413"><a href="#cb15-413"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb15-414"><a href="#cb15-414"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb15-415"><a href="#cb15-415"></a>  <span class="fu">xlab</span>(<span class="st">"Macular hole size"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Probability"</span>) <span class="sc">+</span></span>
<span id="cb15-416"><a href="#cb15-416"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb15-417"><a href="#cb15-417"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb15-418"><a href="#cb15-418"></a><span class="in">```</span></span>
<span id="cb15-419"><a href="#cb15-419"></a></span>
<span id="cb15-420"><a href="#cb15-420"></a><span class="fu">### Putting It All Together</span></span>
<span id="cb15-421"><a href="#cb15-421"></a></span>
<span id="cb15-422"><a href="#cb15-422"></a>What I want to try and reinforce in the figure below is how the log-odds, the odds and the probability of the outcome are all transformations of each other.</span>
<span id="cb15-423"><a href="#cb15-423"></a></span>
<span id="cb15-424"><a href="#cb15-424"></a>In logistic regression we are ultimately interested in the probability of the outcome occurring. But we use the log-odds or logit link function to map probabilities onto a linear real-number range. This means that the change in <span class="in">`Y`</span> for each unit increase in <span class="in">`X`</span> remains the same and we can see that in the top plot. So the log-odds coefficient that our stats software gives us is constant across all values of macular hole size. This represents the **difference** in the log-odds of success for each unit change in <span class="in">`X`</span>.</span>
<span id="cb15-425"><a href="#cb15-425"></a></span>
<span id="cb15-426"><a href="#cb15-426"></a>One unit increase in log-odds:</span>
<span id="cb15-427"><a href="#cb15-427"></a></span>
<span id="cb15-428"><a href="#cb15-428"></a><span class="ss">-   </span><span class="in">`600 -&gt; 700`</span> $\mu m$\</span>
<span id="cb15-429"><a href="#cb15-429"></a>    <span class="in">`= -0.181 - 1.323 = -1.504`</span>\</span>
<span id="cb15-430"><a href="#cb15-430"></a><span class="ss">-   </span><span class="in">`700 -&gt; 800`</span> $\mu m$\</span>
<span id="cb15-431"><a href="#cb15-431"></a>    <span class="in">`= -1.686 - -0.181 = -1.505`</span>\</span>
<span id="cb15-432"><a href="#cb15-432"></a></span>
<span id="cb15-433"><a href="#cb15-433"></a>The middle plot shows the equivalent odds of success across the same range of macular hole size. Here the difference in <span class="in">`Y`</span> is no longer constant for each unit increase in <span class="in">`X`</span>, but the commensurate **ratio** is constant - and this gives us the odds ratio. This means that the odds ratio is constant across all values of macular hole size.</span>
<span id="cb15-434"><a href="#cb15-434"></a></span>
<span id="cb15-435"><a href="#cb15-435"></a>One unit increase in odds:</span>
<span id="cb15-436"><a href="#cb15-436"></a></span>
<span id="cb15-437"><a href="#cb15-437"></a><span class="ss">-   </span><span class="in">`600 -&gt; 700`</span> $\mu m$\</span>
<span id="cb15-438"><a href="#cb15-438"></a>    <span class="in">`= 0.834/3.756 = 0.22`</span>\</span>
<span id="cb15-439"><a href="#cb15-439"></a><span class="ss">-   </span><span class="in">`700 -&gt; 800`</span> $\mu m$\</span>
<span id="cb15-440"><a href="#cb15-440"></a>    <span class="in">`= 0.185/0.834 = 0.22`</span>\</span>
<span id="cb15-441"><a href="#cb15-441"></a></span>
<span id="cb15-442"><a href="#cb15-442"></a>Finally the lower plot shows the equivalent probabilities of success and now there is no constancy in either unit differences or ratios. So, if we are interested in expressing our logistic regression model results as differences or ratios of predicted probabilities, we need to make sure that we qualify the macular hole size that a particular predicted probability corresponds to, as this will change across the range of <span class="in">`X`</span>.</span>
<span id="cb15-443"><a href="#cb15-443"></a></span>
<span id="cb15-444"><a href="#cb15-444"></a>One unit increase in probability:</span>
<span id="cb15-445"><a href="#cb15-445"></a></span>
<span id="cb15-446"><a href="#cb15-446"></a><span class="ss">-   </span><span class="in">`600 -&gt; 700`</span> $\mu m$\</span>
<span id="cb15-447"><a href="#cb15-447"></a>    <span class="in">`= 0.45 - 0.79 = -0.34`</span>\</span>
<span id="cb15-448"><a href="#cb15-448"></a>    <span class="in">`= 0.45/0.79 = 0.57`</span>\</span>
<span id="cb15-449"><a href="#cb15-449"></a><span class="ss">-   </span><span class="in">`700 -&gt; 800`</span> $\mu m$\</span>
<span id="cb15-450"><a href="#cb15-450"></a>    <span class="in">`= 0.16 - 0.45 = -0.29`</span>\</span>
<span id="cb15-451"><a href="#cb15-451"></a>    <span class="in">`= 0.16/0.45 = 0.36`</span>\</span>
<span id="cb15-452"><a href="#cb15-452"></a></span>
<span id="cb15-455"><a href="#cb15-455"></a><span class="in">```{r}</span></span>
<span id="cb15-456"><a href="#cb15-456"></a><span class="co">#| message: false</span></span>
<span id="cb15-457"><a href="#cb15-457"></a><span class="co">#| warning: false</span></span>
<span id="cb15-458"><a href="#cb15-458"></a><span class="co">#| fig-width: 16</span></span>
<span id="cb15-459"><a href="#cb15-459"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb15-460"><a href="#cb15-460"></a><span class="co"># Reformat plots slightly for ggarrange ----</span></span>
<span id="cb15-461"><a href="#cb15-461"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(predictions, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> pred_logodds_est)) <span class="sc">+</span> </span>
<span id="cb15-462"><a href="#cb15-462"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> pred_logodds_LL, <span class="at">ymax =</span> pred_logodds_UL), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb15-463"><a href="#cb15-463"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"cornflowerblue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-464"><a href="#cb15-464"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> y_success), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb15-465"><a href="#cb15-465"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1150</span>, <span class="at">y =</span> <span class="dv">6</span>, <span class="at">label =</span> <span class="st">"log-odds"</span>, <span class="at">size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb15-466"><a href="#cb15-466"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb15-467"><a href="#cb15-467"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1110</span>, <span class="at">y =</span> <span class="fl">3.5</span>, <span class="at">label =</span> <span class="st">"unit differences = constant"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb15-468"><a href="#cb15-468"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">100</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb15-469"><a href="#cb15-469"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8</span>, <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb15-470"><a href="#cb15-470"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">600</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb15-471"><a href="#cb15-471"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">700</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb15-472"><a href="#cb15-472"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">800</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb15-473"><a href="#cb15-473"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(<span class="at">data =</span> emmeans_df, <span class="fu">aes</span>(mac_hole_size, logodds),</span>
<span id="cb15-474"><a href="#cb15-474"></a>                            <span class="at">label =</span> emmeans_df<span class="sc">$</span>logodds, </span>
<span id="cb15-475"><a href="#cb15-475"></a>                            <span class="at">nudge_x =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">50</span>), <span class="at">nudge_y =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb15-476"><a href="#cb15-476"></a>                            <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">segment.size =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb15-477"><a href="#cb15-477"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb15-478"><a href="#cb15-478"></a>  <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb15-479"><a href="#cb15-479"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb15-480"><a href="#cb15-480"></a></span>
<span id="cb15-481"><a href="#cb15-481"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(predictions, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> pred_odds_est)) <span class="sc">+</span> </span>
<span id="cb15-482"><a href="#cb15-482"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> pred_odds_LL, <span class="at">ymax =</span> pred_odds_UL), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb15-483"><a href="#cb15-483"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"cornflowerblue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-484"><a href="#cb15-484"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> y_success), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb15-485"><a href="#cb15-485"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1180</span>, <span class="at">y =</span> <span class="dv">6000</span>, <span class="at">label =</span> <span class="st">"odds"</span>, <span class="at">size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb15-486"><a href="#cb15-486"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1136</span>, <span class="at">y =</span> <span class="dv">5000</span>, <span class="at">label =</span> <span class="st">"unit ratios = constant"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb15-487"><a href="#cb15-487"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb15-488"><a href="#cb15-488"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">1000000</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1000000</span>, <span class="at">by =</span> <span class="dv">1000</span>))) <span class="sc">+</span></span>
<span id="cb15-489"><a href="#cb15-489"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">7000</span>)) <span class="sc">+</span></span>
<span id="cb15-490"><a href="#cb15-490"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">600</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb15-491"><a href="#cb15-491"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">700</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb15-492"><a href="#cb15-492"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">800</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb15-493"><a href="#cb15-493"></a>  <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb15-494"><a href="#cb15-494"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb15-495"><a href="#cb15-495"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb15-496"><a href="#cb15-496"></a>p2_inset <span class="ot">&lt;-</span> p2 <span class="sc">+</span></span>
<span id="cb15-497"><a href="#cb15-497"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">1000000</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1000000</span>, <span class="at">by =</span> <span class="dv">1000</span>))) <span class="sc">+</span></span>
<span id="cb15-498"><a href="#cb15-498"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">600</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb15-499"><a href="#cb15-499"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">700</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb15-500"><a href="#cb15-500"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(<span class="at">data =</span> emmeans_df, <span class="fu">aes</span>(mac_hole_size, odds),</span>
<span id="cb15-501"><a href="#cb15-501"></a>                            <span class="at">label =</span> emmeans_df<span class="sc">$</span>odds, </span>
<span id="cb15-502"><a href="#cb15-502"></a>                            <span class="at">nudge_x =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">50</span>), <span class="at">nudge_y =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb15-503"><a href="#cb15-503"></a>                            <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">segment.size =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">5</span>)</span>
<span id="cb15-504"><a href="#cb15-504"></a>p2 <span class="ot">&lt;-</span> p2 <span class="sc">+</span> <span class="fu">geom_magnify</span>(<span class="at">from =</span> <span class="fu">c</span>(<span class="at">xmin =</span> <span class="dv">500</span>, <span class="at">xmax =</span> <span class="dv">1000</span>, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">5</span>), </span>
<span id="cb15-505"><a href="#cb15-505"></a>                          <span class="at">to =</span> <span class="fu">c</span>(<span class="at">xmin =</span> <span class="dv">470</span>, <span class="at">xmax =</span> <span class="dv">1010</span>, <span class="at">ymin =</span> <span class="dv">1000</span>, <span class="at">ymax =</span> <span class="dv">5000</span>), </span>
<span id="cb15-506"><a href="#cb15-506"></a>                          <span class="at">shadow =</span> T, <span class="at">axes =</span> <span class="st">"y"</span>, <span class="at">plot =</span> p2_inset)</span>
<span id="cb15-507"><a href="#cb15-507"></a></span>
<span id="cb15-508"><a href="#cb15-508"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(predictions, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> pred_probs_est)) <span class="sc">+</span> </span>
<span id="cb15-509"><a href="#cb15-509"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> pred_probs_LL, <span class="at">ymax =</span> pred_probs_UL), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb15-510"><a href="#cb15-510"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"cornflowerblue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-511"><a href="#cb15-511"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(<span class="at">x =</span> mac_hole_size, <span class="at">y =</span> y_success), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb15-512"><a href="#cb15-512"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1140</span>, <span class="at">y =</span> <span class="fl">0.8</span>, <span class="at">label =</span> <span class="st">"probability"</span>, <span class="at">size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb15-513"><a href="#cb15-513"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1075</span>, <span class="at">y =</span> <span class="fl">0.65</span>, <span class="at">label =</span> <span class="st">"unit differences/ratios = not constant"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb15-514"><a href="#cb15-514"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb15-515"><a href="#cb15-515"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb15-516"><a href="#cb15-516"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">600</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb15-517"><a href="#cb15-517"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">700</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb15-518"><a href="#cb15-518"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">800</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb15-519"><a href="#cb15-519"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(<span class="at">data =</span> emmeans_df, <span class="fu">aes</span>(mac_hole_size, probs),</span>
<span id="cb15-520"><a href="#cb15-520"></a>                            <span class="at">label =</span> emmeans_df<span class="sc">$</span>probs, </span>
<span id="cb15-521"><a href="#cb15-521"></a>                            <span class="at">nudge_x =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">50</span>), <span class="at">nudge_y =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb15-522"><a href="#cb15-522"></a>                            <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">segment.size =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb15-523"><a href="#cb15-523"></a>  <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Macular hole size"</span>) <span class="sc">+</span></span>
<span id="cb15-524"><a href="#cb15-524"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span>
<span id="cb15-525"><a href="#cb15-525"></a><span class="fu">ggarrange</span>(p1, p2, p3, <span class="at">align =</span> <span class="st">"v"</span>, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">1.2</span>))</span>
<span id="cb15-526"><a href="#cb15-526"></a><span class="in">```</span></span>
<span id="cb15-527"><a href="#cb15-527"></a></span>
<span id="cb15-528"><a href="#cb15-528"></a><span class="fu">### Key points</span></span>
<span id="cb15-529"><a href="#cb15-529"></a></span>
<span id="cb15-530"><a href="#cb15-530"></a>This has been a long post but we are finally at the end. I hope that reading this has demystified what goes on under the hood in logistic regression as it's really not that difficult once you understand the purpose of the link function.</span>
<span id="cb15-531"><a href="#cb15-531"></a></span>
<span id="cb15-532"><a href="#cb15-532"></a>These are the main summary points:</span>
<span id="cb15-533"><a href="#cb15-533"></a></span>
<span id="cb15-534"><a href="#cb15-534"></a><span class="ss">-   </span>Logistic regression is a type of *generalised linear model* that allows the estimation of associations of potential predictors with a binary outcome.</span>
<span id="cb15-535"><a href="#cb15-535"></a></span>
<span id="cb15-536"><a href="#cb15-536"></a><span class="ss">-   </span>The *logit link* function transforms the probabilities of a binary outcome variable to a continuous, unbounded scale (log-odds). **Standard linear modelling methods can then be applied to estimate the model**.</span>
<span id="cb15-537"><a href="#cb15-537"></a></span>
<span id="cb15-538"><a href="#cb15-538"></a><span class="ss">-   </span>Log-odds, odds and probabilities are all simple transformations of one another.</span>
<span id="cb15-539"><a href="#cb15-539"></a></span>
<span id="cb15-540"><a href="#cb15-540"></a><span class="ss">-   </span>The model is estimated on the log-odds scale where the association between the predictor and the log-odds of the outcome is linear, and the unit difference is constant.</span>
<span id="cb15-541"><a href="#cb15-541"></a></span>
<span id="cb15-542"><a href="#cb15-542"></a><span class="ss">-   </span>Results may be reported in terms of odds or probabilities:</span>
<span id="cb15-543"><a href="#cb15-543"></a></span>
<span id="cb15-544"><a href="#cb15-544"></a><span class="ss">    -   </span>On the odds scale the association between the predictor and the odds of the outcome is non-linear, but the unit ratio is constant.</span>
<span id="cb15-545"><a href="#cb15-545"></a></span>
<span id="cb15-546"><a href="#cb15-546"></a><span class="ss">    -   </span>On the probability scale the association between the predictor and the probability of the outcome is non-linear, and the unit difference/ratio is not constant.</span>
<span id="cb15-547"><a href="#cb15-547"></a></span>
<span id="cb15-548"><a href="#cb15-548"></a><span class="ss">    -   </span>This means probability estimates (risk differences of ratios) depend on the value of the predictor and this needs to be specified.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>