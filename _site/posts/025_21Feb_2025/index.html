<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-02-21">
<meta name="description" content="The core concepts and a simple example to get you up and running with MI in your next analysis.">

<title>Test Site 2 - Missing Data and Multiple Imputation for Dummies  (Part 2)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Test Site 2</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">All Posts</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#mi-in-r" id="toc-mi-in-r" class="nav-link active" data-scroll-target="#mi-in-r"><span class="header-section-number">1</span> MI in R</a></li>
  <li><a href="#the-mice-package" id="toc-the-mice-package" class="nav-link" data-scroll-target="#the-mice-package"><span class="header-section-number">2</span> The mice Package</a>
  <ul>
  <li><a href="#example-data" id="toc-example-data" class="nav-link" data-scroll-target="#example-data"><span class="header-section-number">2.1</span> Example Data</a></li>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview"><span class="header-section-number">2.2</span> Overview</a></li>
  <li><a href="#iterations-within-imputations" id="toc-iterations-within-imputations" class="nav-link" data-scroll-target="#iterations-within-imputations"><span class="header-section-number">2.3</span> Iterations Within Imputations</a></li>
  </ul></li>
  <li><a href="#practical-application-of-mi" id="toc-practical-application-of-mi" class="nav-link" data-scroll-target="#practical-application-of-mi"><span class="header-section-number">3</span> Practical Application of MI</a>
  <ul>
  <li><a href="#inspect" id="toc-inspect" class="nav-link" data-scroll-target="#inspect"><span class="header-section-number">3.1</span> Inspect</a></li>
  <li><a href="#mice" id="toc-mice" class="nav-link" data-scroll-target="#mice"><span class="header-section-number">3.2</span> mice()</a></li>
  <li><a href="#complete" id="toc-complete" class="nav-link" data-scroll-target="#complete"><span class="header-section-number">3.3</span> complete()</a>
  <ul class="collapse">
  <li><a href="#all" id="toc-all" class="nav-link" data-scroll-target="#all"><span class="header-section-number">3.3.1</span> “all”</a></li>
  <li><a href="#long" id="toc-long" class="nav-link" data-scroll-target="#long"><span class="header-section-number">3.3.2</span> “long”</a></li>
  <li><a href="#broad" id="toc-broad" class="nav-link" data-scroll-target="#broad"><span class="header-section-number">3.3.3</span> “broad”</a></li>
  <li><a href="#view-just-one-imputation" id="toc-view-just-one-imputation" class="nav-link" data-scroll-target="#view-just-one-imputation"><span class="header-section-number">3.3.4</span> View just one imputation</a></li>
  <li><a href="#compare-imputed-values" id="toc-compare-imputed-values" class="nav-link" data-scroll-target="#compare-imputed-values"><span class="header-section-number">3.3.5</span> Compare imputed values</a></li>
  </ul></li>
  <li><a href="#with" id="toc-with" class="nav-link" data-scroll-target="#with"><span class="header-section-number">3.4</span> with()</a></li>
  <li><a href="#pool" id="toc-pool" class="nav-link" data-scroll-target="#pool"><span class="header-section-number">3.5</span> pool()</a></li>
  <li><a href="#compare-with-cca" id="toc-compare-with-cca" class="nav-link" data-scroll-target="#compare-with-cca"><span class="header-section-number">3.6</span> Compare with CCA</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">4</span> Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Missing Data and Multiple Imputation for Dummies <br> (Part 2)</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">code</div>
    <div class="quarto-category">concept</div>
    <div class="quarto-category">analysis</div>
  </div>
  </div>

<div>
  <div class="description">
    The core concepts and a simple example to get you up and running with MI in your next analysis.
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 21, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Welcome to Part 2 of our tutorial on missing data and multiple imputation. If you recall, we ended the last post with a brief introduction to MI and so today I am going to extend that discussion further with some specific, but important detail in how MI actually works via its implementation in <code>R</code>. Having a better understanding of the algorithmic process involved is invaluable in contextualising what is actually happening to your data when you incorporate MI into your analysis. As an expository aid, we will also apply MI to a small dataset which I hope will further build your practical intuition of this fairly complex statistical topic.</p>
<section id="mi-in-r" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> MI in R</h1>
<p>In general, there are two primary approaches to MI and these are implemented by different packages in <code>R</code>.</p>
<ul>
<li><p>Joint Multivariate Normal Distribution Multiple Imputation.</p>
<p>Joint modelling assumes that the observed data follows a multivariate normal distribution and consequently draws missing values from the same distribution. The biggest problem with this approach is that <strong>a distribution is assumed for the entire dataset</strong>, and this may not always be tenable, leading to incorrect imputations.</p></li>
<li><p>Conditional Multiple Imputation</p>
<p>In contrast, the conditional approach is iterative, modelling <strong>the conditional distribution of one variable, given the other variables</strong>. In this way a different distribution may be assumed for each variable, rather than fixing the entire dataset to one distribution. The conditional MI approach tends to be more commonly used due to this enhanced flexibility and the procedure is implemented in the <code>mice</code> (multivariate imputation by chained equations) package in <code>R</code>. This is the approach we will focus on for the remainder of this tutorial.</p></li>
</ul>
</section>
<section id="the-mice-package" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> The mice Package</h1>
<section id="example-data" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="example-data"><span class="header-section-number">2.1</span> Example Data</h2>
<p>Before we go any further, let me introduce a small dataset included in the <code>mice</code> package that we will use to illustrate conditional MI in action. The <code>nhanes2</code> dataset contains sample data from the US National Health and Nutrition Examination Study. It consists of <code>25</code> observations of <code>4</code> variables:</p>
<ul>
<li><p><strong>age</strong> - Age group (1=20-39, 2=40-59, 3=60+)</p></li>
<li><p><strong>bmi</strong> - Body mass index (kg/m^2)</p></li>
<li><p><strong>hyp</strong> - Hypertensive (1=no,2=yes)</p></li>
<li><p><strong>chl</strong> - Total serum cholesterol (mg/dL)</p></li>
</ul>
<p><strong>age</strong> and <strong>hyp</strong> are formatted as factors and <strong>bmi</strong> and <strong>chl</strong> as numeric. The data look like:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(mice)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">data</span>(nhanes2)</span>
<span id="cb1-5"><a href="#cb1-5"></a>nhanes2 <span class="sc">|&gt;</span> <span class="fu">tibble</span>() <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25 × 4
   age     bmi hyp     chl
   &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt;
 1 20-39  NA   &lt;NA&gt;     NA
 2 40-59  22.7 no      187
 3 20-39  NA   no      187
 4 60-99  NA   &lt;NA&gt;     NA
 5 20-39  20.4 no      113
 6 60-99  NA   &lt;NA&gt;    184
 7 20-39  22.5 no      118
 8 20-39  30.1 no      187
 9 40-59  22   no      238
10 40-59  NA   &lt;NA&gt;     NA
11 20-39  NA   &lt;NA&gt;     NA
12 40-59  NA   &lt;NA&gt;     NA
13 60-99  21.7 no      206
14 40-59  28.7 yes     204
15 20-39  29.6 no       NA
16 20-39  NA   &lt;NA&gt;     NA
17 60-99  27.2 yes     284
18 40-59  26.3 yes     199
19 20-39  35.3 no      218
20 60-99  25.5 yes      NA
21 20-39  NA   &lt;NA&gt;     NA
22 20-39  33.2 no      229
23 20-39  27.5 no      131
24 60-99  24.9 no       NA
25 40-59  27.4 no      186</code></pre>
</div>
</div>
<p>Note there is some missingness on all variables except <strong>age</strong>.</p>
</section>
<section id="overview" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="overview"><span class="header-section-number">2.2</span> Overview</h2>
<p>In the last post I suggested that MI can be thought of in broad terms as a three-step procedure: imputation, analysis, and pooling. Using the <code>mice</code> package, each of these steps can be equated with a function (blue) and resulting object (red) in your <code>R</code> workspace - in short:</p>
<ol type="1">
<li><code>mice()</code> imputes the data, producing a <code>mids</code> object</li>
<li><code>with()</code> analyses the data, producing a <code>mira</code> object</li>
<li><code>pool()</code> combines the data, producing a <code>mipo</code> object</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mi_flow.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
<figcaption>Main Steps in MI</figcaption>
</figure>
</div>
<p>So, imagine that we have our <code>nhanes2</code> dataset and we want to explore the relationship between <strong>bmi</strong> (as the outcome) and <strong>age</strong>, <strong>hyp</strong> and <strong>chl</strong> (as predictors). If we just go ahead and run a linear regression with the data as is, we get:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">lm</span>(bmi <span class="sc">~</span> age <span class="sc">+</span> hyp <span class="sc">+</span> chl, <span class="at">data =</span> nhanes2) <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="fu">tbl_regression</span>() <span class="sc">|&gt;</span> </span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="fu">add_glance_source_note</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fobrjalwgt" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#fobrjalwgt table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#fobrjalwgt thead, #fobrjalwgt tbody, #fobrjalwgt tfoot, #fobrjalwgt tr, #fobrjalwgt td, #fobrjalwgt th {
  border-style: none;
}

#fobrjalwgt p {
  margin: 0;
  padding: 0;
}

#fobrjalwgt .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fobrjalwgt .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#fobrjalwgt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fobrjalwgt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fobrjalwgt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fobrjalwgt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fobrjalwgt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fobrjalwgt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#fobrjalwgt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fobrjalwgt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fobrjalwgt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fobrjalwgt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fobrjalwgt .gt_spanner_row {
  border-bottom-style: hidden;
}

#fobrjalwgt .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#fobrjalwgt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fobrjalwgt .gt_from_md > :first-child {
  margin-top: 0;
}

#fobrjalwgt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fobrjalwgt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fobrjalwgt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#fobrjalwgt .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#fobrjalwgt .gt_row_group_first td {
  border-top-width: 2px;
}

#fobrjalwgt .gt_row_group_first th {
  border-top-width: 2px;
}

#fobrjalwgt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fobrjalwgt .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#fobrjalwgt .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#fobrjalwgt .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fobrjalwgt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fobrjalwgt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fobrjalwgt .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#fobrjalwgt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fobrjalwgt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fobrjalwgt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fobrjalwgt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fobrjalwgt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fobrjalwgt .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fobrjalwgt .gt_left {
  text-align: left;
}

#fobrjalwgt .gt_center {
  text-align: center;
}

#fobrjalwgt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fobrjalwgt .gt_font_normal {
  font-weight: normal;
}

#fobrjalwgt .gt_font_bold {
  font-weight: bold;
}

#fobrjalwgt .gt_font_italic {
  font-style: italic;
}

#fobrjalwgt .gt_super {
  font-size: 65%;
}

#fobrjalwgt .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#fobrjalwgt .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#fobrjalwgt .gt_indent_1 {
  text-indent: 5px;
}

#fobrjalwgt .gt_indent_2 {
  text-indent: 10px;
}

#fobrjalwgt .gt_indent_3 {
  text-indent: 15px;
}

#fobrjalwgt .gt_indent_4 {
  text-indent: 20px;
}

#fobrjalwgt .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>Beta</strong>"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">age</td>
<td headers="estimate" class="gt_row gt_center"><br></td>
<td headers="ci" class="gt_row gt_center"><br></td>
<td headers="p.value" class="gt_row gt_center"><br></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;20-39</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"><br></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;40-59</td>
<td headers="estimate" class="gt_row gt_center">-6.6</td>
<td headers="ci" class="gt_row gt_center">-12, -1.3</td>
<td headers="p.value" class="gt_row gt_center">0.021</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;60-99</td>
<td headers="estimate" class="gt_row gt_center">-11</td>
<td headers="ci" class="gt_row gt_center">-19, -3.4</td>
<td headers="p.value" class="gt_row gt_center">0.010</td></tr>
    <tr><td headers="label" class="gt_row gt_left">hyp</td>
<td headers="estimate" class="gt_row gt_center"><br></td>
<td headers="ci" class="gt_row gt_center"><br></td>
<td headers="p.value" class="gt_row gt_center"><br></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;no</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"><br></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;yes</td>
<td headers="estimate" class="gt_row gt_center">2.4</td>
<td headers="ci" class="gt_row gt_center">-3.5, 8.2</td>
<td headers="p.value" class="gt_row gt_center">0.4</td></tr>
    <tr><td headers="label" class="gt_row gt_left">chl</td>
<td headers="estimate" class="gt_row gt_center">0.08</td>
<td headers="ci" class="gt_row gt_center">0.02, 0.14</td>
<td headers="p.value" class="gt_row gt_center">0.012</td></tr>
  </tbody>
  <tfoot class="gt_sourcenotes">
    <tr>
      <td class="gt_sourcenote" colspan="4">R² = 0.670; Adjusted R² = 0.505; Sigma = 3.23; Statistic = 4.06; p-value = 0.044; df = 4; Log-likelihood = -30.6; AIC = 73.1; BIC = 76.5; Deviance = 83.7; Residual df = 8; No. Obs. = 13</td>
    </tr>
  </tfoot>
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<p>Everything seems to look ok - regression coefficients seem plausible and standard errors haven’t blown up. But if you look at the table footer you will see that <code>R</code>’s default setting of listwise deletion, means that only <code>13</code> observations have been able to be used. The model has discarded <code>48%</code> of the data. “Unacceptable!” you say. Not only have we lost a decent amount of power (and maybe that wouldn’t concern you so much with a larger dataset), but we are also potentially at risk of bias if our missing data mechanism isn’t MCAR (which is what complete case analysis assumes).</p>
<p>Given I want to show you how to use MI, I am going to do that regardless of whether these data are MCAR or not. So, I will leave as an exercise for you to test the MCAR assumption based on what I have shown you in the previous post, if you are interested (I actually haven’t looked at this so I don’t know whether MCAR may be considered reasonable in this case).</p>
<p>So let’s run through the steps that <code>mice</code> uses if we were to impute these data.</p>
<p>As the first step, the <code>mice()</code> function creates several complete datasets (in the above we have set this to n = <code>3</code>). It considers the missingness in each variable to adhere to a particular distribution, drawing plausible values from this distribution as “placeholders” for the missing values. These “complete” datasets are then stored in an <code>R</code> object class called <code>mids</code> (which is an abbreviation of “multiply imputed dataset”). Each dataset is a copy of the original dataframe, <strong>except</strong> that the missing values are now replaced by those generated by <code>mice()</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>I call these values placeholders as they are not fixed or actually observed, but merely serve to allow estimation of the parameter and its variance.</p>
</div>
</div>
<p>In the second step, we now analyse each of our three complete datasets. Using the <code>with()</code> function, we run the same linear regression model as above on each dataframe of <code>25</code> observations, obtaining three different regression coefficients for each parameter. These coefficients only differ due to the differences in the imputed values across each dataset. The analysis results are then stored in another <code>R</code> object class called <code>mira</code> (“multiply imputed repeated analysis”).</p>
<p>In the third and final step, we pool the three coefficients from separate models into one overall regression coefficient for each parameter, and estimate its variance using the <code>pool()</code> function. The final coefficient is the simple average of the three separate coefficients. As described in the last post, the variance estimate combines both “within” (dataset) and “between” (dataset) variance components. The pooled results are stored in a <code>mipo</code> - “multiple imputation pooled object” - object class in your <code>R</code> environment. This becomes the object that you are interested in reporting the results from.</p>
<p>There is one other function in the <code>mice</code> package that is worth a mention - <code>complete()</code>. While this function isn’t essential in the MI pipeline it is nonetheless a very helpful tool in examining the imputed datasets, and I will show you its usage, along with the other primary functions, shortly.</p>
</section>
<section id="iterations-within-imputations" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="iterations-within-imputations"><span class="header-section-number">2.3</span> Iterations Within Imputations</h2>
<p>There is one last bit of theory we will cover before we get to the practical example. In my understanding of MI, I found it super-helpful to have a cursory working knowledge of the chained equation equation approach. As I think this will also help you, we’ll take a few minutes to flesh out some of the detail in what the procedure is actually doing in the background when you call <code>mice()</code> on your data.</p>
<p>Recall that in essence the mice procedure runs a series of regression models whereby each variable with missing data is regressed conditional on the other variables present. In this way, variables that differ in their distribution can be modelled as such - for example, logistic regression for binary variables or linear regression for continuous. More explicitly, <strong>the chained equation process can be broken down into one “cycle” or iteration, consisting of five steps</strong>:</p>
<p><strong>Iteration start</strong> -</p>
<ul>
<li><p>Step 1: Every missing value in the dataset is replaced with a simple (single) imputation, such as the mean or median.</p></li>
<li><p>Step 2: For one variable - let’s call this “mi_var” - the simple imputations are set back to missing.</p></li>
<li><p>Step 3: The observed values from “mi_var” in Step 2 are regressed (as the outcome) on the other variables (as predictors) in the imputation model, which may or may not consist of all remaining variables in the dataset. The distribution of “mi_var” is selected as appropriate for that variable.</p></li>
<li><p>Step 4: The missing values for “mi_var” are then replaced with predictions (imputations) from the regression model.</p></li>
<li><p>Step 5: Repeat Steps 2-4 for each variable that has missing data. Note that at the end of Step 4 “mi_var” may serve as a predictor for any other variable with missing data, whereby both the observed and imputed values will be used to predict that variable’s missing values.</p></li>
</ul>
<p><strong>- Iteration end</strong></p>
<p>At the end of one iteration, all variables with missing data will have been replaced with predictions (imputations) from regression models that represent the associations observed in the data. Usually multiple iterations (ten is considered standard) are specified with the imputations being updated at the end of each cycle. Enough iterations should be specified to establish with confidence that the imputation parameter estimates (regression coefficients) should “converge” so they are no longer changing, within some tolerance, in a new cycle.</p>
<p>So, when we think of <a href="https://en.wikipedia.org/wiki/Inception">Inception</a> as a movie about layers (dreams within dreams), it can be helpful to think of MI in a similar way, as also consisting of layers (iterations within imputations). Each call to <code>mice()</code> produces multiple imputed datasets where each imputed dataset is itself the result of multiple iterations. Hopefully your brain doesn’t hurt like mine did when I watched Inception!</p>
</section>
</section>
<section id="practical-application-of-mi" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Practical Application of MI</h1>
<p>Ok, enough talking. Let’s actually work through an example - we’ll use the <code>nhanes2</code> dataset I introduced above.</p>
<section id="inspect" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="inspect"><span class="header-section-number">3.1</span> Inspect</h2>
<p>It’s always a good idea to first take a couple of minutes to inspect and/or visualise the missing values and any potential patterns in the data. Let’s first check the number and proportion of missing values for each variable. We could code this ourselves, but there’s actually a handy little function especially for this in the <code>questionr</code> package:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">library</span>(questionr)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="fu">freq.na</span>(nhanes2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    missing  %
chl      10 40
bmi       9 36
hyp       8 32
age       0  0</code></pre>
</div>
</div>
<p>We can extend this further to look for patterns of missing values and <code>mice</code> provides the <code>md.pattern()</code> function for this. An equivalent plot and tabulation are supplied by default but it is possible to suppress the plot if one wishes.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">md.pattern</span>(nhanes2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   age hyp bmi chl   
13   1   1   1   1  0
3    1   1   1   0  1
1    1   1   0   1  1
1    1   0   0   1  2
7    1   0   0   0  3
     0   8   9  10 27</code></pre>
</div>
</div>
<p>Values are either 0 (missing) or 1 (observed). From top to bottom, we read this as:</p>
<ul>
<li><p><code>13</code> people have no missing data.</p></li>
<li><p><code>3</code> people have missingness on <strong>chl</strong> only.</p></li>
<li><p><code>1</code> person has missingness on <strong>bmi</strong> only.</p></li>
<li><p><code>1</code> person has missingness on <strong>hyp</strong> and <strong>bmi</strong> only.</p></li>
<li><p><code>7</code> people have missingness on <strong>hyp</strong>, <strong>bmi</strong> and <strong>chl</strong>.</p></li>
</ul>
<p>The numbers in the bottom row represent the frequencies of missingness on each variable and the resulting marginal total (far right). The numbers in the right-most column represent the number of variables with missingness in each pattern.</p>
</section>
<section id="mice" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="mice"><span class="header-section-number">3.2</span> mice()</h2>
<p>Now, let’s do the imputation. It’s as simple as calling the <code>mice()</code> function on our dataset, but here I will specify <code>3</code> imputations rather than the default of <code>5</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a>imp <span class="ot">&lt;-</span>  <span class="fu">mice</span>(nhanes2, <span class="at">m =</span> <span class="dv">3</span>, <span class="at">print =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-3"><a href="#cb8-3"></a>imp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Class: mids
Number of multiple imputations:  3 
Imputation methods:
     age      bmi      hyp      chl 
      ""    "pmm" "logreg"    "pmm" 
PredictorMatrix:
    age bmi hyp chl
age   0   1   1   1
bmi   1   0   1   1
hyp   1   1   0   1
chl   1   1   1   0</code></pre>
</div>
</div>
<p>By inspecting the resulting <code>mids</code> object, we can see that <code>mice()</code> used <strong>pmm</strong> (predictive mean matching) to impute all the variables except <strong>hyp</strong> which used logistic regression (<strong>logreg</strong>) instead, given this is a binary variable. Note that variables with no missing values will have no method (““) specified because no imputation is actually needed.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="https://stefvanbuuren.name/fimd/sec-pmm.html">pmm</a> is the recommended and default method for the imputation of continuous data in <code>mice()</code></p>
</div>
</div>
<p>The output also shows the <code>predictorMatrix</code> which determines what variables are used in the imputation of another. It is useful to familiarise yourself with this matrix as you may want to customise imputations at some point and amending the <code>predictorMatrix</code> provides such functionality. You can interpret the <code>predictorMatrix</code> as rows corresponding to incomplete target variables and columns as complete predictor variables. A value of <code>1</code> indicates that the column variable acts as a predictor to impute the target (row) variable, and a <code>0</code> means that it is not used. Thus, in our example, <strong>hyp</strong> is predicted from <strong>age</strong>, <strong>bmi</strong> and <strong>chl</strong>. Note that the diagonal is set to <code>0</code> since variables cannot predict themselves. The default setting of the <code>predictorMatrix</code> specifies that every variable predicts all others.</p>
<p>As a relatively quick diagnostic exercise, we can easily examine the correspondence between observed and imputed values (for the continuous variables at least) by using the <code>stripplot()</code> function. Note that <code>mice</code> provides other graphical tools for this that are also worth exploring.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">stripplot</span>(imp, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>), <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">20</span>), <span class="at">cex =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>The plots show relatively good overlap of the imputed values (in blue) with the original non-missing data (red).</p>
</section>
<section id="complete" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="complete"><span class="header-section-number">3.3</span> complete()</h2>
<p>At this point you may actually want to look at the imputed values and datasets themselves. <code>mice</code> makes this easy with the <code>complete()</code> function and while this isn’t integral to the workflow, it can be useful as another plausiblity check that the imputations are working as they should. There are multiple formats that we can view the imputed data in, and I will show you what I consider are the three main ways. In all cases, each observation will be labelled with its imputation number and I will also include the original data (imputation = 0) for comparison.</p>
<section id="all" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="all"><span class="header-section-number">3.3.1</span> “all”</h3>
<p>Using “all” produces a list, where each imputed dataframe becomes an element of that list.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>imp_all <span class="ot">&lt;-</span>  <span class="fu">complete</span>(imp, <span class="st">"all"</span>, <span class="at">include =</span> T)</span>
<span id="cb11-2"><a href="#cb11-2"></a>imp_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$`0`
     age  bmi  hyp chl
1  20-39   NA &lt;NA&gt;  NA
2  40-59 22.7   no 187
3  20-39   NA   no 187
4  60-99   NA &lt;NA&gt;  NA
5  20-39 20.4   no 113
6  60-99   NA &lt;NA&gt; 184
7  20-39 22.5   no 118
8  20-39 30.1   no 187
9  40-59 22.0   no 238
10 40-59   NA &lt;NA&gt;  NA
11 20-39   NA &lt;NA&gt;  NA
12 40-59   NA &lt;NA&gt;  NA
13 60-99 21.7   no 206
14 40-59 28.7  yes 204
15 20-39 29.6   no  NA
16 20-39   NA &lt;NA&gt;  NA
17 60-99 27.2  yes 284
18 40-59 26.3  yes 199
19 20-39 35.3   no 218
20 60-99 25.5  yes  NA
21 20-39   NA &lt;NA&gt;  NA
22 20-39 33.2   no 229
23 20-39 27.5   no 131
24 60-99 24.9   no  NA
25 40-59 27.4   no 186

$`1`
     age  bmi hyp chl
1  20-39 30.1 yes 131
2  40-59 22.7  no 187
3  20-39 22.0  no 187
4  60-99 22.7 yes 187
5  20-39 20.4  no 113
6  60-99 25.5 yes 184
7  20-39 22.5  no 118
8  20-39 30.1  no 187
9  40-59 22.0  no 238
10 40-59 27.4 yes 204
11 20-39 33.2  no 199
12 40-59 22.7 yes 187
13 60-99 21.7  no 206
14 40-59 28.7 yes 204
15 20-39 29.6  no 199
16 20-39 27.2  no 238
17 60-99 27.2 yes 284
18 40-59 26.3 yes 199
19 20-39 35.3  no 218
20 60-99 25.5 yes 131
21 20-39 22.0  no 131
22 20-39 33.2  no 229
23 20-39 27.5  no 131
24 60-99 24.9  no 131
25 40-59 27.4  no 186

$`2`
     age  bmi hyp chl
1  20-39 22.5  no 187
2  40-59 22.7  no 187
3  20-39 25.5  no 187
4  60-99 27.4 yes 204
5  20-39 20.4  no 113
6  60-99 21.7  no 184
7  20-39 22.5  no 118
8  20-39 30.1  no 187
9  40-59 22.0  no 238
10 40-59 22.7 yes 187
11 20-39 22.5  no 187
12 40-59 25.5 yes 184
13 60-99 21.7  no 206
14 40-59 28.7 yes 204
15 20-39 29.6  no 199
16 20-39 22.7  no 131
17 60-99 27.2 yes 284
18 40-59 26.3 yes 199
19 20-39 35.3  no 218
20 60-99 25.5 yes 206
21 20-39 26.3  no 187
22 20-39 33.2  no 229
23 20-39 27.5  no 131
24 60-99 24.9  no 186
25 40-59 27.4  no 186

$`3`
     age  bmi hyp chl
1  20-39 27.2  no 187
2  40-59 22.7  no 187
3  20-39 26.3  no 187
4  60-99 21.7  no 186
5  20-39 20.4  no 113
6  60-99 21.7  no 184
7  20-39 22.5  no 118
8  20-39 30.1  no 187
9  40-59 22.0  no 238
10 40-59 25.5  no 187
11 20-39 28.7 yes 238
12 40-59 27.5 yes 206
13 60-99 21.7  no 206
14 40-59 28.7 yes 204
15 20-39 29.6  no 131
16 20-39 30.1  no 238
17 60-99 27.2 yes 284
18 40-59 26.3 yes 199
19 20-39 35.3  no 218
20 60-99 25.5 yes 218
21 20-39 20.4  no 238
22 20-39 33.2  no 229
23 20-39 27.5  no 131
24 60-99 24.9  no 206
25 40-59 27.4  no 186

attr(,"class")
[1] "mild" "list"</code></pre>
</div>
</div>
</section>
<section id="long" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="long"><span class="header-section-number">3.3.2</span> “long”</h3>
<p>Using “long” produces a dataframe of imputations stacked on top of each other. Imputation and ID numbers are provided as variables to identify which observations belong to which imputations.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>imp_long <span class="ot">&lt;-</span>  <span class="fu">complete</span>(imp, <span class="st">"long"</span>, <span class="at">include =</span> T)</span>
<span id="cb13-2"><a href="#cb13-2"></a>imp_long <span class="sc">|&gt;</span> <span class="fu">tibble</span>() <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 6
     .imp   .id age     bmi hyp     chl
    &lt;int&gt; &lt;int&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt;
  1     0     1 20-39  NA   &lt;NA&gt;     NA
  2     0     2 40-59  22.7 no      187
  3     0     3 20-39  NA   no      187
  4     0     4 60-99  NA   &lt;NA&gt;     NA
  5     0     5 20-39  20.4 no      113
  6     0     6 60-99  NA   &lt;NA&gt;    184
  7     0     7 20-39  22.5 no      118
  8     0     8 20-39  30.1 no      187
  9     0     9 40-59  22   no      238
 10     0    10 40-59  NA   &lt;NA&gt;     NA
 11     0    11 20-39  NA   &lt;NA&gt;     NA
 12     0    12 40-59  NA   &lt;NA&gt;     NA
 13     0    13 60-99  21.7 no      206
 14     0    14 40-59  28.7 yes     204
 15     0    15 20-39  29.6 no       NA
 16     0    16 20-39  NA   &lt;NA&gt;     NA
 17     0    17 60-99  27.2 yes     284
 18     0    18 40-59  26.3 yes     199
 19     0    19 20-39  35.3 no      218
 20     0    20 60-99  25.5 yes      NA
 21     0    21 20-39  NA   &lt;NA&gt;     NA
 22     0    22 20-39  33.2 no      229
 23     0    23 20-39  27.5 no      131
 24     0    24 60-99  24.9 no       NA
 25     0    25 40-59  27.4 no      186
 26     1     1 20-39  30.1 yes     131
 27     1     2 40-59  22.7 no      187
 28     1     3 20-39  22   no      187
 29     1     4 60-99  22.7 yes     187
 30     1     5 20-39  20.4 no      113
 31     1     6 60-99  25.5 yes     184
 32     1     7 20-39  22.5 no      118
 33     1     8 20-39  30.1 no      187
 34     1     9 40-59  22   no      238
 35     1    10 40-59  27.4 yes     204
 36     1    11 20-39  33.2 no      199
 37     1    12 40-59  22.7 yes     187
 38     1    13 60-99  21.7 no      206
 39     1    14 40-59  28.7 yes     204
 40     1    15 20-39  29.6 no      199
 41     1    16 20-39  27.2 no      238
 42     1    17 60-99  27.2 yes     284
 43     1    18 40-59  26.3 yes     199
 44     1    19 20-39  35.3 no      218
 45     1    20 60-99  25.5 yes     131
 46     1    21 20-39  22   no      131
 47     1    22 20-39  33.2 no      229
 48     1    23 20-39  27.5 no      131
 49     1    24 60-99  24.9 no      131
 50     1    25 40-59  27.4 no      186
 51     2     1 20-39  22.5 no      187
 52     2     2 40-59  22.7 no      187
 53     2     3 20-39  25.5 no      187
 54     2     4 60-99  27.4 yes     204
 55     2     5 20-39  20.4 no      113
 56     2     6 60-99  21.7 no      184
 57     2     7 20-39  22.5 no      118
 58     2     8 20-39  30.1 no      187
 59     2     9 40-59  22   no      238
 60     2    10 40-59  22.7 yes     187
 61     2    11 20-39  22.5 no      187
 62     2    12 40-59  25.5 yes     184
 63     2    13 60-99  21.7 no      206
 64     2    14 40-59  28.7 yes     204
 65     2    15 20-39  29.6 no      199
 66     2    16 20-39  22.7 no      131
 67     2    17 60-99  27.2 yes     284
 68     2    18 40-59  26.3 yes     199
 69     2    19 20-39  35.3 no      218
 70     2    20 60-99  25.5 yes     206
 71     2    21 20-39  26.3 no      187
 72     2    22 20-39  33.2 no      229
 73     2    23 20-39  27.5 no      131
 74     2    24 60-99  24.9 no      186
 75     2    25 40-59  27.4 no      186
 76     3     1 20-39  27.2 no      187
 77     3     2 40-59  22.7 no      187
 78     3     3 20-39  26.3 no      187
 79     3     4 60-99  21.7 no      186
 80     3     5 20-39  20.4 no      113
 81     3     6 60-99  21.7 no      184
 82     3     7 20-39  22.5 no      118
 83     3     8 20-39  30.1 no      187
 84     3     9 40-59  22   no      238
 85     3    10 40-59  25.5 no      187
 86     3    11 20-39  28.7 yes     238
 87     3    12 40-59  27.5 yes     206
 88     3    13 60-99  21.7 no      206
 89     3    14 40-59  28.7 yes     204
 90     3    15 20-39  29.6 no      131
 91     3    16 20-39  30.1 no      238
 92     3    17 60-99  27.2 yes     284
 93     3    18 40-59  26.3 yes     199
 94     3    19 20-39  35.3 no      218
 95     3    20 60-99  25.5 yes     218
 96     3    21 20-39  20.4 no      238
 97     3    22 20-39  33.2 no      229
 98     3    23 20-39  27.5 no      131
 99     3    24 60-99  24.9 no      206
100     3    25 40-59  27.4 no      186</code></pre>
</div>
</div>
</section>
<section id="broad" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="broad"><span class="header-section-number">3.3.3</span> “broad”</h3>
<p>In contrast, the “broad” or wide format produces a dataframe of imputations stacked side-by-side. Imputation numbers are included in the variable names.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>imp_wide <span class="ot">&lt;-</span>  <span class="fu">complete</span>(imp, <span class="st">"broad"</span>, <span class="at">include =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `age` -&gt; `age...1`
• `bmi` -&gt; `bmi...2`
• `hyp` -&gt; `hyp...3`
• `chl` -&gt; `chl...4`
• `age` -&gt; `age...5`
• `bmi` -&gt; `bmi...6`
• `hyp` -&gt; `hyp...7`
• `chl` -&gt; `chl...8`
• `age` -&gt; `age...9`
• `bmi` -&gt; `bmi...10`
• `hyp` -&gt; `hyp...11`
• `chl` -&gt; `chl...12`
• `age` -&gt; `age...13`
• `bmi` -&gt; `bmi...14`
• `hyp` -&gt; `hyp...15`
• `chl` -&gt; `chl...16`</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>imp_wide <span class="sc">|&gt;</span> <span class="fu">tibble</span>() <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25 × 16
   age.0 bmi.0 hyp.0 chl.0 age.1 bmi.1 hyp.1 chl.1 age.2 bmi.2 hyp.2 chl.2 age.3
   &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt;
 1 20-39  NA   &lt;NA&gt;     NA 20-39  30.1 yes     131 20-39  22.5 no      187 20-39
 2 40-59  22.7 no      187 40-59  22.7 no      187 40-59  22.7 no      187 40-59
 3 20-39  NA   no      187 20-39  22   no      187 20-39  25.5 no      187 20-39
 4 60-99  NA   &lt;NA&gt;     NA 60-99  22.7 yes     187 60-99  27.4 yes     204 60-99
 5 20-39  20.4 no      113 20-39  20.4 no      113 20-39  20.4 no      113 20-39
 6 60-99  NA   &lt;NA&gt;    184 60-99  25.5 yes     184 60-99  21.7 no      184 60-99
 7 20-39  22.5 no      118 20-39  22.5 no      118 20-39  22.5 no      118 20-39
 8 20-39  30.1 no      187 20-39  30.1 no      187 20-39  30.1 no      187 20-39
 9 40-59  22   no      238 40-59  22   no      238 40-59  22   no      238 40-59
10 40-59  NA   &lt;NA&gt;     NA 40-59  27.4 yes     204 40-59  22.7 yes     187 40-59
11 20-39  NA   &lt;NA&gt;     NA 20-39  33.2 no      199 20-39  22.5 no      187 20-39
12 40-59  NA   &lt;NA&gt;     NA 40-59  22.7 yes     187 40-59  25.5 yes     184 40-59
13 60-99  21.7 no      206 60-99  21.7 no      206 60-99  21.7 no      206 60-99
14 40-59  28.7 yes     204 40-59  28.7 yes     204 40-59  28.7 yes     204 40-59
15 20-39  29.6 no       NA 20-39  29.6 no      199 20-39  29.6 no      199 20-39
16 20-39  NA   &lt;NA&gt;     NA 20-39  27.2 no      238 20-39  22.7 no      131 20-39
17 60-99  27.2 yes     284 60-99  27.2 yes     284 60-99  27.2 yes     284 60-99
18 40-59  26.3 yes     199 40-59  26.3 yes     199 40-59  26.3 yes     199 40-59
19 20-39  35.3 no      218 20-39  35.3 no      218 20-39  35.3 no      218 20-39
20 60-99  25.5 yes      NA 60-99  25.5 yes     131 60-99  25.5 yes     206 60-99
21 20-39  NA   &lt;NA&gt;     NA 20-39  22   no      131 20-39  26.3 no      187 20-39
22 20-39  33.2 no      229 20-39  33.2 no      229 20-39  33.2 no      229 20-39
23 20-39  27.5 no      131 20-39  27.5 no      131 20-39  27.5 no      131 20-39
24 60-99  24.9 no       NA 60-99  24.9 no      131 60-99  24.9 no      186 60-99
25 40-59  27.4 no      186 40-59  27.4 no      186 40-59  27.4 no      186 40-59
# ℹ 3 more variables: bmi.3 &lt;dbl&gt;, hyp.3 &lt;fct&gt;, chl.3 &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="view-just-one-imputation" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="view-just-one-imputation"><span class="header-section-number">3.3.4</span> View just one imputation</h3>
<p>All good you say, but what if I want to view just one imputation. Well you can do that quite easily in the call to <code>complete()</code>. Here we will ask for just the second imputation.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">complete</span>(imp, <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">tibble</span>() <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25 × 4
   age     bmi hyp     chl
   &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt;
 1 20-39  22.5 no      187
 2 40-59  22.7 no      187
 3 20-39  25.5 no      187
 4 60-99  27.4 yes     204
 5 20-39  20.4 no      113
 6 60-99  21.7 no      184
 7 20-39  22.5 no      118
 8 20-39  30.1 no      187
 9 40-59  22   no      238
10 40-59  22.7 yes     187
11 20-39  22.5 no      187
12 40-59  25.5 yes     184
13 60-99  21.7 no      206
14 40-59  28.7 yes     204
15 20-39  29.6 no      199
16 20-39  22.7 no      131
17 60-99  27.2 yes     284
18 40-59  26.3 yes     199
19 20-39  35.3 no      218
20 60-99  25.5 yes     206
21 20-39  26.3 no      187
22 20-39  33.2 no      229
23 20-39  27.5 no      131
24 60-99  24.9 no      186
25 40-59  27.4 no      186</code></pre>
</div>
</div>
</section>
<section id="compare-imputed-values" class="level3" data-number="3.3.5">
<h3 data-number="3.3.5" class="anchored" data-anchor-id="compare-imputed-values"><span class="header-section-number">3.3.5</span> Compare imputed values</h3>
<p>If you want to compare the imputed values in a more direct way, we can use the broad format to do that on a variable by variable basis. Here I will ask to look at just <strong>bmi</strong>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">complete</span>(imp, <span class="st">"broad"</span>, <span class="at">include =</span> T) <span class="sc">|&gt;</span> </span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"bmi"</span>)) <span class="sc">|&gt;</span> <span class="fu">tibble</span>() <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `age` -&gt; `age...1`
• `bmi` -&gt; `bmi...2`
• `hyp` -&gt; `hyp...3`
• `chl` -&gt; `chl...4`
• `age` -&gt; `age...5`
• `bmi` -&gt; `bmi...6`
• `hyp` -&gt; `hyp...7`
• `chl` -&gt; `chl...8`
• `age` -&gt; `age...9`
• `bmi` -&gt; `bmi...10`
• `hyp` -&gt; `hyp...11`
• `chl` -&gt; `chl...12`
• `age` -&gt; `age...13`
• `bmi` -&gt; `bmi...14`
• `hyp` -&gt; `hyp...15`
• `chl` -&gt; `chl...16`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25 × 4
   bmi.0 bmi.1 bmi.2 bmi.3
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  NA    30.1  22.5  27.2
 2  22.7  22.7  22.7  22.7
 3  NA    22    25.5  26.3
 4  NA    22.7  27.4  21.7
 5  20.4  20.4  20.4  20.4
 6  NA    25.5  21.7  21.7
 7  22.5  22.5  22.5  22.5
 8  30.1  30.1  30.1  30.1
 9  22    22    22    22  
10  NA    27.4  22.7  25.5
11  NA    33.2  22.5  28.7
12  NA    22.7  25.5  27.5
13  21.7  21.7  21.7  21.7
14  28.7  28.7  28.7  28.7
15  29.6  29.6  29.6  29.6
16  NA    27.2  22.7  30.1
17  27.2  27.2  27.2  27.2
18  26.3  26.3  26.3  26.3
19  35.3  35.3  35.3  35.3
20  25.5  25.5  25.5  25.5
21  NA    22    26.3  20.4
22  33.2  33.2  33.2  33.2
23  27.5  27.5  27.5  27.5
24  24.9  24.9  24.9  24.9
25  27.4  27.4  27.4  27.4</code></pre>
</div>
</div>
<p><code>bmi.0</code> is the original <strong>bmi</strong> data and the columns to its right are each of the three imputations for that variable. This provides an easy way to scan across and examine what <code>mice</code> has given us.</p>
</section>
</section>
<section id="with" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="with"><span class="header-section-number">3.4</span> with()</h2>
<p>Now that we have imputed the data, we can use <code>with()</code> to analyse the data. Generally there is not much need to inspect the output of this step and we usually go straight onto pooling the results, but for the sake of the exercise we will take a closer look at the <code>mira</code> object that is generated. So, let’s run the regression model that we specified earlier, with <strong>bmi</strong> as the outcome and <strong>age</strong>, <strong>hyp</strong> and <strong>chl</strong> as predictors.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>fit_imp <span class="ot">&lt;-</span> <span class="fu">with</span>(imp, <span class="fu">lm</span>(bmi <span class="sc">~</span> age <span class="sc">+</span> hyp <span class="sc">+</span> chl))</span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="fu">summary</span>(fit_imp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 6
   term        estimate std.error statistic    p.value  nobs
   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;
 1 (Intercept)  20.3       3.22        6.29 0.00000386    25
 2 age40-59     -4.74      1.97       -2.41 0.0260        25
 3 age60-99     -5.13      2.08       -2.46 0.0229        25
 4 hypyes        2.36      1.79        1.32 0.203         25
 5 chl           0.0420    0.0176      2.39 0.0266        25
 6 (Intercept)  16.1       3.57        4.51 0.000214      25
 7 age40-59     -4.11      1.86       -2.22 0.0385        25
 8 age60-99     -5.11      1.93       -2.64 0.0156        25
 9 hypyes        2.00      1.80        1.11 0.279         25
10 chl           0.0602    0.0200      3.01 0.00687       25
11 (Intercept)  21.8       3.74        5.84 0.0000104     25
12 age40-59     -3.03      1.77       -1.71 0.103         25
13 age60-99     -5.19      1.85       -2.81 0.0108        25
14 hypyes        1.88      1.88        1.00 0.328         25
15 chl           0.0306    0.0198      1.55 0.138         25</code></pre>
</div>
</div>
<p>See how we obtain the regression output for each imputed dataset stacked one on top of the other in a single dataframe. This allows us to quickly compare the estimated regression parameters across imputations.</p>
</section>
<section id="pool" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="pool"><span class="header-section-number">3.5</span> pool()</h2>
<p>We can now call <code>pool()</code> to pool the results of the separate regressions based on Rubin’s rules.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">summary</span>(<span class="fu">pool</span>(fit_imp), <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 8
  term        estimate std.error statistic    df p.value `2.5 %` `97.5 %`
  &lt;fct&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)  19.4       4.90        3.96  4.48  0.0134  6.35     32.4  
2 age40-59     -3.96      2.12       -1.87 10.5   0.0895 -8.65      0.728
3 age60-99     -5.14      1.96       -2.63 18.2   0.0169 -9.25     -1.04 
4 hypyes        2.08      1.84        1.13 17.7   0.274  -1.80      5.95 
5 chl           0.0443    0.0258      1.72  5.01  0.146  -0.0219    0.110</code></pre>
</div>
</div>
<p>Note that there is also a “tidy” way to format this output directly, using the <code>tbl_regression()</code> function, which provides for much nicer viewing.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>fit_imp <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="fu">tbl_regression</span>() <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="fu">add_glance_source_note</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="bsvemmnntr" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#bsvemmnntr table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#bsvemmnntr thead, #bsvemmnntr tbody, #bsvemmnntr tfoot, #bsvemmnntr tr, #bsvemmnntr td, #bsvemmnntr th {
  border-style: none;
}

#bsvemmnntr p {
  margin: 0;
  padding: 0;
}

#bsvemmnntr .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#bsvemmnntr .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#bsvemmnntr .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#bsvemmnntr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#bsvemmnntr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bsvemmnntr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bsvemmnntr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bsvemmnntr .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#bsvemmnntr .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#bsvemmnntr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#bsvemmnntr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#bsvemmnntr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#bsvemmnntr .gt_spanner_row {
  border-bottom-style: hidden;
}

#bsvemmnntr .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#bsvemmnntr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#bsvemmnntr .gt_from_md > :first-child {
  margin-top: 0;
}

#bsvemmnntr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#bsvemmnntr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#bsvemmnntr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#bsvemmnntr .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#bsvemmnntr .gt_row_group_first td {
  border-top-width: 2px;
}

#bsvemmnntr .gt_row_group_first th {
  border-top-width: 2px;
}

#bsvemmnntr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bsvemmnntr .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#bsvemmnntr .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#bsvemmnntr .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bsvemmnntr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bsvemmnntr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#bsvemmnntr .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#bsvemmnntr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#bsvemmnntr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bsvemmnntr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bsvemmnntr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bsvemmnntr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bsvemmnntr .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bsvemmnntr .gt_left {
  text-align: left;
}

#bsvemmnntr .gt_center {
  text-align: center;
}

#bsvemmnntr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#bsvemmnntr .gt_font_normal {
  font-weight: normal;
}

#bsvemmnntr .gt_font_bold {
  font-weight: bold;
}

#bsvemmnntr .gt_font_italic {
  font-style: italic;
}

#bsvemmnntr .gt_super {
  font-size: 65%;
}

#bsvemmnntr .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#bsvemmnntr .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#bsvemmnntr .gt_indent_1 {
  text-indent: 5px;
}

#bsvemmnntr .gt_indent_2 {
  text-indent: 10px;
}

#bsvemmnntr .gt_indent_3 {
  text-indent: 15px;
}

#bsvemmnntr .gt_indent_4 {
  text-indent: 20px;
}

#bsvemmnntr .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>Beta</strong>"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">age</td>
<td headers="estimate" class="gt_row gt_center"><br></td>
<td headers="ci" class="gt_row gt_center"><br></td>
<td headers="p.value" class="gt_row gt_center"><br></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;20-39</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"><br></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;40-59</td>
<td headers="estimate" class="gt_row gt_center">-4.0</td>
<td headers="ci" class="gt_row gt_center">-8.7, 0.73</td>
<td headers="p.value" class="gt_row gt_center">0.090</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;60-99</td>
<td headers="estimate" class="gt_row gt_center">-5.1</td>
<td headers="ci" class="gt_row gt_center">-9.3, -1.0</td>
<td headers="p.value" class="gt_row gt_center">0.017</td></tr>
    <tr><td headers="label" class="gt_row gt_left">hyp</td>
<td headers="estimate" class="gt_row gt_center"><br></td>
<td headers="ci" class="gt_row gt_center"><br></td>
<td headers="p.value" class="gt_row gt_center"><br></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;no</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"><br></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;yes</td>
<td headers="estimate" class="gt_row gt_center">2.1</td>
<td headers="ci" class="gt_row gt_center">-1.8, 6.0</td>
<td headers="p.value" class="gt_row gt_center">0.3</td></tr>
    <tr><td headers="label" class="gt_row gt_left">chl</td>
<td headers="estimate" class="gt_row gt_center">0.04</td>
<td headers="ci" class="gt_row gt_center">-0.02, 0.11</td>
<td headers="p.value" class="gt_row gt_center">0.15</td></tr>
  </tbody>
  <tfoot class="gt_sourcenotes">
    <tr>
      <td class="gt_sourcenote" colspan="4">nimp = 3.00; No. Obs. = 25; R² = 0.364; Adjusted R² = 0.236</td>
    </tr>
  </tfoot>
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
</section>
<section id="compare-with-cca" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="compare-with-cca"><span class="header-section-number">3.6</span> Compare with CCA</h2>
<p>I will re-print the model output from the CCA so that we can compare it to the MI results:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="fu">lm</span>(bmi <span class="sc">~</span> age <span class="sc">+</span> hyp <span class="sc">+</span> chl, <span class="at">data =</span> nhanes2) <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a href="#cb29-2"></a>  <span class="fu">tbl_regression</span>() <span class="sc">|&gt;</span> </span>
<span id="cb29-3"><a href="#cb29-3"></a>  <span class="fu">add_glance_source_note</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="rzxkwsbxuy" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#rzxkwsbxuy table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#rzxkwsbxuy thead, #rzxkwsbxuy tbody, #rzxkwsbxuy tfoot, #rzxkwsbxuy tr, #rzxkwsbxuy td, #rzxkwsbxuy th {
  border-style: none;
}

#rzxkwsbxuy p {
  margin: 0;
  padding: 0;
}

#rzxkwsbxuy .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rzxkwsbxuy .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rzxkwsbxuy .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rzxkwsbxuy .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rzxkwsbxuy .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rzxkwsbxuy .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rzxkwsbxuy .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rzxkwsbxuy .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rzxkwsbxuy .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rzxkwsbxuy .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rzxkwsbxuy .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rzxkwsbxuy .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rzxkwsbxuy .gt_spanner_row {
  border-bottom-style: hidden;
}

#rzxkwsbxuy .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rzxkwsbxuy .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rzxkwsbxuy .gt_from_md > :first-child {
  margin-top: 0;
}

#rzxkwsbxuy .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rzxkwsbxuy .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rzxkwsbxuy .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rzxkwsbxuy .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rzxkwsbxuy .gt_row_group_first td {
  border-top-width: 2px;
}

#rzxkwsbxuy .gt_row_group_first th {
  border-top-width: 2px;
}

#rzxkwsbxuy .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rzxkwsbxuy .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rzxkwsbxuy .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rzxkwsbxuy .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rzxkwsbxuy .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rzxkwsbxuy .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rzxkwsbxuy .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#rzxkwsbxuy .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rzxkwsbxuy .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rzxkwsbxuy .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rzxkwsbxuy .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rzxkwsbxuy .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rzxkwsbxuy .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rzxkwsbxuy .gt_left {
  text-align: left;
}

#rzxkwsbxuy .gt_center {
  text-align: center;
}

#rzxkwsbxuy .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rzxkwsbxuy .gt_font_normal {
  font-weight: normal;
}

#rzxkwsbxuy .gt_font_bold {
  font-weight: bold;
}

#rzxkwsbxuy .gt_font_italic {
  font-style: italic;
}

#rzxkwsbxuy .gt_super {
  font-size: 65%;
}

#rzxkwsbxuy .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#rzxkwsbxuy .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rzxkwsbxuy .gt_indent_1 {
  text-indent: 5px;
}

#rzxkwsbxuy .gt_indent_2 {
  text-indent: 10px;
}

#rzxkwsbxuy .gt_indent_3 {
  text-indent: 15px;
}

#rzxkwsbxuy .gt_indent_4 {
  text-indent: 20px;
}

#rzxkwsbxuy .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>Beta</strong>"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">age</td>
<td headers="estimate" class="gt_row gt_center"><br></td>
<td headers="ci" class="gt_row gt_center"><br></td>
<td headers="p.value" class="gt_row gt_center"><br></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;20-39</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"><br></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;40-59</td>
<td headers="estimate" class="gt_row gt_center">-6.6</td>
<td headers="ci" class="gt_row gt_center">-12, -1.3</td>
<td headers="p.value" class="gt_row gt_center">0.021</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;60-99</td>
<td headers="estimate" class="gt_row gt_center">-11</td>
<td headers="ci" class="gt_row gt_center">-19, -3.4</td>
<td headers="p.value" class="gt_row gt_center">0.010</td></tr>
    <tr><td headers="label" class="gt_row gt_left">hyp</td>
<td headers="estimate" class="gt_row gt_center"><br></td>
<td headers="ci" class="gt_row gt_center"><br></td>
<td headers="p.value" class="gt_row gt_center"><br></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;no</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"><br></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;yes</td>
<td headers="estimate" class="gt_row gt_center">2.4</td>
<td headers="ci" class="gt_row gt_center">-3.5, 8.2</td>
<td headers="p.value" class="gt_row gt_center">0.4</td></tr>
    <tr><td headers="label" class="gt_row gt_left">chl</td>
<td headers="estimate" class="gt_row gt_center">0.08</td>
<td headers="ci" class="gt_row gt_center">0.02, 0.14</td>
<td headers="p.value" class="gt_row gt_center">0.012</td></tr>
  </tbody>
  <tfoot class="gt_sourcenotes">
    <tr>
      <td class="gt_sourcenote" colspan="4">R² = 0.670; Adjusted R² = 0.505; Sigma = 3.23; Statistic = 4.06; p-value = 0.044; df = 4; Log-likelihood = -30.6; AIC = 73.1; BIC = 76.5; Deviance = 83.7; Residual df = 8; No. Obs. = 13</td>
    </tr>
  </tfoot>
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<p>There are certainly some differences in the regression coefficients - most notable for <strong>age</strong>. Interestingly <strong>age</strong> had no missingness in the original data, so MI is likely facilitating more accurate estimation of the age parameters given we are able to utilise all of the available data by not throwing almost half of it away (as in the CCA). Obviously we cannot say with certainty what the true population parameters are, as these are not simulated data, but it would be reasonable to assume that MI provides a more valid (less biased) analysis.</p>
</section>
</section>
<section id="conclusion" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Conclusion</h1>
<p>I think that’s probably more than enough for this post. What we have covered today are really just the basics of MI using <code>mice</code>. You have no doubt surmised by now that missing data is a fairly complex topic in applied biostatistics, and one that extends into more advanced areas that we haven’t even considered in these posts. There are many other considerations in MI, including:</p>
<ul>
<li><p>How to impute derived variables (e.g.&nbsp;ratios, interaction terms, quadratic terms, etc).</p></li>
<li><p>How to impute for multilevel (repeated measures) models.</p></li>
<li><p>How to predict after MI (this is not straightforward).</p></li>
</ul>
<p>A good starting point if you want to do more reading on missing data and MI is Stef van Buuren’s “bible” on the topic - “Flexible Imputation of Missing Data”. A free online version is available at <a href="https://stefvanbuuren.name/fimd/" class="uri">https://stefvanbuuren.name/fimd/</a>. It is well worth bookmarking as a reference text to help you in your missing data analysis endeavours. A paper that goes in some way to addressing the final issue of prediction can be found <a href="https://journals.sagepub.com/doi/abs/10.1177/0049124115610345">here</a> and is also worth checking out.</p>
<p>Ok team, I hope you have found these posts useful. Until next time…</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="pgseye/Weekly_Stats_Tips" data-repo-id="R_kgDOKvfOfQ" data-category="General" data-category-id="DIC_kwDOKvfOfc4CbFWq" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb30" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb30-1"><a href="#cb30-1"></a><span class="co">---</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="an">title:</span><span class="co"> "Missing Data and Multiple Imputation for Dummies &lt;br&gt; (Part 2)"</span></span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="an">date:</span><span class="co"> 2025-02-21</span></span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="an">categories:</span><span class="co"> [code, concept, analysis]</span></span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="co">#image: "images/mi_flow.png"</span></span>
<span id="cb30-6"><a href="#cb30-6"></a><span class="an">description:</span><span class="co"> "The core concepts and a simple example to get you up and running with MI in your next analysis."</span></span>
<span id="cb30-7"><a href="#cb30-7"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb30-8"><a href="#cb30-8"></a><span class="co">   html:</span></span>
<span id="cb30-9"><a href="#cb30-9"></a><span class="co">     df-print: tibble</span></span>
<span id="cb30-10"><a href="#cb30-10"></a><span class="co">---</span></span>
<span id="cb30-11"><a href="#cb30-11"></a></span>
<span id="cb30-12"><a href="#cb30-12"></a>Welcome to Part 2 of our tutorial on missing data and multiple imputation. If you recall, we ended the last post with a brief introduction to MI and so today I am going to extend that discussion further with some specific, but important detail in how MI actually works via its implementation in <span class="in">`R`</span>. Having a better understanding of the algorithmic process involved is invaluable in contextualising what is actually happening to your data when you incorporate MI into your analysis. As an expository aid, we will also apply MI to a small dataset which I hope will further build your practical intuition of this fairly complex statistical topic.</span>
<span id="cb30-13"><a href="#cb30-13"></a></span>
<span id="cb30-14"><a href="#cb30-14"></a><span class="fu"># MI in R</span></span>
<span id="cb30-15"><a href="#cb30-15"></a></span>
<span id="cb30-16"><a href="#cb30-16"></a>In general, there are two primary approaches to MI and these are implemented by different packages in <span class="in">`R`</span>.</span>
<span id="cb30-17"><a href="#cb30-17"></a></span>
<span id="cb30-18"><a href="#cb30-18"></a><span class="ss">-   </span>Joint Multivariate Normal Distribution Multiple Imputation.</span>
<span id="cb30-19"><a href="#cb30-19"></a></span>
<span id="cb30-20"><a href="#cb30-20"></a>    Joint modelling assumes that the observed data follows a multivariate normal distribution and consequently draws missing values from the same distribution. The biggest problem with this approach is that **a distribution is assumed for the entire dataset**, and this may not always be tenable, leading to incorrect imputations.</span>
<span id="cb30-21"><a href="#cb30-21"></a></span>
<span id="cb30-22"><a href="#cb30-22"></a><span class="ss">-   </span>Conditional Multiple Imputation</span>
<span id="cb30-23"><a href="#cb30-23"></a></span>
<span id="cb30-24"><a href="#cb30-24"></a>    In contrast, the conditional approach is iterative, modelling **the conditional distribution of one variable, given the other variables**. In this way a different distribution may be assumed for each variable, rather than fixing the entire dataset to one distribution. The conditional MI approach tends to be more commonly used due to this enhanced flexibility and the procedure is implemented in the <span class="in">`mice`</span> (multivariate imputation by chained equations) package in <span class="in">`R`</span>. This is the approach we will focus on for the remainder of this tutorial.</span>
<span id="cb30-25"><a href="#cb30-25"></a></span>
<span id="cb30-26"><a href="#cb30-26"></a><span class="fu"># The mice Package</span></span>
<span id="cb30-27"><a href="#cb30-27"></a></span>
<span id="cb30-28"><a href="#cb30-28"></a><span class="fu">## Example Data</span></span>
<span id="cb30-29"><a href="#cb30-29"></a></span>
<span id="cb30-30"><a href="#cb30-30"></a>Before we go any further, let me introduce a small dataset included in the <span class="in">`mice`</span> package that we will use to illustrate conditional MI in action. The <span class="in">`nhanes2`</span> dataset contains sample data from the US National Health and Nutrition Examination Study. It consists of <span class="in">`25`</span> observations of <span class="in">`4`</span> variables:</span>
<span id="cb30-31"><a href="#cb30-31"></a></span>
<span id="cb30-32"><a href="#cb30-32"></a><span class="ss">-   </span>**age** - Age group (1=20-39, 2=40-59, 3=60+)</span>
<span id="cb30-33"><a href="#cb30-33"></a></span>
<span id="cb30-34"><a href="#cb30-34"></a><span class="ss">-   </span>**bmi** - Body mass index (kg/m\^2)</span>
<span id="cb30-35"><a href="#cb30-35"></a></span>
<span id="cb30-36"><a href="#cb30-36"></a><span class="ss">-   </span>**hyp** - Hypertensive (1=no,2=yes)</span>
<span id="cb30-37"><a href="#cb30-37"></a></span>
<span id="cb30-38"><a href="#cb30-38"></a><span class="ss">-   </span>**chl** - Total serum cholesterol (mg/dL)</span>
<span id="cb30-39"><a href="#cb30-39"></a></span>
<span id="cb30-40"><a href="#cb30-40"></a>**age** and **hyp** are formatted as factors and **bmi** and **chl** as numeric. The data look like:</span>
<span id="cb30-41"><a href="#cb30-41"></a></span>
<span id="cb30-44"><a href="#cb30-44"></a><span class="in">```{r}</span></span>
<span id="cb30-45"><a href="#cb30-45"></a><span class="co">#| message: false</span></span>
<span id="cb30-46"><a href="#cb30-46"></a><span class="co">#| warning: false</span></span>
<span id="cb30-47"><a href="#cb30-47"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb30-48"><a href="#cb30-48"></a><span class="fu">library</span>(mice)</span>
<span id="cb30-49"><a href="#cb30-49"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb30-50"><a href="#cb30-50"></a><span class="fu">data</span>(nhanes2)</span>
<span id="cb30-51"><a href="#cb30-51"></a>nhanes2 <span class="sc">|&gt;</span> <span class="fu">tibble</span>() <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span>
<span id="cb30-52"><a href="#cb30-52"></a><span class="in">```</span></span>
<span id="cb30-53"><a href="#cb30-53"></a></span>
<span id="cb30-54"><a href="#cb30-54"></a>Note there is some missingness on all variables except **age**.</span>
<span id="cb30-55"><a href="#cb30-55"></a></span>
<span id="cb30-56"><a href="#cb30-56"></a><span class="fu">## Overview</span></span>
<span id="cb30-57"><a href="#cb30-57"></a></span>
<span id="cb30-58"><a href="#cb30-58"></a>In the last post I suggested that MI can be thought of in broad terms as a three-step procedure: imputation, analysis, and pooling. Using the <span class="in">`mice`</span> package, each of these steps can be equated with a function (blue) and resulting object (red) in your <span class="in">`R`</span> workspace - in short:</span>
<span id="cb30-59"><a href="#cb30-59"></a></span>
<span id="cb30-60"><a href="#cb30-60"></a><span class="ss">1.  </span><span class="in">`mice()`</span> imputes the data, producing a <span class="in">`mids`</span> object</span>
<span id="cb30-61"><a href="#cb30-61"></a><span class="ss">2.  </span><span class="in">`with()`</span> analyses the data, producing a <span class="in">`mira`</span> object</span>
<span id="cb30-62"><a href="#cb30-62"></a><span class="ss">3.  </span><span class="in">`pool()`</span> combines the data, producing a <span class="in">`mipo`</span> object</span>
<span id="cb30-63"><a href="#cb30-63"></a></span>
<span id="cb30-64"><a href="#cb30-64"></a><span class="al">![Main Steps in MI](images/mi_flow.png)</span>{fig-align="center"}</span>
<span id="cb30-65"><a href="#cb30-65"></a></span>
<span id="cb30-66"><a href="#cb30-66"></a>So, imagine that we have our <span class="in">`nhanes2`</span> dataset and we want to explore the relationship between **bmi** (as the outcome) and **age**, **hyp** and **chl** (as predictors). If we just go ahead and run a linear regression with the data as is, we get:</span>
<span id="cb30-67"><a href="#cb30-67"></a></span>
<span id="cb30-70"><a href="#cb30-70"></a><span class="in">```{r}</span></span>
<span id="cb30-71"><a href="#cb30-71"></a><span class="fu">lm</span>(bmi <span class="sc">~</span> age <span class="sc">+</span> hyp <span class="sc">+</span> chl, <span class="at">data =</span> nhanes2) <span class="sc">|&gt;</span> </span>
<span id="cb30-72"><a href="#cb30-72"></a>  <span class="fu">tbl_regression</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-73"><a href="#cb30-73"></a>  <span class="fu">add_glance_source_note</span>()</span>
<span id="cb30-74"><a href="#cb30-74"></a><span class="in">```</span></span>
<span id="cb30-75"><a href="#cb30-75"></a></span>
<span id="cb30-76"><a href="#cb30-76"></a>Everything seems to look ok - regression coefficients seem plausible and standard errors haven't blown up. But if you look at the table footer you will see that <span class="in">`R`</span>'s default setting of listwise deletion, means that only <span class="in">`13`</span> observations have been able to be used. The model has discarded <span class="in">`48%`</span> of the data. "Unacceptable!" you say. Not only have we lost a decent amount of power (and maybe that wouldn't concern you so much with a larger dataset), but we are also potentially at risk of bias if our missing data mechanism isn't MCAR (which is what complete case analysis assumes).</span>
<span id="cb30-77"><a href="#cb30-77"></a></span>
<span id="cb30-78"><a href="#cb30-78"></a>Given I want to show you how to use MI, I am going to do that regardless of whether these data are MCAR or not. So, I will leave as an exercise for you to test the MCAR assumption based on what I have shown you in the previous post, if you are interested (I actually haven't looked at this so I don't know whether MCAR may be considered reasonable in this case).</span>
<span id="cb30-79"><a href="#cb30-79"></a></span>
<span id="cb30-80"><a href="#cb30-80"></a>So let's run through the steps that <span class="in">`mice`</span> uses if we were to impute these data.</span>
<span id="cb30-81"><a href="#cb30-81"></a></span>
<span id="cb30-82"><a href="#cb30-82"></a>As the first step, the <span class="in">`mice()`</span> function creates several complete datasets (in the above we have set this to n = <span class="in">`3`</span>). It considers the missingness in each variable to adhere to a particular distribution, drawing plausible values from this distribution as "placeholders" for the missing values. These "complete" datasets are then stored in an <span class="in">`R`</span> object class called <span class="in">`mids`</span> (which is an abbreviation of "multiply imputed dataset"). Each dataset is a copy of the original dataframe, **except** that the missing values are now replaced by those generated by <span class="in">`mice()`</span>.</span>
<span id="cb30-83"><a href="#cb30-83"></a></span>
<span id="cb30-84"><a href="#cb30-84"></a>::: callout-note</span>
<span id="cb30-85"><a href="#cb30-85"></a>I call these values placeholders as they are not fixed or actually observed, but merely serve to allow estimation of the parameter and its variance.</span>
<span id="cb30-86"><a href="#cb30-86"></a>:::</span>
<span id="cb30-87"><a href="#cb30-87"></a></span>
<span id="cb30-88"><a href="#cb30-88"></a>In the second step, we now analyse each of our three complete datasets. Using the <span class="in">`with()`</span> function, we run the same linear regression model as above on each dataframe of <span class="in">`25`</span> observations, obtaining three different regression coefficients for each parameter. These coefficients only differ due to the differences in the imputed values across each dataset. The analysis results are then stored in another <span class="in">`R`</span> object class called <span class="in">`mira`</span> ("multiply imputed repeated analysis").</span>
<span id="cb30-89"><a href="#cb30-89"></a></span>
<span id="cb30-90"><a href="#cb30-90"></a>In the third and final step, we pool the three coefficients from separate models into one overall regression coefficient for each parameter, and estimate its variance using the <span class="in">`pool()`</span> function. The final coefficient is the simple average of the three separate coefficients. As described in the last post, the variance estimate combines both "within" (dataset) and "between" (dataset) variance components. The pooled results are stored in a <span class="in">`mipo`</span> - "multiple imputation pooled object" - object class in your <span class="in">`R`</span> environment. This becomes the object that you are interested in reporting the results from.</span>
<span id="cb30-91"><a href="#cb30-91"></a></span>
<span id="cb30-92"><a href="#cb30-92"></a>There is one other function in the <span class="in">`mice`</span> package that is worth a mention - <span class="in">`complete()`</span>. While this function isn't essential in the MI pipeline it is nonetheless a very helpful tool in examining the imputed datasets, and I will show you its usage, along with the other primary functions, shortly.</span>
<span id="cb30-93"><a href="#cb30-93"></a></span>
<span id="cb30-94"><a href="#cb30-94"></a><span class="fu">## Iterations Within Imputations</span></span>
<span id="cb30-95"><a href="#cb30-95"></a></span>
<span id="cb30-96"><a href="#cb30-96"></a>There is one last bit of theory we will cover before we get to the practical example. In my understanding of MI, I found it super-helpful to have a cursory working knowledge of the chained equation equation approach. As I think this will also help you, we'll take a few minutes to flesh out some of the detail in what the procedure is actually doing in the background when you call <span class="in">`mice()`</span> on your data.</span>
<span id="cb30-97"><a href="#cb30-97"></a></span>
<span id="cb30-98"><a href="#cb30-98"></a>Recall that in essence the mice procedure runs a series of regression models whereby each variable with missing data is regressed conditional on the other variables present. In this way, variables that differ in their distribution can be modelled as such - for example, logistic regression for binary variables or linear regression for continuous. More explicitly, **the chained equation process can be broken down into one "cycle" or iteration, consisting of five steps**:</span>
<span id="cb30-99"><a href="#cb30-99"></a></span>
<span id="cb30-100"><a href="#cb30-100"></a>**Iteration start** -</span>
<span id="cb30-101"><a href="#cb30-101"></a></span>
<span id="cb30-102"><a href="#cb30-102"></a><span class="ss">-   </span>Step 1: Every missing value in the dataset is replaced with a simple (single) imputation, such as the mean or median.</span>
<span id="cb30-103"><a href="#cb30-103"></a></span>
<span id="cb30-104"><a href="#cb30-104"></a><span class="ss">-   </span>Step 2: For one variable - let's call this "mi_var" - the simple imputations are set back to missing.</span>
<span id="cb30-105"><a href="#cb30-105"></a></span>
<span id="cb30-106"><a href="#cb30-106"></a><span class="ss">-   </span>Step 3: The observed values from "mi_var" in Step 2 are regressed (as the outcome) on the other variables (as predictors) in the imputation model, which may or may not consist of all remaining variables in the dataset. The distribution of "mi_var" is selected as appropriate for that variable.</span>
<span id="cb30-107"><a href="#cb30-107"></a></span>
<span id="cb30-108"><a href="#cb30-108"></a><span class="ss">-   </span>Step 4: The missing values for "mi_var" are then replaced with predictions (imputations) from the regression model.</span>
<span id="cb30-109"><a href="#cb30-109"></a></span>
<span id="cb30-110"><a href="#cb30-110"></a><span class="ss">-   </span>Step 5: Repeat Steps 2-4 for each variable that has missing data. Note that at the end of Step 4 "mi_var" may serve as a predictor for any other variable with missing data, whereby both the observed and imputed values will be used to predict that variable's missing values.</span>
<span id="cb30-111"><a href="#cb30-111"></a></span>
<span id="cb30-112"><a href="#cb30-112"></a>**- Iteration end**</span>
<span id="cb30-113"><a href="#cb30-113"></a></span>
<span id="cb30-114"><a href="#cb30-114"></a>At the end of one iteration, all variables with missing data will have been replaced with predictions (imputations) from regression models that represent the associations observed in the data. Usually multiple iterations (ten is considered standard) are specified with the imputations being updated at the end of each cycle. Enough iterations should be specified to establish with confidence that the imputation parameter estimates (regression coefficients) should "converge" so they are no longer changing, within some tolerance, in a new cycle.</span>
<span id="cb30-115"><a href="#cb30-115"></a></span>
<span id="cb30-116"><a href="#cb30-116"></a>So, when we think of <span class="co">[</span><span class="ot">Inception</span><span class="co">](https://en.wikipedia.org/wiki/Inception)</span> as a movie about layers (dreams within dreams), it can be helpful to think of MI in a similar way, as also consisting of layers (iterations within imputations). Each call to <span class="in">`mice()`</span> produces multiple imputed datasets where each imputed dataset is itself the result of multiple iterations. Hopefully your brain doesn't hurt like mine did when I watched Inception!</span>
<span id="cb30-117"><a href="#cb30-117"></a></span>
<span id="cb30-118"><a href="#cb30-118"></a><span class="fu"># Practical Application of MI</span></span>
<span id="cb30-119"><a href="#cb30-119"></a></span>
<span id="cb30-120"><a href="#cb30-120"></a>Ok, enough talking. Let's actually work through an example - we'll use the <span class="in">`nhanes2`</span> dataset I introduced above.</span>
<span id="cb30-121"><a href="#cb30-121"></a></span>
<span id="cb30-122"><a href="#cb30-122"></a><span class="fu">## Inspect</span></span>
<span id="cb30-123"><a href="#cb30-123"></a></span>
<span id="cb30-124"><a href="#cb30-124"></a>It's always a good idea to first take a couple of minutes to inspect and/or visualise the missing values and any potential patterns in the data. Let's first check the number and proportion of missing values for each variable. We could code this ourselves, but there's actually a handy little function especially for this in the <span class="in">`questionr`</span> package:</span>
<span id="cb30-125"><a href="#cb30-125"></a></span>
<span id="cb30-128"><a href="#cb30-128"></a><span class="in">```{r}</span></span>
<span id="cb30-129"><a href="#cb30-129"></a><span class="fu">library</span>(questionr)</span>
<span id="cb30-130"><a href="#cb30-130"></a><span class="fu">freq.na</span>(nhanes2)</span>
<span id="cb30-131"><a href="#cb30-131"></a><span class="in">```</span></span>
<span id="cb30-132"><a href="#cb30-132"></a></span>
<span id="cb30-133"><a href="#cb30-133"></a>We can extend this further to look for patterns of missing values and <span class="in">`mice`</span> provides the <span class="in">`md.pattern()`</span> function for this. An equivalent plot and tabulation are supplied by default but it is possible to suppress the plot if one wishes.</span>
<span id="cb30-134"><a href="#cb30-134"></a></span>
<span id="cb30-137"><a href="#cb30-137"></a><span class="in">```{r}</span></span>
<span id="cb30-138"><a href="#cb30-138"></a><span class="fu">md.pattern</span>(nhanes2)</span>
<span id="cb30-139"><a href="#cb30-139"></a><span class="in">```</span></span>
<span id="cb30-140"><a href="#cb30-140"></a></span>
<span id="cb30-141"><a href="#cb30-141"></a>Values are either 0 (missing) or 1 (observed). From top to bottom, we read this as:</span>
<span id="cb30-142"><a href="#cb30-142"></a></span>
<span id="cb30-143"><a href="#cb30-143"></a><span class="ss">-   </span><span class="in">`13`</span> people have no missing data.</span>
<span id="cb30-144"><a href="#cb30-144"></a></span>
<span id="cb30-145"><a href="#cb30-145"></a><span class="ss">-   </span><span class="in">`3`</span> people have missingness on **chl** only.</span>
<span id="cb30-146"><a href="#cb30-146"></a></span>
<span id="cb30-147"><a href="#cb30-147"></a><span class="ss">-   </span><span class="in">`1`</span> person has missingness on **bmi** only.</span>
<span id="cb30-148"><a href="#cb30-148"></a></span>
<span id="cb30-149"><a href="#cb30-149"></a><span class="ss">-   </span><span class="in">`1`</span> person has missingness on **hyp** and **bmi** only.</span>
<span id="cb30-150"><a href="#cb30-150"></a></span>
<span id="cb30-151"><a href="#cb30-151"></a><span class="ss">-   </span><span class="in">`7`</span> people have missingness on **hyp**, **bmi** and **chl**.</span>
<span id="cb30-152"><a href="#cb30-152"></a></span>
<span id="cb30-153"><a href="#cb30-153"></a>The numbers in the bottom row represent the frequencies of missingness on each variable and the resulting marginal total (far right). The numbers in the right-most column represent the number of variables with missingness in each pattern.</span>
<span id="cb30-154"><a href="#cb30-154"></a></span>
<span id="cb30-155"><a href="#cb30-155"></a><span class="fu">## mice()</span></span>
<span id="cb30-156"><a href="#cb30-156"></a></span>
<span id="cb30-157"><a href="#cb30-157"></a>Now, let's do the imputation. It's as simple as calling the <span class="in">`mice()`</span> function on our dataset, but here I will specify <span class="in">`3`</span> imputations rather than the default of <span class="in">`5`</span>.</span>
<span id="cb30-158"><a href="#cb30-158"></a></span>
<span id="cb30-161"><a href="#cb30-161"></a><span class="in">```{r}</span></span>
<span id="cb30-162"><a href="#cb30-162"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb30-163"><a href="#cb30-163"></a>imp <span class="ot">&lt;-</span>  <span class="fu">mice</span>(nhanes2, <span class="at">m =</span> <span class="dv">3</span>, <span class="at">print =</span> <span class="cn">FALSE</span>)</span>
<span id="cb30-164"><a href="#cb30-164"></a>imp</span>
<span id="cb30-165"><a href="#cb30-165"></a><span class="in">```</span></span>
<span id="cb30-166"><a href="#cb30-166"></a></span>
<span id="cb30-167"><a href="#cb30-167"></a>By inspecting the resulting <span class="in">`mids`</span> object, we can see that <span class="in">`mice()`</span> used **pmm** (predictive mean matching) to impute all the variables except **hyp** which used logistic regression (**logreg**) instead, given this is a binary variable. Note that variables with no missing values will have no method ("") specified because no imputation is actually needed.</span>
<span id="cb30-168"><a href="#cb30-168"></a></span>
<span id="cb30-169"><a href="#cb30-169"></a>::: callout-note</span>
<span id="cb30-170"><a href="#cb30-170"></a><span class="co">[</span><span class="ot">pmm</span><span class="co">](https://stefvanbuuren.name/fimd/sec-pmm.html)</span> is the recommended and default method for the imputation of continuous data in <span class="in">`mice()`</span></span>
<span id="cb30-171"><a href="#cb30-171"></a>:::</span>
<span id="cb30-172"><a href="#cb30-172"></a></span>
<span id="cb30-173"><a href="#cb30-173"></a>The output also shows the <span class="in">`predictorMatrix`</span> which determines what variables are used in the imputation of another. It is useful to familiarise yourself with this matrix as you may want to customise imputations at some point and amending the <span class="in">`predictorMatrix`</span> provides such functionality. You can interpret the <span class="in">`predictorMatrix`</span> as rows corresponding to incomplete target variables and columns as complete predictor variables. A value of <span class="in">`1`</span> indicates that the column variable acts as a predictor to impute the target (row) variable, and a <span class="in">`0`</span> means that it is not used. Thus, in our example, **hyp** is predicted from **age**, **bmi** and **chl**. Note that the diagonal is set to <span class="in">`0`</span> since variables cannot predict themselves. The default setting of the <span class="in">`predictorMatrix`</span> specifies that every variable predicts all others.</span>
<span id="cb30-174"><a href="#cb30-174"></a></span>
<span id="cb30-175"><a href="#cb30-175"></a>As a relatively quick diagnostic exercise, we can easily examine the correspondence between observed and imputed values (for the continuous variables at least) by using the <span class="in">`stripplot()`</span> function. Note that <span class="in">`mice`</span> provides other graphical tools for this that are also worth exploring.</span>
<span id="cb30-176"><a href="#cb30-176"></a></span>
<span id="cb30-179"><a href="#cb30-179"></a><span class="in">```{r}</span></span>
<span id="cb30-180"><a href="#cb30-180"></a><span class="fu">stripplot</span>(imp, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>), <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">20</span>), <span class="at">cex =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb30-181"><a href="#cb30-181"></a><span class="in">```</span></span>
<span id="cb30-182"><a href="#cb30-182"></a></span>
<span id="cb30-183"><a href="#cb30-183"></a>The plots show relatively good overlap of the imputed values (in blue) with the original non-missing data (red).</span>
<span id="cb30-184"><a href="#cb30-184"></a></span>
<span id="cb30-185"><a href="#cb30-185"></a><span class="fu">## complete()</span></span>
<span id="cb30-186"><a href="#cb30-186"></a></span>
<span id="cb30-187"><a href="#cb30-187"></a>At this point you may actually want to look at the imputed values and datasets themselves. <span class="in">`mice`</span> makes this easy with the <span class="in">`complete()`</span> function and while this isn't integral to the workflow, it can be useful as another plausiblity check that the imputations are working as they should. There are multiple formats that we can view the imputed data in, and I will show you what I consider are the three main ways. In all cases, each observation will be labelled with its imputation number and I will also include the original data (imputation = 0) for comparison.</span>
<span id="cb30-188"><a href="#cb30-188"></a></span>
<span id="cb30-189"><a href="#cb30-189"></a><span class="fu">### "all"</span></span>
<span id="cb30-190"><a href="#cb30-190"></a></span>
<span id="cb30-191"><a href="#cb30-191"></a>Using "all" produces a list, where each imputed dataframe becomes an element of that list.</span>
<span id="cb30-192"><a href="#cb30-192"></a></span>
<span id="cb30-195"><a href="#cb30-195"></a><span class="in">```{r}</span></span>
<span id="cb30-196"><a href="#cb30-196"></a>imp_all <span class="ot">&lt;-</span>  <span class="fu">complete</span>(imp, <span class="st">"all"</span>, <span class="at">include =</span> T)</span>
<span id="cb30-197"><a href="#cb30-197"></a>imp_all</span>
<span id="cb30-198"><a href="#cb30-198"></a><span class="in">```</span></span>
<span id="cb30-199"><a href="#cb30-199"></a></span>
<span id="cb30-200"><a href="#cb30-200"></a><span class="fu">### "long"</span></span>
<span id="cb30-201"><a href="#cb30-201"></a></span>
<span id="cb30-202"><a href="#cb30-202"></a>Using "long" produces a dataframe of imputations stacked on top of each other. Imputation and ID numbers are provided as variables to identify which observations belong to which imputations.</span>
<span id="cb30-203"><a href="#cb30-203"></a></span>
<span id="cb30-206"><a href="#cb30-206"></a><span class="in">```{r}</span></span>
<span id="cb30-207"><a href="#cb30-207"></a>imp_long <span class="ot">&lt;-</span>  <span class="fu">complete</span>(imp, <span class="st">"long"</span>, <span class="at">include =</span> T)</span>
<span id="cb30-208"><a href="#cb30-208"></a>imp_long <span class="sc">|&gt;</span> <span class="fu">tibble</span>() <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span>
<span id="cb30-209"><a href="#cb30-209"></a><span class="in">```</span></span>
<span id="cb30-210"><a href="#cb30-210"></a></span>
<span id="cb30-211"><a href="#cb30-211"></a><span class="fu">### "broad"</span></span>
<span id="cb30-212"><a href="#cb30-212"></a></span>
<span id="cb30-213"><a href="#cb30-213"></a>In contrast, the "broad" or wide format produces a dataframe of imputations stacked side-by-side. Imputation numbers are included in the variable names.</span>
<span id="cb30-214"><a href="#cb30-214"></a></span>
<span id="cb30-217"><a href="#cb30-217"></a><span class="in">```{r}</span></span>
<span id="cb30-218"><a href="#cb30-218"></a>imp_wide <span class="ot">&lt;-</span>  <span class="fu">complete</span>(imp, <span class="st">"broad"</span>, <span class="at">include =</span> T)</span>
<span id="cb30-219"><a href="#cb30-219"></a>imp_wide <span class="sc">|&gt;</span> <span class="fu">tibble</span>() <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span>
<span id="cb30-220"><a href="#cb30-220"></a><span class="in">```</span></span>
<span id="cb30-221"><a href="#cb30-221"></a></span>
<span id="cb30-222"><a href="#cb30-222"></a><span class="fu">### View just one imputation</span></span>
<span id="cb30-223"><a href="#cb30-223"></a></span>
<span id="cb30-224"><a href="#cb30-224"></a>All good you say, but what if I want to view just one imputation. Well you can do that quite easily in the call to <span class="in">`complete()`</span>. Here we will ask for just the second imputation.</span>
<span id="cb30-225"><a href="#cb30-225"></a></span>
<span id="cb30-228"><a href="#cb30-228"></a><span class="in">```{r}</span></span>
<span id="cb30-229"><a href="#cb30-229"></a><span class="fu">complete</span>(imp, <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">tibble</span>() <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span>
<span id="cb30-230"><a href="#cb30-230"></a><span class="in">```</span></span>
<span id="cb30-231"><a href="#cb30-231"></a></span>
<span id="cb30-232"><a href="#cb30-232"></a><span class="fu">### Compare imputed values</span></span>
<span id="cb30-233"><a href="#cb30-233"></a></span>
<span id="cb30-234"><a href="#cb30-234"></a>If you want to compare the imputed values in a more direct way, we can use the broad format to do that on a variable by variable basis. Here I will ask to look at just **bmi**.</span>
<span id="cb30-235"><a href="#cb30-235"></a></span>
<span id="cb30-238"><a href="#cb30-238"></a><span class="in">```{r}</span></span>
<span id="cb30-239"><a href="#cb30-239"></a><span class="fu">complete</span>(imp, <span class="st">"broad"</span>, <span class="at">include =</span> T) <span class="sc">|&gt;</span> </span>
<span id="cb30-240"><a href="#cb30-240"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"bmi"</span>)) <span class="sc">|&gt;</span> <span class="fu">tibble</span>() <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span>
<span id="cb30-241"><a href="#cb30-241"></a><span class="in">```</span></span>
<span id="cb30-242"><a href="#cb30-242"></a></span>
<span id="cb30-243"><a href="#cb30-243"></a><span class="in">`bmi.0`</span> is the original **bmi** data and the columns to its right are each of the three imputations for that variable. This provides an easy way to scan across and examine what <span class="in">`mice`</span> has given us.</span>
<span id="cb30-244"><a href="#cb30-244"></a></span>
<span id="cb30-245"><a href="#cb30-245"></a><span class="fu">## with()</span></span>
<span id="cb30-246"><a href="#cb30-246"></a></span>
<span id="cb30-247"><a href="#cb30-247"></a>Now that we have imputed the data, we can use <span class="in">`with()`</span> to analyse the data. Generally there is not much need to inspect the output of this step and we usually go straight onto pooling the results, but for the sake of the exercise we will take a closer look at the <span class="in">`mira`</span> object that is generated. So, let's run the regression model that we specified earlier, with **bmi** as the outcome and **age**, **hyp** and **chl** as predictors.</span>
<span id="cb30-248"><a href="#cb30-248"></a></span>
<span id="cb30-251"><a href="#cb30-251"></a><span class="in">```{r}</span></span>
<span id="cb30-252"><a href="#cb30-252"></a>fit_imp <span class="ot">&lt;-</span> <span class="fu">with</span>(imp, <span class="fu">lm</span>(bmi <span class="sc">~</span> age <span class="sc">+</span> hyp <span class="sc">+</span> chl))</span>
<span id="cb30-253"><a href="#cb30-253"></a><span class="fu">summary</span>(fit_imp)</span>
<span id="cb30-254"><a href="#cb30-254"></a><span class="in">```</span></span>
<span id="cb30-255"><a href="#cb30-255"></a></span>
<span id="cb30-256"><a href="#cb30-256"></a>See how we obtain the regression output for each imputed dataset stacked one on top of the other in a single dataframe. This allows us to quickly compare the estimated regression parameters across imputations.</span>
<span id="cb30-257"><a href="#cb30-257"></a></span>
<span id="cb30-258"><a href="#cb30-258"></a><span class="fu">## pool()</span></span>
<span id="cb30-259"><a href="#cb30-259"></a></span>
<span id="cb30-260"><a href="#cb30-260"></a>We can now call <span class="in">`pool()`</span> to pool the results of the separate regressions based on Rubin's rules.</span>
<span id="cb30-261"><a href="#cb30-261"></a></span>
<span id="cb30-264"><a href="#cb30-264"></a><span class="in">```{r}</span></span>
<span id="cb30-265"><a href="#cb30-265"></a><span class="fu">summary</span>(<span class="fu">pool</span>(fit_imp), <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-266"><a href="#cb30-266"></a><span class="in">```</span></span>
<span id="cb30-267"><a href="#cb30-267"></a></span>
<span id="cb30-268"><a href="#cb30-268"></a>Note that there is also a "tidy" way to format this output directly, using the <span class="in">`tbl_regression()`</span> function, which provides for much nicer viewing.</span>
<span id="cb30-269"><a href="#cb30-269"></a></span>
<span id="cb30-272"><a href="#cb30-272"></a><span class="in">```{r}</span></span>
<span id="cb30-273"><a href="#cb30-273"></a><span class="co">#| message: false</span></span>
<span id="cb30-274"><a href="#cb30-274"></a><span class="co">#| warning: false</span></span>
<span id="cb30-275"><a href="#cb30-275"></a>fit_imp <span class="sc">|&gt;</span> </span>
<span id="cb30-276"><a href="#cb30-276"></a>  <span class="fu">tbl_regression</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-277"><a href="#cb30-277"></a>  <span class="fu">add_glance_source_note</span>()</span>
<span id="cb30-278"><a href="#cb30-278"></a><span class="in">```</span></span>
<span id="cb30-279"><a href="#cb30-279"></a></span>
<span id="cb30-280"><a href="#cb30-280"></a><span class="fu">## Compare with CCA</span></span>
<span id="cb30-281"><a href="#cb30-281"></a></span>
<span id="cb30-282"><a href="#cb30-282"></a>I will re-print the model output from the CCA so that we can compare it to the MI results:</span>
<span id="cb30-283"><a href="#cb30-283"></a></span>
<span id="cb30-286"><a href="#cb30-286"></a><span class="in">```{r}</span></span>
<span id="cb30-287"><a href="#cb30-287"></a><span class="fu">lm</span>(bmi <span class="sc">~</span> age <span class="sc">+</span> hyp <span class="sc">+</span> chl, <span class="at">data =</span> nhanes2) <span class="sc">|&gt;</span> </span>
<span id="cb30-288"><a href="#cb30-288"></a>  <span class="fu">tbl_regression</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-289"><a href="#cb30-289"></a>  <span class="fu">add_glance_source_note</span>()</span>
<span id="cb30-290"><a href="#cb30-290"></a><span class="in">```</span></span>
<span id="cb30-291"><a href="#cb30-291"></a></span>
<span id="cb30-292"><a href="#cb30-292"></a>There are certainly some differences in the regression coefficients - most notable for **age**. Interestingly **age** had no missingness in the original data, so MI is likely facilitating more accurate estimation of the age parameters given we are able to utilise all of the available data by not throwing almost half of it away (as in the CCA). Obviously we cannot say with certainty what the true population parameters are, as these are not simulated data, but it would be reasonable to assume that MI provides a more valid (less biased) analysis.</span>
<span id="cb30-293"><a href="#cb30-293"></a></span>
<span id="cb30-294"><a href="#cb30-294"></a><span class="fu"># Conclusion</span></span>
<span id="cb30-295"><a href="#cb30-295"></a></span>
<span id="cb30-296"><a href="#cb30-296"></a>I think that's probably more than enough for this post. What we have covered today are really just the basics of MI using <span class="in">`mice`</span>. You have no doubt surmised by now that missing data is a fairly complex topic in applied biostatistics, and one that extends into more advanced areas that we haven't even considered in these posts. There are many other considerations in MI, including:</span>
<span id="cb30-297"><a href="#cb30-297"></a></span>
<span id="cb30-298"><a href="#cb30-298"></a><span class="ss">-   </span>How to impute derived variables (e.g. ratios, interaction terms, quadratic terms, etc).</span>
<span id="cb30-299"><a href="#cb30-299"></a></span>
<span id="cb30-300"><a href="#cb30-300"></a><span class="ss">-   </span>How to impute for multilevel (repeated measures) models.</span>
<span id="cb30-301"><a href="#cb30-301"></a></span>
<span id="cb30-302"><a href="#cb30-302"></a><span class="ss">-   </span>How to predict after MI (this is not straightforward).</span>
<span id="cb30-303"><a href="#cb30-303"></a></span>
<span id="cb30-304"><a href="#cb30-304"></a>A good starting point if you want to do more reading on missing data and MI is Stef van Buuren's "bible" on the topic - "Flexible Imputation of Missing Data". A free online version is available at <span class="ot">&lt;https://stefvanbuuren.name/fimd/&gt;</span>. It is well worth bookmarking as a reference text to help you in your missing data analysis endeavours. A paper that goes in some way to addressing the final issue of prediction can be found <span class="co">[</span><span class="ot">here</span><span class="co">](https://journals.sagepub.com/doi/abs/10.1177/0049124115610345)</span> and is also worth checking out.</span>
<span id="cb30-305"><a href="#cb30-305"></a></span>
<span id="cb30-306"><a href="#cb30-306"></a>Ok team, I hope you have found these posts useful. Until next time...</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>