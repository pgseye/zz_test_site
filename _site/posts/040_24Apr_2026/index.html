<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2026-04-24">
<meta name="description" content="What they are and how they’re used.">

<title>Test Site 2 - ROC Curves in Clinical Decision-Making: A Gentle Introduction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Test Site 2</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">All Posts</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#a-bit-of-history-from-radar-to-medicine" id="toc-a-bit-of-history-from-radar-to-medicine" class="nav-link" data-scroll-target="#a-bit-of-history-from-radar-to-medicine"><span class="header-section-number">2</span> A Bit of History: From Radar to Medicine</a></li>
  <li><a href="#key-concepts" id="toc-key-concepts" class="nav-link" data-scroll-target="#key-concepts"><span class="header-section-number">3</span> Key Concepts</a>
  <ul>
  <li><a href="#the-confusion-matrix-22-table" id="toc-the-confusion-matrix-22-table" class="nav-link" data-scroll-target="#the-confusion-matrix-22-table"><span class="header-section-number">3.1</span> The Confusion Matrix (2×2 Table)</a></li>
  <li><a href="#roc-curve" id="toc-roc-curve" class="nav-link" data-scroll-target="#roc-curve"><span class="header-section-number">3.2</span> ROC Curve</a></li>
  </ul></li>
  <li><a href="#a-simulated-example" id="toc-a-simulated-example" class="nav-link" data-scroll-target="#a-simulated-example"><span class="header-section-number">4</span> A Simulated Example</a>
  <ul>
  <li><a href="#plotting-a-roc-curve-by-first-principles" id="toc-plotting-a-roc-curve-by-first-principles" class="nav-link" data-scroll-target="#plotting-a-roc-curve-by-first-principles"><span class="header-section-number">4.1</span> Plotting a ROC Curve by First Principles</a></li>
  <li><a href="#plotting-a-roc-curve-the-easy-way" id="toc-plotting-a-roc-curve-the-easy-way" class="nav-link" data-scroll-target="#plotting-a-roc-curve-the-easy-way"><span class="header-section-number">4.2</span> Plotting a ROC Curve the Easy Way</a></li>
  <li><a href="#other-bits-and-pieces" id="toc-other-bits-and-pieces" class="nav-link" data-scroll-target="#other-bits-and-pieces"><span class="header-section-number">4.3</span> Other Bits and Pieces</a></li>
  </ul></li>
  <li><a href="#wrap-up" id="toc-wrap-up" class="nav-link" data-scroll-target="#wrap-up"><span class="header-section-number">5</span> Wrap-Up</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">ROC Curves in Clinical Decision-Making: A Gentle Introduction</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">concept</div>
    <div class="quarto-category">code</div>
  </div>
  </div>

<div>
  <div class="description">
    What they are and how they’re used.
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 24, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>When clinicians or researchers develop a diagnostic test - say, a blood biomarker for detecting a disease - they’re really asking:</p>
<blockquote class="blockquote">
<p>“How well does this test distinguish sick from healthy?”</p>
</blockquote>
<p>In being able to answer that question, we ultimately care about two things:</p>
<ul>
<li><p><strong>Sensitivity</strong> — the ability to correctly identify the sick (true positives).</p></li>
<li><p><strong>Specificity</strong> — the ability to correctly identify the healthy (true negatives).</p></li>
</ul>
<p>But diagnostic tests often give a continuous value (e.g., concentration of a biomarker). So we have to choose a threshold: values above are positive and values below are negative. So where should we set this cut-off?</p>
<p>Enter the receiver-operator characteristic (ROC) curve. This is a tool that evaluates how <strong>sensitivity and specificity trade off as we vary a test threshold of interest</strong>. In addition, the area under the ROC curve gives an idea about the benefit of using the test in question - the greater the area the more accurate the test. In today’s post we’ll talk about ROC curves and how they’re used to aid in clinical-decision making. At first blush the ROC curve can appear quite confusing and difficult to interpret, but I’m hoping by the end of this post I’ll have demystified it enough that you can comfortably employ one in your next diagnostic study.</p>
<hr>
</section>
<section id="a-bit-of-history-from-radar-to-medicine" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="a-bit-of-history-from-radar-to-medicine"><span class="header-section-number">2</span> A Bit of History: From Radar to Medicine</h2>
<p>Interestingly, ROC curves were first developed during World War II by electrical and radar engineers in the UK. They were trying to distinguish real aircraft returns from noise and clutter on radar screens. The question was essentially the same: given a signal, how do we choose a threshold to decide “target present” vs “target absent” while balancing false alarms and misses? After the war, this framework migrated into signal detection theory and then into statistics and also to multiple areas within medicine. The ROC curve has also been applied in other research fields including biometrics, forecasting of natural hazards, meteorology, model performance assessment, and is increasingly used in machine learning and data mining research. As you can tell, it has wide utility in decision making, but it’s ultimately based on a relatively simple idea.</p>
<hr>
</section>
<section id="key-concepts" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="key-concepts"><span class="header-section-number">3</span> Key Concepts</h2>
<section id="the-confusion-matrix-22-table" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="the-confusion-matrix-22-table"><span class="header-section-number">3.1</span> The Confusion Matrix (2×2 Table)</h3>
<p>At the heart of ROC analysis is the confusion matrix, a simple 2×2 table that compares the results of a diagnostic test against the true disease status. For any chosen threshold that classifies a continuous test result as positive or negative, each individual falls into one of four categories. True positives (TP) are patients who truly have the disease and whose test result is positive, while true negatives (TN) are disease-free individuals correctly identified as negative by the test. Errors arise in two ways: false positives (FP) occur when healthy individuals are incorrectly labelled as having the disease, and false negatives (FN) occur when diseased individuals are missed by the test.</p>
<p>These four quantities form the basis of nearly all diagnostic performance measures. In particular, sensitivity (also called the true positive rate) is the proportion of diseased individuals correctly detected by the test. Specificity is the proportion of non-diseased individuals correctly classified. ROC curves are constructed by repeatedly recalculating these quantities as the decision threshold moves, tracing out how sensitivity increases at the cost of decreasing specificity, <strong>for every possible test threshold</strong>.</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th><strong>Disease Present</strong></th>
<th><strong>Disease Absent</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Test Positive</strong></td>
<td>True Positive (TP)</td>
<td>False Positive (FP)</td>
</tr>
<tr class="even">
<td><strong>Test Negative</strong></td>
<td>False Negative (FN)</td>
<td>True Negative (TN)</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>So from this simple table, we calculate:</p>
<ul>
<li><p>Sensitivity (True Positive Rate) = TP / (TP + FN)</p></li>
<li><p>Specificity = TN / (TN + FP)</p></li>
<li><p>False Positive Rate = 1 – Specificity = FP / (FP + TN)</p></li>
</ul>
</section>
<section id="roc-curve" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="roc-curve"><span class="header-section-number">3.2</span> ROC Curve</h3>
<p>To construct a ROC curve it’s then a relatively simple case of plotting Sensitivity (True Positive Rate) vs False Positive Rate (FPR) at every possible threshold. A perfect test would go straight up the y-axis to <code>1.0</code> then straight across with a resulting Area Under Curve (AUC) = <code>1.0</code>. In contrast, a test no better than chance would follow the diagonal with an AUC = <code>0.5</code>. In practice, most clinical tests fall somewhere in between.</p>
<p>Let’s illustrate this in practice. I will use the <code>pROC</code> package in <code>R</code> for the analyses in this post, but there are other ROC creation packages available in <code>R</code>, and your mileage will vary depending on what you want. I find <code>pROC</code> fairly simple but if you are after something with a little more flexibility than I would encourage you to also explore the <code>cutpointR</code> package - I know that it offers more options in the calculation of optimal cutpoints. I have not personally used the <code>ROCR</code> package but this is another one that is available for these type of analyses.</p>
</section>
</section>
<section id="a-simulated-example" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="a-simulated-example"><span class="header-section-number">4</span> A Simulated Example</h2>
<p>To help you to better understand what a ROC curve is doing in calculations under the hood, I have simulated some data (<code>50</code> observations) containing a continuous biomarker (<code>test_values</code>) and a binary <code>disease</code> status. Let’s take a look at the first few rows of the simulated data:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co"># Simulate data</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co"># Disease status: 0 = healthy, 1 = diseased</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>disease <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.4</span>)</span>
<span id="cb1-12"><a href="#cb1-12"></a></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co"># Continuous test: diseased group has higher values</span></span>
<span id="cb1-14"><a href="#cb1-14"></a>test_values <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>disease, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb1-15"><a href="#cb1-15"></a></span>
<span id="cb1-16"><a href="#cb1-16"></a>sim_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(disease, test_values) <span class="sc">|&gt;</span> </span>
<span id="cb1-17"><a href="#cb1-17"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(test_values))</span>
<span id="cb1-18"><a href="#cb1-18"></a></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="co"># Peek at data</span></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="fu">head</span>(sim_data) <span class="sc">|&gt;</span> </span>
<span id="cb1-21"><a href="#cb1-21"></a>    <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: center;">disease</th>
<th style="text-align: center;">test_values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">3.52</td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: center;">3.25</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">3.21</td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: center;">2.90</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">2.84</td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: center;">2.78</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Now, let’s plot these data:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">ggplot</span>(sim_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(disease), <span class="at">y =</span> test_values)) <span class="sc">+</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(disease))) <span class="sc">+</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>What can you see from this plot? Well, the obvious thing we can appreciate is that if you have this fictitious disease, the biomarker test value tends to be higher compared to if you don’t. Ahhh, you might think - that is a useful characteristic to have if you want the test to be able to discriminate between those with and those without the disease. And you’d be right of course. But you might also be able to appreciate that because there is overlap in test values across disease states, no single test value is going to be <code>100%</code> accurate.</p>
<p>For the sake of the illustration let’s set an initial test value cut-off (threshold) at <code>0</code>, like so:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">ggplot</span>(sim_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(disease), <span class="at">y =</span> test_values)) <span class="sc">+</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(disease))) <span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="fu">geom_hline</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>In interpreting this and the following plot, keep in mind the following:</p>
<blockquote class="blockquote">
<p>We are diagnosing everyone with a test value ABOVE the red line - regardless of their actual status - as having the disease.</p>
</blockquote>
<blockquote class="blockquote">
<p>We are calling everyone with a test value BELOW the red line - regardless of their actual status - as being healthy.</p>
</blockquote>
<p>With a threshold set at <code>0</code> we will correctly identify <em>all</em> of those with the disease, so our true positive rate (TPR) will be <code>100%</code>, but you’ll note that we will also misclassify about half of those without the disease - our false positive rate (FPR) will be about <code>50%</code>. Not good enough you might think - we don’t want to diagnose a bunch of people as sick when they’re not, because then we might subject them to unnecessary treatment. Instead, let’s make the cut-off for our biomarker higher and see if that helps.</p>
<p>So now we raise the cut-off to <code>1</code>:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">ggplot</span>(sim_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(disease), <span class="at">y =</span> test_values)) <span class="sc">+</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(disease))) <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="fu">geom_hline</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">yintercept =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>We no longer correctly identify all those with the disease (TPR = <code>85%</code>), but we also don’t incorrectly misdiagnose as many healthy individuals either (FPR = <code>13%</code>). Only clinical judgement can ultimately decide whether this is a more acceptable decision threshold but certainly it better balances misclassification error.</p>
<p>The reason I am showing you these plots is that they form the basis of a ROC curve. If you created such a plot for every test value (threshold) in the dataset, calculating the TPR and FPR in each case (and collating each as a paired set of coordinates), then this is all the information you would need to plot the resulting ROC curve.</p>
<section id="plotting-a-roc-curve-by-first-principles" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="plotting-a-roc-curve-by-first-principles"><span class="header-section-number">4.1</span> Plotting a ROC Curve by First Principles</h3>
<p>Let’s do just that now. I am going to take you through this process step by step to illustrate (and demystify) how a ROC curve is constructed. To make my life a little easier I will use the <code>coords()</code> function in the <code>pROC</code> package to calculate the TPR and FPR at every test value. I will also list the test value itself, as well as disease status an the cumulative number of TP’s and FP’s - these are helpful to understand how the rates are generated. To aid interpretation biomarker test values are first ranked in order from highest to lowest. The resulting data are as follows:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Compute ROC object</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(sim_data<span class="sc">$</span>disease, sim_data<span class="sc">$</span>test_values)</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co"># Calculate threshold data</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>coord_data <span class="ot">&lt;-</span>  <span class="fu">coords</span>(roc_obj, <span class="at">ret =</span> <span class="fu">c</span>(<span class="st">"threshold"</span>, <span class="st">"tp"</span>, <span class="st">"fp"</span>, <span class="st">"tpr"</span>, <span class="st">"fpr"</span>))</span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co"># Merge in simulated data</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>coord_data <span class="ot">&lt;-</span>  coord_data <span class="sc">|&gt;</span> </span>
<span id="cb5-7"><a href="#cb5-7"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(threshold)) <span class="sc">|&gt;</span> </span>
<span id="cb5-8"><a href="#cb5-8"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb5-9"><a href="#cb5-9"></a>coord_data <span class="ot">&lt;-</span>  <span class="fu">cbind</span>(coord_data, sim_data) <span class="sc">|&gt;</span> </span>
<span id="cb5-10"><a href="#cb5-10"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb5-11"><a href="#cb5-11"></a>  <span class="fu">select</span>(id, test_values, disease, tp, fp, tpr, fpr)</span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="co"># Print</span></span>
<span id="cb5-13"><a href="#cb5-13"></a>coord_data <span class="sc">|&gt;</span> </span>
<span id="cb5-14"><a href="#cb5-14"></a>      <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: center;">id</th>
<th style="text-align: center;">test_values</th>
<th style="text-align: center;">disease</th>
<th style="text-align: center;">tp</th>
<th style="text-align: center;">fp</th>
<th style="text-align: center;">tpr</th>
<th style="text-align: center;">fpr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">3.52</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.05</td>
<td style="text-align: center;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">3.25</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.10</td>
<td style="text-align: center;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">3.21</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.15</td>
<td style="text-align: center;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">2.90</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.20</td>
<td style="text-align: center;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">2.84</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.25</td>
<td style="text-align: center;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: center;">2.78</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.30</td>
<td style="text-align: center;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: center;">7</td>
<td style="text-align: center;">2.69</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.35</td>
<td style="text-align: center;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: center;">8</td>
<td style="text-align: center;">2.58</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.40</td>
<td style="text-align: center;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: center;">9</td>
<td style="text-align: center;">2.25</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.45</td>
<td style="text-align: center;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: center;">10</td>
<td style="text-align: center;">2.17</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.45</td>
<td style="text-align: center;">0.03</td>
</tr>
<tr class="odd">
<td style="text-align: center;">11</td>
<td style="text-align: center;">2.12</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.50</td>
<td style="text-align: center;">0.03</td>
</tr>
<tr class="even">
<td style="text-align: center;">12</td>
<td style="text-align: center;">2.05</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.50</td>
<td style="text-align: center;">0.07</td>
</tr>
<tr class="odd">
<td style="text-align: center;">13</td>
<td style="text-align: center;">1.94</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.55</td>
<td style="text-align: center;">0.07</td>
</tr>
<tr class="even">
<td style="text-align: center;">14</td>
<td style="text-align: center;">1.92</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.60</td>
<td style="text-align: center;">0.07</td>
</tr>
<tr class="odd">
<td style="text-align: center;">15</td>
<td style="text-align: center;">1.60</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">13</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.65</td>
<td style="text-align: center;">0.07</td>
</tr>
<tr class="even">
<td style="text-align: center;">16</td>
<td style="text-align: center;">1.53</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">14</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.70</td>
<td style="text-align: center;">0.07</td>
</tr>
<tr class="odd">
<td style="text-align: center;">17</td>
<td style="text-align: center;">1.50</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.75</td>
<td style="text-align: center;">0.07</td>
</tr>
<tr class="even">
<td style="text-align: center;">18</td>
<td style="text-align: center;">1.37</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">0.75</td>
<td style="text-align: center;">0.10</td>
</tr>
<tr class="odd">
<td style="text-align: center;">19</td>
<td style="text-align: center;">1.31</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">16</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">0.80</td>
<td style="text-align: center;">0.10</td>
</tr>
<tr class="even">
<td style="text-align: center;">20</td>
<td style="text-align: center;">1.31</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">0.85</td>
<td style="text-align: center;">0.10</td>
</tr>
<tr class="odd">
<td style="text-align: center;">21</td>
<td style="text-align: center;">1.01</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">0.85</td>
<td style="text-align: center;">0.13</td>
</tr>
<tr class="even">
<td style="text-align: center;">22</td>
<td style="text-align: center;">0.92</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">0.85</td>
<td style="text-align: center;">0.17</td>
</tr>
<tr class="odd">
<td style="text-align: center;">23</td>
<td style="text-align: center;">0.88</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">0.85</td>
<td style="text-align: center;">0.20</td>
</tr>
<tr class="even">
<td style="text-align: center;">24</td>
<td style="text-align: center;">0.88</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">0.90</td>
<td style="text-align: center;">0.20</td>
</tr>
<tr class="odd">
<td style="text-align: center;">25</td>
<td style="text-align: center;">0.86</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">19</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">0.95</td>
<td style="text-align: center;">0.20</td>
</tr>
<tr class="even">
<td style="text-align: center;">26</td>
<td style="text-align: center;">0.82</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">19</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">0.95</td>
<td style="text-align: center;">0.23</td>
</tr>
<tr class="odd">
<td style="text-align: center;">27</td>
<td style="text-align: center;">0.55</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">19</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">0.95</td>
<td style="text-align: center;">0.27</td>
</tr>
<tr class="even">
<td style="text-align: center;">28</td>
<td style="text-align: center;">0.45</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.27</td>
</tr>
<tr class="odd">
<td style="text-align: center;">29</td>
<td style="text-align: center;">0.45</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.30</td>
</tr>
<tr class="even">
<td style="text-align: center;">30</td>
<td style="text-align: center;">0.43</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.33</td>
</tr>
<tr class="odd">
<td style="text-align: center;">31</td>
<td style="text-align: center;">0.38</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.37</td>
</tr>
<tr class="even">
<td style="text-align: center;">32</td>
<td style="text-align: center;">0.30</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.40</td>
</tr>
<tr class="odd">
<td style="text-align: center;">33</td>
<td style="text-align: center;">0.22</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">13</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.43</td>
</tr>
<tr class="even">
<td style="text-align: center;">34</td>
<td style="text-align: center;">0.15</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">14</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.47</td>
</tr>
<tr class="odd">
<td style="text-align: center;">35</td>
<td style="text-align: center;">0.05</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.50</td>
</tr>
<tr class="even">
<td style="text-align: center;">36</td>
<td style="text-align: center;">-0.03</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">16</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.53</td>
</tr>
<tr class="odd">
<td style="text-align: center;">37</td>
<td style="text-align: center;">-0.04</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.57</td>
</tr>
<tr class="even">
<td style="text-align: center;">38</td>
<td style="text-align: center;">-0.21</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.60</td>
</tr>
<tr class="odd">
<td style="text-align: center;">39</td>
<td style="text-align: center;">-0.23</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">19</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.63</td>
</tr>
<tr class="even">
<td style="text-align: center;">40</td>
<td style="text-align: center;">-0.30</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.67</td>
</tr>
<tr class="odd">
<td style="text-align: center;">41</td>
<td style="text-align: center;">-0.31</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">21</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.70</td>
</tr>
<tr class="even">
<td style="text-align: center;">42</td>
<td style="text-align: center;">-0.33</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">22</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.73</td>
</tr>
<tr class="odd">
<td style="text-align: center;">43</td>
<td style="text-align: center;">-0.38</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">23</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.77</td>
</tr>
<tr class="even">
<td style="text-align: center;">44</td>
<td style="text-align: center;">-0.49</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">24</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.80</td>
</tr>
<tr class="odd">
<td style="text-align: center;">45</td>
<td style="text-align: center;">-0.71</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">25</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.83</td>
</tr>
<tr class="even">
<td style="text-align: center;">46</td>
<td style="text-align: center;">-1.02</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">26</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.87</td>
</tr>
<tr class="odd">
<td style="text-align: center;">47</td>
<td style="text-align: center;">-1.07</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">27</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.90</td>
</tr>
<tr class="even">
<td style="text-align: center;">48</td>
<td style="text-align: center;">-1.27</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">28</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.93</td>
</tr>
<tr class="odd">
<td style="text-align: center;">49</td>
<td style="text-align: center;">-1.69</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">29</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">0.97</td>
</tr>
<tr class="even">
<td style="text-align: center;">50</td>
<td style="text-align: center;">-2.31</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">1.00</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The way to interpret this table is as follows. Each row contains the data for an “independent” set of calculations assuming the <code>test_value</code> in that row were the threshold value decided on for the data. The TP and FP numbers are cumulative counts of individuals who are classified as having the disease regardless of whether they actually do (TP) or don’t (FP). In other words, the <code>test_value</code> in that row <strong>indicates the biomarker value whereby ANY test measure equal to OR greater than that, will result in a positive test classification</strong>. Let’s pick a few rows out and perform the calculations manually. But before we do that, let’s quickly establish the denominators we need for these calculations - the total numbers of individuals with and without the disease. We can do that with a simple <code>table(sim_data$disease)</code> which tells us that there are <code>30</code> healthy individuals and <code>20</code> diseased individuals in this fictitious dataset.</p>
<p>Let’s look at the first row of data (<code>id</code> = <code>1</code>). This contains the highest recorded biomarker level and there is one individual with this value. This individual also happens to have the disease, so they are considered a TP. The TPR is then calculated as <code>1/20 = 0.05</code> and the FPR is calculated as <code>0/30 = 0</code>. This gives us the first point in our ROC curve so let’s plot that:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>coord_data <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(fpr, tpr)) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>  <span class="fu">xlab</span>(<span class="st">"FPR (1 - Specificity)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"TPR (Sensitivity)"</span>) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>Now let’s consider the second row of data (<code>id</code> = <code>2</code>). This individual also happens to have the disease, so they are considered a TP. Our cumulate TP count increases to <code>2</code>, but our FP count remains unchanged. The TPR is now calculated as <code>2/20 = 0.1</code> and the FPR remains as <code>0/30 = 0</code>. This gives us the second point in our ROC curve so we can now plot both:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>coord_data <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(fpr, tpr)) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="fu">xlab</span>(<span class="st">"FPR (1 - Specificity)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"TPR (Sensitivity)"</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>Now let’s skip ahead to <code>id</code> = <code>10</code> because I hope you’re starting to get a feel for things. This represents our first healthy individual. But because the biomarker value of <code>2.17</code> measured for this individual is the new threshold at play, they would be (mis)classified as having the disease. So their count contributes to the cumulative FP and FPR. Thus, the TPR is now calculated as <code>9/20 = 0.45</code> and the FPR as <code>1/30 = 0.03</code>. This gives us the 10th point in our ROC curve, so let’s plot these and all preceding points.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>coord_data <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(fpr, tpr)) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="fu">xlab</span>(<span class="st">"FPR (1 - Specificity)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"TPR (Sensitivity)"</span>) <span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>We can do the same for the first <code>20</code> observations:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>coord_data <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(fpr, tpr)) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>  <span class="fu">xlab</span>(<span class="st">"FPR (1 - Specificity)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"TPR (Sensitivity)"</span>) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>and all observations:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>coord_data <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(fpr, tpr)) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="fu">xlab</span>(<span class="st">"FPR (1 - Specificity)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"TPR (Sensitivity)"</span>) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>So that’s how you construct a ROC curve manually, but of course there’s no need to do this in practice. There are plenty of functions available to do this automatically for you.</p>
</section>
<section id="plotting-a-roc-curve-the-easy-way" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="plotting-a-roc-curve-the-easy-way"><span class="header-section-number">4.2</span> Plotting a ROC Curve the Easy Way</h3>
<p>Computing the ROC curve using the <code>pROC</code> package, is then really quite simple. The first way I will show you is with the out-of-the-box roc plot function that comes with <code>pROC</code>:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Compute ROC object</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(sim_data<span class="sc">$</span>disease, sim_data<span class="sc">$</span>test_values)</span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co"># Basic ROC Plot</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="fu">plot</span>(roc_obj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>As you can see it’s a functional, but no frills plot. We can embellish this, however, by including the 95% C.I.s and some annotation:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Extended ROC Plot  (base R)</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">plot.roc</span>(sim_data<span class="sc">$</span>disease, sim_data<span class="sc">$</span>test_values,</span>
<span id="cb12-3"><a href="#cb12-3"></a>                     <span class="at">main =</span> <span class="st">"Confidence intervals"</span>, <span class="at">percent =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-4"><a href="#cb12-4"></a>                     <span class="at">ci =</span> <span class="cn">TRUE</span>, <span class="co"># compute AUC (of AUC by default)</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>                     <span class="at">print.auc =</span> <span class="cn">TRUE</span>) <span class="co"># print the AUC (will contain the CI)</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>ci_obj <span class="ot">&lt;-</span> <span class="fu">ci.se</span>(roc_obj, <span class="co"># CI of sensitivity</span></span>
<span id="cb12-7"><a href="#cb12-7"></a>               <span class="at">specificities =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">5</span>)) <span class="co"># over a select set of specificities</span></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="fu">plot</span>(ci_obj, <span class="at">type =</span> <span class="st">"shape"</span>, <span class="at">col =</span> <span class="st">"#1c61b6AA"</span>) <span class="co"># plot as a blue shape</span></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="fu">plot</span>(<span class="fu">ci</span>(roc_obj, <span class="at">of =</span> <span class="st">"thresholds"</span>, <span class="at">thresholds =</span> <span class="st">"best"</span>)) <span class="co"># add one threshold</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>There is a second plotting option that leverages <code>ggplot()</code> functionality and while a little bit more coding effort is required, is considerably more flexible. That can generate something like:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Compute ROC object</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(sim_data<span class="sc">$</span>disease, sim_data<span class="sc">$</span>test_values)</span>
<span id="cb13-3"><a href="#cb13-3"></a></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="co"># Calculate CI for sensitivity across specificities</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>ci_obj <span class="ot">&lt;-</span> <span class="fu">ci.se</span>(roc_obj, </span>
<span id="cb13-6"><a href="#cb13-6"></a>                <span class="at">specificities =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.05</span>))</span>
<span id="cb13-7"><a href="#cb13-7"></a></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="co"># Extract CI data for plotting - CONVERT TO 1-SPECIFICITY</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>ci_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb13-10"><a href="#cb13-10"></a>  <span class="at">fpr =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">as.numeric</span>(<span class="fu">rownames</span>(ci_obj)),  <span class="co"># 1 - specificity</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>  <span class="at">lower =</span> ci_obj[, <span class="dv">1</span>],</span>
<span id="cb13-12"><a href="#cb13-12"></a>  <span class="at">upper =</span> ci_obj[, <span class="dv">3</span>]</span>
<span id="cb13-13"><a href="#cb13-13"></a>)</span>
<span id="cb13-14"><a href="#cb13-14"></a></span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="co"># Calculate AUC CI</span></span>
<span id="cb13-16"><a href="#cb13-16"></a>auc_ci <span class="ot">&lt;-</span> <span class="fu">ci.auc</span>(roc_obj)</span>
<span id="cb13-17"><a href="#cb13-17"></a></span>
<span id="cb13-18"><a href="#cb13-18"></a><span class="co"># Create label</span></span>
<span id="cb13-19"><a href="#cb13-19"></a>auc_label <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"AUC = "</span>, <span class="fu">round</span>(<span class="fu">auc</span>(roc_obj), <span class="dv">3</span>),</span>
<span id="cb13-20"><a href="#cb13-20"></a>                    <span class="st">"</span><span class="sc">\n</span><span class="st">95% CI: "</span>, <span class="fu">round</span>(auc_ci[<span class="dv">1</span>], <span class="dv">3</span>), </span>
<span id="cb13-21"><a href="#cb13-21"></a>                    <span class="st">" - "</span>, <span class="fu">round</span>(auc_ci[<span class="dv">3</span>], <span class="dv">3</span>))</span>
<span id="cb13-22"><a href="#cb13-22"></a></span>
<span id="cb13-23"><a href="#cb13-23"></a><span class="co"># Find optimal threshold (Youden's index)</span></span>
<span id="cb13-24"><a href="#cb13-24"></a>best_coords <span class="ot">&lt;-</span> <span class="fu">coords</span>(roc_obj, <span class="st">"best"</span>, <span class="at">ret =</span> <span class="fu">c</span>(<span class="st">"threshold"</span>, <span class="st">"sensitivity"</span>, <span class="st">"specificity"</span>))</span>
<span id="cb13-25"><a href="#cb13-25"></a></span>
<span id="cb13-26"><a href="#cb13-26"></a><span class="co"># Plot</span></span>
<span id="cb13-27"><a href="#cb13-27"></a><span class="fu">ggroc</span>(roc_obj, <span class="at">legacy.axes =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb13-28"><a href="#cb13-28"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> ci_data, </span>
<span id="cb13-29"><a href="#cb13-29"></a>              <span class="fu">aes</span>(<span class="at">x =</span> fpr, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper),  <span class="co"># Use fpr (1-specificity)</span></span>
<span id="cb13-30"><a href="#cb13-30"></a>              <span class="at">fill =</span> <span class="st">"#1c61b6AA"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb13-31"><a href="#cb13-31"></a>  <span class="fu">annotate</span>(<span class="st">"point"</span>, <span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span> best_coords<span class="sc">$</span>specificity, <span class="at">y =</span> best_coords<span class="sc">$</span>sensitivity,  <span class="co"># Convert here too</span></span>
<span id="cb13-32"><a href="#cb13-32"></a>           <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb13-33"><a href="#cb13-33"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.75</span>, <span class="at">y =</span> <span class="fl">0.5</span>, <span class="at">label =</span> auc_label, <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb13-34"><a href="#cb13-34"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span> best_coords<span class="sc">$</span>specificity <span class="sc">+</span> <span class="fl">0.12</span>,  <span class="co"># Adjust position</span></span>
<span id="cb13-35"><a href="#cb13-35"></a>           <span class="at">y =</span> best_coords<span class="sc">$</span>sensitivity <span class="sc">-</span> <span class="fl">0.06</span>,</span>
<span id="cb13-36"><a href="#cb13-36"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Threshold ="</span>, <span class="fu">round</span>(best_coords<span class="sc">$</span>threshold, <span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb13-37"><a href="#cb13-37"></a>  <span class="fu">xlab</span>(<span class="st">"FPR (1 - Specificity)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"TPR (Sensitivity)"</span>) <span class="sc">+</span></span>
<span id="cb13-38"><a href="#cb13-38"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>That looks even nicer to my eye. In this plot I have also included and annotated the optimal threshold(s) based on the <a href="https://en.wikipedia.org/wiki/Youden%27s_J_statistic">Youden index</a> - a popular statistic for evaluating ROC performance. In this case there are two (equivalent) optimum thresholds at each of biomarker values <code>0.84</code> and <code>1.16</code>. Remember when I said earlier that a test value of <code>1</code> might count for a sensible threshold…</p>
</section>
<section id="other-bits-and-pieces" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="other-bits-and-pieces"><span class="header-section-number">4.3</span> Other Bits and Pieces</h3>
<p>I mentioned the Youden Index above. If this is something you’re after it’s simple to extract this as follows:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Get optimal cutpoint based on youden Index</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="fu">coords</span>(roc_obj, <span class="at">x =</span> <span class="st">"best"</span>, <span class="at">best.method =</span> <span class="st">"youden"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3"></a>      <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: center;">threshold</th>
<th style="text-align: center;">specificity</th>
<th style="text-align: center;">sensitivity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0.84</td>
<td style="text-align: center;">0.8</td>
<td style="text-align: center;">0.95</td>
</tr>
<tr class="even">
<td style="text-align: center;">1.16</td>
<td style="text-align: center;">0.9</td>
<td style="text-align: center;">0.85</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>And likewise, for the AUC:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Get AUC</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="fu">auc</span>(roc_obj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Area under the curve: 0.9383</code></pre>
</div>
</div>
</section>
</section>
<section id="wrap-up" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="wrap-up"><span class="header-section-number">5</span> Wrap-Up</h2>
<p>I hope I’ve shown you how ROC curves are a foundational tool in clinical decision analytics. But as importantly I hope I’ve given you some insight into how they are created. Understanding the calculations underlying their visualisation will place you in better stead for interpreting a ROC curve in the broader clinical context of your patient’s care.</p>
<p>Until next month…</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="pgseye/Weekly_Stats_Tips" data-repo-id="R_kgDOKvfOfQ" data-category="General" data-category-id="DIC_kwDOKvfOfc4CbFWq" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb17" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb17-1"><a href="#cb17-1"></a><span class="co">---</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="an">title:</span><span class="co"> "ROC Curves in Clinical Decision-Making: A Gentle Introduction"</span></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="an">date:</span><span class="co"> 2026-04-24</span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="an">categories:</span><span class="co"> [concept, code]</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="an">image:</span><span class="co"> "images/roc.png"</span></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="an">description:</span><span class="co"> "What they are and how they're used."</span></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="co">---</span></span>
<span id="cb17-8"><a href="#cb17-8"></a></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="fu">## Introduction</span></span>
<span id="cb17-10"><a href="#cb17-10"></a></span>
<span id="cb17-11"><a href="#cb17-11"></a>When clinicians or researchers develop a diagnostic test - say, a blood biomarker for detecting a disease - they’re really asking:</span>
<span id="cb17-12"><a href="#cb17-12"></a></span>
<span id="cb17-13"><a href="#cb17-13"></a><span class="at">&gt; "How well does this test distinguish sick from healthy?"</span></span>
<span id="cb17-14"><a href="#cb17-14"></a></span>
<span id="cb17-15"><a href="#cb17-15"></a>In being able to answer that question, we ultimately care about two things:</span>
<span id="cb17-16"><a href="#cb17-16"></a></span>
<span id="cb17-17"><a href="#cb17-17"></a><span class="ss">-   </span>**Sensitivity** — the ability to correctly identify the sick (true positives).</span>
<span id="cb17-18"><a href="#cb17-18"></a></span>
<span id="cb17-19"><a href="#cb17-19"></a><span class="ss">-   </span>**Specificity** — the ability to correctly identify the healthy (true negatives).</span>
<span id="cb17-20"><a href="#cb17-20"></a></span>
<span id="cb17-21"><a href="#cb17-21"></a>But diagnostic tests often give a continuous value (e.g., concentration of a biomarker). So we have to choose a threshold: values above are positive and values below are negative. So where should we set this cut-off?</span>
<span id="cb17-22"><a href="#cb17-22"></a></span>
<span id="cb17-23"><a href="#cb17-23"></a>Enter the receiver-operator characteristic (ROC) curve. This is a tool that evaluates how **sensitivity and specificity trade off as we vary a test threshold of interest**. In addition, the area under the ROC curve gives an idea about the benefit of using the test in question - the greater the area the more accurate the test. In today's post we'll talk about ROC curves and how they're used to aid in clinical-decision making. At first blush the ROC curve can appear quite confusing and difficult to interpret, but I'm hoping by the end of this post I'll have demystified it enough that you can comfortably employ one in your next diagnostic study.</span>
<span id="cb17-24"><a href="#cb17-24"></a></span>
<span id="cb17-25"><a href="#cb17-25"></a>------------------------------------------------------------------------</span>
<span id="cb17-26"><a href="#cb17-26"></a></span>
<span id="cb17-27"><a href="#cb17-27"></a><span class="fu">## A Bit of History: From Radar to Medicine</span></span>
<span id="cb17-28"><a href="#cb17-28"></a></span>
<span id="cb17-29"><a href="#cb17-29"></a>Interestingly, ROC curves were first developed during World War II by electrical and radar engineers in the UK. They were trying to distinguish real aircraft returns from noise and clutter on radar screens. The question was essentially the same: given a signal, how do we choose a threshold to decide "target present" vs "target absent" while balancing false alarms and misses? After the war, this framework migrated into signal detection theory and then into statistics and also to multiple areas within medicine. The ROC curve has also been applied in other research fields including biometrics, forecasting of natural hazards, meteorology, model performance assessment, and is increasingly used in machine learning and data mining research. As you can tell, it has wide utility in decision making, but it's ultimately based on a relatively simple idea.</span>
<span id="cb17-30"><a href="#cb17-30"></a></span>
<span id="cb17-31"><a href="#cb17-31"></a>------------------------------------------------------------------------</span>
<span id="cb17-32"><a href="#cb17-32"></a></span>
<span id="cb17-33"><a href="#cb17-33"></a><span class="fu">## Key Concepts</span></span>
<span id="cb17-34"><a href="#cb17-34"></a></span>
<span id="cb17-35"><a href="#cb17-35"></a><span class="fu">### The Confusion Matrix (2×2 Table)</span></span>
<span id="cb17-36"><a href="#cb17-36"></a></span>
<span id="cb17-37"><a href="#cb17-37"></a>At the heart of ROC analysis is the confusion matrix, a simple 2×2 table that compares the results of a diagnostic test against the true disease status. For any chosen threshold that classifies a continuous test result as positive or negative, each individual falls into one of four categories. True positives (TP) are patients who truly have the disease and whose test result is positive, while true negatives (TN) are disease-free individuals correctly identified as negative by the test. Errors arise in two ways: false positives (FP) occur when healthy individuals are incorrectly labelled as having the disease, and false negatives (FN) occur when diseased individuals are missed by the test.</span>
<span id="cb17-38"><a href="#cb17-38"></a></span>
<span id="cb17-39"><a href="#cb17-39"></a>These four quantities form the basis of nearly all diagnostic performance measures. In particular, sensitivity (also called the true positive rate) is the proportion of diseased individuals correctly detected by the test. Specificity is the proportion of non-diseased individuals correctly classified. ROC curves are constructed by repeatedly recalculating these quantities as the decision threshold moves, tracing out how sensitivity increases at the cost of decreasing specificity, **for every possible test threshold**.</span>
<span id="cb17-40"><a href="#cb17-40"></a></span>
<span id="cb17-41"><a href="#cb17-41"></a>|                   | **Disease Present** | **Disease Absent**  |</span>
<span id="cb17-42"><a href="#cb17-42"></a>|-------------------|---------------------|---------------------|</span>
<span id="cb17-43"><a href="#cb17-43"></a>| **Test Positive** | True Positive (TP)  | False Positive (FP) |</span>
<span id="cb17-44"><a href="#cb17-44"></a>| **Test Negative** | False Negative (FN) | True Negative (TN)  |</span>
<span id="cb17-45"><a href="#cb17-45"></a></span>
<span id="cb17-46"><a href="#cb17-46"></a>&lt;br&gt;</span>
<span id="cb17-47"><a href="#cb17-47"></a></span>
<span id="cb17-48"><a href="#cb17-48"></a>So from this simple table, we calculate:</span>
<span id="cb17-49"><a href="#cb17-49"></a></span>
<span id="cb17-50"><a href="#cb17-50"></a><span class="ss">-   </span>Sensitivity (True Positive Rate) = TP / (TP + FN)</span>
<span id="cb17-51"><a href="#cb17-51"></a></span>
<span id="cb17-52"><a href="#cb17-52"></a><span class="ss">-   </span>Specificity = TN / (TN + FP)</span>
<span id="cb17-53"><a href="#cb17-53"></a></span>
<span id="cb17-54"><a href="#cb17-54"></a><span class="ss">-   </span>False Positive Rate = 1 – Specificity = FP / (FP + TN)</span>
<span id="cb17-55"><a href="#cb17-55"></a></span>
<span id="cb17-56"><a href="#cb17-56"></a><span class="fu">### ROC Curve</span></span>
<span id="cb17-57"><a href="#cb17-57"></a></span>
<span id="cb17-58"><a href="#cb17-58"></a>To construct a ROC curve it's then a relatively simple case of plotting Sensitivity (True Positive Rate) vs False Positive Rate (FPR) at every possible threshold. A perfect test would go straight up the y-axis to <span class="in">`1.0`</span> then straight across with a resulting Area Under Curve (AUC) = <span class="in">`1.0`</span>. In contrast, a test no better than chance would follow the diagonal with an AUC = <span class="in">`0.5`</span>. In practice, most clinical tests fall somewhere in between.</span>
<span id="cb17-59"><a href="#cb17-59"></a></span>
<span id="cb17-60"><a href="#cb17-60"></a>Let's illustrate this in practice. I will use the <span class="in">`pROC`</span> package in <span class="in">`R`</span> for the analyses in this post, but there are other ROC creation packages available in <span class="in">`R`</span>, and your mileage will vary depending on what you want. I find <span class="in">`pROC`</span> fairly simple but if you are after something with a little more flexibility than I would encourage you to also explore the <span class="in">`cutpointR`</span> package - I know that it offers more options in the calculation of optimal cutpoints. I have not personally used the <span class="in">`ROCR`</span> package but this is another one that is available for these type of analyses.</span>
<span id="cb17-61"><a href="#cb17-61"></a></span>
<span id="cb17-62"><a href="#cb17-62"></a><span class="fu">## A Simulated Example</span></span>
<span id="cb17-63"><a href="#cb17-63"></a></span>
<span id="cb17-64"><a href="#cb17-64"></a>To help you to better understand what a ROC curve is doing in calculations under the hood, I have simulated some data (<span class="in">`50`</span> observations) containing a continuous biomarker (<span class="in">`test_values`</span>) and a binary <span class="in">`disease`</span> status. Let's take a look at the first few rows of the simulated data:</span>
<span id="cb17-65"><a href="#cb17-65"></a></span>
<span id="cb17-66"><a href="#cb17-66"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb17-67"><a href="#cb17-67"></a><span class="in">knitr::opts_chunk$set(</span></span>
<span id="cb17-68"><a href="#cb17-68"></a><span class="in">  echo = TRUE,</span></span>
<span id="cb17-69"><a href="#cb17-69"></a><span class="in">  message = FALSE,</span></span>
<span id="cb17-70"><a href="#cb17-70"></a><span class="in">  warning = FALSE</span></span>
<span id="cb17-71"><a href="#cb17-71"></a><span class="in">)</span></span>
<span id="cb17-72"><a href="#cb17-72"></a><span class="in">```</span></span>
<span id="cb17-73"><a href="#cb17-73"></a></span>
<span id="cb17-76"><a href="#cb17-76"></a><span class="in">```{r}</span></span>
<span id="cb17-77"><a href="#cb17-77"></a><span class="fu">library</span>(pROC)</span>
<span id="cb17-78"><a href="#cb17-78"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb17-79"><a href="#cb17-79"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb17-80"><a href="#cb17-80"></a></span>
<span id="cb17-81"><a href="#cb17-81"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb17-82"><a href="#cb17-82"></a></span>
<span id="cb17-83"><a href="#cb17-83"></a><span class="co"># Simulate data</span></span>
<span id="cb17-84"><a href="#cb17-84"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb17-85"><a href="#cb17-85"></a></span>
<span id="cb17-86"><a href="#cb17-86"></a><span class="co"># Disease status: 0 = healthy, 1 = diseased</span></span>
<span id="cb17-87"><a href="#cb17-87"></a>disease <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.4</span>)</span>
<span id="cb17-88"><a href="#cb17-88"></a></span>
<span id="cb17-89"><a href="#cb17-89"></a><span class="co"># Continuous test: diseased group has higher values</span></span>
<span id="cb17-90"><a href="#cb17-90"></a>test_values <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>disease, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb17-91"><a href="#cb17-91"></a></span>
<span id="cb17-92"><a href="#cb17-92"></a>sim_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(disease, test_values) <span class="sc">|&gt;</span> </span>
<span id="cb17-93"><a href="#cb17-93"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(test_values))</span>
<span id="cb17-94"><a href="#cb17-94"></a></span>
<span id="cb17-95"><a href="#cb17-95"></a><span class="co"># Peek at data</span></span>
<span id="cb17-96"><a href="#cb17-96"></a><span class="fu">head</span>(sim_data) <span class="sc">|&gt;</span> </span>
<span id="cb17-97"><a href="#cb17-97"></a>    <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb17-98"><a href="#cb17-98"></a><span class="in">```</span></span>
<span id="cb17-99"><a href="#cb17-99"></a></span>
<span id="cb17-100"><a href="#cb17-100"></a>Now, let's plot these data:</span>
<span id="cb17-101"><a href="#cb17-101"></a></span>
<span id="cb17-102"><a href="#cb17-102"></a><span class="in">```{r, fig.width=8, fig.height=4, out.width="80%"}</span></span>
<span id="cb17-103"><a href="#cb17-103"></a><span class="in">ggplot(sim_data, aes(x = factor(disease), y = test_values)) +</span></span>
<span id="cb17-104"><a href="#cb17-104"></a><span class="in">  geom_point(aes(color = factor(disease))) +</span></span>
<span id="cb17-105"><a href="#cb17-105"></a><span class="in">  theme_bw(base_size = 20)</span></span>
<span id="cb17-106"><a href="#cb17-106"></a><span class="in">```</span></span>
<span id="cb17-107"><a href="#cb17-107"></a></span>
<span id="cb17-108"><a href="#cb17-108"></a>What can you see from this plot? Well, the obvious thing we can appreciate is that if you have this fictitious disease, the biomarker test value tends to be higher compared to if you don't. Ahhh, you might think - that is a useful characteristic to have if you want the test to be able to discriminate between those with and those without the disease. And you'd be right of course. But you might also be able to appreciate that because there is overlap in test values across disease states, no single test value is going to be <span class="in">`100%`</span> accurate.</span>
<span id="cb17-109"><a href="#cb17-109"></a></span>
<span id="cb17-110"><a href="#cb17-110"></a>For the sake of the illustration let's set an initial test value cut-off (threshold) at <span class="in">`0`</span>, like so:</span>
<span id="cb17-111"><a href="#cb17-111"></a></span>
<span id="cb17-112"><a href="#cb17-112"></a><span class="in">```{r, fig.width=8, fig.height=4, out.width="80%"}</span></span>
<span id="cb17-113"><a href="#cb17-113"></a><span class="in">ggplot(sim_data, aes(x = factor(disease), y = test_values)) +</span></span>
<span id="cb17-114"><a href="#cb17-114"></a><span class="in">  geom_point(aes(color = factor(disease))) +</span></span>
<span id="cb17-115"><a href="#cb17-115"></a><span class="in">  geom_hline(color = "red", yintercept = 0) +</span></span>
<span id="cb17-116"><a href="#cb17-116"></a><span class="in">  theme_bw(base_size = 20)</span></span>
<span id="cb17-117"><a href="#cb17-117"></a><span class="in">```</span></span>
<span id="cb17-118"><a href="#cb17-118"></a></span>
<span id="cb17-119"><a href="#cb17-119"></a>In interpreting this and the following plot, keep in mind the following:</span>
<span id="cb17-120"><a href="#cb17-120"></a></span>
<span id="cb17-121"><a href="#cb17-121"></a><span class="at">&gt; We are diagnosing everyone with a test value ABOVE the red line - regardless of their actual status - as having the disease.</span></span>
<span id="cb17-122"><a href="#cb17-122"></a></span>
<span id="cb17-123"><a href="#cb17-123"></a><span class="at">&gt; We are calling everyone with a test value BELOW the red line - regardless of their actual status - as being healthy.</span></span>
<span id="cb17-124"><a href="#cb17-124"></a></span>
<span id="cb17-125"><a href="#cb17-125"></a>With a threshold set at <span class="in">`0`</span> we will correctly identify *all* of those with the disease, so our true positive rate (TPR) will be <span class="in">`100%`</span>, but you'll note that we will also misclassify about half of those without the disease - our false positive rate (FPR) will be about <span class="in">`50%`</span>. Not good enough you might think - we don't want to diagnose a bunch of people as sick when they're not, because then we might subject them to unnecessary treatment. Instead, let's make the cut-off for our biomarker higher and see if that helps.</span>
<span id="cb17-126"><a href="#cb17-126"></a></span>
<span id="cb17-127"><a href="#cb17-127"></a>So now we raise the cut-off to <span class="in">`1`</span>:</span>
<span id="cb17-128"><a href="#cb17-128"></a></span>
<span id="cb17-129"><a href="#cb17-129"></a><span class="in">```{r, fig.width=8, fig.height=4, out.width="80%"}</span></span>
<span id="cb17-130"><a href="#cb17-130"></a><span class="in">ggplot(sim_data, aes(x = factor(disease), y = test_values)) +</span></span>
<span id="cb17-131"><a href="#cb17-131"></a><span class="in">  geom_point(aes(color = factor(disease))) +</span></span>
<span id="cb17-132"><a href="#cb17-132"></a><span class="in">  geom_hline(color = "red", yintercept = 1) +</span></span>
<span id="cb17-133"><a href="#cb17-133"></a><span class="in">  theme_bw(base_size = 20)</span></span>
<span id="cb17-134"><a href="#cb17-134"></a><span class="in">```</span></span>
<span id="cb17-135"><a href="#cb17-135"></a></span>
<span id="cb17-136"><a href="#cb17-136"></a>We no longer correctly identify all those with the disease (TPR = <span class="in">`85%`</span>), but we also don't incorrectly misdiagnose as many healthy individuals either (FPR = <span class="in">`13%`</span>). Only clinical judgement can ultimately decide whether this is a more acceptable decision threshold but certainly it better balances misclassification error.</span>
<span id="cb17-137"><a href="#cb17-137"></a></span>
<span id="cb17-138"><a href="#cb17-138"></a>The reason I am showing you these plots is that they form the basis of a ROC curve. If you created such a plot for every test value (threshold) in the dataset, calculating the TPR and FPR in each case (and collating each as a paired set of coordinates), then this is all the information you would need to plot the resulting ROC curve.</span>
<span id="cb17-139"><a href="#cb17-139"></a></span>
<span id="cb17-140"><a href="#cb17-140"></a><span class="fu">### Plotting a ROC Curve by First Principles</span></span>
<span id="cb17-141"><a href="#cb17-141"></a></span>
<span id="cb17-142"><a href="#cb17-142"></a>Let's do just that now. I am going to take you through this process step by step to illustrate (and demystify) how a ROC curve is constructed. To make my life a little easier I will use the <span class="in">`coords()`</span> function in the <span class="in">`pROC`</span> package to calculate the TPR and FPR at every test value. I will also list the test value itself, as well as disease status an the cumulative number of TP's and FP's - these are helpful to understand how the rates are generated. To aid interpretation biomarker test values are first ranked in order from highest to lowest. The resulting data are as follows:</span>
<span id="cb17-143"><a href="#cb17-143"></a></span>
<span id="cb17-146"><a href="#cb17-146"></a><span class="in">```{r}</span></span>
<span id="cb17-147"><a href="#cb17-147"></a><span class="co"># Compute ROC object</span></span>
<span id="cb17-148"><a href="#cb17-148"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(sim_data<span class="sc">$</span>disease, sim_data<span class="sc">$</span>test_values)</span>
<span id="cb17-149"><a href="#cb17-149"></a><span class="co"># Calculate threshold data</span></span>
<span id="cb17-150"><a href="#cb17-150"></a>coord_data <span class="ot">&lt;-</span>  <span class="fu">coords</span>(roc_obj, <span class="at">ret =</span> <span class="fu">c</span>(<span class="st">"threshold"</span>, <span class="st">"tp"</span>, <span class="st">"fp"</span>, <span class="st">"tpr"</span>, <span class="st">"fpr"</span>))</span>
<span id="cb17-151"><a href="#cb17-151"></a><span class="co"># Merge in simulated data</span></span>
<span id="cb17-152"><a href="#cb17-152"></a>coord_data <span class="ot">&lt;-</span>  coord_data <span class="sc">|&gt;</span> </span>
<span id="cb17-153"><a href="#cb17-153"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(threshold)) <span class="sc">|&gt;</span> </span>
<span id="cb17-154"><a href="#cb17-154"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb17-155"><a href="#cb17-155"></a>coord_data <span class="ot">&lt;-</span>  <span class="fu">cbind</span>(coord_data, sim_data) <span class="sc">|&gt;</span> </span>
<span id="cb17-156"><a href="#cb17-156"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb17-157"><a href="#cb17-157"></a>  <span class="fu">select</span>(id, test_values, disease, tp, fp, tpr, fpr)</span>
<span id="cb17-158"><a href="#cb17-158"></a><span class="co"># Print</span></span>
<span id="cb17-159"><a href="#cb17-159"></a>coord_data <span class="sc">|&gt;</span> </span>
<span id="cb17-160"><a href="#cb17-160"></a>      <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb17-161"><a href="#cb17-161"></a><span class="in">```</span></span>
<span id="cb17-162"><a href="#cb17-162"></a></span>
<span id="cb17-163"><a href="#cb17-163"></a>The way to interpret this table is as follows. Each row contains the data for an "independent" set of calculations assuming the <span class="in">`test_value`</span> in that row were the threshold value decided on for the data. The TP and FP numbers are cumulative counts of individuals who are classified as having the disease regardless of whether they actually do (TP) or don't (FP). In other words, the <span class="in">`test_value`</span> in that row **indicates the biomarker value whereby ANY test measure equal to OR greater than that, will result in a positive test classification**. Let's pick a few rows out and perform the calculations manually. But before we do that, let's quickly establish the denominators we need for these calculations - the total numbers of individuals with and without the disease. We can do that with a simple <span class="in">`table(sim_data$disease)`</span> which tells us that there are <span class="in">`30`</span> healthy individuals and <span class="in">`20`</span> diseased individuals in this fictitious dataset.</span>
<span id="cb17-164"><a href="#cb17-164"></a></span>
<span id="cb17-165"><a href="#cb17-165"></a>Let's look at the first row of data (<span class="in">`id`</span> = <span class="in">`1`</span>). This contains the highest recorded biomarker level and there is one individual with this value. This individual also happens to have the disease, so they are considered a TP. The TPR is then calculated as <span class="in">`1/20 = 0.05`</span> and the FPR is calculated as <span class="in">`0/30 = 0`</span>. This gives us the first point in our ROC curve so let's plot that:</span>
<span id="cb17-166"><a href="#cb17-166"></a></span>
<span id="cb17-167"><a href="#cb17-167"></a><span class="in">```{r, fig.width=8, fig.height=6, out.width="80%"}</span></span>
<span id="cb17-168"><a href="#cb17-168"></a><span class="in">coord_data |&gt; </span></span>
<span id="cb17-169"><a href="#cb17-169"></a><span class="in">  slice(1) |&gt; </span></span>
<span id="cb17-170"><a href="#cb17-170"></a><span class="in">  ggplot(aes(fpr, tpr)) +</span></span>
<span id="cb17-171"><a href="#cb17-171"></a><span class="in">  geom_point(size = 3) +</span></span>
<span id="cb17-172"><a href="#cb17-172"></a><span class="in">  xlab("FPR (1 - Specificity)") + ylab("TPR (Sensitivity)") +</span></span>
<span id="cb17-173"><a href="#cb17-173"></a><span class="in">  scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +</span></span>
<span id="cb17-174"><a href="#cb17-174"></a><span class="in">  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +</span></span>
<span id="cb17-175"><a href="#cb17-175"></a><span class="in">  theme_bw(base_size = 20)</span></span>
<span id="cb17-176"><a href="#cb17-176"></a><span class="in">```</span></span>
<span id="cb17-177"><a href="#cb17-177"></a></span>
<span id="cb17-178"><a href="#cb17-178"></a>Now let's consider the second row of data (<span class="in">`id`</span> = <span class="in">`2`</span>). This individual also happens to have the disease, so they are considered a TP. Our cumulate TP count increases to <span class="in">`2`</span>, but our FP count remains unchanged. The TPR is now calculated as <span class="in">`2/20 = 0.1`</span> and the FPR remains as <span class="in">`0/30 = 0`</span>. This gives us the second point in our ROC curve so we can now plot both:</span>
<span id="cb17-179"><a href="#cb17-179"></a></span>
<span id="cb17-180"><a href="#cb17-180"></a><span class="in">```{r, fig.width=8, fig.height=6, out.width="80%"}</span></span>
<span id="cb17-181"><a href="#cb17-181"></a><span class="in">coord_data |&gt; </span></span>
<span id="cb17-182"><a href="#cb17-182"></a><span class="in">  slice(1:2) |&gt; </span></span>
<span id="cb17-183"><a href="#cb17-183"></a><span class="in">  ggplot(aes(fpr, tpr)) +</span></span>
<span id="cb17-184"><a href="#cb17-184"></a><span class="in">  geom_point(size = 3) +</span></span>
<span id="cb17-185"><a href="#cb17-185"></a><span class="in">  xlab("FPR (1 - Specificity)") + ylab("TPR (Sensitivity)") +</span></span>
<span id="cb17-186"><a href="#cb17-186"></a><span class="in">  scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +</span></span>
<span id="cb17-187"><a href="#cb17-187"></a><span class="in">  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +</span></span>
<span id="cb17-188"><a href="#cb17-188"></a><span class="in">  theme_bw(base_size = 20)</span></span>
<span id="cb17-189"><a href="#cb17-189"></a><span class="in">```</span></span>
<span id="cb17-190"><a href="#cb17-190"></a></span>
<span id="cb17-191"><a href="#cb17-191"></a>Now let's skip ahead to <span class="in">`id`</span> = <span class="in">`10`</span> because I hope you're starting to get a feel for things. This represents our first healthy individual. But because the biomarker value of <span class="in">`2.17`</span> measured for this individual is the new threshold at play, they would be (mis)classified as having the disease. So their count contributes to the cumulative FP and FPR. Thus, the TPR is now calculated as <span class="in">`9/20 = 0.45`</span> and the FPR as <span class="in">`1/30 = 0.03`</span>. This gives us the 10th point in our ROC curve, so let's plot these and all preceding points.</span>
<span id="cb17-192"><a href="#cb17-192"></a></span>
<span id="cb17-193"><a href="#cb17-193"></a><span class="in">```{r, fig.width=8, fig.height=6, out.width="80%"}</span></span>
<span id="cb17-194"><a href="#cb17-194"></a><span class="in">coord_data |&gt; </span></span>
<span id="cb17-195"><a href="#cb17-195"></a><span class="in">  slice(1:10) |&gt;  </span></span>
<span id="cb17-196"><a href="#cb17-196"></a><span class="in">  ggplot(aes(fpr, tpr)) +</span></span>
<span id="cb17-197"><a href="#cb17-197"></a><span class="in">  geom_point(size = 3) +</span></span>
<span id="cb17-198"><a href="#cb17-198"></a><span class="in">  xlab("FPR (1 - Specificity)") + ylab("TPR (Sensitivity)") +</span></span>
<span id="cb17-199"><a href="#cb17-199"></a><span class="in">  scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +</span></span>
<span id="cb17-200"><a href="#cb17-200"></a><span class="in">  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +</span></span>
<span id="cb17-201"><a href="#cb17-201"></a><span class="in">  theme_bw(base_size = 20)</span></span>
<span id="cb17-202"><a href="#cb17-202"></a><span class="in">```</span></span>
<span id="cb17-203"><a href="#cb17-203"></a></span>
<span id="cb17-204"><a href="#cb17-204"></a>We can do the same for the first <span class="in">`20`</span> observations:</span>
<span id="cb17-205"><a href="#cb17-205"></a></span>
<span id="cb17-206"><a href="#cb17-206"></a><span class="in">```{r, fig.width=8, fig.height=6, out.width="80%"}</span></span>
<span id="cb17-207"><a href="#cb17-207"></a><span class="in">coord_data |&gt; </span></span>
<span id="cb17-208"><a href="#cb17-208"></a><span class="in">  slice(1:20) |&gt; </span></span>
<span id="cb17-209"><a href="#cb17-209"></a><span class="in">  ggplot(aes(fpr, tpr)) +</span></span>
<span id="cb17-210"><a href="#cb17-210"></a><span class="in">  geom_point(size = 3) +</span></span>
<span id="cb17-211"><a href="#cb17-211"></a><span class="in">  xlab("FPR (1 - Specificity)") + ylab("TPR (Sensitivity)") +</span></span>
<span id="cb17-212"><a href="#cb17-212"></a><span class="in">  scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +</span></span>
<span id="cb17-213"><a href="#cb17-213"></a><span class="in">  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +</span></span>
<span id="cb17-214"><a href="#cb17-214"></a><span class="in">  theme_bw(base_size = 20)</span></span>
<span id="cb17-215"><a href="#cb17-215"></a><span class="in">```</span></span>
<span id="cb17-216"><a href="#cb17-216"></a></span>
<span id="cb17-217"><a href="#cb17-217"></a>and all observations:</span>
<span id="cb17-218"><a href="#cb17-218"></a></span>
<span id="cb17-219"><a href="#cb17-219"></a><span class="in">```{r, fig.width=8, fig.height=6, out.width="80%"}</span></span>
<span id="cb17-220"><a href="#cb17-220"></a><span class="in">coord_data |&gt; </span></span>
<span id="cb17-221"><a href="#cb17-221"></a><span class="in">  ggplot(aes(fpr, tpr)) +</span></span>
<span id="cb17-222"><a href="#cb17-222"></a><span class="in">  geom_point(size = 3) +</span></span>
<span id="cb17-223"><a href="#cb17-223"></a><span class="in">  xlab("FPR (1 - Specificity)") + ylab("TPR (Sensitivity)") +</span></span>
<span id="cb17-224"><a href="#cb17-224"></a><span class="in">  scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +</span></span>
<span id="cb17-225"><a href="#cb17-225"></a><span class="in">  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) +</span></span>
<span id="cb17-226"><a href="#cb17-226"></a><span class="in">  theme_bw(base_size = 20)</span></span>
<span id="cb17-227"><a href="#cb17-227"></a><span class="in">```</span></span>
<span id="cb17-228"><a href="#cb17-228"></a></span>
<span id="cb17-229"><a href="#cb17-229"></a>So that's how you construct a ROC curve manually, but of course there's no need to do this in practice. There are plenty of functions available to do this automatically for you. </span>
<span id="cb17-230"><a href="#cb17-230"></a></span>
<span id="cb17-231"><a href="#cb17-231"></a><span class="fu">### Plotting a ROC Curve the Easy Way</span></span>
<span id="cb17-232"><a href="#cb17-232"></a></span>
<span id="cb17-233"><a href="#cb17-233"></a>Computing the ROC curve using the <span class="in">`pROC`</span> package, is then really quite simple. The first way I will show you is with the out-of-the-box roc plot function that comes with <span class="in">`pROC`</span>:</span>
<span id="cb17-234"><a href="#cb17-234"></a></span>
<span id="cb17-237"><a href="#cb17-237"></a><span class="in">```{r}</span></span>
<span id="cb17-238"><a href="#cb17-238"></a><span class="co"># Compute ROC object</span></span>
<span id="cb17-239"><a href="#cb17-239"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(sim_data<span class="sc">$</span>disease, sim_data<span class="sc">$</span>test_values)</span>
<span id="cb17-240"><a href="#cb17-240"></a></span>
<span id="cb17-241"><a href="#cb17-241"></a><span class="co"># Basic ROC Plot</span></span>
<span id="cb17-242"><a href="#cb17-242"></a><span class="fu">plot</span>(roc_obj)</span>
<span id="cb17-243"><a href="#cb17-243"></a><span class="in">```</span></span>
<span id="cb17-244"><a href="#cb17-244"></a></span>
<span id="cb17-245"><a href="#cb17-245"></a>As you can see it's a functional, but no frills plot. We can embellish this, however, by including the 95% C.I.s and some annotation:</span>
<span id="cb17-246"><a href="#cb17-246"></a></span>
<span id="cb17-249"><a href="#cb17-249"></a><span class="in">```{r}</span></span>
<span id="cb17-250"><a href="#cb17-250"></a><span class="co"># Extended ROC Plot  (base R)</span></span>
<span id="cb17-251"><a href="#cb17-251"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">plot.roc</span>(sim_data<span class="sc">$</span>disease, sim_data<span class="sc">$</span>test_values,</span>
<span id="cb17-252"><a href="#cb17-252"></a>                     <span class="at">main =</span> <span class="st">"Confidence intervals"</span>, <span class="at">percent =</span> <span class="cn">TRUE</span>,</span>
<span id="cb17-253"><a href="#cb17-253"></a>                     <span class="at">ci =</span> <span class="cn">TRUE</span>, <span class="co"># compute AUC (of AUC by default)</span></span>
<span id="cb17-254"><a href="#cb17-254"></a>                     <span class="at">print.auc =</span> <span class="cn">TRUE</span>) <span class="co"># print the AUC (will contain the CI)</span></span>
<span id="cb17-255"><a href="#cb17-255"></a>ci_obj <span class="ot">&lt;-</span> <span class="fu">ci.se</span>(roc_obj, <span class="co"># CI of sensitivity</span></span>
<span id="cb17-256"><a href="#cb17-256"></a>               <span class="at">specificities =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">5</span>)) <span class="co"># over a select set of specificities</span></span>
<span id="cb17-257"><a href="#cb17-257"></a><span class="fu">plot</span>(ci_obj, <span class="at">type =</span> <span class="st">"shape"</span>, <span class="at">col =</span> <span class="st">"#1c61b6AA"</span>) <span class="co"># plot as a blue shape</span></span>
<span id="cb17-258"><a href="#cb17-258"></a><span class="fu">plot</span>(<span class="fu">ci</span>(roc_obj, <span class="at">of =</span> <span class="st">"thresholds"</span>, <span class="at">thresholds =</span> <span class="st">"best"</span>)) <span class="co"># add one threshold</span></span>
<span id="cb17-259"><a href="#cb17-259"></a><span class="in">```</span></span>
<span id="cb17-260"><a href="#cb17-260"></a></span>
<span id="cb17-261"><a href="#cb17-261"></a>There is a second plotting option that leverages <span class="in">`ggplot()`</span> functionality and while a little bit more coding effort is required, is considerably more flexible. That can generate something like:</span>
<span id="cb17-262"><a href="#cb17-262"></a></span>
<span id="cb17-265"><a href="#cb17-265"></a><span class="in">```{r}</span></span>
<span id="cb17-266"><a href="#cb17-266"></a><span class="co"># Compute ROC object</span></span>
<span id="cb17-267"><a href="#cb17-267"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(sim_data<span class="sc">$</span>disease, sim_data<span class="sc">$</span>test_values)</span>
<span id="cb17-268"><a href="#cb17-268"></a></span>
<span id="cb17-269"><a href="#cb17-269"></a><span class="co"># Calculate CI for sensitivity across specificities</span></span>
<span id="cb17-270"><a href="#cb17-270"></a>ci_obj <span class="ot">&lt;-</span> <span class="fu">ci.se</span>(roc_obj, </span>
<span id="cb17-271"><a href="#cb17-271"></a>                <span class="at">specificities =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.05</span>))</span>
<span id="cb17-272"><a href="#cb17-272"></a></span>
<span id="cb17-273"><a href="#cb17-273"></a><span class="co"># Extract CI data for plotting - CONVERT TO 1-SPECIFICITY</span></span>
<span id="cb17-274"><a href="#cb17-274"></a>ci_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb17-275"><a href="#cb17-275"></a>  <span class="at">fpr =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">as.numeric</span>(<span class="fu">rownames</span>(ci_obj)),  <span class="co"># 1 - specificity</span></span>
<span id="cb17-276"><a href="#cb17-276"></a>  <span class="at">lower =</span> ci_obj[, <span class="dv">1</span>],</span>
<span id="cb17-277"><a href="#cb17-277"></a>  <span class="at">upper =</span> ci_obj[, <span class="dv">3</span>]</span>
<span id="cb17-278"><a href="#cb17-278"></a>)</span>
<span id="cb17-279"><a href="#cb17-279"></a></span>
<span id="cb17-280"><a href="#cb17-280"></a><span class="co"># Calculate AUC CI</span></span>
<span id="cb17-281"><a href="#cb17-281"></a>auc_ci <span class="ot">&lt;-</span> <span class="fu">ci.auc</span>(roc_obj)</span>
<span id="cb17-282"><a href="#cb17-282"></a></span>
<span id="cb17-283"><a href="#cb17-283"></a><span class="co"># Create label</span></span>
<span id="cb17-284"><a href="#cb17-284"></a>auc_label <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"AUC = "</span>, <span class="fu">round</span>(<span class="fu">auc</span>(roc_obj), <span class="dv">3</span>),</span>
<span id="cb17-285"><a href="#cb17-285"></a>                    <span class="st">"</span><span class="sc">\n</span><span class="st">95% CI: "</span>, <span class="fu">round</span>(auc_ci[<span class="dv">1</span>], <span class="dv">3</span>), </span>
<span id="cb17-286"><a href="#cb17-286"></a>                    <span class="st">" - "</span>, <span class="fu">round</span>(auc_ci[<span class="dv">3</span>], <span class="dv">3</span>))</span>
<span id="cb17-287"><a href="#cb17-287"></a></span>
<span id="cb17-288"><a href="#cb17-288"></a><span class="co"># Find optimal threshold (Youden's index)</span></span>
<span id="cb17-289"><a href="#cb17-289"></a>best_coords <span class="ot">&lt;-</span> <span class="fu">coords</span>(roc_obj, <span class="st">"best"</span>, <span class="at">ret =</span> <span class="fu">c</span>(<span class="st">"threshold"</span>, <span class="st">"sensitivity"</span>, <span class="st">"specificity"</span>))</span>
<span id="cb17-290"><a href="#cb17-290"></a></span>
<span id="cb17-291"><a href="#cb17-291"></a><span class="co"># Plot</span></span>
<span id="cb17-292"><a href="#cb17-292"></a><span class="fu">ggroc</span>(roc_obj, <span class="at">legacy.axes =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb17-293"><a href="#cb17-293"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> ci_data, </span>
<span id="cb17-294"><a href="#cb17-294"></a>              <span class="fu">aes</span>(<span class="at">x =</span> fpr, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper),  <span class="co"># Use fpr (1-specificity)</span></span>
<span id="cb17-295"><a href="#cb17-295"></a>              <span class="at">fill =</span> <span class="st">"#1c61b6AA"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb17-296"><a href="#cb17-296"></a>  <span class="fu">annotate</span>(<span class="st">"point"</span>, <span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span> best_coords<span class="sc">$</span>specificity, <span class="at">y =</span> best_coords<span class="sc">$</span>sensitivity,  <span class="co"># Convert here too</span></span>
<span id="cb17-297"><a href="#cb17-297"></a>           <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb17-298"><a href="#cb17-298"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.75</span>, <span class="at">y =</span> <span class="fl">0.5</span>, <span class="at">label =</span> auc_label, <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb17-299"><a href="#cb17-299"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span> best_coords<span class="sc">$</span>specificity <span class="sc">+</span> <span class="fl">0.12</span>,  <span class="co"># Adjust position</span></span>
<span id="cb17-300"><a href="#cb17-300"></a>           <span class="at">y =</span> best_coords<span class="sc">$</span>sensitivity <span class="sc">-</span> <span class="fl">0.06</span>,</span>
<span id="cb17-301"><a href="#cb17-301"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Threshold ="</span>, <span class="fu">round</span>(best_coords<span class="sc">$</span>threshold, <span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb17-302"><a href="#cb17-302"></a>  <span class="fu">xlab</span>(<span class="st">"FPR (1 - Specificity)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"TPR (Sensitivity)"</span>) <span class="sc">+</span></span>
<span id="cb17-303"><a href="#cb17-303"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span>
<span id="cb17-304"><a href="#cb17-304"></a><span class="in">```</span></span>
<span id="cb17-305"><a href="#cb17-305"></a></span>
<span id="cb17-306"><a href="#cb17-306"></a>That looks even nicer to my eye. In this plot I have also included and annotated the optimal threshold(s) based on the <span class="co">[</span><span class="ot">Youden index</span><span class="co">](https://en.wikipedia.org/wiki/Youden%27s_J_statistic)</span> - a popular statistic for evaluating ROC performance. In this case there are two (equivalent) optimum thresholds at each of biomarker values <span class="in">`0.84`</span> and <span class="in">`1.16`</span>. Remember when I said earlier that a test value of <span class="in">`1`</span> might count for a sensible threshold...</span>
<span id="cb17-307"><a href="#cb17-307"></a></span>
<span id="cb17-308"><a href="#cb17-308"></a><span class="fu">### Other Bits and Pieces</span></span>
<span id="cb17-309"><a href="#cb17-309"></a></span>
<span id="cb17-310"><a href="#cb17-310"></a>I mentioned the Youden Index above. If this is something you're after it's simple to extract this as follows:</span>
<span id="cb17-311"><a href="#cb17-311"></a></span>
<span id="cb17-314"><a href="#cb17-314"></a><span class="in">```{r}</span></span>
<span id="cb17-315"><a href="#cb17-315"></a><span class="co"># Get optimal cutpoint based on youden Index</span></span>
<span id="cb17-316"><a href="#cb17-316"></a><span class="fu">coords</span>(roc_obj, <span class="at">x =</span> <span class="st">"best"</span>, <span class="at">best.method =</span> <span class="st">"youden"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-317"><a href="#cb17-317"></a>      <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb17-318"><a href="#cb17-318"></a><span class="in">```</span></span>
<span id="cb17-319"><a href="#cb17-319"></a></span>
<span id="cb17-320"><a href="#cb17-320"></a>And likewise, for the AUC:</span>
<span id="cb17-321"><a href="#cb17-321"></a></span>
<span id="cb17-324"><a href="#cb17-324"></a><span class="in">```{r}</span></span>
<span id="cb17-325"><a href="#cb17-325"></a><span class="co"># Get AUC</span></span>
<span id="cb17-326"><a href="#cb17-326"></a><span class="fu">auc</span>(roc_obj)</span>
<span id="cb17-327"><a href="#cb17-327"></a><span class="in">```</span></span>
<span id="cb17-328"><a href="#cb17-328"></a></span>
<span id="cb17-329"><a href="#cb17-329"></a><span class="fu">## Wrap-Up</span></span>
<span id="cb17-330"><a href="#cb17-330"></a></span>
<span id="cb17-331"><a href="#cb17-331"></a>I hope I've shown you how ROC curves are a foundational tool in clinical decision analytics. But as importantly I hope I've given you some insight into how they are created. Understanding the calculations underlying their visualisation will place you in better stead for interpreting a ROC curve in the broader clinical context of your patient's care.</span>
<span id="cb17-332"><a href="#cb17-332"></a></span>
<span id="cb17-333"><a href="#cb17-333"></a>Until next month...</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>