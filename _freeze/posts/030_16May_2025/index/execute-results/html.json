{
  "hash": "daef68c63db764ddccfdd188b7f825e7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Model Prediction/Visualisation <br> 4. Generalised Linear Models (GLMs)\"\ndate: 2025-05-16\ncategories: [code, concept, modelling, visualisation]\nimage: \"images/plot.png\"\ndescription: \"Know what you are predicting when using GLMs.\"\n---\n\n\n\nThe examples that I've used so far in this series of posts on model prediction and visualisation have all involved a continuous outcome measure (birthweight measured in grams), and so accordingly we have used a simple linear (regression) model. Nothing difficult there. But does anything change in the visualisation process when the models become a little more advanced?\n\nWell, the answer is both yes and no (sorry!). While the coding fundamentals largely remain the same, there are some additional considerations in the visualisation of GLM's (as well as mixed and survival models which we will discuss in future posts) that you need to be aware of and better still, understand.\n\nSo let's get to it. We'll again use the familiar `birthwt` dataset, this time to predict from, and visualise a logistic regression model. Our outcome variable (`low`) is now a dichotomised version of birthweight, with `1` assigned to values less than `2500` grams and `0` to values that are greater.\n\n# Assuming Linear Relationship in the Log-Odds\n\nIn the first instance we'll assume a linear relationship of maternal age with the log-odds of low birthweight and our model may be written as:\n\n`mod <-  glm(low ~ age, family = \"binomial\", data = birthwt)`\n\nIf you recall in the last post, we excluded the observation for the oldest mother having the heaviest baby, and we will do that again here.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(splines)\nlibrary(gtsummary)\ndata(birthwt, package = \"MASS\")\n# Model\nmod <-  glm(low ~ age, family = \"binomial\", data = subset(birthwt, age < 40))\ntbl_regression(mod, intercept = T)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"cfoilweiqc\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#cfoilweiqc table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#cfoilweiqc thead, #cfoilweiqc tbody, #cfoilweiqc tfoot, #cfoilweiqc tr, #cfoilweiqc td, #cfoilweiqc th {\n  border-style: none;\n}\n\n#cfoilweiqc p {\n  margin: 0;\n  padding: 0;\n}\n\n#cfoilweiqc .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#cfoilweiqc .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#cfoilweiqc .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#cfoilweiqc .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#cfoilweiqc .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#cfoilweiqc .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#cfoilweiqc .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#cfoilweiqc .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#cfoilweiqc .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#cfoilweiqc .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#cfoilweiqc .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#cfoilweiqc .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#cfoilweiqc .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#cfoilweiqc .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#cfoilweiqc .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#cfoilweiqc .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#cfoilweiqc .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#cfoilweiqc .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#cfoilweiqc .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cfoilweiqc .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#cfoilweiqc .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#cfoilweiqc .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#cfoilweiqc .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cfoilweiqc .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#cfoilweiqc .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#cfoilweiqc .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#cfoilweiqc .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cfoilweiqc .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#cfoilweiqc .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#cfoilweiqc .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#cfoilweiqc .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#cfoilweiqc .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#cfoilweiqc .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cfoilweiqc .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#cfoilweiqc .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cfoilweiqc .gt_left {\n  text-align: left;\n}\n\n#cfoilweiqc .gt_center {\n  text-align: center;\n}\n\n#cfoilweiqc .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#cfoilweiqc .gt_font_normal {\n  font-weight: normal;\n}\n\n#cfoilweiqc .gt_font_bold {\n  font-weight: bold;\n}\n\n#cfoilweiqc .gt_font_italic {\n  font-style: italic;\n}\n\n#cfoilweiqc .gt_super {\n  font-size: 65%;\n}\n\n#cfoilweiqc .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#cfoilweiqc .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#cfoilweiqc .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#cfoilweiqc .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#cfoilweiqc .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#cfoilweiqc .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#cfoilweiqc .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#cfoilweiqc .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#cfoilweiqc div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"label\"><span data-qmd-base64=\"KipDaGFyYWN0ZXJpc3RpYyoq\"><span class='gt_from_md'><strong>Characteristic</strong></span></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"estimate\"><span data-qmd-base64=\"Kipsb2coT1IpKio=\"><span class='gt_from_md'><strong>log(OR)</strong></span></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"conf.low\"><span data-qmd-base64=\"Kio5NSUgQ0kqKg==\"><span class='gt_from_md'><strong>95% CI</strong></span></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"p.value\"><span data-qmd-base64=\"KipwLXZhbHVlKio=\"><span class='gt_from_md'><strong>p-value</strong></span></span></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">(Intercept)</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">0.32</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">-1.1, 1.8</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.7</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">age</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-0.05</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">-0.11, 0.01</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.14</td></tr>\n  </tbody>\n  <tfoot class=\"gt_sourcenotes\">\n    <tr>\n      <td class=\"gt_sourcenote\" colspan=\"4\"><span data-qmd-base64=\"QWJicmV2aWF0aW9uczogQ0kgPSBDb25maWRlbmNlIEludGVydmFsLCBPUiA9IE9kZHMgUmF0aW8=\"><span class='gt_from_md'>Abbreviations: CI = Confidence Interval, OR = Odds Ratio</span></span></td>\n    </tr>\n  </tfoot>\n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n\nThe model suggests that there is an \\~ `0.05` reduction in the log-odds of being low birthweight with each year increase in maternal age.\n\n## Visualising Log-Odds of the Outcome\n\nBut how do we visualise the relationship between maternal age and the log-odds of low birthweight? And then compare the model fit? Well, the first part of that is not as straightforward as creating a simple scatterplot of the association between a continuous covariate and a continuous outcome, but it's certainly not intractable. We need to do a little bit of legwork to get what we want, and in this case the simplest solution is to calculate the observed proportions of low birthweight aggregated across quantiles of maternal age, then convert those proportions to log-odds using the `qlogis()` function. The code to do this is shown below.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Categorise maternal age into 5 quantiles (could make this more or less)\nbirthwt <- birthwt |>\n    mutate(age_5 = cut_number(age, 5))\n# Proportion of women with low birthweight babies in each quantile of maternal age\ngrouped_dat <- birthwt |> \n  group_by(age_5) |> \n  count(low) |> \n  pivot_wider(names_from = low,\n              values_from = n) |> \n  mutate(obs_props = `1`/(`0` + `1`),\n         obs_logodds = qlogis(obs_props))\n# Take the middle age of each quantile range and bind to data\nvec = c(16.5, 20, 22.5, 26, 36.5)\ngrouped_dat <-  cbind(\"age_5_mid\" = vec, grouped_dat)\n```\n:::\n\n\n\nWe can then plot that data as:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_logodds)) +\n  geom_point(size = 3) +\n  scale_y_continuous(limits = c(-2, 0), breaks = seq(-2, 0, by = 0.2)) + \n  scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +\n  xlab(\"Maternal Age\") + ylab(\"Log-odds of Low Birthweight\") +\n  theme_bw(base_size = 20)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=1152}\n:::\n:::\n\n\n\nAnd superimpose the model predictions as:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnewdf <-  expand.grid(age = seq(15, 45, by = 5))\nnewdf <-  newdf |> \n    mutate(pred_logodds = predict(mod, newdata = newdf))\nggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_logodds)) +\n  geom_point(size = 3) +\n  geom_line(data = newdf, aes(x = age, y = pred_logodds)) +\n  scale_y_continuous(limits = c(-2, 0), breaks = seq(-2, 0, by = 0.2)) + \n  scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +\n  xlab(\"Maternal Age (yrs)\") + ylab(\"Predicted Log-odds of Low Birthweight\") +\n  theme_bw(base_size = 20)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=1152}\n:::\n:::\n\n\n\nLet's recap what we have done, and why, here. We've taken the **observed** proportions of low birthweight babies, converted those values to equivalent **observed** log-odds and plotted those alongside the model **predicted** log-odds as a visual aid to assess model fit. Now, I'm not suggesting that this is something you do every time you fit a logistic regression model, but it gives you some idea of the basis in the model fitting - which is always in the log-odds of the outcome. And in its default state, this assumes a linear association of the covariate with that outcome form.\n\n## Visualising Probability of the Outcome\n\nI would like to point out at this stage that it's not much extra work to plot the **predicted** probabilities (of low birthweight) - the outcome that you are as a general rule, more interested in knowing about. We already calculated the **observed** proportions, so the only small tweak we now need to make in predicting from our model to ensure we are generating **predicted** probabilities, is to include `type = \"response\"` in our prediction call:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnewdf <-  expand.grid(age = seq(15, 45, by = 5))\nnewdf <-  newdf |> \n    mutate(pred_probs = predict(mod, newdata = newdf, type = \"response\"))\nggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_props)) +\n  geom_point(size = 3) +\n  geom_line(data = newdf, aes(x = age, y = pred_probs)) +\n  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) + \n  scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +\n  xlab(\"Maternal Age (yrs)\") + ylab(\"Predicted Probability of Low Birthweight\") +\n  theme_bw(base_size = 20)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=1152}\n:::\n:::\n\n\n\nNote that in contrast to the (assumed linear) log-odds, the association between a continuous covariate and the predicted probability is now **expected** to be non-linear.\n\n# Allowing Non-Linear Relationship in the Log-Odds\n\nLet us now repeat all of those steps but this time relaxing the linearity assumption of maternal age with the log-odds of having a low-birthweight baby. We can do that by simply fitting a restricted cubic spline term on maternal age - given the few data points, we won't go too heavy-handed on the wiggliness and risk over-fitting, by specifying `df = 2` (i.e. one internal knot) instead of the usual `df = 3`. Our new model then becomes:\n\n`mod2 <-  glm(low ~ ns(age, 2), family = \"binomial\", data = birthwt)`\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Model\nmod2 <-  glm(low ~ ns(age,2), family = \"binomial\", data = subset(birthwt, age < 40))\ntbl_regression(mod2, intercept = T)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"xkcuswtzdi\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#xkcuswtzdi table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#xkcuswtzdi thead, #xkcuswtzdi tbody, #xkcuswtzdi tfoot, #xkcuswtzdi tr, #xkcuswtzdi td, #xkcuswtzdi th {\n  border-style: none;\n}\n\n#xkcuswtzdi p {\n  margin: 0;\n  padding: 0;\n}\n\n#xkcuswtzdi .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#xkcuswtzdi .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#xkcuswtzdi .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#xkcuswtzdi .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#xkcuswtzdi .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#xkcuswtzdi .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xkcuswtzdi .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#xkcuswtzdi .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#xkcuswtzdi .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#xkcuswtzdi .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#xkcuswtzdi .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#xkcuswtzdi .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#xkcuswtzdi .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#xkcuswtzdi .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#xkcuswtzdi .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#xkcuswtzdi .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#xkcuswtzdi .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#xkcuswtzdi .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#xkcuswtzdi .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xkcuswtzdi .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#xkcuswtzdi .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#xkcuswtzdi .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#xkcuswtzdi .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xkcuswtzdi .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#xkcuswtzdi .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#xkcuswtzdi .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xkcuswtzdi .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xkcuswtzdi .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#xkcuswtzdi .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xkcuswtzdi .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#xkcuswtzdi .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xkcuswtzdi .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#xkcuswtzdi .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xkcuswtzdi .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#xkcuswtzdi .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xkcuswtzdi .gt_left {\n  text-align: left;\n}\n\n#xkcuswtzdi .gt_center {\n  text-align: center;\n}\n\n#xkcuswtzdi .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#xkcuswtzdi .gt_font_normal {\n  font-weight: normal;\n}\n\n#xkcuswtzdi .gt_font_bold {\n  font-weight: bold;\n}\n\n#xkcuswtzdi .gt_font_italic {\n  font-style: italic;\n}\n\n#xkcuswtzdi .gt_super {\n  font-size: 65%;\n}\n\n#xkcuswtzdi .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#xkcuswtzdi .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#xkcuswtzdi .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#xkcuswtzdi .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#xkcuswtzdi .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#xkcuswtzdi .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#xkcuswtzdi .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#xkcuswtzdi .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#xkcuswtzdi div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"label\"><span data-qmd-base64=\"KipDaGFyYWN0ZXJpc3RpYyoq\"><span class='gt_from_md'><strong>Characteristic</strong></span></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"estimate\"><span data-qmd-base64=\"Kipsb2coT1IpKio=\"><span class='gt_from_md'><strong>log(OR)</strong></span></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"conf.low\"><span data-qmd-base64=\"Kio5NSUgQ0kqKg==\"><span class='gt_from_md'><strong>95% CI</strong></span></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"p.value\"><span data-qmd-base64=\"KipwLXZhbHVlKio=\"><span class='gt_from_md'><strong>p-value</strong></span></span></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">(Intercept)</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-0.82</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">-1.9, 0.18</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.12</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">ns(age, 2)</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\"><br /></td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\"><br /></td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><br /></td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">    ns(age, 2)1</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-0.25</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">-2.4, 2.0</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.8</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">    ns(age, 2)2</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-1.5</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">-3.4, 0.04</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.078</td></tr>\n  </tbody>\n  <tfoot class=\"gt_sourcenotes\">\n    <tr>\n      <td class=\"gt_sourcenote\" colspan=\"4\"><span data-qmd-base64=\"QWJicmV2aWF0aW9uczogQ0kgPSBDb25maWRlbmNlIEludGVydmFsLCBPUiA9IE9kZHMgUmF0aW8=\"><span class='gt_from_md'>Abbreviations: CI = Confidence Interval, OR = Odds Ratio</span></span></td>\n    </tr>\n  </tfoot>\n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n\n## Visualising Log-Odds of the Outcome\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnewdf2 <-  expand.grid(age = seq(15, 45, by = 0.5))\nnewdf2 <-  newdf2 |> \n    mutate(pred_logodds = predict(mod2, newdata = newdf2))\nggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_logodds)) +\n  geom_point(size = 3) +\n  geom_line(data = newdf2, aes(x = age, y = pred_logodds)) +\n  scale_y_continuous(limits = c(-2, 0), breaks = seq(-2, 0, by = 0.2)) + \n  scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +\n  xlab(\"Maternal Age (yrs)\") + ylab(\"Predicted Log-odds of Low Birthweight\") +\n  theme_bw(base_size = 20)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=1152}\n:::\n:::\n\n\n\n## Visualising Probability of the Outcome\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnewdf2 <-  expand.grid(age = seq(15, 45, by = 0.5))\nnewdf2 <-  newdf2 |> \n    mutate(pred_probs = predict(mod2, newdata = newdf2, type = \"response\"))\nggplot(data = grouped_dat, aes(x = age_5_mid, y = obs_props)) +\n  geom_point(size = 3) +\n  geom_line(data = newdf2, aes(x = age, y = pred_probs)) +\n  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.2)) + \n  scale_x_continuous(limits = c(15, 45), breaks = seq(15, 45, by = 5)) +\n  xlab(\"Maternal Age (yrs)\") + ylab(\"Predicted Probability of Low Birthweight\") +\n  theme_bw(base_size = 20)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=1152}\n:::\n:::\n\n\n\nA likelihood ratio test of the two models suggests the spline term doesn’t actually add any statistical value and can be removed. In any case, the takeaway here is to note that visualising the non-linear functional form is no more difficult than the default linear case. Also take note that with the introduction of a spline term, **both the predicted log-odds and probabilities** no longer assume a linear association with the covariate of interest.\n\nThat's probably enough on this particular topic - I will hopefully see you again in two weeks for more prediction/visualisation tips.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}